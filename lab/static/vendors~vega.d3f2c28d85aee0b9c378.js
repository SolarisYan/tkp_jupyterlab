(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"+aST":function(e,t,n){"use strict";(function(e){var r=n("J29t");function i(t){return typeof e==="function"&&Object(r["isFunction"])(e.isBuffer)?e.isBuffer(t):false}t["a"]=function(e,t){var n=t&&t.property?Object(r["field"])(t.property):r["identity"];return Object(r["isObject"])(e)&&!i(e)?a(n(e)):n(JSON.parse(e))};function a(e,t){return t&&t.copy?JSON.parse(JSON.stringify(e)):e}}).call(this,n("tjlA").Buffer)},"1uk8":function(e,t){},"7nn0":function(e,t,n){"use strict";(function(e){var r=n("J29t");function i(t){return typeof e==="function"&&Object(r["isFunction"])(e.isBuffer)?e.isBuffer(t):false}t["a"]=function(e,t){var n=t&&t.property?Object(r["field"])(t.property):r["identity"];return Object(r["isObject"])(e)&&!i(e)?a(n(e)):n(JSON.parse(e))};function a(e,t){return t&&t.copy?JSON.parse(JSON.stringify(e)):e}}).call(this,n("tjlA").Buffer)},"9koE":function(e){e.exports={name:"vega-lite",author:'Jeffrey Heer, Dominik Moritz, Kanit "Ham" Wongsuphasawat',version:"2.6.0",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-Lite is a concise high-level language for interactive visualization.",main:"build/vega-lite.js",unpkg:"build/vega-lite.min.js",jsdelivr:"build/vega-lite.min.js",module:"build/src/index",types:"build/src/index.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{prebuild:"mkdir -p build/src",build:"npm run build:only","build:only":"tsc && rollup -c",postbuild:"uglifyjs build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && npm run schema","build:examples":"npm run data && TZ=America/Los_Angeles scripts/build-examples.sh","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"bundle exec jekyll build -q && scripts/generate-toc","build:site":"tsc -p site && webpack --config site/webpack.config.js","build:versions":"scripts/update-version.sh","check:examples":"scripts/check-examples.sh","check:schema":"scripts/check-schema.sh",clean:"rm -rf build && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' -type f -delete",data:"rsync -r node_modules/vega-datasets/data/* data",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",preschema:"npm run prebuild",schema:"node --stack-size=1200 ./node_modules/.bin/ts-json-schema-generator --path tsconfig.json --type TopLevelSpec > build/vega-lite-schema.json && npm run renameschema && cp build/vega-lite-schema.json _data/",renameschema:"scripts/rename-schema.sh",presite:"npm run prebuild && npm run data && npm run build:site && npm run build:toc && npm run build:versions && scripts/create-example-pages",site:"bundle exec jekyll serve --incremental",lint:"tslint -p . -e 'package.json'",test:"jest test/ && npm run lint && npm run schema && jest examples/ && npm run test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":'TZ=America/Los_Angeles TS_NODE_COMPILER_OPTIONS=\'{"module":"commonjs"}\' wdio wdio.conf.js',"test:runtime:generate":"rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true npm run test:runtime","watch:build":"npm run build:only && concurrently --kill-others -n Typescript,Rollup 'tsc -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Webpack 'tsc -p site --watch' 'webpack --config site/webpack.config.js --mode development --watch'","watch:test":"jest --watch"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^4.1.4","@types/d3":"^5.0.0","@types/highlight.js":"^9.12.3","@types/jest":"^23.1.1","@types/mkdirp":"^0.5.2","@types/node":"^9.0.0","@types/webdriverio":"^4.10.2",ajv:"^6.5.1",chai:"^4.1.2",cheerio:"^1.0.0-rc.2",chromedriver:"^2.40.0",codecov:"^3.0.2",concurrently:"^3.6.0",d3:"^5.5.0","highlight.js":"^9.12.0",jest:"^23.1.0",mkdirp:"^0.5.1",rollup:"^0.59.4","rollup-plugin-commonjs":"^9.1.3","rollup-plugin-json":"^3.0.0","rollup-plugin-node-resolve":"^3.3.0","rollup-plugin-sourcemaps":"^0.4.2","source-map-support":"^0.5.6","svg2png-many":"^0.0.7","ts-jest":"^22.4.6","ts-json-schema-generator":"^0.28.0","ts-node":"^6.1.1",tslint:"5.10.0","tslint-eslint-rules":"^5.3.1",typescript:"^2.9.2","uglify-js":"^3.4.1",vega:"^4.0.0-rc.3","vega-datasets":"^1.19.0","vega-embed":"^3.16.0","vega-tooltip":"^0.11.0","wdio-chromedriver-service":"^0.1.3","wdio-dot-reporter":"0.0.9","wdio-mocha-framework":"^0.5.13","wdio-static-server-service":"^1.0.1",webdriverio:"^4.13.0",webpack:"^4.12.0","webpack-cli":"^3.0.8","yaml-front-matter":"^4.0.0"},dependencies:{"@types/json-stable-stringify":"^1.0.32","json-stable-stringify":"^1.0.1",tslib:"^1.9.2","vega-event-selector":"^2.0.0","vega-typings":"^0.3.17","vega-util":"^1.7.0",yargs:"^11.0.0"},jest:{transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["node_modules","test-runtime","<rootDir>/build","_site","src"],coverageDirectory:"./coverage/",collectCoverage:false}}},EawG:function(e,t,n){"use strict";(function(e){var r=n("J29t");function i(t){return typeof e==="function"&&Object(r["isFunction"])(e.isBuffer)?e.isBuffer(t):false}t["a"]=function(e,t){var n=t&&t.property?Object(r["field"])(t.property):r["identity"];return Object(r["isObject"])(e)&&!i(e)?a(n(e)):n(JSON.parse(e))};function a(e,t){return t&&t.copy?JSON.parse(JSON.stringify(e)):e}}).call(this,n("tjlA").Buffer)},G3Yf:function(e,t,n){"use strict";(function(e){var r=n("J29t");function i(t){return typeof e==="function"&&Object(r["isFunction"])(e.isBuffer)?e.isBuffer(t):false}t["a"]=function(e,t){var n=t&&t.property?Object(r["field"])(t.property):r["identity"];return Object(r["isObject"])(e)&&!i(e)?a(n(e)):n(JSON.parse(e))};function a(e,t){return t&&t.copy?JSON.parse(JSON.stringify(e)):e}}).call(this,n("tjlA").Buffer)},WtOp:function(e,t,n){"use strict";(function(e){var r=n("J29t");function i(t){return typeof e==="function"&&Object(r["isFunction"])(e.isBuffer)?e.isBuffer(t):false}t["a"]=function(e,t){var n=t&&t.property?Object(r["field"])(t.property):r["identity"];return Object(r["isObject"])(e)&&!i(e)?a(n(e)):n(JSON.parse(e))};function a(e,t){return t&&t.copy?JSON.parse(JSON.stringify(e)):e}}).call(this,n("tjlA").Buffer)},ZYJ9:function(e,t){function n(e,t){t=t||{};var n=JSON.stringify([1],null,a(t,"indent",2)).slice(2,-3);var r=a(t,"margins",false);var o=n===""?Infinity:a(t,"maxLength",80);return function e(t,a,u){if(t&&typeof t.toJSON==="function"){t=t.toJSON()}var s=JSON.stringify(t);if(s===undefined){return s}var l=o-a.length-u;if(s.length<=l){var f=i(s,r);if(f.length<=l){return f}}if(typeof t==="object"&&t!==null){var c=a+n;var d=[];var h;var p=function(e,t){return t===e.length-1?0:1};if(Array.isArray(t)){for(var v=0;v<t.length;v++){d.push(e(t[v],c,p(t,v))||"null")}h="[]"}else{Object.keys(t).forEach(function(n,r,i){var a=JSON.stringify(n)+": ";var o=e(t[n],c,a.length+p(i,r));if(o!==undefined){d.push(a+o)}});h="{}"}if(d.length>0){return[h[0],n+d.join(",\n"+c),h[1]].join("\n"+a)}}return s}(e,"",0)}var r=/("(?:[^\\"]|\\.)*")|[:,\][}{]/g;function i(e,t){var n=t?" ":"";var i={"{":"{"+n,"[":"["+n,"}":n+"}","]":n+"]",",":", ",":":": "};return e.replace(r,function(e,t){return t?e:i[e]})}function a(e,t,n){return t in e?e[t]:n}e.exports=n},etOl:function(e,t,n){"use strict";n.r(t);var r={};n.r(r);n.d(r,"aggregate",function(){return un});n.d(r,"bin",function(){return ln});n.d(r,"collect",function(){return dn});n.d(r,"compare",function(){return pn});n.d(r,"countpattern",function(){return gn});n.d(r,"cross",function(){return bn});n.d(r,"density",function(){return An});n.d(r,"expression",function(){return Dn});n.d(r,"extent",function(){return Pn});n.d(r,"facet",function(){return Fn});n.d(r,"field",function(){return Un});n.d(r,"filter",function(){return Vn});n.d(r,"flatten",function(){return Gn});n.d(r,"fold",function(){return Yn});n.d(r,"formula",function(){return Jn});n.d(r,"generate",function(){return Zn});n.d(r,"impute",function(){return nr});n.d(r,"joinaggregate",function(){return ur});n.d(r,"key",function(){return lr});n.d(r,"load",function(){return cr});n.d(r,"lookup",function(){return hr});n.d(r,"multiextent",function(){return vr});n.d(r,"multivalues",function(){return mr});n.d(r,"params",function(){return br});n.d(r,"pivot",function(){return _r});n.d(r,"prefacet",function(){return jr});n.d(r,"project",function(){return Er});n.d(r,"proxy",function(){return Tr});n.d(r,"relay",function(){return Nr});n.d(r,"sample",function(){return Cr});n.d(r,"sequence",function(){return Rr});n.d(r,"sieve",function(){return Ir});n.d(r,"subflow",function(){return Ln});n.d(r,"tupleindex",function(){return qr});n.d(r,"values",function(){return Wr});n.d(r,"window",function(){return Jr});var i={};n.r(i);n.d(i,"bound",function(){return Hl});n.d(i,"identifier",function(){return Yl});n.d(i,"mark",function(){return Ql});n.d(i,"overlap",function(){return ef});n.d(i,"render",function(){return ff});n.d(i,"viewlayout",function(){return jf});var a={};n.r(a);n.d(a,"axisticks",function(){return fc});n.d(a,"datajoin",function(){return dc});n.d(a,"encode",function(){return gc});n.d(a,"legendentries",function(){return Dc});n.d(a,"linkpath",function(){return qc});n.d(a,"pie",function(){return ed});n.d(a,"scale",function(){return ud});n.d(a,"sortitems",function(){return bd});n.d(a,"stack",function(){return Od});n.d(a,"validTicks",function(){return rc});var o={};n.r(o);n.d(o,"contour",function(){return Nd});n.d(o,"geojson",function(){return Id});n.d(o,"geopath",function(){return Yd});n.d(o,"geopoint",function(){return Qd});n.d(o,"geoshape",function(){return Kd});n.d(o,"graticule",function(){return nh});n.d(o,"projection",function(){return ih});var u={};n.r(u);n.d(u,"force",function(){return gh});var s={};n.r(s);n.d(s,"nest",function(){return Eh});n.d(s,"pack",function(){return Ph});n.d(s,"partition",function(){return Ih});n.d(s,"stratify",function(){return qh});n.d(s,"tree",function(){return Hh});n.d(s,"treelinks",function(){return Gh});n.d(s,"treemap",function(){return Jh});var l={};n.r(l);n.d(l,"voronoi",function(){return Kh});var f={};n.r(f);n.d(f,"wordcloud",function(){return mp});var c={};n.r(c);n.d(c,"crossfilter",function(){return Tp});n.d(c,"resolvefilter",function(){return Np});var d={};n.r(d);n.d(d,"version",function(){return Cp["a"]});n.d(d,"accessor",function(){return V["accessor"]});n.d(d,"accessorName",function(){return V["accessorName"]});n.d(d,"accessorFields",function(){return V["accessorFields"]});n.d(d,"id",function(){return V["id"]});n.d(d,"identity",function(){return V["identity"]});n.d(d,"zero",function(){return V["zero"]});n.d(d,"one",function(){return V["one"]});n.d(d,"truthy",function(){return V["truthy"]});n.d(d,"falsy",function(){return V["falsy"]});n.d(d,"logger",function(){return V["logger"]});n.d(d,"None",function(){return V["None"]});n.d(d,"Error",function(){return V["Error"]});n.d(d,"Warn",function(){return V["Warn"]});n.d(d,"Info",function(){return V["Info"]});n.d(d,"Debug",function(){return V["Debug"]});n.d(d,"panLinear",function(){return V["panLinear"]});n.d(d,"panLog",function(){return V["panLog"]});n.d(d,"panPow",function(){return V["panPow"]});n.d(d,"zoomLinear",function(){return V["zoomLinear"]});n.d(d,"zoomLog",function(){return V["zoomLog"]});n.d(d,"zoomPow",function(){return V["zoomPow"]});n.d(d,"array",function(){return V["array"]});n.d(d,"compare",function(){return V["compare"]});n.d(d,"constant",function(){return V["constant"]});n.d(d,"debounce",function(){return V["debounce"]});n.d(d,"error",function(){return V["error"]});n.d(d,"extend",function(){return V["extend"]});n.d(d,"extentIndex",function(){return V["extentIndex"]});n.d(d,"fastmap",function(){return V["fastmap"]});n.d(d,"field",function(){return V["field"]});n.d(d,"inherits",function(){return V["inherits"]});n.d(d,"isArray",function(){return V["isArray"]});n.d(d,"isBoolean",function(){return V["isBoolean"]});n.d(d,"isDate",function(){return V["isDate"]});n.d(d,"isFunction",function(){return V["isFunction"]});n.d(d,"isNumber",function(){return V["isNumber"]});n.d(d,"isObject",function(){return V["isObject"]});n.d(d,"isRegExp",function(){return V["isRegExp"]});n.d(d,"isString",function(){return V["isString"]});n.d(d,"key",function(){return V["key"]});n.d(d,"merge",function(){return V["merge"]});n.d(d,"pad",function(){return V["pad"]});n.d(d,"peek",function(){return V["peek"]});n.d(d,"repeat",function(){return V["repeat"]});n.d(d,"splitAccessPath",function(){return V["splitAccessPath"]});n.d(d,"stringValue",function(){return V["stringValue"]});n.d(d,"toBoolean",function(){return V["toBoolean"]});n.d(d,"toDate",function(){return V["toDate"]});n.d(d,"toNumber",function(){return V["toNumber"]});n.d(d,"toString",function(){return V["toString"]});n.d(d,"toSet",function(){return V["toSet"]});n.d(d,"truncate",function(){return V["truncate"]});n.d(d,"visitArray",function(){return V["visitArray"]});n.d(d,"Dataflow",function(){return Ft});n.d(d,"EventStream",function(){return me});n.d(d,"Parameters",function(){return ie});n.d(d,"Pulse",function(){return yt});n.d(d,"MultiPulse",function(){return Ot});n.d(d,"Operator",function(){return ce});n.d(d,"Transform",function(){return Wt});n.d(d,"changeset",function(){return ne});n.d(d,"ingest",function(){return Q});n.d(d,"isTuple",function(){return Y});n.d(d,"definition",function(){return Bt});n.d(d,"transform",function(){return Gt});n.d(d,"transforms",function(){return Ht});n.d(d,"tupleid",function(){return X});n.d(d,"scale",function(){return ec["d"]});n.d(d,"scheme",function(){return ec["g"]});n.d(d,"schemeDiscretized",function(){return ec["h"]});n.d(d,"interpolate",function(){return ec["b"]});n.d(d,"interpolateRange",function(){return ec["c"]});n.d(d,"timeInterval",function(){return ec["i"]});n.d(d,"utcInterval",function(){return ec["j"]});n.d(d,"projection",function(){return Hd});n.d(d,"View",function(){return _I});n.d(d,"parse",function(){return _L});n.d(d,"expressionFunction",function(){return CN});n.d(d,"formatLocale",function(){return tc["formatDefaultLocale"]});n.d(d,"timeFormatLocale",function(){return Xe["timeFormatDefaultLocale"]});n.d(d,"runtime",function(){return GL});n.d(d,"runtimeContext",function(){return JL});n.d(d,"bin",function(){return rn["a"]});n.d(d,"bootstrapCI",function(){return rn["b"]});n.d(d,"quartiles",function(){return rn["c"]});n.d(d,"random",function(){return rn["d"]});n.d(d,"setRandom",function(){return rn["j"]});n.d(d,"randomInteger",function(){return rn["e"]});n.d(d,"randomKDE",function(){return rn["f"]});n.d(d,"randomMixture",function(){return rn["g"]});n.d(d,"randomNormal",function(){return rn["h"]});n.d(d,"randomUniform",function(){return rn["i"]});n.d(d,"loader",function(){return Lp});n.d(d,"read",function(){return uv});n.d(d,"inferType",function(){return Yp});n.d(d,"inferTypes",function(){return Xp});n.d(d,"typeParsers",function(){return Bp});n.d(d,"formats",function(){return ov});n.d(d,"Bounds",function(){return lv});n.d(d,"Gradient",function(){return dv});n.d(d,"GroupItem",function(){return pv});n.d(d,"ResourceLoader",function(){return vv});n.d(d,"Item",function(){return hv});n.d(d,"Scenegraph",function(){return gy});n.d(d,"Handler",function(){return Sy});n.d(d,"Renderer",function(){return zy});n.d(d,"CanvasHandler",function(){return Py});n.d(d,"CanvasRenderer",function(){return Vy});n.d(d,"SVGHandler",function(){return Xy});n.d(d,"SVGRenderer",function(){return ib});n.d(d,"SVGStringRenderer",function(){return bb});n.d(d,"RenderType",function(){return Tb});n.d(d,"renderModule",function(){return Nb});n.d(d,"Marks",function(){return sy});n.d(d,"boundClip",function(){return Cb});n.d(d,"boundContext",function(){return Ag});n.d(d,"boundStroke",function(){return Og});n.d(d,"boundItem",function(){return ly});n.d(d,"boundMark",function(){return cy});n.d(d,"pathCurves",function(){return _v});n.d(d,"pathSymbols",function(){return Rv});n.d(d,"pathRectangle",function(){return Hv});n.d(d,"pathTrail",function(){return Gv});n.d(d,"pathParse",function(){return Ov});n.d(d,"pathRender",function(){return Mv});n.d(d,"point",function(){return wy});n.d(d,"domCreate",function(){return by});n.d(d,"domFind",function(){return _y});n.d(d,"domChild",function(){return xy});n.d(d,"domClear",function(){return ky});n.d(d,"openTag",function(){return Zy});n.d(d,"closeTag",function(){return Ky});n.d(d,"font",function(){return Zm});n.d(d,"fontFamily",function(){return Qm});n.d(d,"fontSize",function(){return $m});n.d(d,"textMetrics",function(){return Wm});n.d(d,"resetSVGClipId",function(){return rm});n.d(d,"sceneEqual",function(){return Rb});n.d(d,"pathEqual",function(){return Lb});n.d(d,"sceneToJSON",function(){return hy});n.d(d,"sceneFromJSON",function(){return py});n.d(d,"sceneZOrder",function(){return Lg});n.d(d,"sceneVisit",function(){return Ig});n.d(d,"scenePickVisit",function(){return Fg});var h={};n.r(h);n.d(h,"pick",function(){return MI});n.d(h,"omit",function(){return NI});n.d(h,"stringify",function(){return DI});n.d(h,"hash",function(){return CI});n.d(h,"contains",function(){return PI});n.d(h,"without",function(){return RI});n.d(h,"union",function(){return LI});n.d(h,"some",function(){return II});n.d(h,"every",function(){return FI});n.d(h,"flatten",function(){return qI});n.d(h,"mergeDeep",function(){return UI});n.d(h,"unique",function(){return VI});n.d(h,"differ",function(){return HI});n.d(h,"hasIntersection",function(){return BI});n.d(h,"isNumeric",function(){return GI});n.d(h,"differArray",function(){return $I});n.d(h,"keys",function(){return YI});n.d(h,"vals",function(){return XI});n.d(h,"flagKeys",function(){return JI});n.d(h,"duplicate",function(){return QI});n.d(h,"isBoolean",function(){return ZI});n.d(h,"varName",function(){return KI});n.d(h,"logicalExpr",function(){return eF});n.d(h,"deleteNestedProperty",function(){return tF});n.d(h,"titlecase",function(){return nF});n.d(h,"accessPathWithDatum",function(){return rF});n.d(h,"flatAccessWithDatum",function(){return iF});n.d(h,"replacePathInField",function(){return aF});n.d(h,"removePathFromField",function(){return oF});n.d(h,"accessPathDepth",function(){return uF});var p={};n.r(p);n.d(p,"AGGREGATE_OPS",function(){return lF});n.d(p,"isAggregateOp",function(){return fF});n.d(p,"COUNTING_OPS",function(){return cF});n.d(p,"isCountingAggregateOp",function(){return dF});n.d(p,"SUM_OPS",function(){return hF});n.d(p,"SHARED_DOMAIN_OPS",function(){return pF});n.d(p,"SHARED_DOMAIN_OP_INDEX",function(){return vF});var v={};n.r(v);n.d(v,"AXIS_PARTS",function(){return gF});n.d(v,"AXIS_PROPERTY_TYPE",function(){return mF});n.d(v,"isAxisProperty",function(){return xF});n.d(v,"VG_AXIS_PROPERTIES",function(){return kF});n.d(v,"AXIS_PROPERTIES",function(){return OF});var g={};n.r(g);n.d(g,"Channel",function(){return wF});n.d(g,"X",function(){return jF});n.d(g,"Y",function(){return SF});n.d(g,"X2",function(){return EF});n.d(g,"Y2",function(){return AF});n.d(g,"LATITUDE",function(){return zF});n.d(g,"LATITUDE2",function(){return TF});n.d(g,"LONGITUDE",function(){return MF});n.d(g,"LONGITUDE2",function(){return NF});n.d(g,"ROW",function(){return DF});n.d(g,"COLUMN",function(){return CF});n.d(g,"SHAPE",function(){return PF});n.d(g,"SIZE",function(){return RF});n.d(g,"COLOR",function(){return LF});n.d(g,"FILL",function(){return IF});n.d(g,"STROKE",function(){return FF});n.d(g,"TEXT",function(){return qF});n.d(g,"DETAIL",function(){return UF});n.d(g,"KEY",function(){return WF});n.d(g,"ORDER",function(){return VF});n.d(g,"OPACITY",function(){return HF});n.d(g,"TOOLTIP",function(){return BF});n.d(g,"HREF",function(){return GF});n.d(g,"GEOPOSITION_CHANNEL_INDEX",function(){return $F});n.d(g,"GEOPOSITION_CHANNELS",function(){return YF});n.d(g,"isColorChannel",function(){return JF});n.d(g,"CHANNELS",function(){return KF});n.d(g,"SINGLE_DEF_CHANNELS",function(){return rq});n.d(g,"isChannel",function(){return iq});n.d(g,"UNIT_CHANNELS",function(){return aq});n.d(g,"NONPOSITION_CHANNELS",function(){return vq});n.d(g,"POSITION_SCALE_CHANNELS",function(){return mq});n.d(g,"NONPOSITION_SCALE_CHANNELS",function(){return jq});n.d(g,"SCALE_CHANNELS",function(){return Eq});n.d(g,"isScaleChannel",function(){return Aq});n.d(g,"supportMark",function(){return zq});n.d(g,"getSupportedMark",function(){return Tq});n.d(g,"rangeType",function(){return Mq});var m={};n.r(m);n.d(m,"binToString",function(){return Nq});n.d(m,"isBinParams",function(){return Dq});n.d(m,"autoMaxBins",function(){return Cq});var y={};n.r(y);n.d(y,"Mark",function(){return Pq});n.d(y,"AREA",function(){return Rq});n.d(y,"BAR",function(){return Lq});n.d(y,"LINE",function(){return Iq});n.d(y,"POINT",function(){return Fq});n.d(y,"TEXT",function(){return qq});n.d(y,"TICK",function(){return Uq});n.d(y,"TRAIL",function(){return Wq});n.d(y,"RECT",function(){return Vq});n.d(y,"RULE",function(){return Hq});n.d(y,"GEOSHAPE",function(){return Bq});n.d(y,"CIRCLE",function(){return Gq});n.d(y,"SQUARE",function(){return $q});n.d(y,"isMark",function(){return Xq});n.d(y,"isPathMark",function(){return Jq});n.d(y,"PRIMITIVE_MARKS",function(){return Qq});n.d(y,"isMarkDef",function(){return Zq});n.d(y,"isPrimitiveMark",function(){return eU});n.d(y,"STROKE_CONFIG",function(){return tU});n.d(y,"FILL_CONFIG",function(){return nU});n.d(y,"FILL_STROKE_CONFIG",function(){return rU});n.d(y,"VL_ONLY_MARK_CONFIG_PROPERTIES",function(){return iU});n.d(y,"VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX",function(){return aU});n.d(y,"defaultMarkConfig",function(){return oU});n.d(y,"defaultBarConfig",function(){return uU});n.d(y,"defaultTickConfig",function(){return sU});var b={};n.r(b);n.d(b,"isDateTime",function(){return _U});n.d(b,"MONTHS",function(){return xU});n.d(b,"SHORT_MONTHS",function(){return kU});n.d(b,"DAYS",function(){return OU});n.d(b,"SHORT_DAYS",function(){return wU});n.d(b,"dateTimeExpr",function(){return AU});var _={};n.r(_);n.d(_,"TimeUnit",function(){return zU});n.d(_,"TIMEUNIT_PARTS",function(){return MU});n.d(_,"isLocalSingleTimeUnit",function(){return NU});n.d(_,"isUtcSingleTimeUnit",function(){return CU});n.d(_,"isUTCTimeUnit",function(){return IU});n.d(_,"getLocalTimeUnit",function(){return FU});n.d(_,"TIMEUNITS",function(){return UU});n.d(_,"isTimeUnit",function(){return WU});n.d(_,"convert",function(){return HU});n.d(_,"getTimeUnitParts",function(){return GU});n.d(_,"containsTimeUnit",function(){return $U});n.d(_,"fieldExpr",function(){return YU});n.d(_,"formatExpression",function(){return XU});n.d(_,"normalizeTimeUnit",function(){return JU});var x={};n.r(x);n.d(x,"Type",function(){return QU});n.d(x,"TYPE_INDEX",function(){return ZU});n.d(x,"isType",function(){return KU});n.d(x,"QUANTITATIVE",function(){return eW});n.d(x,"ORDINAL",function(){return tW});n.d(x,"TEMPORAL",function(){return nW});n.d(x,"NOMINAL",function(){return rW});n.d(x,"GEOJSON",function(){return iW});n.d(x,"getFullName",function(){return aW});var k={};n.r(k);n.d(k,"isConditionalSelection",function(){return oW});n.d(k,"isRepeatRef",function(){return uW});n.d(k,"toFieldDefBase",function(){return sW});n.d(k,"isConditionalDef",function(){return lW});n.d(k,"hasConditionalFieldDef",function(){return fW});n.d(k,"hasConditionalValueDef",function(){return cW});n.d(k,"isFieldDef",function(){return dW});n.d(k,"isStringFieldDef",function(){return hW});n.d(k,"isValueDef",function(){return pW});n.d(k,"isScaleFieldDef",function(){return vW});n.d(k,"vgField",function(){return mW});n.d(k,"isDiscrete",function(){return yW});n.d(k,"isContinuous",function(){return bW});n.d(k,"isCount",function(){return _W});n.d(k,"verbalTitleFormatter",function(){return xW});n.d(k,"functionalTitleFormatter",function(){return kW});n.d(k,"defaultTitleFormatter",function(){return OW});n.d(k,"setTitleFormatter",function(){return jW});n.d(k,"resetTitleFormatter",function(){return SW});n.d(k,"title",function(){return EW});n.d(k,"defaultType",function(){return AW});n.d(k,"getFieldDef",function(){return zW});n.d(k,"normalize",function(){return TW});n.d(k,"normalizeFieldDef",function(){return MW});n.d(k,"normalizeBin",function(){return NW});n.d(k,"channelCompatibility",function(){return CW});n.d(k,"isNumberFieldDef",function(){return PW});n.d(k,"isTimeFieldDef",function(){return RW});n.d(k,"valueExpr",function(){return LW});n.d(k,"valueArray",function(){return IW});var O={};n.r(O);n.d(O,"channelHasField",function(){return FW});n.d(O,"isAggregate",function(){return qW});n.d(O,"normalizeEncoding",function(){return UW});n.d(O,"isRanged",function(){return WW});n.d(O,"fieldDefs",function(){return VW});n.d(O,"forEach",function(){return HW});n.d(O,"reduce",function(){return BW});var w={};n.r(w);n.d(w,"add",function(){return oV});n.d(w,"remove",function(){return uV});n.d(w,"COMPOSITE_MARK_STYLES",function(){return sV});n.d(w,"VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX",function(){return lV});n.d(w,"normalize",function(){return fV});var j={};n.r(j);n.d(j,"defaultLegendConfig",function(){return dV});n.d(j,"LEGEND_PROPERTIES",function(){return vV});n.d(j,"VG_LEGEND_PROPERTIES",function(){return gV});var S={};n.r(S);n.d(S,"ScaleType",function(){return mV});n.d(S,"SCALE_TYPES",function(){return bV});n.d(S,"scaleCompatible",function(){return _V});n.d(S,"scaleTypePrecedence",function(){return kV});n.d(S,"CONTINUOUS_TO_CONTINUOUS_SCALES",function(){return OV});n.d(S,"CONTINUOUS_DOMAIN_SCALES",function(){return jV});n.d(S,"DISCRETE_DOMAIN_SCALES",function(){return EV});n.d(S,"TIME_SCALE_TYPES",function(){return TV});n.d(S,"hasDiscreteDomain",function(){return MV});n.d(S,"isBinScale",function(){return NV});n.d(S,"hasContinuousDomain",function(){return DV});n.d(S,"isContinuousToContinuous",function(){return CV});n.d(S,"defaultScaleConfig",function(){return PV});n.d(S,"isExtendedScheme",function(){return RV});n.d(S,"isSelectionDomain",function(){return LV});n.d(S,"SCALE_PROPERTIES",function(){return FV});n.d(S,"NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES",function(){return GV});n.d(S,"SCALE_TYPE_INDEX",function(){return $V});n.d(S,"scaleTypeSupportProperty",function(){return YV});n.d(S,"channelScalePropertyIncompatability",function(){return XV});n.d(S,"scaleTypeSupportDataType",function(){return JV});n.d(S,"channelSupportScaleType",function(){return QV});n.d(S,"getSupportedScaleType",function(){return ZV});var E={};n.r(E);n.d(E,"defaultViewConfig",function(){return iH});n.d(E,"defaultConfig",function(){return aH});n.d(E,"initConfig",function(){return oH});n.d(E,"stripAndRedirectConfig",function(){return fH});var A={};n.r(A);n.d(A,"isStackOffset",function(){return hH});n.d(A,"STACKABLE_MARKS",function(){return pH});n.d(A,"STACK_BY_DEFAULT_MARKS",function(){return vH});n.d(A,"stack",function(){return mH});var z={};n.r(z);n.d(z,"isFacetSpec",function(){return yH});n.d(z,"isUnitSpec",function(){return bH});n.d(z,"isLayerSpec",function(){return _H});n.d(z,"isRepeatSpec",function(){return xH});n.d(z,"isConcatSpec",function(){return kH});n.d(z,"isVConcatSpec",function(){return OH});n.d(z,"isHConcatSpec",function(){return wH});n.d(z,"normalize",function(){return jH});n.d(z,"fieldDefs",function(){return VH});n.d(z,"isStacked",function(){return HH});var T={};n.r(T);n.d(T,"isUrlData",function(){return JH});n.d(T,"isInlineData",function(){return QH});n.d(T,"isNamedData",function(){return ZH});n.d(T,"MAIN",function(){return KH});n.d(T,"RAW",function(){return eB});var M={};n.r(M);n.d(M,"HEADER_TITLE_PROPERTIES_MAP",function(){return dB});n.d(M,"HEADER_LABEL_PROPERTIES_MAP",function(){return hB});n.d(M,"HEADER_TITLE_PROPERTIES",function(){return pB});n.d(M,"HEADER_LABEL_PROPERTIES",function(){return vB});var N={};n.r(N);n.d(N,"isSortField",function(){return gB});n.d(N,"isSortArray",function(){return mB});var D={};n.r(D);n.d(D,"symbols",function(){return RG});n.d(D,"gradient",function(){return LG});n.d(D,"labels",function(){return IG});var C={};n.r(C);n.d(C,"isFilter",function(){return VX});n.d(C,"isLookup",function(){return HX});n.d(C,"isWindow",function(){return BX});n.d(C,"isCalculate",function(){return GX});n.d(C,"isBin",function(){return $X});n.d(C,"isTimeUnit",function(){return YX});n.d(C,"isAggregate",function(){return XX});n.d(C,"isStack",function(){return JX});n.d(C,"normalizeTransform",function(){return QX});var P={};n.r(P);n.d(P,"DEFAULT_REQUIRED_CHANNEL_MAP",function(){return GQ});n.d(P,"DEFAULT_SUPPORTED_CHANNEL_TYPE",function(){return $Q});n.d(P,"getEncodingMappingError",function(){return YQ});var R={};n.r(R);n.d(R,"compile",function(){return WQ});n.d(R,"aggregate",function(){return p});n.d(R,"axis",function(){return v});n.d(R,"bin",function(){return m});n.d(R,"channel",function(){return g});n.d(R,"compositeMark",function(){return w});n.d(R,"config",function(){return E});n.d(R,"data",function(){return T});n.d(R,"datetime",function(){return b});n.d(R,"encoding",function(){return O});n.d(R,"facet",function(){return BQ});n.d(R,"fieldDef",function(){return k});n.d(R,"header",function(){return M});n.d(R,"legend",function(){return j});n.d(R,"mark",function(){return y});n.d(R,"scale",function(){return S});n.d(R,"sort",function(){return N});n.d(R,"spec",function(){return z});n.d(R,"stack",function(){return A});n.d(R,"timeUnit",function(){return _});n.d(R,"transform",function(){return C});n.d(R,"type",function(){return x});n.d(R,"util",function(){return h});n.d(R,"validate",function(){return P});n.d(R,"version",function(){return JQ});var L={};n.r(L);n.d(L,"excel",function(){return tZ});n.d(L,"ggplot2",function(){return iZ});n.d(L,"quartz",function(){return sZ});n.d(L,"vox",function(){return cZ});n.d(L,"dark",function(){return vZ});n.d(L,"fivethirtyeight",function(){return _Z});var I=n("mrSG");var F=n("2fsI");var q=n("ZYJ9");var U=n.n(q);var W=n("jWEn");var V=n("J29t");function H(e){var t=e||V["identity"],n=[],r={};n.add=function(e){var i=t(e);if(!r[i]){r[i]=1;n.push(e)}return n};n.remove=function(e){var i=t(e),a;if(r[i]){r[i]=0;if((a=n.indexOf(e))>=0){n.splice(a,1)}}return n};return n}var B=Symbol("vega_id"),G=1;function $(){G=1}function Y(e){return!!(e&&X(e))}function X(e){return e[B]}function J(e,t){e[B]=t;return e}function Q(e){var t=e===Object(e)?e:{data:e};return X(t)?t:J(t,G++)}function Z(e){return K(e,Q({}))}function K(e,t){for(var n in e)t[n]=e[n];return t}function ee(e,t){return J(t,X(e))}function te(e){return e&&e.constructor===ne}function ne(){var e=[],t=[],n=[],r=[],i=[],a=false;return{constructor:ne,insert:function(t){var n=Object(V["array"])(t),r=0,i=n.length;for(;r<i;++r)e.push(n[r]);return this},remove:function(e){var n=Object(V["isFunction"])(e)?r:t,i=Object(V["array"])(e),a=0,o=i.length;for(;a<o;++a)n.push(i[a]);return this},modify:function(e,t,r){var a={field:t,value:Object(V["constant"])(r)};if(Object(V["isFunction"])(e)){a.filter=e;i.push(a)}else{a.tuple=e;n.push(a)}return this},encode:function(e,t){if(Object(V["isFunction"])(e))i.push({filter:e,field:t});else n.push({tuple:e,field:t});return this},reflow:function(){a=true;return this},pulse:function(o,u){var s={},l={},f,c,d,h,p,v;for(f=0,c=u.length;f<c;++f){s[X(u[f])]=1}for(f=0,c=t.length;f<c;++f){p=t[f];s[X(p)]=-1}for(f=0,c=r.length;f<c;++f){h=r[f];u.forEach(function(e){if(h(e))s[X(e)]=-1})}for(f=0,c=e.length;f<c;++f){p=e[f];v=X(p);if(s[v]){s[v]=1}else{o.add.push(Q(e[f]))}}for(f=0,c=u.length;f<c;++f){p=u[f];if(s[X(p)]<0)o.rem.push(p)}function g(e,t,n){if(n){e[t]=n(e)}else{o.encode=t}if(!a)l[X(e)]=e}for(f=0,c=n.length;f<c;++f){d=n[f];p=d.tuple;h=d.field;v=s[X(p)];if(v>0){g(p,h,d.value);o.modifies(h)}}for(f=0,c=i.length;f<c;++f){d=i[f];h=d.filter;u.forEach(function(e){if(h(e)&&s[X(e)]>0){g(e,d.field,d.value)}});o.modifies(d.field)}if(a){o.mod=t.length||r.length?u.filter(function(e){return s[X(e)]>0}):u.slice()}else{for(v in l)o.mod.push(l[v])}return o}}}var re="_:mod:_";function ie(){Object.defineProperty(this,re,{writable:true,value:{}})}var ae=ie.prototype;ae.set=function(e,t,n,r){var i=this,a=i[e],o=i[re];if(t!=null&&t>=0){if(a[t]!==n||r){a[t]=n;o[t+":"+e]=-1;o[e]=-1}}else if(a!==n||r){i[e]=n;o[e]=Object(V["isArray"])(n)?1+n.length:-1}return i};ae.modified=function(e,t){var n=this[re],r;if(!arguments.length){for(r in n){if(n[r])return true}return false}else if(Object(V["isArray"])(e)){for(r=0;r<e.length;++r){if(n[e[r]])return true}return false}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]};ae.clear=function(){this[re]={};return this};var oe=0;var ue="pulse";var se=new ie;var le=1,fe=2;function ce(e,t,n,r){this.id=++oe;this.value=e;this.stamp=-1;this.rank=-1;this.qrank=-1;this.flags=0;if(t){this._update=t}if(n)this.parameters(n,r)}var de=ce.prototype;de.targets=function(){return this._targets||(this._targets=H(V["id"]))};de.set=function(e){if(this.value!==e){this.value=e;return 1}else{return 0}};function he(e){return function(t){var n=this.flags;if(arguments.length===0)return!!(n&e);this.flags=t?n|e:n&~e;return this}}de.skip=he(le);de.modified=he(fe);de.parameters=function(e,t){t=t!==false;var n=this,r=n._argval=n._argval||new ie,i=n._argops=n._argops||[],a=[],o,u,s,l;function f(e,o,u){if(u instanceof ce){if(u!==n){if(t)u.targets().add(n);a.push(u)}i.push({op:u,name:e,index:o})}else{r.set(e,o,u)}}for(o in e){u=e[o];if(o===ue){Object(V["array"])(u).forEach(function(e){if(!(e instanceof ce)){Object(V["error"])("Pulse parameters must be operator instances.")}else if(e!==n){e.targets().add(n);a.push(e)}});n.source=u}else if(Object(V["isArray"])(u)){r.set(o,-1,Array(s=u.length));for(l=0;l<s;++l)f(o,l,u[l])}else{f(o,-1,u)}}this.marshall().clear();return a};de.marshall=function(e){var t=this._argval||se,n=this._argops,r,i,a,o,u;if(n&&(a=n.length)){for(i=0;i<a;++i){r=n[i];o=r.op;u=o.modified()&&o.stamp===e;t.set(r.name,r.index,o.value,u)}}return t};de.evaluate=function(e){if(this._update){var t=this.marshall(e.stamp),n=this._update(t,e);t.clear();if(n!==this.value){this.value=n}else if(!this.modified()){return e.StopPropagation}}};de.run=function(e){if(e.stamp<=this.stamp)return e.StopPropagation;var t;if(this.skip()){this.skip(false);t=0}else{t=this.evaluate(e)}this.stamp=e.stamp;return this.pulse=t||e};var pe=function(e,t,n,r){var i=1,a;if(e instanceof ce){a=e}else if(e&&e.prototype instanceof ce){a=new e}else if(Object(V["isFunction"])(e)){a=new ce(null,e)}else{i=0;a=new ce(e,t)}this.rank(a);if(i){r=n;n=t}if(n)this.connect(a,a.parameters(n,r));this.touch(a);return a};var ve=function(e,t){var n=e.rank,r,i;for(r=0,i=t.length;r<i;++r){if(n<t[r].rank){this.rerank(e);return}}};var ge=0;function me(e,t,n){this.id=++ge;this.value=null;if(n)this.receive=n;if(e)this._filter=e;if(t)this._apply=t}function ye(e,t,n){return new me(e,t,n)}var be=me.prototype;be._filter=V["truthy"];be._apply=V["identity"];be.targets=function(){return this._targets||(this._targets=H(V["id"]))};be.consume=function(e){if(!arguments.length)return!!this._consume;this._consume=!!e;return this};be.receive=function(e){if(this._filter(e)){var t=this.value=this._apply(e),n=this._targets,r=n?n.length:0,i=0;for(;i<r;++i)n[i].receive(t);if(this._consume){e.preventDefault();e.stopPropagation()}}};be.filter=function(e){var t=ye(e);this.targets().add(t);return t};be.apply=function(e){var t=ye(null,e);this.targets().add(t);return t};be.merge=function(){var e=ye();this.targets().add(e);for(var t=0,n=arguments.length;t<n;++t){arguments[t].targets().add(e)}return e};be.throttle=function(e){var t=-1;return this.filter(function(){var n=Date.now();if(n-t>e){t=n;return 1}else{return 0}})};be.debounce=function(e){var t=ye();this.targets().add(ye(null,null,Object(V["debounce"])(e,function(e){var n=e.dataflow;t.receive(e);if(n&&n.run)n.run()})));return t};be.between=function(e,t){var n=false;e.targets().add(ye(null,null,function(){n=true}));t.targets().add(ye(null,null,function(){n=false}));return this.filter(function(){return n})};var _e=function(e,t,n,r){var i=this,a=ye(n,r),o=function(e){e.dataflow=i;try{a.receive(e)}catch(e){i.error(e)}finally{i.run()}},u;if(typeof e==="string"&&typeof document!=="undefined"){u=document.querySelectorAll(e)}else{u=Object(V["array"])(e)}for(var s=0,l=u.length;s<l;++s){u[s].addEventListener(t,o)}return a};var xe=/^([A-Za-z]+:)?\/\//;var ke="file://";var Oe=function(e){return{options:e||{},sanitize:je,load:we,file:Ee,http:Se}};function we(e,t){var n=this;return n.sanitize(e,t).then(function(e){var r=e.href;return e.localFile?n.file(r):n.http(r,t)})}function je(e,t){t=Object(V["extend"])({},this.options,t);return new Promise(function(n,r){var i={href:null},a,o,u,s;if(e==null||typeof e!=="string"){r("Sanitize failure, invalid URI: "+Object(V["stringValue"])(e));return}o=xe.test(e);if((s=t.baseURL)&&!o){if(!Te(e,"/")&&s[s.length-1]!=="/"){e="/"+e}e=s+e}u=(a=Te(e,ke))||t.mode==="file"||t.mode!=="http"&&!o&&ze();if(a){e=e.slice(ke.length)}else if(Te(e,"//")){if(t.defaultProtocol==="file"){e=e.slice(2);u=true}else{e=(t.defaultProtocol||"http")+":"+e}}Object.defineProperty(i,"localFile",{value:!!u});i.href=e;if(t.target){i.target=t.target+""}n(i)})}function Se(e,t){return Ae(e,Object(V["extend"])({},this.options.http,t)).then(function(e){if(!e.ok)throw e.status+""+e.statusText;return e.text()})}function Ee(e){return new Promise(function(t,n){var r=ze();r?r.readFile(e,function(e,r){if(e)n(e);else t(r)}):n("No file system access for "+e)})}function Ae(e,t){var r=typeof fetch==="function"?fetch:n(20);return r?r(e,t):Promise.reject("No fetch method available.")}function ze(){var e="function"==="function"&&n(19);return e&&Object(V["isFunction"])(e.readFile)?e:null}function Te(e,t){return e==null?false:e.lastIndexOf(t,0)===0}var Me={boolean:V["toBoolean"],integer:V["toNumber"],number:V["toNumber"],date:V["toDate"],string:V["toString"],unknown:V["identity"]};var Ne=[Le,qe,Fe,Ie];var De=["boolean","integer","number","date"];function Ce(e,t){if(!e||!e.length)return"unknown";var n,r,i,a=0,o=e.length,u=Ne.length,s=Ne.map(function(e,t){return t+1});for(r=0,o=e.length;r<o;++r){n=t?e[r][t]:e[r];for(i=0;i<u;++i){if(s[i]&&Re(n)&&!Ne[i](n)){s[i]=0;++a;if(a===Ne.length)return"string"}}}a=s.reduce(function(e,t){return e===0?t:e},0)-1;return De[a]}function Pe(e,t){return t.reduce(function(t,n){t[n]=Ce(e,n);return t},{})}function Re(e){return e!=null&&e===e}function Le(e){return e==="true"||e==="false"||e===true||e===false}function Ie(e){return!isNaN(Date.parse(e))}function Fe(e){return!isNaN(+e)&&!(e instanceof Date)}function qe(e){return Fe(e)&&(e=+e)===~~e}var Ue=n("/7f5");function We(e){return function(t,n){var r={delimiter:e};return Ve(t,n?Object(V["extend"])(n,r):r)}}function Ve(e,t){if(t.header){e=t.header.map(V["stringValue"]).join(t.delimiter)+"\n"+e}return Object(Ue["b"])(t.delimiter).parse(e+"")}var He=n("WtOp");var Be=n("4BhY");var Ge=function(e,t){var n,r,i;e=Object(He["a"])(e,t);n=t&&(i=t.feature)?Be["a"]:t&&(i=t.mesh)?Be["b"]:Object(V["error"])("Missing TopoJSON feature or mesh parameter.");r=(r=e.objects[i])?n(e,r):Object(V["error"])("Invalid TopoJSON object: "+i);return r&&r.features||[r]};var $e={dsv:Ve,csv:We(","),tsv:We("\t"),json:He["a"],topojson:Ge};var Ye=function(e,t){if(arguments.length>1){$e[e]=t;return this}else{return $e.hasOwnProperty(e)?$e[e]:null}};var Xe=n("DG2x");var Je=function(e,t,n){t=t||{};var r=Ye(t.type||"json");if(!r)Object(V["error"])("Unknown data format type: "+t.type);e=r(e,t);if(t.parse)Qe(e,t.parse,n);if(e.hasOwnProperty("columns"))delete e.columns;return e};function Qe(e,t,n){if(!e.length)return;n=n||Xe["timeParse"];var r=e.columns||Object.keys(e[0]),i,a,o,u,s,l,f;if(t==="auto")t=Pe(e,r);r=Object.keys(t);i=r.map(function(e){var r=t[e],i,a;if(r&&(r.indexOf("date:")===0||r.indexOf("utc:")===0)){i=r.split(/:(.+)?/,2);a=i[1];if(a[0]==="'"&&a[a.length-1]==="'"||a[0]==='"'&&a[a.length-1]==='"'){a=a.slice(1,-1)}return i[0]==="utc"?Object(Xe["utcParse"])(a):n(a)}if(!Me[r]){throw Error("Illegal format pattern: "+e+":"+r)}return Me[r]});for(u=0,l=e.length,f=r.length;u<l;++u){a=e[u];for(s=0;s<f;++s){o=r[s];a[o]=i[s](a[o])}}}function Ze(e,t,n){return this.pulse(e,this.changeset().insert(Je(t,n)))}function Ke(e){var t,n,r=new Promise(function(r,i){t=function(){r(e)};n=i});r.requests=0;r.done=function(){if(--r.requests===0){e.runAfter(function(){e._pending=null;try{e.run();if(e._pending){e._pending.then(t)}else{t()}}catch(e){n(e)}})}};return e._pending=r}function et(e,t,n){var r=this,i=0,a=r._pending||Ke(r);a.requests+=1;return r.loader().load(t,{context:"dataflow"}).then(function(e){return Je(e,n)},function(e){i=-1;r.error("Loading failed",t,e)}).catch(function(e){i=-2;r.error("Data ingestion failed",t,e)}).then(function(t){r.pulse(e,r.changeset().remove(V["truthy"]).insert(t||[]));a.done();return i})}var tt={skip:true};var nt=function(e,t,n,r,i){var a=e instanceof ce?it:rt;a(this,e,t,n,r,i);return this};function rt(e,t,n,r,i,a){var o=Object(V["extend"])({},a,tt),u,s;if(!Object(V["isFunction"])(n))n=Object(V["constant"])(n);if(r===undefined){u=function(t){e.touch(n(t))}}else if(Object(V["isFunction"])(r)){s=new ce(null,r,i,false);u=function(t){var r,i=n(t);s.evaluate(t);te(r=s.value)?e.pulse(i,r,a):e.update(i,r,o)}}else{u=function(t){e.update(n(t),r,o)}}t.apply(u)}function it(e,t,n,r,i,a){var o,u;if(r===undefined){u=n}else{o=Object(V["isFunction"])(r)?r:Object(V["constant"])(r);r=!n?o:function(e,t){var r=o(e,t);if(!n.skip()){n.skip(r!==this.value).value=r}return r};u=new ce(null,r,i,false);u.modified(a&&a.force);u.rank=0;if(n){u.skip(true);u.value=n.value;u.targets().add(n)}}t.targets().add(u)}function at(e){e.rank=++this._rank}function ot(e){var t=[e],n,r,i;while(t.length){this.rank(n=t.pop());if(r=n._targets){for(i=r.length;--i>=0;){t.push(n=r[i]);if(n===e)Object(V["error"])("Cycle detected in dataflow graph.")}}}}var ut={};var st=1<<0,lt=1<<1,ft=1<<2,ct=st|lt,dt=st|ft,ht=st|lt|ft,pt=1<<3,vt=1<<4,gt=1<<5,mt=1<<6;function yt(e,t,n){this.dataflow=e;this.stamp=t==null?-1:t;this.add=[];this.rem=[];this.mod=[];this.fields=null;this.encode=n||null}var bt=yt.prototype;bt.StopPropagation=ut;bt.ADD=st;bt.REM=lt;bt.MOD=ft;bt.ADD_REM=ct;bt.ADD_MOD=dt;bt.ALL=ht;bt.REFLOW=pt;bt.SOURCE=vt;bt.NO_SOURCE=gt;bt.NO_FIELDS=mt;bt.fork=function(e){return new yt(this.dataflow).init(this,e)};bt.clone=function(){var e=this.fork(ht);e.add=e.add.slice();e.rem=e.rem.slice();e.mod=e.mod.slice();if(e.source)e.source=e.source.slice();return e.materialize(ht|vt)};bt.addAll=function(){var e=this;if(!this.source||this.source.length===this.add.length){return e}else{e=new yt(this.dataflow).init(this);e.add=e.source;return e}};bt.init=function(e,t){var n=this;n.stamp=e.stamp;n.encode=e.encode;if(e.fields&&!(t&mt)){n.fields=e.fields}if(t&st){n.addF=e.addF;n.add=e.add}else{n.addF=null;n.add=[]}if(t&lt){n.remF=e.remF;n.rem=e.rem}else{n.remF=null;n.rem=[]}if(t&ft){n.modF=e.modF;n.mod=e.mod}else{n.modF=null;n.mod=[]}if(t&gt){n.srcF=null;n.source=null}else{n.srcF=e.srcF;n.source=e.source}return n};bt.runAfter=function(e){this.dataflow.runAfter(e)};bt.changed=function(e){var t=e||ht;return t&st&&this.add.length||t&lt&&this.rem.length||t&ft&&this.mod.length};bt.reflow=function(e){if(e)return this.fork(ht).reflow();var t=this.add.length,n=this.source&&this.source.length;if(n&&n!==t){this.mod=this.source;if(t)this.filter(ft,kt(this,st))}return this};bt.modifies=function(e){var t=Object(V["array"])(e),n=this.fields||(this.fields={});t.forEach(function(e){n[e]=true});return this};bt.modified=function(e){var t=this.fields;return!(this.mod.length&&t)?false:!arguments.length?!!t:Object(V["isArray"])(e)?e.some(function(e){return t[e]}):t[e]};bt.filter=function(e,t){var n=this;if(e&st)n.addF=_t(n.addF,t);if(e&lt)n.remF=_t(n.remF,t);if(e&ft)n.modF=_t(n.modF,t);if(e&vt)n.srcF=_t(n.srcF,t);return n};function _t(e,t){return e?function(n,r){return e(n,r)&&t(n,r)}:t}bt.materialize=function(e){e=e||ht;var t=this;if(e&st&&t.addF){t.add=xt(t.add,t.addF);t.addF=null}if(e&lt&&t.remF){t.rem=xt(t.rem,t.remF);t.remF=null}if(e&ft&&t.modF){t.mod=xt(t.mod,t.modF);t.modF=null}if(e&vt&&t.srcF){t.source=t.source.filter(t.srcF);t.srcF=null}return t};function xt(e,t){var n=[];Object(V["visitArray"])(e,t,function(e){n.push(e)});return n}function kt(e,t){var n={};e.visit(t,function(e){n[X(e)]=1});return function(e){return n[X(e)]?null:e}}bt.visit=function(e,t){var n=this,r=t,i,a;if(e&vt){Object(V["visitArray"])(n.source,n.srcF,r);return n}if(e&st)Object(V["visitArray"])(n.add,n.addF,r);if(e&lt)Object(V["visitArray"])(n.rem,n.remF,r);if(e&ft)Object(V["visitArray"])(n.mod,n.modF,r);if(e&pt&&(i=n.source)){a=n.add.length+n.mod.length;if(a===i.length){}else if(a){Object(V["visitArray"])(i,kt(n,dt),r)}else{Object(V["visitArray"])(i,n.srcF,r)}}return n};function Ot(e,t,n,r){var i=this,a=0,o,u,s,l,f;this.dataflow=e;this.stamp=t;this.fields=null;this.encode=r||null;this.pulses=n;for(s=0,l=n.length;s<l;++s){o=n[s];if(o.stamp!==t)continue;if(o.fields){u=i.fields||(i.fields={});for(f in o.fields){u[f]=1}}if(o.changed(i.ADD))a|=i.ADD;if(o.changed(i.REM))a|=i.REM;if(o.changed(i.MOD))a|=i.MOD}this.changes=a}var wt=Object(V["inherits"])(Ot,yt);wt.fork=function(e){var t=new yt(this.dataflow).init(this,e&this.NO_FIELDS);if(e!==undefined){if(e&t.ADD){this.visit(t.ADD,function(e){return t.add.push(e)})}if(e&t.REM){this.visit(t.REM,function(e){return t.rem.push(e)})}if(e&t.MOD){this.visit(t.MOD,function(e){return t.mod.push(e)})}}return t};wt.changed=function(e){return this.changes&e};wt.modified=function(e){var t=this,n=t.fields;return!(n&&t.changes&t.MOD)?0:Object(V["isArray"])(e)?e.some(function(e){return n[e]}):n[e]};wt.filter=function(){Object(V["error"])("MultiPulse does not support filtering.")};wt.materialize=function(){Object(V["error"])("MultiPulse does not support materialization.")};wt.visit=function(e,t){var n=this,r=n.pulses,i=r.length,a=0;if(e&n.SOURCE){for(;a<i;++a){r[a].visit(e,t)}}else{for(;a<i;++a){if(r[a].stamp===n.stamp){r[a].visit(e,t)}}}return n};function jt(e){var t=this,n=0,r=t.logLevel(),i,a,o,u;if(t._pending){t.info("Awaiting requests, delaying dataflow run.");return 0}if(t._pulse){t.error("Dataflow invoked recursively. Use the runAfter method to queue invocation.");return 0}if(!t._touched.length){t.info("Dataflow invoked, but nothing to do.");return 0}t._pulse=new yt(t,++t._clock,e);if(r>=V["Info"]){o=Date.now();t.debug("-- START PROPAGATION ("+t._clock+") -----")}t._touched.forEach(function(e){t._enqueue(e,true)});t._touched=H(V["id"]);try{while(t._heap.size()>0){i=t._heap.pop();if(i.rank!==i.qrank){t._enqueue(i,true);continue}a=i.run(t._getPulse(i,e));if(r>=V["Debug"]){t.debug(i.id,a===ut?"STOP":a,i)}if(a!==ut){t._pulse=a;if(i._targets)i._targets.forEach(function(e){t._enqueue(e)})}++n}}catch(e){u=e}t._pulses={};t._pulse=null;if(r>=V["Info"]){o=Date.now()-o;t.info("> Pulse "+t._clock+": "+n+" operators; "+o+"ms")}if(u){t._postrun=[];t.error(u)}if(t._onrun){try{t._onrun(t,n,u)}catch(e){t.error(e)}}if(t._postrun.length){var s=t._postrun;t._postrun=[];s.sort(function(e,t){return t.priority-e.priority}).forEach(function(e){St(t,e.callback)})}return this}function St(e,t){try{t(e)}catch(t){e.error(t)}}function Et(){return this._pending||this.run()&&this._pending||Promise.resolve(this)}function At(e,t,n){if(this._pulse||t){this._postrun.push({priority:n||0,callback:e})}else{St(this,e)}}function zt(e,t){var n=!this._pulses[e.id];if(n)this._pulses[e.id]=this._pulse;if(n||t){e.qrank=e.rank;this._heap.push(e)}}function Tt(e,t){var n=e.source,r=this._clock,i;if(n&&Object(V["isArray"])(n)){i=n.map(function(e){return e.pulse});return new Ot(this,r,i,t)}i=this._pulses[e.id];if(n){n=n.pulse;if(!n||n===ut){i.source=[]}else if(n.stamp===r&&i.target!==e){i=n}else{i.source=n.source}}return i}var Mt={skip:false,force:false};function Nt(e,t){var n=t||Mt;if(this._pulse){this._enqueue(e)}else{this._touched.add(e)}if(n.skip)e.skip(true);return this}function Dt(e,t,n){var r=n||Mt;if(e.set(t)||r.force){this.touch(e,r)}return this}function Ct(e,t,n){this.touch(e,n||Mt);var r=new yt(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];r.target=e;this._pulses[e.id]=t.pulse(r,i);return this}function Pt(e){this.cmp=e;this.nodes=[]}var Rt=Pt.prototype;Rt.size=function(){return this.nodes.length};Rt.clear=function(){this.nodes=[];return this};Rt.peek=function(){return this.nodes[0]};Rt.push=function(e){var t=this.nodes;t.push(e);return Lt(t,0,t.length-1,this.cmp)};Rt.pop=function(){var e=this.nodes,t=e.pop(),n;if(e.length){n=e[0];e[0]=t;It(e,0,this.cmp)}else{n=t}return n};Rt.replace=function(e){var t=this.nodes,n=t[0];t[0]=e;It(t,0,this.cmp);return n};Rt.pushpop=function(e){var t=this.nodes,n=t[0];if(t.length&&this.cmp(n,e)<0){t[0]=e;e=n;It(t,0,this.cmp)}return e};function Lt(e,t,n,r){var i,a,o;i=e[n];while(n>t){o=n-1>>1;a=e[o];if(r(i,a)<0){e[n]=a;n=o;continue}break}return e[n]=i}function It(e,t,n){var r=t,i=e.length,a=e[t],o=2*t+1,u;while(o<i){u=o+1;if(u<i&&n(e[o],e[u])>=0){o=u}e[t]=e[o];t=o;o=2*t+1}e[t]=a;return Lt(e,r,t,n)}function Ft(){this._log=Object(V["logger"])();this.logLevel(V["Error"]);this._clock=0;this._rank=0;try{this._loader=Oe()}catch(e){}this._touched=H(V["id"]);this._pulses={};this._pulse=null;this._heap=new Pt(function(e,t){return e.qrank-t.qrank});this._postrun=[]}var qt=Ft.prototype;qt.stamp=function(){return this._clock};qt.loader=function(e){if(arguments.length){this._loader=e;return this}else{return this._loader}};qt.cleanThreshold=1e4;qt.add=pe;qt.connect=ve;qt.rank=at;qt.rerank=ot;qt.pulse=Ct;qt.touch=Nt;qt.update=Dt;qt.changeset=ne;qt.ingest=Ze;qt.request=et;qt.events=_e;qt.on=nt;qt.run=jt;qt.runAsync=Et;qt.runAfter=At;qt._enqueue=zt;qt._getPulse=Tt;function Ut(e){return function(){return this._log[e].apply(this,arguments)}}qt.error=Ut("error");qt.warn=Ut("warn");qt.info=Ut("info");qt.debug=Ut("debug");qt.logLevel=Ut("level");function Wt(e,t){ce.call(this,e,null,t)}var Vt=Object(V["inherits"])(Wt,ce);Vt.run=function(e){if(e.stamp<=this.stamp)return e.StopPropagation;var t;if(this.skip()){this.skip(false)}else{t=this.evaluate(e)}t=t||e;if(t!==e.StopPropagation)this.pulse=t;this.stamp=e.stamp;return t};Vt.evaluate=function(e){var t=this.marshall(e.stamp),n=this.transform(t,e);t.clear();return n};Vt.transform=function(){};var Ht={};function Bt(e){var t=Gt(e);return t&&t.Definition||null}function Gt(e){e=e&&e.toLowerCase();return Ht.hasOwnProperty(e)?Ht[e]:null}function $t(e){return function(t){var n=e.length,r=1,i=String(e[0](t));for(;r<n;++r){i+="|"+e[r](t)}return i}}function Yt(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:$t(e)}function Xt(e,t,n){return n||e+(!t?"":"_"+t)}var Jt={values:Kt({name:"values",init:"cell.store = true;",set:"cell.data.values()",idx:-1}),count:Kt({name:"count",set:"cell.num"}),__count__:Kt({name:"count",set:"this.missing + this.valid"}),missing:Kt({name:"missing",set:"this.missing"}),valid:Kt({name:"valid",set:"this.valid"}),sum:Kt({name:"sum",init:"this.sum = 0;",add:"this.sum += v;",rem:"this.sum -= v;",set:"this.sum"}),mean:Kt({name:"mean",init:"this.mean = 0;",add:"var d = v - this.mean; this.mean += d / this.valid;",rem:"var d = v - this.mean; this.mean -= this.valid ? d / this.valid : this.mean;",set:"this.mean"}),average:Kt({name:"average",set:"this.mean",req:["mean"],idx:1}),variance:Kt({name:"variance",init:"this.dev = 0;",add:"this.dev += d * (v - this.mean);",rem:"this.dev -= d * (v - this.mean);",set:"this.valid > 1 ? this.dev / (this.valid-1) : 0",req:["mean"],idx:1}),variancep:Kt({name:"variancep",set:"this.valid > 1 ? this.dev / this.valid : 0",req:["variance"],idx:2}),stdev:Kt({name:"stdev",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid-1)) : 0",req:["variance"],idx:2}),stdevp:Kt({name:"stdevp",set:"this.valid > 1 ? Math.sqrt(this.dev / this.valid) : 0",req:["variance"],idx:2}),stderr:Kt({name:"stderr",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid * (this.valid-1))) : 0",req:["variance"],idx:2}),distinct:Kt({name:"distinct",set:"cell.data.distinct(this.get)",req:["values"],idx:3}),ci0:Kt({name:"ci0",set:"cell.data.ci0(this.get)",req:["values"],idx:3}),ci1:Kt({name:"ci1",set:"cell.data.ci1(this.get)",req:["values"],idx:3}),median:Kt({name:"median",set:"cell.data.q2(this.get)",req:["values"],idx:3}),q1:Kt({name:"q1",set:"cell.data.q1(this.get)",req:["values"],idx:3}),q3:Kt({name:"q3",set:"cell.data.q3(this.get)",req:["values"],idx:3}),argmin:Kt({name:"argmin",init:"this.argmin = null;",add:"if (v < this.min) this.argmin = t;",rem:"if (v <= this.min) this.argmin = null;",set:"this.argmin || cell.data.argmin(this.get)",req:["min"],str:["values"],idx:3}),argmax:Kt({name:"argmax",init:"this.argmax = null;",add:"if (v > this.max) this.argmax = t;",rem:"if (v >= this.max) this.argmax = null;",set:"this.argmax || cell.data.argmax(this.get)",req:["max"],str:["values"],idx:3}),min:Kt({name:"min",init:"this.min = null;",add:"if (v < this.min || this.min === null) this.min = v;",rem:"if (v <= this.min) this.min = NaN;",set:"this.min = (isNaN(this.min) ? cell.data.min(this.get) : this.min)",str:["values"],idx:4}),max:Kt({name:"max",init:"this.max = null;",add:"if (v > this.max || this.max === null) this.max = v;",rem:"if (v >= this.max) this.max = NaN;",set:"this.max = (isNaN(this.max) ? cell.data.max(this.get) : this.max)",str:["values"],idx:4})};var Qt=Object.keys(Jt);function Zt(e,t){return Jt[e](t)}function Kt(e){return function(t){var n=Object(V["extend"])({init:"",add:"",rem:"",idx:0},e);n.out=t||e.name;return n}}function en(e,t){return e.idx-t.idx}function tn(e,t){function n(e,r){function i(t){if(!e[t])n(e,e[t]=Jt[t]())}if(r.req)r.req.forEach(i);if(t&&r.str)r.str.forEach(i);return e}var r=e.reduce(n,e.reduce(function(e,t){e[t.name]=t;return e},{}));var i=[],a;for(a in r)i.push(r[a]);return i.sort(en)}function nn(e,t){var n=t||V["identity"],r=tn(e,true),i="var cell = this.cell; this.valid = 0; this.missing = 0;",a="this.cell = cell; this.init();",o="if(v==null){++this.missing; return;} if(v!==v) return; ++this.valid;",u="if(v==null){--this.missing; return;} if(v!==v) return; --this.valid;",s="var cell = this.cell;";r.forEach(function(e){i+=e.init;o+=e.add;u+=e.rem});e.slice().sort(en).forEach(function(e){s+="t['"+e.out+"']="+e.set+";"});s+="return t;";a=Function("cell",a);a.prototype.init=Function(i);a.prototype.add=Function("v","t",o);a.prototype.rem=Function("v","t",u);a.prototype.set=Function("t",s);a.prototype.get=n;a.fields=e.map(function(e){return e.out});return a}var rn=n("VZYI");function an(e){this._key=e?Object(V["field"])(e):X;this.reset()}var on=an.prototype;on.reset=function(){this._add=[];this._rem=[];this._ext=null;this._get=null;this._q=null};on.add=function(e){this._add.push(e)};on.rem=function(e){this._rem.push(e)};on.values=function(){this._get=null;if(this._rem.length===0)return this._add;var e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={},u,s,l;for(u=0;u<i;++u){o[n(t[u])]=1}for(u=0,s=0;u<r;++u){if(o[n(l=e[u])]){o[n(l)]=0}else{a[s++]=l}}this._rem=[];return this._add=a};on.distinct=function(e){var t=this.values(),n=t.length,r={},i=0,a;while(--n>=0){a=e(t[n])+"";if(!r.hasOwnProperty(a)){r[a]=1;++i}}return i};on.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=Object(V["extentIndex"])(t,e);this._ext=[t[n[0]],t[n[1]]];this._get=e}return this._ext};on.argmin=function(e){return this.extent(e)[0]||{}};on.argmax=function(e){return this.extent(e)[1]||{}};on.min=function(e){var t=this.extent(e)[0];return t!=null?e(t):+Infinity};on.max=function(e){var t=this.extent(e)[1];return t!=null?e(t):-Infinity};on.quartile=function(e){if(this._get!==e||!this._q){this._q=Object(rn["c"])(this.values(),e);this._get=e}return this._q};on.q1=function(e){return this.quartile(e)[0]};on.q2=function(e){return this.quartile(e)[1]};on.q3=function(e){return this.quartile(e)[2]};on.ci=function(e){if(this._get!==e||!this._ci){this._ci=Object(rn["b"])(this.values(),1e3,.05,e);this._get=e}return this._ci};on.ci0=function(e){return this.ci(e)[0]};on.ci1=function(e){return this.ci(e)[1]};function un(e){Wt.call(this,null,e);this._adds=[];this._mods=[];this._alen=0;this._mlen=0;this._drop=true;this._cross=false;this._dims=[];this._dnames=[];this._measures=[];this._countOnly=false;this._counts=null;this._prev=null;this._inputs=null;this._outputs=null}un.Definition={type:"Aggregate",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"ops",type:"enum",array:true,values:Qt},{name:"fields",type:"field",null:true,array:true},{name:"as",type:"string",null:true,array:true},{name:"drop",type:"boolean",default:true},{name:"cross",type:"boolean",default:false},{name:"key",type:"field"}]};var sn=Object(V["inherits"])(un,Wt);sn.transform=function(e,t){var n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i;this.stamp=r.stamp;if(this.value&&((i=e.modified())||t.modified(this._inputs))){this._prev=this.value;this.value=i?this.init(e):{};t.visit(t.SOURCE,function(e){n.add(e)})}else{this.value=this.value||this.init(e);t.visit(t.REM,function(e){n.rem(e)});t.visit(t.ADD,function(e){n.add(e)})}r.modifies(this._outputs);n._drop=e.drop!==false;if(e.cross&&n._dims.length>1){n._drop=false;this.cross()}return n.changes(r)};sn.cross=function(){var e=this,t=e.value,n=e._dnames,r=n.map(function(){return{}}),i=n.length;function a(e){var t,a,o,u;for(t in e){o=e[t].tuple;for(a=0;a<i;++a){r[a][u=o[n[a]]]=u}}}a(e._prev);a(t);function o(a,u,s){var l=n[s],f=r[s++],c,d;for(c in f){u[l]=f[c];d=a?a+"|"+c:c;if(s<i)o(d,u,s);else if(!t[d])e.cell(d,u)}}o("",{},0)};sn.init=function(e){var t=this._inputs=[],n=this._outputs=[],r={};function i(e){var n=Object(V["array"])(Object(V["accessorFields"])(e)),i=0,a=n.length,o;for(;i<a;++i){if(!r[o=n[i]]){r[o]=1;t.push(o)}}}this._dims=Object(V["array"])(e.groupby);this._dnames=this._dims.map(function(e){var t=Object(V["accessorName"])(e);i(e);n.push(t);return t});this.cellkey=e.key?e.key:Yt(this._dims);this._countOnly=true;this._counts=[];this._measures=[];var a=e.fields||[null],o=e.ops||["count"],u=e.as||[],s=a.length,l={},f,c,d,h,p,v;if(s!==o.length){Object(V["error"])("Unmatched number of fields and aggregate ops.")}for(v=0;v<s;++v){f=a[v];c=o[v];if(f==null&&c!=="count"){Object(V["error"])("Null aggregate field specified.")}h=Object(V["accessorName"])(f);p=Xt(c,h,u[v]);n.push(p);if(c==="count"){this._counts.push(p);continue}d=l[h];if(!d){i(f);d=l[h]=[];d.field=f;this._measures.push(d)}if(c!=="count")this._countOnly=false;d.push(Zt(c,p))}this._measures=this._measures.map(function(e){return nn(e,e.field)});return{}};sn.cellkey=Yt();sn.cell=function(e,t){var n=this.value[e];if(!n){n=this.value[e]=this.newcell(e,t);this._adds[this._alen++]=n}else if(n.num===0&&this._drop&&n.stamp<this.stamp){n.stamp=this.stamp;this._adds[this._alen++]=n}else if(n.stamp<this.stamp){n.stamp=this.stamp;this._mods[this._mlen++]=n}return n};sn.newcell=function(e,t){var n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:false};if(!this._countOnly){var r=this._measures,i=r.length,a;n.agg=Array(i);for(a=0;a<i;++a){n.agg[a]=new r[a](n)}}if(n.store){n.data=new an}return n};sn.newtuple=function(e,t){var n=this._dnames,r=this._dims,i={},a,o;for(a=0,o=r.length;a<o;++a){i[n[a]]=r[a](e)}return t?ee(t.tuple,i):Q(i)};sn.add=function(e){var t=this.cellkey(e),n=this.cell(t,e),r,i,a;n.num+=1;if(this._countOnly)return;if(n.store)n.data.add(e);r=n.agg;for(i=0,a=r.length;i<a;++i){r[i].add(r[i].get(e),e)}};sn.rem=function(e){var t=this.cellkey(e),n=this.cell(t,e),r,i,a;n.num-=1;if(this._countOnly)return;if(n.store)n.data.rem(e);r=n.agg;for(i=0,a=r.length;i<a;++i){r[i].rem(r[i].get(e),e)}};sn.celltuple=function(e){var t=e.tuple,n=this._counts,r,i,a;if(e.store){e.data.values()}for(i=0,a=n.length;i<a;++i){t[n[i]]=e.num}if(!this._countOnly){r=e.agg;for(i=0,a=r.length;i<a;++i){r[i].set(t)}}return t};sn.changes=function(e){var t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,u=e.mod,s,l,f,c;if(r)for(l in r){s=r[l];if(!i||s.num)o.push(s.tuple)}for(f=0,c=this._alen;f<c;++f){a.push(this.celltuple(t[f]));t[f]=null}for(f=0,c=this._mlen;f<c;++f){s=n[f];(s.num===0&&i?o:u).push(this.celltuple(s));n[f]=null}this._alen=this._mlen=0;this._prev=null;return e};function ln(e){Wt.call(this,null,e)}ln.Definition={type:"Bin",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:true,default:[5,2]},{name:"extent",type:"number",array:true,length:2,required:true},{name:"step",type:"number"},{name:"steps",type:"number",array:true},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:true},{name:"name",type:"string"},{name:"as",type:"string",array:true,length:2,default:["bin0","bin1"]}]};var fn=Object(V["inherits"])(ln,Wt);fn.transform=function(e,t){var n=this._bins(e),r=n.start,i=n.step,a=e.as||["bin0","bin1"],o=a[0],u=a[1],s;if(e.modified()){t=t.reflow(true);s=t.SOURCE}else{s=t.modified(Object(V["accessorFields"])(e.field))?t.ADD_MOD:t.ADD}t.visit(s,function(e){var t=n(e);e[o]=t;e[u]=t==null?null:r+i*(1+(t-r)/i)});return t.modifies(a)};fn._bins=function(e){if(this.value&&!e.modified()){return this.value}var t=e.field,n=Object(rn["a"])(e),r=n.start,i=n.stop,a=n.step,o,u;if((o=e.anchor)!=null){u=o-(r+a*Math.floor((o-r)/a));r+=u;i+=u}var s=function(e){var n=t(e);if(n==null){return null}else{n=Math.max(r,Math.min(+n,i-a));return r+a*Math.floor((n-r)/a)}};s.start=r;s.stop=i;s.step=a;return this.value=Object(V["accessor"])(s,Object(V["accessorFields"])(t),e.name||"bin_"+Object(V["accessorName"])(t))};var cn=function(e,t,n){var r=e,i=t||[],a=n||[],o={},u=0;return{add:function(e){a.push(e)},remove:function(e){o[r(e)]=++u},size:function(){return i.length},data:function(e,t){if(u){i=i.filter(function(e){return!o[r(e)]});o={};u=0}if(t&&e){i.sort(e)}if(a.length){i=e?Object(V["merge"])(e,i,a.sort(e)):i.concat(a);a=[]}return i}}};function dn(e){Wt.call(this,[],e)}dn.Definition={type:"Collect",metadata:{source:true},params:[{name:"sort",type:"compare"}]};var hn=Object(V["inherits"])(dn,Wt);hn.transform=function(e,t){var n=t.fork(t.ALL),r=cn(X,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));n.visit(n.REM,r.remove);this.modified(a);this.value=n.source=r.data(i,a);if(t.source&&t.source.root){this.value.root=t.source.root}return n};function pn(e){ce.call(this,null,vn,e)}Object(V["inherits"])(pn,ce);function vn(e){return this.value&&!e.modified()?this.value:Object(V["compare"])(e.fields,e.orders)}function gn(e){Wt.call(this,null,e)}gn.Definition={type:"CountPattern",metadata:{generates:true,changes:true},params:[{name:"field",type:"field",required:true},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:true,length:2,default:["text","count"]}]};function mn(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}var yn=Object(V["inherits"])(gn,Wt);yn.transform=function(e,t){function n(t){return function(n){var r=mn(u(n),e.case,a)||[],i;for(var s=0,l=r.length;s<l;++s){if(!o.test(i=r[s]))t(i)}}}var r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,u=e.field,s=e.as||["text","count"],l=n(function(e){i[e]=1+(i[e]||0)}),f=n(function(e){i[e]-=1});if(r){t.visit(t.SOURCE,l)}else{t.visit(t.ADD,l);t.visit(t.REM,f)}return this._finish(t,s)};yn._parameterCheck=function(e,t){var n=false;if(e.modified("stopwords")||!this._stop){this._stop=new RegExp("^"+(e.stopwords||"")+"$","i");n=true}if(e.modified("pattern")||!this._match){this._match=new RegExp(e.pattern||"[\\w']+","g");n=true}if(e.modified("field")||t.modified(e.field.fields)){n=true}if(n)this._counts={};return n};yn._finish=function(e,t){var n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS),u,s,l;for(u in n){s=r[u];l=n[u]||0;if(!s&&l){r[u]=s=Q({});s[i]=u;s[a]=l;o.add.push(s)}else if(l===0){if(s)o.rem.push(s);n[u]=null;r[u]=null}else if(s[a]!==l){s[a]=l;o.mod.push(s)}}return o.modifies(t)};function bn(e){Wt.call(this,null,e)}bn.Definition={type:"Cross",metadata:{generates:true},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:true,length:2,default:["a","b"]}]};var _n=Object(V["inherits"])(bn,Wt);_n.transform=function(e,t){var n=t.fork(t.NO_SOURCE),r=this.value,i=e.as||["a","b"],a=i[0],o=i[1],u=!r||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");if(u){if(r)n.rem=r;r=t.materialize(t.SOURCE).source;n.add=this.value=xn(r,a,o,e.filter||V["truthy"])}else{n.mod=r}n.source=this.value;return n.modifies(i)};function xn(e,t,n,r){var i=[],a={},o=e.length,u=0,s,l;for(;u<o;++u){a[t]=l=e[u];for(s=0;s<o;++s){a[n]=e[s];if(r(a)){i.push(Q(a));a={};a[t]=l}}}return i}var kn={kde:rn["f"],mixture:rn["g"],normal:rn["h"],uniform:rn["i"]};var On="distributions",wn="function",jn="field";function Sn(e,t){var n=e[wn];if(!kn.hasOwnProperty(n)){Object(V["error"])("Unknown distribution function: "+n)}var r=kn[n]();for(var i in e){if(i===jn){r.data((e.from||t()).map(e[i]))}else if(i===On){r[i](e[i].map(function(e){return Sn(e,t)}))}else if(typeof r[i]===wn){r[i](e[i])}}return r}var En=n("3Fae");function An(e){Wt.call(this,null,e)}var zn=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:true},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}];var Tn={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:true,params:zn},{name:"weights",type:"number",array:true}]};An.Definition={type:"Density",metadata:{generates:true},params:[{name:"extent",type:"number",array:true,length:2},{name:"steps",type:"number",default:100},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:zn.concat(Tn)},{name:"as",type:"string",array:true,default:["value","density"]}]};var Mn=Object(V["inherits"])(An,Wt);Mn.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=Sn(e.distribution,Nn(t)),i=e.method||"pdf";if(i!=="pdf"&&i!=="cdf"){Object(V["error"])("Invalid density method: "+i)}if(!e.extent&&!r.data){Object(V["error"])("Missing density extent parameter.")}i=r[i];var a=e.as||["value","density"],o=e.extent||Object(En["f"])(r.data()),u=(o[1]-o[0])/(e.steps||100),s=Object(En["n"])(o[0],o[1]+u/2,u).map(function(e){var t={};t[a[0]]=e;t[a[1]]=i(e);return Q(t)});if(this.value)n.rem=this.value;this.value=n.add=n.source=s}return n};function Nn(e){return function(){return e.materialize(e.SOURCE).source}}function Dn(e){ce.call(this,null,Cn,e);this.modified(true)}Object(V["inherits"])(Dn,ce);function Cn(e){var t=e.expr;return this.value&&!e.modified("expr")?this.value:Object(V["accessor"])(function(n){return t(n,e)},Object(V["accessorFields"])(t),Object(V["accessorName"])(t))}function Pn(e){Wt.call(this,[+Infinity,-Infinity],e)}Pn.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:true}]};var Rn=Object(V["inherits"])(Pn,Wt);Rn.transform=function(e,t){var n=this.value,r=e.field,i=n[0],a=n[1],o=t.ADD,u;u=t.changed()||t.modified(r.fields)||e.modified("field");if(u){o=t.SOURCE;i=+Infinity;a=-Infinity}t.visit(o,function(e){var t=r(e);if(t!=null){t=+t;if(t<i)i=t;if(t>a)a=t}});this.value=[i,a]};function Ln(e,t){ce.call(this,e);this.parent=t}var In=Object(V["inherits"])(Ln,ce);In.connect=function(e){this.targets().add(e);return e.source=this};In.add=function(e){this.value.add.push(e)};In.rem=function(e){this.value.rem.push(e)};In.mod=function(e){this.value.mod.push(e)};In.init=function(e){this.value.init(e,e.NO_SOURCE)};In.evaluate=function(){return this.value};function Fn(e){Wt.call(this,{},e);this._keys=Object(V["fastmap"])();var t=this._targets=[];t.active=0;t.forEach=function(e){for(var n=0,r=t.active;n<r;++n)e(t[n],n,t)}}var qn=Object(V["inherits"])(Fn,Wt);qn.activate=function(e){this._targets[this._targets.active++]=e};qn.subflow=function(e,t,n,r){var i=this.value,a=i.hasOwnProperty(e)&&i[e],o,u;if(!a){u=r||(u=this._group[e])&&u.tuple;o=n.dataflow;a=o.add(new Ln(n.fork(n.NO_SOURCE),this)).connect(t(o,e,u));i[e]=a;this.activate(a)}else if(a.value.stamp<n.stamp){a.init(n);this.activate(a)}return a};qn.transform=function(e,t){var n=t.dataflow,r=this,i=e.key,a=e.subflow,o=this._keys,u=e.modified("key");function s(e){return r.subflow(e,a,t)}this._group=e.group||{};this._targets.active=0;t.visit(t.REM,function(e){var t=X(e),n=o.get(t);if(n!==undefined){o.delete(t);s(n).rem(e)}});t.visit(t.ADD,function(e){var t=i(e);o.set(X(e),t);s(t).add(e)});if(u||t.modified(i.fields)){t.visit(t.MOD,function(e){var t=X(e),n=o.get(t),r=i(e);if(n===r){s(r).mod(e)}else{o.set(t,r);s(n).rem(e);s(r).add(e)}})}else if(t.changed(t.MOD)){t.visit(t.MOD,function(e){s(o.get(X(e))).mod(e)})}if(u){t.visit(t.REFLOW,function(e){var t=X(e),n=o.get(t),r=i(e);if(n!==r){o.set(t,r);s(n).rem(e);s(r).add(e)}})}if(o.empty>n.cleanThreshold)n.runAfter(o.clean);return t};function Un(e){ce.call(this,null,Wn,e)}Object(V["inherits"])(Un,ce);function Wn(e){return this.value&&!e.modified()?this.value:Object(V["isArray"])(e.name)?Object(V["array"])(e.name).map(function(e){return Object(V["field"])(e)}):Object(V["field"])(e.name,e.as)}function Vn(e){Wt.call(this,Object(V["fastmap"])(),e)}Vn.Definition={type:"Filter",metadata:{changes:true},params:[{name:"expr",type:"expr",required:true}]};var Hn=Object(V["inherits"])(Vn,Wt);Hn.transform=function(e,t){var n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,u=i.mod,s=e.expr,l=true;t.visit(t.REM,function(e){var t=X(e);if(!r.has(t))o.push(e);else r.delete(t)});t.visit(t.ADD,function(t){if(s(t,e))a.push(t);else r.set(X(t),1)});function f(t){var n=X(t),i=s(t,e),f=r.get(n);if(i&&f){r.delete(n);a.push(t)}else if(!i&&!f){r.set(n,1);o.push(t)}else if(l&&i&&!f){u.push(t)}}t.visit(t.MOD,f);if(e.modified()){l=false;t.visit(t.REFLOW,f)}if(r.empty>n.cleanThreshold)n.runAfter(r.clean);return i};function Bn(e,t){if(!e)return null;return e.map(function(e,n){return t[n]||Object(V["accessorName"])(e)})}function Gn(e){Wt.call(this,[],e)}Gn.Definition={type:"Flatten",metadata:{generates:true},params:[{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true}]};var $n=Object(V["inherits"])(Gn,Wt);$n.transform=function(e,t){var n=t.fork(t.NO_SOURCE),r=e.fields,i=Bn(r,e.as||[]),a=i.length;n.rem=this.value;t.visit(t.SOURCE,function(e){var t=r.map(function(t){return t(e)}),o=t.reduce(function(e,t){return Math.max(e,t.length)},0),u=0,s,l,f;for(;u<o;++u){l=Z(e);for(s=0;s<a;++s){l[i[s]]=(f=t[s][u])==null?null:f}n.add.push(l)}});this.value=n.source=n.add;return n.modifies(i)};function Yn(e){Wt.call(this,[],e)}Yn.Definition={type:"Fold",metadata:{generates:true},params:[{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true,length:2,default:["key","value"]}]};var Xn=Object(V["inherits"])(Yn,Wt);Xn.transform=function(e,t){var n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(V["accessorName"]),a=e.as||["key","value"],o=a[0],u=a[1],s=r.length;n.rem=this.value;t.visit(t.SOURCE,function(e){for(var t=0,a;t<s;++t){a=Z(e);a[o]=i[t];a[u]=r[t](e);n.add.push(a)}});this.value=n.source=n.add;return n.modifies(a)};function Jn(e){Wt.call(this,null,e)}Jn.Definition={type:"Formula",metadata:{modifies:true},params:[{name:"expr",type:"expr",required:true},{name:"as",type:"string",required:true},{name:"initonly",type:"boolean"}]};var Qn=Object(V["inherits"])(Jn,Wt);Qn.transform=function(e,t){var n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)?t.ADD_MOD:t.ADD;function o(t){t[r]=n(t,e)}if(i){t=t.materialize().reflow(true)}if(!e.initonly){t.modifies(r)}return t.visit(a,o)};function Zn(e){Wt.call(this,[],e)}var Kn=Object(V["inherits"])(Zn,Wt);Kn.transform=function(e,t){var n=this.value,r=t.fork(t.ALL),i=e.size-n.length,a=e.generator,o,u,s;if(i>0){for(o=[];--i>=0;){o.push(s=Q(a(e)));n.push(s)}r.add=r.add.length?r.materialize(r.ADD).add.concat(o):o}else{u=n.slice(0,-i);r.rem=r.rem.length?r.materialize(r.REM).rem.concat(u):u;n=n.slice(-i)}r.source=this.value=n;return r};var er={value:"value",median:En["i"],mean:En["h"],min:En["k"],max:En["g"]};var tr=[];function nr(e){Wt.call(this,[],e)}nr.Definition={type:"Impute",metadata:{changes:true},params:[{name:"field",type:"field",required:true},{name:"key",type:"field",required:true},{name:"keyvals",array:true},{name:"groupby",type:"field",array:true},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};var rr=Object(V["inherits"])(nr,Wt);function ir(e){var t=e.method||er.value,n;if(er[t]==null){Object(V["error"])("Unrecognized imputation method: "+t)}else if(t===er.value){n=e.value!==undefined?e.value:0;return function(){return n}}else{return er[t]}}function ar(e){var t=e.field;return function(e){return e?t(e):NaN}}rr.transform=function(e,t){var n=t.fork(t.ALL),r=ir(e),i=ar(e),a=Object(V["accessorName"])(e.field),o=Object(V["accessorName"])(e.key),u=(e.groupby||[]).map(V["accessorName"]),s=or(t.source,e.groupby,e.key,e.keyvals),l=[],f=this.value,c=s.domain.length,d,h,p,v,g,m,y,b,_,x;for(g=0,b=s.length;g<b;++g){d=s[g];p=d.values;h=NaN;for(y=0;y<c;++y){if(d[y]!=null)continue;v=s.domain[y];x={_impute:true};for(m=0,_=p.length;m<_;++m)x[u[m]]=p[m];x[o]=v;x[a]=isNaN(h)?h=r(d,i):h;l.push(Q(x))}}if(l.length)n.add=n.materialize(n.ADD).add.concat(l);if(f.length)n.rem=n.materialize(n.REM).rem.concat(f);this.value=l;return n};function or(e,t,n,r){var i=function(e){return e(g)},a=[],o=r?r.slice():[],u={},s={},l,f,c,d,h,p,v,g;o.forEach(function(e,t){u[e]=t+1});for(d=0,v=e.length;d<v;++d){g=e[d];p=n(g);h=u[p]||(u[p]=o.push(p));f=(l=t?t.map(i):tr)+"";if(!(c=s[f])){c=s[f]=[];a.push(c);c.values=l}c[h-1]=g}a.domain=o;return a}function ur(e){un.call(this,e)}ur.Definition={type:"JoinAggregate",metadata:{modifies:true},params:[{name:"groupby",type:"field",array:true},{name:"fields",type:"field",null:true,array:true},{name:"ops",type:"enum",array:true,values:Qt},{name:"as",type:"string",null:true,array:true},{name:"key",type:"field"}]};var sr=Object(V["inherits"])(ur,un);sr.transform=function(e,t){var n=this,r=e.modified(),i;if(n.value&&(r||t.modified(n._inputs))){i=n.value=r?n.init(e):{};t.visit(t.SOURCE,function(e){n.add(e)})}else{i=n.value=n.value||this.init(e);t.visit(t.REM,function(e){n.rem(e)});t.visit(t.ADD,function(e){n.add(e)})}n.changes();t.visit(t.SOURCE,function(e){Object(V["extend"])(e,i[n.cellkey(e)].tuple)});return t.reflow(r).modifies(this._outputs)};sr.changes=function(){var e=this._adds,t=this._mods,n,r;for(n=0,r=this._alen;n<r;++n){this.celltuple(e[n]);e[n]=null}for(n=0,r=this._mlen;n<r;++n){this.celltuple(t[n]);t[n]=null}this._alen=this._mlen=0};function lr(e){ce.call(this,null,fr,e)}Object(V["inherits"])(lr,ce);function fr(e){return this.value&&!e.modified()?this.value:Object(V["key"])(e.fields,e.flat)}function cr(e){Wt.call(this,null,e)}var dr=Object(V["inherits"])(cr,Wt);dr.transform=function(e,t){t.dataflow.request(this.target,e.url,e.format)};function hr(e){Wt.call(this,{},e)}hr.Definition={type:"Lookup",metadata:{modifies:true},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:true},{name:"key",type:"field",required:true}]},{name:"values",type:"field",array:true},{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true},{name:"default",default:null}]};var pr=Object(V["inherits"])(hr,Wt);pr.transform=function(e,t){var n=t,r=e.as,i=e.fields,a=e.index,o=e.values,u=e.default==null?null:e.default,s=e.modified(),l=s?t.SOURCE:t.ADD,f=i.length,c,d,h;if(o){d=o.length;if(f>1&&!r){Object(V["error"])('Multi-field lookup requires explicit "as" parameter.')}if(r&&r.length!==f*d){Object(V["error"])('The "as" parameter has too few output field names.')}r=r||o.map(V["accessorName"]);c=function(e){for(var t=0,n=0,s,l;t<f;++t){l=a.get(i[t](e));if(l==null)for(s=0;s<d;++s,++n)e[r[n]]=u;else for(s=0;s<d;++s,++n)e[r[n]]=o[s](l)}}}else{if(!r){Object(V["error"])("Missing output field names.")}c=function(e){for(var t=0,n;t<f;++t){n=a.get(i[t](e));e[r[t]]=n==null?u:n}}}if(s){n=t.reflow(true)}else{h=i.some(function(e){return t.modified(e.fields)});l|=h?t.MOD:0}t.visit(l,c);return n.modifies(r)};function vr(e){ce.call(this,null,gr,e)}Object(V["inherits"])(vr,ce);function gr(e){if(this.value&&!e.modified()){return this.value}var t=+Infinity,n=-Infinity,r=e.extents,i,a,o;for(i=0,a=r.length;i<a;++i){o=r[i];if(o[0]<t)t=o[0];if(o[1]>n)n=o[1]}return[t,n]}function mr(e){ce.call(this,null,yr,e)}Object(V["inherits"])(mr,ce);function yr(e){return this.value&&!e.modified()?this.value:e.values.reduce(function(e,t){return e.concat(t)},[])}function br(e){Wt.call(this,null,e)}Object(V["inherits"])(br,Wt);br.prototype.transform=function(e,t){this.modified(e.modified());this.value=e;return t.fork(t.NO_SOURCE|t.NO_FIELDS)};function _r(e){un.call(this,e)}_r.Definition={type:"Pivot",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"value",type:"field",required:true},{name:"op",type:"enum",values:Qt,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var xr=Object(V["inherits"])(_r,un);xr._transform=xr.transform;xr.transform=function(e,t){return this._transform(kr(e,t),t)};function kr(e,t){var n=e.field,r=e.value,i=(e.op==="count"?"__count__":e.op)||"sum",a=Object(V["accessorFields"])(n).concat(Object(V["accessorFields"])(r)),o=wr(n,e.limit||0,t);return{key:e.key,groupby:e.groupby,ops:o.map(function(){return i}),fields:o.map(function(e){return Or(e,n,r,a)}),as:o.map(function(e){return e+""}),modified:e.modified.bind(e)}}function Or(e,t,n,r){return Object(V["accessor"])(function(r){return t(r)===e?n(r):NaN},r,e+"")}function wr(e,t,n){var r={},i=[];n.visit(n.SOURCE,function(t){var n=e(t);if(!r[n]){r[n]=1;i.push(n)}});i.sort(function(e,t){return(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0});return t?i.slice(0,t):i}function jr(e){Fn.call(this,e)}var Sr=Object(V["inherits"])(jr,Fn);Sr.transform=function(e,t){var n=this,r=e.subflow,i=e.field;if(e.modified("field")||i&&t.modified(Object(V["accessorFields"])(i))){Object(V["error"])("PreFacet does not support field modification.")}this._targets.active=0;t.visit(t.MOD,function(e){var a=n.subflow(X(e),r,t,e);i?i(e).forEach(function(e){a.mod(e)}):a.mod(e)});t.visit(t.ADD,function(e){var a=n.subflow(X(e),r,t,e);i?i(e).forEach(function(e){a.add(Q(e))}):a.add(e)});t.visit(t.REM,function(e){var a=n.subflow(X(e),r,t,e);i?i(e).forEach(function(e){a.rem(e)}):a.rem(e)});return t};function Er(e){Wt.call(this,null,e)}Er.Definition={type:"Project",metadata:{generates:true,changes:true},params:[{name:"fields",type:"field",array:true},{name:"as",type:"string",null:true,array:true}]};var Ar=Object(V["inherits"])(Er,Wt);Ar.transform=function(e,t){var n=e.fields,r=Bn(e.fields,e.as||[]),i=n?function(e,t){return zr(e,t,n,r)}:K,a,o;if(this.value){o=this.value}else{t=t.addAll();o=this.value={}}a=t.fork(t.NO_SOURCE);t.visit(t.REM,function(e){var t=X(e);a.rem.push(o[t]);o[t]=null});t.visit(t.ADD,function(e){var t=i(e,Q({}));o[X(e)]=t;a.add.push(t)});t.visit(t.MOD,function(e){a.mod.push(i(e,o[X(e)]))});return a};function zr(e,t,n,r){for(var i=0,a=n.length;i<a;++i){t[r[i]]=n[i](e)}return t}function Tr(e){Wt.call(this,null,e)}var Mr=Object(V["inherits"])(Tr,Wt);Mr.transform=function(e,t){this.value=e.value;return e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};function Nr(e){Wt.call(this,null,e)}var Dr=Object(V["inherits"])(Nr,Wt);Dr.transform=function(e,t){var n,r;if(this.value){r=this.value}else{n=t=t.addAll();r=this.value={}}if(e.derive){n=t.fork(t.NO_SOURCE);t.visit(t.REM,function(e){var t=X(e);n.rem.push(r[t]);r[t]=null});t.visit(t.ADD,function(e){var t=Z(e);r[X(e)]=t;n.add.push(t)});t.visit(t.MOD,function(e){n.mod.push(K(e,r[X(e)]))})}return n};function Cr(e){Wt.call(this,[],e);this.count=0}Cr.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};var Pr=Object(V["inherits"])(Cr,Wt);Pr.transform=function(e,t){var n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value,o=this.count,u=0,s=a.reduce(function(e,t){e[X(t)]=1;return e},{});function l(e){var t,r;if(a.length<i){a.push(e)}else{r=~~((o+1)*Object(rn["d"])());if(r<a.length&&r>=u){t=a[r];if(s[X(t)])n.rem.push(t);a[r]=e}}++o}if(t.rem.length){t.visit(t.REM,function(e){var t=X(e);if(s[t]){s[t]=-1;n.rem.push(e)}--o});a=a.filter(function(e){return s[X(e)]!==-1})}if((t.rem.length||r)&&a.length<i&&t.source){u=o=a.length;t.visit(t.SOURCE,function(e){if(!s[X(e)])l(e)});u=-1}if(r&&a.length>i){for(var f=0,c=a.length-i;f<c;++f){s[X(a[f])]=-1;n.rem.push(a[f])}a=a.slice(c)}if(t.mod.length){t.visit(t.MOD,function(e){if(s[X(e)])n.mod.push(e)})}if(t.add.length){t.visit(t.ADD,l)}if(t.add.length||u<0){n.add=a.filter(function(e){return!s[X(e)]})}this.count=o;this.value=n.source=a;return n};function Rr(e){Wt.call(this,null,e)}Rr.Definition={type:"Sequence",metadata:{changes:true},params:[{name:"start",type:"number",required:true},{name:"stop",type:"number",required:true},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};var Lr=Object(V["inherits"])(Rr,Wt);Lr.transform=function(e,t){if(this.value&&!e.modified())return;var n=t.materialize().fork(t.MOD),r=e.as||"data";n.rem=this.value?t.rem.concat(this.value):t.rem;this.value=Object(En["n"])(e.start,e.stop,e.step||1).map(function(e){var t={};t[r]=e;return Q(t)});n.add=t.add.concat(this.value);return n};function Ir(e){Wt.call(this,null,e);this.modified(true)}var Fr=Object(V["inherits"])(Ir,Wt);Fr.transform=function(e,t){this.value=t.source;return t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};function qr(e){Wt.call(this,Object(V["fastmap"])(),e)}var Ur=Object(V["inherits"])(qr,Wt);Ur.transform=function(e,t){var n=t.dataflow,r=e.field,i=this.value,a=true;function o(e){i.set(r(e),e)}if(e.modified("field")||t.modified(r.fields)){i.clear();t.visit(t.SOURCE,o)}else if(t.changed()){t.visit(t.REM,function(e){i.delete(r(e))});t.visit(t.ADD,o)}else{a=false}this.modified(a);if(i.empty>n.cleanThreshold)n.runAfter(i.clean);return t.fork()};function Wr(e){Wt.call(this,null,e)}var Vr=Object(V["inherits"])(Wr,Wt);Vr.transform=function(e,t){var n=!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields);if(n){this.value=(e.sort?t.source.slice().sort(e.sort):t.source).map(e.field)}};function Hr(e,t,n,r){var i=Br[e](t,n);return{init:i.init||V["zero"],update:function(e,t){t[r]=i.next(e)}}}var Br={row_number:function(){return{next:function(e){return e.index+1}}},rank:function(){var e;return{init:function(){e=1},next:function(t){var n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){var e;return{init:function(){e=1},next:function(t){var n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){var e=Br.rank(),t=e.next;return{init:e.init,next:function(e){return(t(e)-1)/(e.data.length-1)}}},cume_dist:function(){var e;return{init:function(){e=0},next:function(t){var n=t.index,r=t.data,i=t.compare;if(e<n){while(n+1<r.length&&!i(r[n],r[n+1]))++n;e=n}return(1+e)/r.length}}},ntile:function(e,t){t=+t;if(!(t>0))Object(V["error"])("ntile num must be greater than zero.");var n=Br.cume_dist(),r=n.next;return{init:n.init,next:function(e){return Math.ceil(t*r(e))}}},lag:function(e,t){t=+t||1;return{next:function(n){var r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){t=+t||1;return{next:function(n){var r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:function(t){return e(t.data[t.i0])}}},last_value:function(e){return{next:function(t){return e(t.data[t.i1-1])}}},nth_value:function(e,t){t=+t;if(!(t>0))Object(V["error"])("nth_value nth must be greater than zero.");return{next:function(n){var r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}}};var Gr=Object.keys(Br);function $r(e){var t=this,n=Object(V["array"])(e.ops),r=Object(V["array"])(e.fields),i=Object(V["array"])(e.params),a=Object(V["array"])(e.as),o=t.outputs=[],u=t.windows=[],s={},l={},f=true,c=[],d=[];function h(e){Object(V["array"])(Object(V["accessorFields"])(e)).forEach(function(e){s[e]=1})}h(e.sort);n.forEach(function(e,t){var n=r[t],s=Object(V["accessorName"])(n),p=Xt(e,s,a[t]);h(n);o.push(p);if(Br.hasOwnProperty(e)){u.push(Hr(e,r[t],i[t],p))}else{if(n==null&&e!=="count"){Object(V["error"])("Null aggregate field specified.")}if(e==="count"){c.push(p);return}f=false;var v=l[s];if(!v){v=l[s]=[];v.field=n;d.push(v)}v.push(Zt(e,p))}});if(c.length||d.length){t.cell=Xr(d,c,f)}t.inputs=Object.keys(s)}var Yr=$r.prototype;Yr.init=function(){this.windows.forEach(function(e){e.init()});if(this.cell)this.cell.init()};Yr.update=function(e,t){var n=this,r=n.cell,i=n.windows,a=e.data,o=i&&i.length,u;if(r){for(u=e.p0;u<e.i0;++u)r.rem(a[u]);for(u=e.p1;u<e.i1;++u)r.add(a[u]);r.set(t)}for(u=0;u<o;++u)i[u].update(e,t)};function Xr(e,t,n){e=e.map(function(e){return nn(e,e.field)});var r={num:0,agg:null,store:false,count:t};if(!n){var i=e.length,a=r.agg=Array(i),o=0;for(;o<i;++o)a[o]=new e[o](r)}if(r.store){var u=r.data=new an}r.add=function(e){r.num+=1;if(n)return;if(u)u.add(e);for(var t=0;t<i;++t){a[t].add(a[t].get(e),e)}};r.rem=function(e){r.num-=1;if(n)return;if(u)u.rem(e);for(var t=0;t<i;++t){a[t].rem(a[t].get(e),e)}};r.set=function(e){var i,o;if(u)u.values();for(i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)};r.init=function(){r.num=0;if(u)u.reset();for(var e=0;e<i;++e)a[e].init()};return r}function Jr(e){Wt.call(this,{},e);this._mlen=0;this._mods=[]}Jr.Definition={type:"Window",metadata:{modifies:true},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:true},{name:"ops",type:"enum",array:true,values:Gr.concat(Qt)},{name:"params",type:"number",null:true,array:true},{name:"fields",type:"field",null:true,array:true},{name:"as",type:"string",null:true,array:true},{name:"frame",type:"number",null:true,array:true,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:false}]};var Qr=Object(V["inherits"])(Jr,Wt);Qr.transform=function(e,t){var n=this,r=n.state,i=e.modified(),a,o;this.stamp=t.stamp;if(!r||i){r=n.state=new $r(e)}var u=Yt(e.groupby);function s(e){return n.group(u(e))}if(i||t.modified(r.inputs)){n.value={};t.visit(t.SOURCE,function(e){s(e).add(e)})}else{t.visit(t.REM,function(e){s(e).remove(e)});t.visit(t.ADD,function(e){s(e).add(e)})}for(a=0,o=n._mlen;a<o;++a){Zr(n._mods[a],r,e)}n._mlen=0;n._mods=[];return t.reflow(i).modifies(r.outputs)};Qr.group=function(e){var t=this,n=t.value[e];if(!n){n=t.value[e]=cn(X);n.stamp=-1}if(n.stamp<t.stamp){n.stamp=t.stamp;t._mods[t._mlen++]=n}return n};function Zr(e,t,n){var r=n.sort,i=r&&!n.ignorePeers,a=n.frame||[null,0],o=e.data(r),u=o.length,s=0,l=i?Object(En["e"])(r):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:o,compare:r||Object(V["constant"])(-1)};for(t.init();s<u;++s){Kr(f,a,s,u);if(i)ei(f,l);t.update(f,o[s])}}function Kr(e,t,n,r){e.p0=e.i0;e.p1=e.i1;e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0]));e.i1=t[1]==null?r:Math.min(r,n+Math.abs(t[1])+1);e.index=n}function ei(e,t){var n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;if(n>0&&!i(a[n],a[n-1]))e.i0=t.left(a,a[n]);if(r<o&&!i(a[r],a[r+1]))e.i1=t.right(a,a[r])}var ti="top";var ni="left";var ri="right";var ii="bottom";var ai="top-left";var oi="top-right";var ui="bottom-left";var si="bottom-right";var li="start";var fi="middle";var ci="end";var di="group";var hi="axis";var pi="title";var vi="frame";var gi="scope";var mi="legend";var yi="row-header";var bi="row-footer";var _i="row-title";var xi="column-header";var ki="column-footer";var Oi="column-title";var wi="padding";var ji="symbol";var Si="fit";var Ei="fit-x";var Ai="fit-y";var zi="pad";var Ti="none";var Mi="all";var Ni="each";var Di="flush";var Ci="column";var Pi="row";function Ri(e){this.clear();if(e)this.union(e)}var Li=Ri.prototype;Li.clone=function(){return new Ri(this)};Li.clear=function(){this.x1=+Number.MAX_VALUE;this.y1=+Number.MAX_VALUE;this.x2=-Number.MAX_VALUE;this.y2=-Number.MAX_VALUE;return this};Li.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE};Li.set=function(e,t,n,r){if(n<e){this.x2=e;this.x1=n}else{this.x1=e;this.x2=n}if(r<t){this.y2=t;this.y1=r}else{this.y1=t;this.y2=r}return this};Li.add=function(e,t){if(e<this.x1)this.x1=e;if(t<this.y1)this.y1=t;if(e>this.x2)this.x2=e;if(t>this.y2)this.y2=t;return this};Li.expand=function(e){this.x1-=e;this.y1-=e;this.x2+=e;this.y2+=e;return this};Li.round=function(){this.x1=Math.floor(this.x1);this.y1=Math.floor(this.y1);this.x2=Math.ceil(this.x2);this.y2=Math.ceil(this.y2);return this};Li.translate=function(e,t){this.x1+=e;this.x2+=e;this.y1+=t;this.y2+=t;return this};Li.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),a=t-t*r+n*i,o=n-t*i-n*r,u=this.x1,s=this.x2,l=this.y1,f=this.y2;return this.clear().add(r*u-i*l+a,i*u+r*l+o).add(r*u-i*f+a,i*u+r*f+o).add(r*s-i*l+a,i*s+r*l+o).add(r*s-i*f+a,i*s+r*f+o)};Li.union=function(e){if(e.x1<this.x1)this.x1=e.x1;if(e.y1<this.y1)this.y1=e.y1;if(e.x2>this.x2)this.x2=e.x2;if(e.y2>this.y2)this.y2=e.y2;return this};Li.intersect=function(e){if(e.x1>this.x1)this.x1=e.x1;if(e.y1>this.y1)this.y1=e.y1;if(e.x2<this.x2)this.x2=e.x2;if(e.y2<this.y2)this.y2=e.y2;return this};Li.encloses=function(e){return e&&(this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2)};Li.alignsWith=function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)};Li.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)};Li.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)};Li.width=function(){return this.x2-this.x1};Li.height=function(){return this.y2-this.y1};var Ii=0;var Fi=function(e,t){var n=[],r;return r={id:"gradient_"+Ii++,x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(e,t){n.push({offset:e,color:t});return r}}};function qi(e){this.mark=e;this.bounds=this.bounds||new Ri}function Ui(e){qi.call(this,e);this.items=this.items||[]}Object(V["inherits"])(Ui,qi);var Wi=n("4Usi");var Vi=/^([A-Za-z]+:)?\/\//;var Hi="file://";var Bi=function(e){return{options:e||{},sanitize:$i,load:Gi,file:Xi,http:Yi}};function Gi(e,t){var n=this;return n.sanitize(e,t).then(function(e){var r=e.href;return e.localFile?n.file(r):n.http(r,t)})}function $i(e,t){t=Object(V["extend"])({},this.options,t);return new Promise(function(n,r){var i={href:null},a,o,u,s;if(e==null||typeof e!=="string"){r("Sanitize failure, invalid URI: "+Object(V["stringValue"])(e));return}o=Vi.test(e);if((s=t.baseURL)&&!o){if(!Zi(e,"/")&&s[s.length-1]!=="/"){e="/"+e}e=s+e}u=(a=Zi(e,Hi))||t.mode==="file"||t.mode!=="http"&&!o&&Qi();if(a){e=e.slice(Hi.length)}else if(Zi(e,"//")){if(t.defaultProtocol==="file"){e=e.slice(2);u=true}else{e=(t.defaultProtocol||"http")+":"+e}}Object.defineProperty(i,"localFile",{value:!!u});i.href=e;if(t.target){i.target=t.target+""}n(i)})}function Yi(e,t){return Ji(e,Object(V["extend"])({},this.options.http,t)).then(function(e){if(!e.ok)throw e.status+""+e.statusText;return e.text()})}function Xi(e){return new Promise(function(t,n){var r=Qi();r?r.readFile(e,function(e,r){if(e)n(e);else t(r)}):n("No file system access for "+e)})}function Ji(e,t){var r=typeof fetch==="function"?fetch:n(18);return r?r(e,t):Promise.reject("No fetch method available.")}function Qi(){var e="function"==="function"&&n(17);return e&&Object(V["isFunction"])(e.readFile)?e:null}function Zi(e,t){return e==null?false:e.lastIndexOf(t,0)===0}var Ki={boolean:V["toBoolean"],integer:V["toNumber"],number:V["toNumber"],date:V["toDate"],string:V["toString"],unknown:V["identity"]};var ea=[aa,sa,ua,oa];var ta=["boolean","integer","number","date"];function na(e,t){if(!e||!e.length)return"unknown";var n,r,i,a=0,o=e.length,u=ea.length,s=ea.map(function(e,t){return t+1});for(r=0,o=e.length;r<o;++r){n=t?e[r][t]:e[r];for(i=0;i<u;++i){if(s[i]&&ia(n)&&!ea[i](n)){s[i]=0;++a;if(a===ea.length)return"string"}}}a=s.reduce(function(e,t){return e===0?t:e},0)-1;return ta[a]}function ra(e,t){return t.reduce(function(t,n){t[n]=na(e,n);return t},{})}function ia(e){return e!=null&&e===e}function aa(e){return e==="true"||e==="false"||e===true||e===false}function oa(e){return!isNaN(Date.parse(e))}function ua(e){return!isNaN(+e)&&!(e instanceof Date)}function sa(e){return ua(e)&&(e=+e)===~~e}function la(e){return function(t,n){var r={delimiter:e};return fa(t,n?Object(V["extend"])(n,r):r)}}function fa(e,t){if(t.header){e=t.header.map(V["stringValue"]).join(t.delimiter)+"\n"+e}return Object(Ue["b"])(t.delimiter).parse(e+"")}var ca=n("7nn0");var da=function(e,t){var n,r,i;e=Object(ca["a"])(e,t);n=t&&(i=t.feature)?Be["a"]:t&&(i=t.mesh)?Be["b"]:Object(V["error"])("Missing TopoJSON feature or mesh parameter.");r=(r=e.objects[i])?n(e,r):Object(V["error"])("Invalid TopoJSON object: "+i);return r&&r.features||[r]};var ha={dsv:fa,csv:la(","),tsv:la("\t"),json:ca["a"],topojson:da};var pa=function(e,t){if(arguments.length>1){ha[e]=t;return this}else{return ha.hasOwnProperty(e)?ha[e]:null}};var va=function(e,t,n){t=t||{};var r=pa(t.type||"json");if(!r)Object(V["error"])("Unknown data format type: "+t.type);e=r(e,t);if(t.parse)ga(e,t.parse,n);if(e.hasOwnProperty("columns"))delete e.columns;return e};function ga(e,t,n){if(!e.length)return;n=n||Xe["timeParse"];var r=e.columns||Object.keys(e[0]),i,a,o,u,s,l,f;if(t==="auto")t=ra(e,r);r=Object.keys(t);i=r.map(function(e){var r=t[e],i,a;if(r&&(r.indexOf("date:")===0||r.indexOf("utc:")===0)){i=r.split(/:(.+)?/,2);a=i[1];if(a[0]==="'"&&a[a.length-1]==="'"||a[0]==='"'&&a[a.length-1]==='"'){a=a.slice(1,-1)}return i[0]==="utc"?Object(Xe["utcParse"])(a):n(a)}if(!Ki[r]){throw Error("Illegal format pattern: "+e+":"+r)}return Ki[r]});for(u=0,l=e.length,f=r.length;u<l;++u){a=e[u];for(s=0;s<f;++s){o=r[s];a[o]=i[s](a[o])}}}function ma(e){this._pending=0;this._loader=e||Bi()}var ya=ma.prototype;ya.pending=function(){return this._pending};function ba(e){e._pending+=1}function _a(e){e._pending-=1}ya.sanitizeURL=function(e){var t=this;ba(t);return t._loader.sanitize(e,{context:"href"}).then(function(e){_a(t);return e}).catch(function(){_a(t);return null})};ya.loadImage=function(e){var t=this,n=Object(Wi["b"])();ba(t);return t._loader.sanitize(e,{context:"image"}).then(function(e){var r=e.href;if(!r||!n)throw{url:r};var i=new n;i.onload=function(){_a(t);i.loaded=true};i.onerror=function(){_a(t);i.loaded=false};i.src=r;return i}).catch(function(e){_a(t);return{loaded:false,width:0,height:0,src:e&&e.url||""}})};ya.ready=function(){var e=this;return new Promise(function(t){function n(r){if(!e.pending())t(r);else setTimeout(function(){n(true)},10)}n(false)})};var xa=n("DBpu");var ka={basis:{curve:xa["c"]},"basis-closed":{curve:xa["d"]},"basis-open":{curve:xa["e"]},bundle:{curve:xa["f"],tension:"beta",value:.85},cardinal:{curve:xa["g"],tension:"tension",value:0},"cardinal-open":{curve:xa["i"],tension:"tension",value:0},"cardinal-closed":{curve:xa["h"],tension:"tension",value:0},"catmull-rom":{curve:xa["j"],tension:"alpha",value:.5},"catmull-rom-closed":{curve:xa["k"],tension:"alpha",value:.5},"catmull-rom-open":{curve:xa["l"],tension:"alpha",value:.5},linear:{curve:xa["m"]},"linear-closed":{curve:xa["n"]},monotone:{horizontal:xa["p"],vertical:xa["o"]},natural:{curve:xa["q"]},step:{curve:xa["r"]},"step-after":{curve:xa["s"]},"step-before":{curve:xa["t"]}};function Oa(e,t,n){var r=ka.hasOwnProperty(e)&&ka[e],i=null;if(r){i=r.curve||r[t||"vertical"];if(r.tension&&n!=null){i=i[r.tension](n)}}return i}var wa={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},ja=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];var Sa=function(e){var t=[],n,r,i,a,o,u,s,l,f,c,d;n=e.slice().replace(ja[0],"###$1").split(ja[1]).slice(1);for(l=0,c=n.length;l<c;++l){r=n[l];i=r.slice(1).trim().replace(ja[2],"$1###$2").split(ja[3]);u=r.charAt(0);a=[u];for(f=0,d=i.length;f<d;++f){if((o=+i[f])===o){a.push(o)}}s=wa[u.toLowerCase()];if(a.length-1>s){for(f=1,d=a.length;f<d;f+=s){t.push([u].concat(a.slice(f,f+s)))}}else{t.push(a)}}return t};var Ea={};var Aa={};var za=[].join;function Ta(e,t,n,r,i,a,o,u,s){var l=za.call(arguments);if(Ea[l]){return Ea[l]}var f=o*(Math.PI/180);var c=Math.sin(f);var d=Math.cos(f);n=Math.abs(n);r=Math.abs(r);var h=d*(u-e)*.5+c*(s-t)*.5;var p=d*(s-t)*.5-c*(u-e)*.5;var v=h*h/(n*n)+p*p/(r*r);if(v>1){v=Math.sqrt(v);n*=v;r*=v}var g=d/n;var m=c/n;var y=-c/r;var b=d/r;var _=g*u+m*s;var x=y*u+b*s;var k=g*e+m*t;var O=y*e+b*t;var w=(k-_)*(k-_)+(O-x)*(O-x);var j=1/w-.25;if(j<0)j=0;var S=Math.sqrt(j);if(a==i)S=-S;var E=.5*(_+k)-S*(O-x);var A=.5*(x+O)+S*(k-_);var z=Math.atan2(x-A,_-E);var T=Math.atan2(O-A,k-E);var M=T-z;if(M<0&&a===1){M+=2*Math.PI}else if(M>0&&a===0){M-=2*Math.PI}var N=Math.ceil(Math.abs(M/(Math.PI*.5+.001)));var D=[];for(var C=0;C<N;++C){var P=z+C*M/N;var R=z+(C+1)*M/N;D[C]=[E,A,P,R,n,r,c,d]}return Ea[l]=D}function Ma(e){var t=za.call(e);if(Aa[t]){return Aa[t]}var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],l=e[7];var f=l*o;var c=-s*u;var d=s*o;var h=l*u;var p=Math.cos(i);var v=Math.sin(i);var g=Math.cos(a);var m=Math.sin(a);var y=.5*(a-i);var b=Math.sin(y*.5);var _=8/3*b*b/Math.sin(y);var x=n+p-_*v;var k=r+v+_*p;var O=n+g;var w=r+m;var j=O+_*m;var S=w-_*g;return Aa[t]=[f*x+c*k,d*x+h*k,f*j+c*S,d*j+h*S,f*O+c*w,d*O+h*w]}var Na=["l",0,0,0,0,0,0,0];function Da(e,t){var n=Na[0]=e[0];if(n==="a"||n==="A"){Na[1]=t*e[1];Na[2]=t*e[2];Na[6]=t*e[6];Na[7]=t*e[7]}else{for(var r=1,i=e.length;r<i;++r){Na[r]=t*e[r]}}return Na}var Ca=function(e,t,n,r,i){var a,o=null,u=0,s=0,l=0,f=0,c,d,h,p;if(n==null)n=0;if(r==null)r=0;if(i==null)i=1;if(e.beginPath)e.beginPath();for(var v=0,g=t.length;v<g;++v){a=t[v];if(i!==1)a=Da(a,i);switch(a[0]){case"l":u+=a[1];s+=a[2];e.lineTo(u+n,s+r);break;case"L":u=a[1];s=a[2];e.lineTo(u+n,s+r);break;case"h":u+=a[1];e.lineTo(u+n,s+r);break;case"H":u=a[1];e.lineTo(u+n,s+r);break;case"v":s+=a[1];e.lineTo(u+n,s+r);break;case"V":s=a[1];e.lineTo(u+n,s+r);break;case"m":u+=a[1];s+=a[2];e.moveTo(u+n,s+r);break;case"M":u=a[1];s=a[2];e.moveTo(u+n,s+r);break;case"c":c=u+a[5];d=s+a[6];l=u+a[3];f=s+a[4];e.bezierCurveTo(u+a[1]+n,s+a[2]+r,l+n,f+r,c+n,d+r);u=c;s=d;break;case"C":u=a[5];s=a[6];l=a[3];f=a[4];e.bezierCurveTo(a[1]+n,a[2]+r,l+n,f+r,u+n,s+r);break;case"s":c=u+a[3];d=s+a[4];l=2*u-l;f=2*s-f;e.bezierCurveTo(l+n,f+r,u+a[1]+n,s+a[2]+r,c+n,d+r);l=u+a[1];f=s+a[2];u=c;s=d;break;case"S":c=a[3];d=a[4];l=2*u-l;f=2*s-f;e.bezierCurveTo(l+n,f+r,a[1]+n,a[2]+r,c+n,d+r);u=c;s=d;l=a[1];f=a[2];break;case"q":c=u+a[3];d=s+a[4];l=u+a[1];f=s+a[2];e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;break;case"Q":c=a[3];d=a[4];e.quadraticCurveTo(a[1]+n,a[2]+r,c+n,d+r);u=c;s=d;l=a[1];f=a[2];break;case"t":c=u+a[1];d=s+a[2];if(o[0].match(/[QqTt]/)===null){l=u;f=s}else if(o[0]==="t"){l=2*u-h;f=2*s-p}else if(o[0]==="q"){l=2*u-l;f=2*s-f}h=l;p=f;e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;l=u+a[1];f=s+a[2];break;case"T":c=a[1];d=a[2];l=2*u-l;f=2*s-f;e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;break;case"a":Pa(e,u+n,s+r,[a[1],a[2],a[3],a[4],a[5],a[6]+u+n,a[7]+s+r]);u+=a[6];s+=a[7];break;case"A":Pa(e,u+n,s+r,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+r]);u=a[6];s=a[7];break;case"z":case"Z":e.closePath();break}o=a}};function Pa(e,t,n,r){var i=Ta(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(var a=0;a<i.length;++a){var o=Ma(i[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var Ra=2*Math.PI,La=Math.sqrt(3)/2;var Ia={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0);e.arc(0,0,n,0,Ra)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r);e.lineTo(-n,r);e.lineTo(-r,r);e.lineTo(-r,n);e.lineTo(r,n);e.lineTo(r,r);e.lineTo(n,r);e.lineTo(n,-r);e.lineTo(r,-r);e.lineTo(r,-n);e.lineTo(-r,-n);e.lineTo(-r,-r);e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0);e.lineTo(0,-n);e.lineTo(n,0);e.lineTo(0,n);e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=La*n;e.moveTo(0,-r);e.lineTo(-n,r);e.lineTo(n,r);e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=La*n;e.moveTo(0,r);e.lineTo(-n,-r);e.lineTo(n,-r);e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=La*n;e.moveTo(r,0);e.lineTo(-r,-n);e.lineTo(-r,n);e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=La*n;e.moveTo(-r,0);e.lineTo(r,-n);e.lineTo(r,n);e.closePath()}}};function Fa(e){return Ia.hasOwnProperty(e)?Ia[e]:Ua(e)}var qa={};function Ua(e){if(!qa.hasOwnProperty(e)){var t=Sa(e);qa[e]={draw:function(e,n){Ca(e,t,0,0,Math.sqrt(n)/2)}}}return qa[e]}var Wa=n("sLbp");function Va(e){return e.x}function Ha(e){return e.y}function Ba(e){return e.width}function Ga(e){return e.height}function $a(e){return function(){return e}}var Ya=function(){var e=Va,t=Ha,n=Ba,r=Ga,i=$a(0),a=null;function o(o,u,s){var l,f=u!=null?u:+e.call(this,o),c=s!=null?s:+t.call(this,o),d=+n.call(this,o),h=+r.call(this,o),p=+i.call(this,o);if(!a)a=l=Object(Wa["a"])();if(p<=0){a.rect(f,c,d,h)}else{var v=f+d,g=c+h;a.moveTo(f+p,c);a.lineTo(v-p,c);a.quadraticCurveTo(v,c,v,c+p);a.lineTo(v,g-p);a.quadraticCurveTo(v,g,v-p,g);a.lineTo(f+p,g);a.quadraticCurveTo(f,g,f,g-p);a.lineTo(f,c+p);a.quadraticCurveTo(f,c,f+p,c);a.closePath()}if(l){a=null;return l+""||null}}o.x=function(t){if(arguments.length){e=typeof t==="function"?t:$a(+t);return o}else{return e}};o.y=function(e){if(arguments.length){t=typeof e==="function"?e:$a(+e);return o}else{return t}};o.width=function(e){if(arguments.length){n=typeof e==="function"?e:$a(+e);return o}else{return n}};o.height=function(e){if(arguments.length){r=typeof e==="function"?e:$a(+e);return o}else{return r}};o.cornerRadius=function(e){if(arguments.length){i=typeof e==="function"?e:$a(+e);return o}else{return i}};o.context=function(e){if(arguments.length){a=e==null?null:e;return o}else{return a}};return o};var Xa=Math.PI;var Ja=function(){var e,t,n,r,i=null,a,o,u,s;function l(e,t,n){var r=n/2;if(a){var l=u-t,f=e-o;if(l||f){var c=Math.sqrt(l*l+f*f),d=(l/=c)*s,h=(f/=c)*s,p=Math.atan2(f,l);i.moveTo(o-d,u-h);i.lineTo(e-l*r,t-f*r);i.arc(e,t,r,p-Xa,p);i.lineTo(o+d,u+h);i.arc(o,u,s,p,p+Xa)}else{i.arc(e,t,r,0,2*Xa)}i.closePath()}else{a=1}o=e;u=t;s=r}function f(o){var u,s=o.length,f,c=false,d;if(i==null)i=d=Object(Wa["a"])();for(u=0;u<=s;++u){if(!(u<s&&r(f=o[u],u,o))===c){if(c=!c)a=0}if(c)l(+e(f,u,o),+t(f,u,o),+n(f,u,o))}if(d){i=null;return d+""||null}}f.x=function(t){if(arguments.length){e=t;return f}else{return e}};f.y=function(e){if(arguments.length){t=e;return f}else{return t}};f.size=function(e){if(arguments.length){n=e;return f}else{return n}};f.defined=function(e){if(arguments.length){r=e;return f}else{return r}};f.context=function(e){if(arguments.length){if(e==null){i=null}else{i=e}return f}else{return i}};return f};function Qa(e){return e.x||0}function Za(e){return e.y||0}function Ka(e){return e.width||0}function eo(e){return e.size||1}function to(e){return e.height||0}function no(e){return(e.x||0)+(e.width||0)}function ro(e){return(e.y||0)+(e.height||0)}function io(e){return e.startAngle||0}function ao(e){return e.endAngle||0}function oo(e){return e.padAngle||0}function uo(e){return e.innerRadius||0}function so(e){return e.outerRadius||0}function lo(e){return e.cornerRadius||0}function fo(e){return!(e.defined===false)}function co(e){return e.size==null?64:e.size}function ho(e){return Fa(e.shape||"circle")}var po=Object(xa["a"])().startAngle(io).endAngle(ao).padAngle(oo).innerRadius(uo).outerRadius(so).cornerRadius(lo),vo=Object(xa["b"])().x(Qa).y1(Za).y0(ro).defined(fo),go=Object(xa["b"])().y(Za).x1(Qa).x0(no).defined(fo),mo=Object(xa["u"])().x(Qa).y(Za).defined(fo),yo=Ya().x(Qa).y(Za).width(Ka).height(to).cornerRadius(lo),bo=Object(xa["v"])().type(ho).size(co),_o=Ja().x(Qa).y(Za).defined(fo).size(eo);function xo(e,t){return po.context(e)(t)}function ko(e,t){var n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?go:vo).curve(Oa(r,n.orient,n.tension)).context(e)(t)}function Oo(e,t){var n=t[0],r=n.interpolate||"linear";return mo.curve(Oa(r,n.orient,n.tension)).context(e)(t)}function wo(e,t,n,r){return yo.context(e)(t,n,r)}function jo(e,t){return(t.mark.shape||t.shape).context(e)(t)}function So(e,t){return bo.context(e)(t)}function Eo(e,t){return _o.context(e)(t)}var Ao=function(e,t){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){e.expand(t.strokeWidth!=null?+t.strokeWidth:1)}return e};var zo,To=Math.PI*2,Mo=To/4,No=To-1e-8;function Do(e){zo=e;return Do}function Co(){}function Po(e,t){zo.add(e,t)}Do.beginPath=Co;Do.closePath=Co;Do.moveTo=Po;Do.lineTo=Po;Do.rect=function(e,t,n,r){Po(e,t);Po(e+n,t+r)};Do.quadraticCurveTo=function(e,t,n,r){Po(e,t);Po(n,r)};Do.bezierCurveTo=function(e,t,n,r,i,a){Po(e,t);Po(n,r);Po(i,a)};Do.arc=function(e,t,n,r,i,a){if(Math.abs(i-r)>No){Po(e-n,t-n);Po(e+n,t+n);return}var o=Infinity,u=-Infinity,s=Infinity,l=-Infinity,f,c,d,h;function p(e){d=n*Math.cos(e);h=n*Math.sin(e);if(d<o)o=d;if(d>u)u=d;if(h<s)s=h;if(h>l)l=h}p(r);p(i);if(i!==r){r=r%To;if(r<0)r+=To;i=i%To;if(i<0)i+=To;if(i<r){a=!a;f=r;r=i;i=f}if(a){i-=To;f=r-r%Mo;for(c=0;c<4&&f>i;++c,f-=Mo)p(f)}else{f=r-r%Mo+Mo;for(c=0;c<4&&f<i;++c,f=f+Mo)p(f)}}Po(e+o,t+s);Po(e+u,t+l)};var Ro=function(e,t,n){var r=n.width(),i=n.height(),a=n.x1+t.x1*r,o=n.y1+t.y1*i,u=n.x1+t.x2*r,s=n.y1+t.y2*i,l=t.stops,f=0,c=l.length,d=e.createLinearGradient(a,o,u,s);for(;f<c;++f){d.addColorStop(l[f].offset,l[f].color)}return d};var Lo=function(e,t,n){return n.id?Ro(e,n,t.bounds):n};var Io=function(e,t,n){n*=t.fillOpacity==null?1:t.fillOpacity;if(n>0){e.globalAlpha=n;e.fillStyle=Lo(e,t,t.fill);return true}else{return false}};var Fo=[];var qo=function(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;if(r<=0)return false;n*=t.strokeOpacity==null?1:t.strokeOpacity;if(n>0){e.globalAlpha=n;e.strokeStyle=Lo(e,t,t.stroke);e.lineWidth=r;e.lineCap=t.strokeCap||"butt";e.lineJoin=t.strokeJoin||"miter";e.miterLimit=t.strokeMiterLimit||10;if(e.setLineDash){e.setLineDash(t.strokeDash||Fo);e.lineDashOffset=t.strokeDashOffset||0}return true}else{return false}};function Uo(e,t){return e.zindex-t.zindex||e.index-t.index}function Wo(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,a;for(i=0,a=t.length;i<a;++i){r=t[i];r.index=i;if(r.zindex)n.push(r)}e.zdirty=false;return e.zitems=n.sort(Uo)}function Vo(e,t){var n=e.items,r,i;if(!n||!n.length)return;var a=Wo(e);if(a&&a.length){for(r=0,i=n.length;r<i;++r){if(!n[r].zindex)t(n[r])}n=a}for(r=0,i=n.length;r<i;++r){t(n[r])}}function Ho(e,t){var n=e.items,r,i;if(!n||!n.length)return null;var a=Wo(e);if(a&&a.length)n=a;for(i=n.length;--i>=0;){if(r=t(n[i]))return r}if(n===a){for(n=e.items,i=n.length;--i>=0;){if(!n[i].zindex){if(r=t(n[i]))return r}}}return null}function Bo(e){return function(t,n,r){Vo(n,function(n){if(!r||r.intersects(n.bounds)){$o(e,t,n,n)}})}}function Go(e){return function(t,n,r){if(n.items.length&&(!r||r.intersects(n.bounds))){$o(e,t,n.items[0],n.items)}}}function $o(e,t,n,r){var i=n.opacity==null?1:n.opacity;if(i===0)return;if(e(t,r))return;if(n.fill&&Io(t,n,i)){t.fill()}if(n.stroke&&qo(t,n,i)){t.stroke()}}var Yo=function(){return true};function Xo(e){if(!e)e=Yo;return function(t,n,r,i,a,o){r*=t.pixelRatio;i*=t.pixelRatio;return Ho(n,function(n){var u=n.bounds;if(u&&!u.contains(a,o)||!u)return;if(e(t,n,r,i,a,o))return n})}}function Jo(e,t){return function(n,r,i,a){var o=Array.isArray(r)?r[0]:r,u=t==null?o.fill:t,s=o.stroke&&n.isPointInStroke,l,f;if(s){l=o.strokeWidth;f=o.strokeCap;n.lineWidth=l!=null?l:1;n.lineCap=f!=null?f:"butt"}return e(n,r)?false:u&&n.isPointInPath(i,a)||s&&n.isPointInStroke(i,a)}}function Qo(e){return Xo(Jo(e))}var Zo=function(e,t){return"translate("+e+","+t+")"};var Ko=function(e){return Zo(e.x||0,e.y||0)};var eu=function(e,t){function n(e,n){e("transform",Ko(n));e("d",t(null,n))}function r(e,n){t(Do(e),n);return Ao(e,n).translate(n.x||0,n.y||0)}function i(e,n){var r=n.x||0,i=n.y||0;e.translate(r,i);e.beginPath();t(e,n);e.translate(-r,-i)}return{type:e,tag:"path",nested:false,attr:n,bound:r,draw:Bo(i),pick:Qo(i)}};var tu=eu("arc",xo);function nu(e,t){var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=0,a=e.length;if(a===1)return e[0];while(i<a){var o=i+a>>>1;if(e[o][r]<n)i=o+1;else a=o}i=Math.max(0,i-1);a=Math.min(e.length-1,a);return n-e[i][r]<e[a][r]-n?e[i]:e[a]}function ru(e,t){var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,a,o;while(--r>=0){if(e[r].defined===false)continue;i=e[r].x-t[0];a=e[r].y-t[1];o=i*i+a*a;if(o<n)return e[r]}return null}function iu(e,t){var n=e.length,r,i,a;while(--n>=0){if(e[n].defined===false)continue;r=e[n].x-t[0];i=e[n].y-t[1];a=r*r+i*i;r=e[n].size||1;if(a<r*r)return e[n]}return null}var au=function(e,t,n){function r(e,n){var r=n.mark.items;if(r.length)e("d",t(null,r))}function i(e,n){var r=n.items;if(r.length===0){return e}else{t(Do(e),r);return Ao(e,r[0])}}function a(e,n){e.beginPath();t(e,n)}var o=Jo(a);function u(e,t,n,r,i,a){var u=t.items,s=t.bounds;if(!u||!u.length||s&&!s.contains(i,a)){return null}n*=e.pixelRatio;r*=e.pixelRatio;return o(e,u,n,r)?u[0]:null}return{type:e,tag:"path",nested:true,attr:r,bound:i,draw:Go(a),pick:u,tip:n}};var ou=au("area",ko,nu);var uu=1;function su(){uu=1}var lu=function(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+uu++),o=i.clipping[a]||(i.clipping[a]={id:a});if(Object(V["isFunction"])(r)){o.path=r(null)}else{o.width=n.width||0;o.height=n.height||0}return"url(#"+a+")"};var fu=.5;function cu(e,t){e("transform",Ko(t))}function du(e,t){var n=t.stroke?fu:0;e("class","background");e("d",wo(null,t,n,n))}function hu(e,t,n){var r=t.clip?lu(n,t,t):null;e("clip-path",r)}function pu(e,t){if(!t.clip&&t.items){var n=t.items;for(var r=0,i=n.length;r<i;++r){e.union(n[r].bounds)}}if((t.clip||t.width||t.height)&&!t.noBound){e.add(0,0).add(t.width||0,t.height||0)}Ao(e,t);return e.translate(t.x||0,t.y||0)}function vu(e,t){var n=t.stroke?fu:0;e.beginPath();wo(e,t,n,n)}var gu=Jo(vu);function mu(e,t,n){var r=this;Vo(t,function(t){var i=t.x||0,a=t.y||0,o=t.width||0,u=t.height||0,s;e.save();e.translate(i,a);if(t.stroke||t.fill){s=t.opacity==null?1:t.opacity;if(s>0){vu(e,t);if(t.fill&&Io(e,t,s)){e.fill()}if(t.stroke&&qo(e,t,s)){e.stroke()}}}if(t.clip){e.beginPath();e.rect(0,0,o,u);e.clip()}if(n)n.translate(-i,-a);Vo(t,function(t){r.draw(e,t,n)});if(n)n.translate(i,a);e.restore()})}function yu(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items){return null}var o=this,u=n*e.pixelRatio,s=r*e.pixelRatio;return Ho(t,function(l){var f,c,d,h;h=l.bounds;if(h&&!h.contains(i,a))return;c=l.x||0;d=l.y||0;e.save();e.translate(c,d);c=i-c;d=a-d;f=Ho(l,function(e){return bu(e,c,d)?o.pick(e,n,r,c,d):null});if(!f&&t.interactive!==false&&(l.fill||l.stroke)&&gu(e,l,u,s)){f=l}e.restore();return f||null})}function bu(e,t,n){return(e.interactive!==false||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var _u={type:"group",tag:"g",nested:false,attr:cu,bound:pu,draw:mu,pick:yu,background:du,foreground:hu};function xu(e,t){var n=e.image;if(!n||n.url!==e.url){n={loaded:false,width:0,height:0};t.loadImage(e.url).then(function(t){e.image=t;e.image.url=e.url})}return n}function ku(e,t){return e==="center"?t/2:e==="right"?t:0}function Ou(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function wu(e,t,n){var r=xu(t,n),i=t.x||0,a=t.y||0,o=(t.width!=null?t.width:r.width)||0,u=(t.height!=null?t.height:r.height)||0,s=t.aspect===false?"none":"xMidYMid";i-=ku(t.align,o);a-=Ou(t.baseline,u);e("href",r.src||"","http://www.w3.org/1999/xlink","xlink:href");e("transform",Zo(i,a));e("width",o);e("height",u);e("preserveAspectRatio",s)}function ju(e,t){var n=t.image,r=t.x||0,i=t.y||0,a=(t.width!=null?t.width:n&&n.width)||0,o=(t.height!=null?t.height:n&&n.height)||0;r-=ku(t.align,a);i-=Ou(t.baseline,o);return e.set(r,i,r+a,i+o)}function Su(e,t,n){var r=this;Vo(t,function(t){if(n&&!n.intersects(t.bounds))return;var i=xu(t,r),a=t.x||0,o=t.y||0,u=(t.width!=null?t.width:i.width)||0,s=(t.height!=null?t.height:i.height)||0,l,f,c,d;a-=ku(t.align,u);o-=Ou(t.baseline,s);if(t.aspect!==false){f=i.width/i.height;c=t.width/t.height;if(f===f&&c===c&&f!==c){if(c<f){d=u/f;o+=(s-d)/2;s=d}else{d=s*f;a+=(u-d)/2;u=d}}}if(i.loaded){e.globalAlpha=(l=t.opacity)!=null?l:1;e.drawImage(i,a,o,u,s)}})}var Eu={type:"image",tag:"image",nested:false,attr:wu,bound:ju,draw:Su,pick:Xo(),get:xu,xOffset:ku,yOffset:Ou};var Au=au("line",Oo,ru);function zu(e,t){e("transform",Ko(t));e("d",t.path)}function Tu(e,t){var n=t.path;if(n==null)return true;var r=t.pathCache;if(!r||r.path!==n){(t.pathCache=r=Sa(n)).path=n}Ca(e,r,t.x,t.y)}function Mu(e,t){return Tu(Do(e),t)?e.set(0,0,0,0):Ao(e,t)}var Nu={type:"path",tag:"path",nested:false,attr:zu,bound:Mu,draw:Bo(Tu),pick:Qo(Tu)};function Du(e,t){e("d",wo(null,t))}function Cu(e,t){var n,r;return Ao(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function Pu(e,t){e.beginPath();wo(e,t)}var Ru={type:"rect",tag:"path",nested:false,attr:Du,bound:Cu,draw:Bo(Pu),pick:Qo(Pu)};function Lu(e,t){e("transform",Ko(t));e("x2",t.x2!=null?t.x2-(t.x||0):0);e("y2",t.y2!=null?t.y2-(t.y||0):0)}function Iu(e,t){var n,r;return Ao(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function Fu(e,t,n){var r,i,a,o;if(t.stroke&&qo(e,t,n)){r=t.x||0;i=t.y||0;a=t.x2!=null?t.x2:r;o=t.y2!=null?t.y2:i;e.beginPath();e.moveTo(r,i);e.lineTo(a,o);return true}return false}function qu(e,t,n){Vo(t,function(t){if(n&&!n.intersects(t.bounds))return;var r=t.opacity==null?1:t.opacity;if(r&&Fu(e,t,r)){e.stroke()}})}function Uu(e,t,n,r){if(!e.isPointInStroke)return false;return Fu(e,t,1)&&e.isPointInStroke(n,r)}var Wu={type:"rule",tag:"line",nested:false,attr:Lu,bound:Iu,draw:qu,pick:Xo(Uu)};var Vu=eu("shape",jo);var Hu=eu("symbol",So);var Bu,Gu;var $u={height:Zu,measureWidth:Ju,estimateWidth:Yu,width:Yu,canvas:Ku};Ku(true);function Yu(e){Gu=Zu(e);return Xu(es(e))}function Xu(e){return~~(.8*e.length*Gu)}function Ju(e){Bu.font=rs(e);return Qu(es(e))}function Qu(e){return Bu.measureText(e).width}function Zu(e){return e.fontSize!=null?e.fontSize:11}function Ku(e){Bu=e&&(Bu=Object(Wi["a"])(1,1))?Bu.getContext("2d"):null;$u.width=Bu?Ju:Yu}function es(e){var t=e.text;if(t==null){return""}else{return e.limit>0?ts(e):t+""}}function ts(e){var t=+e.limit,n=e.text+"",r;if(Bu){Bu.font=rs(e);r=Qu}else{Gu=Zu(e);r=Xu}if(r(n)<t)return n;var i=e.ellipsis||"",a=e.dir==="rtl",o=0,u=n.length,s;t-=r(i);if(a){while(o<u){s=o+u>>>1;if(r(n.slice(s))>t)o=s+1;else u=s}return i+n.slice(o)}else{while(o<u){s=1+(o+u>>>1);if(r(n.slice(0,s))<t)o=s;else u=s-1}return n.slice(0,o)+i}}function ns(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function rs(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Zu(e)+"px "+ns(e,t)}function is(e){var t=e.baseline,n=Zu(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:0)}var as={left:"start",center:"middle",right:"end"};var os=new Ri;function us(e,t){var n=t.dx||0,r=(t.dy||0)+is(t),i=t.x||0,a=t.y||0,o=t.angle||0,u=t.radius||0,s;if(u){s=(t.theta||0)-Math.PI/2;i+=u*Math.cos(s);a+=u*Math.sin(s)}e("text-anchor",as[t.align]||"start");if(o){s=Zo(i,a)+" rotate("+o+")";if(n||r)s+=" "+Zo(n,r)}else{s=Zo(i+n,a+r)}e("transform",s)}function ss(e,t,n){var r=$u.height(t),i=t.align,a=t.radius||0,o=t.x||0,u=t.y||0,s=t.dx||0,l=(t.dy||0)+is(t)-Math.round(.8*r),f,c;if(a){c=(t.theta||0)-Math.PI/2;o+=a*Math.cos(c);u+=a*Math.sin(c)}f=$u.width(t);if(i==="center"){s-=f/2}else if(i==="right"){s-=f}else{}e.set(s+=o,l+=u,s+f,l+r);if(t.angle&&!n){e.rotate(t.angle*Math.PI/180,o,u)}return e.expand(n||!f?0:1)}function ls(e,t,n){Vo(t,function(t){var r,i,a,o,u,s;if(n&&!n.intersects(t.bounds))return;if(!(s=es(t)))return;r=t.opacity==null?1:t.opacity;if(r===0)return;e.font=rs(t);e.textAlign=t.align||"left";i=t.x||0;a=t.y||0;if(o=t.radius){u=(t.theta||0)-Math.PI/2;i+=o*Math.cos(u);a+=o*Math.sin(u)}if(t.angle){e.save();e.translate(i,a);e.rotate(t.angle*Math.PI/180);i=a=0}i+=t.dx||0;a+=(t.dy||0)+is(t);if(t.fill&&Io(e,t,r)){e.fillText(s,i,a)}if(t.stroke&&qo(e,t,r)){e.strokeText(s,i,a)}if(t.angle)e.restore()})}function fs(e,t,n,r,i,a){if(t.fontSize<=0)return false;if(!t.angle)return true;var o=ss(os,t,true),u=-t.angle*Math.PI/180,s=Math.cos(u),l=Math.sin(u),f=t.x,c=t.y,d=s*i-l*a+(f-f*s+c*l),h=l*i+s*a+(c-f*l-c*s);return o.contains(d,h)}var cs={type:"text",tag:"text",nested:false,attr:us,bound:ss,draw:ls,pick:Xo(fs)};var ds=au("trail",Eo,iu);var hs={arc:tu,area:ou,group:_u,image:Eu,line:Au,path:Nu,rect:Ru,rule:Wu,shape:Vu,symbol:Hu,text:cs,trail:ds};var ps=function(e,t,n){var r=hs[e.mark.marktype],i=t||r.bound;if(r.nested)e=e.mark;return i(e.bounds||(e.bounds=new Ri),e,n)};var vs={mark:null};var gs=function(e,t,n){var r=hs[e.marktype],i=r.bound,a=e.items,o=a&&a.length,u,s,l,f;if(r.nested){if(o){l=a[0]}else{vs.mark=e;l=vs}f=ps(l,i,n);t=t&&t.union(f)||f;return t}t=t||e.bounds&&e.bounds.clear()||new Ri;if(o){for(u=0,s=a.length;u<s;++u){t.union(ps(a[u],i,n))}}return e.bounds=t};var ms=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","interpolate","tension","orient","defined","url","path","x2","y2","size","shape","text","angle","theta","radius","dx","dy","font","fontSize","fontWeight","fontStyle","fontVariant"];function ys(e,t){return JSON.stringify(e,ms,t)}function bs(e){var t=typeof e==="string"?JSON.parse(e):e;return _s(t)}function _s(e){var t=e.marktype,n=e.items,r,i,a;if(n){for(i=0,a=n.length;i<a;++i){r=t?"mark":"group";n[i][r]=e;if(n[i].zindex)n[i][r].zdirty=true;if("group"===(t||r))_s(n[i])}}if(t)gs(e);return e}function xs(e){if(arguments.length){this.root=bs(e)}else{this.root=Os({marktype:"group",name:"root",role:"frame"});this.root.items=[new Ui(this.root)]}}var ks=xs.prototype;ks.toJSON=function(e){return ys(this.root,e||0)};ks.mark=function(e,t,n){t=t||this.root.items[0];var r=Os(e,t);t.items[n]=r;if(r.zindex)r.group.zdirty=true;return r};function Os(e,t){return{bounds:new Ri,clip:!!e.clip,group:t,interactive:e.interactive===false?false:true,items:[],marktype:e.marktype,name:e.name||undefined,role:e.role||undefined,zindex:e.zindex||0}}function ws(e,t,n){if(!e&&typeof document!=="undefined"&&document.createElement){e=document}return e?n?e.createElementNS(n,t):e.createElement(t):null}function js(e,t){t=t.toLowerCase();var n=e.childNodes,r=0,i=n.length;for(;r<i;++r)if(n[r].tagName.toLowerCase()===t){return n[r]}}function Ss(e,t,n,r){var i=e.childNodes[t],a;if(!i||i.tagName.toLowerCase()!==n.toLowerCase()){a=i||null;i=ws(e.ownerDocument,n,r);e.insertBefore(i,a)}return i}function Es(e,t){var n=e.childNodes,r=n.length;while(r>t)e.removeChild(n[--r]);return e}function As(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}var zs=function(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]};var Ts=function(e,t,n,r){var i=e&&e.mark,a,o;if(i&&(a=hs[i.marktype]).tip){o=zs(t,n);o[0]-=r[0];o[1]-=r[1];while(e=e.mark.group){o[0]-=e.x||0;o[1]-=e.y||0}e=a.tip(i.items,o)}return e};function Ms(e,t){this._active=null;this._handlers={};this._loader=e||Bi();this._tooltip=t||Ns}function Ns(e,t,n,r){e.element().setAttribute("title",r||"")}var Ds=Ms.prototype;Ds.initialize=function(e,t,n){this._el=e;this._obj=n||null;return this.origin(t)};Ds.element=function(){return this._el};Ds.canvas=function(){return this._el&&this._el.firstChild};Ds.origin=function(e){if(arguments.length){this._origin=e||[0,0];return this}else{return this._origin.slice()}};Ds.scene=function(e){if(!arguments.length)return this._scene;this._scene=e;return this};Ds.on=function(){};Ds.off=function(){};Ds._handlerIndex=function(e,t,n){for(var r=e?e.length:0;--r>=0;){if(e[r].type===t&&(!n||e[r].handler===n)){return r}}return-1};Ds.handlers=function(e){var t=this._handlers,n=[],r;if(e){n.push.apply(n,t[this.eventName(e)])}else{for(r in t){n.push.apply(n,t[r])}}return n};Ds.eventName=function(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)};Ds.handleHref=function(e,t,n){this._loader.sanitize(n,{context:"href"}).then(function(t){var n=new MouseEvent(e.type,e),r=ws(null,"a");for(var i in t)r.setAttribute(i,t[i]);r.dispatchEvent(n)}).catch(function(){})};Ds.handleTooltip=function(e,t,n){if(t&&t.tooltip!=null){t=Ts(t,e,this.canvas(),this._origin);var r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}};Ds.getItemBoundingClientRect=function(e){if(!(t=this.canvas()))return;var t,n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.x1+r[0]+n.left,o=i.y1+r[1]+n.top,u=i.width(),s=i.height();while(e.mark&&(e=e.mark.group)){a+=e.x||0;o+=e.y||0}return{x:a,y:o,width:u,height:s,left:a,top:o,right:a+u,bottom:o+s}};function Cs(e){this._el=null;this._bgcolor=null;this._loader=new ma(e)}var Ps=Cs.prototype;Ps.initialize=function(e,t,n,r,i){this._el=e;return this.resize(t,n,r,i)};Ps.element=function(){return this._el};Ps.canvas=function(){return this._el&&this._el.firstChild};Ps.background=function(e){if(arguments.length===0)return this._bgcolor;this._bgcolor=e;return this};Ps.resize=function(e,t,n,r){this._width=e;this._height=t;this._origin=n||[0,0];this._scale=r||1;return this};Ps.dirty=function(){};Ps.render=function(e){var t=this;t._call=function(){t._render(e)};t._call();t._call=null;return t};Ps._render=function(){};Ps.renderAsync=function(e){var t=this.render(e);return this._ready?this._ready.then(function(){return t}):Promise.resolve(t)};Ps._load=function(e,t){var n=this,r=n._loader[e](t);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then(function(e){if(e)i();n._ready=null})}return r};Ps.sanitizeURL=function(e){return this._load("sanitizeURL",e)};Ps.loadImage=function(e){return this._load("loadImage",e)};var Rs=["keydown","keypress","keyup","dragenter","dragleave","dragover","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"];var Ls="mousemove";var Is="mouseout";var Fs="click";function qs(e,t){Ms.call(this,e,t);this._down=null;this._touch=null;this._first=true}var Us=Object(V["inherits"])(qs,Ms);Us.initialize=function(e,t,n){var r=this._canvas=e&&js(e,"canvas");if(r){var i=this;this.events.forEach(function(e){r.addEventListener(e,function(t){if(Us[e]){Us[e].call(i,t)}else{i.fire(e,t)}})})}return Ms.prototype.initialize.call(this,e,t,n)};Us.canvas=function(){return this._canvas};Us.context=function(){return this._canvas.getContext("2d")};Us.events=Rs;Us.DOMMouseScroll=function(e){this.fire("mousewheel",e)};function Ws(e,t,n){return function(r){var i=this._active,a=this.pickEvent(r);if(a===i){this.fire(e,r)}else{if(!i||!i.exit){this.fire(n,r)}this._active=a;this.fire(t,r);this.fire(e,r)}}}function Vs(e){return function(t){this.fire(e,t);this._active=null}}Us.mousemove=Ws("mousemove","mouseover","mouseout");Us.dragover=Ws("dragover","dragenter","dragleave");Us.mouseout=Vs("mouseout");Us.dragleave=Vs("dragleave");Us.mousedown=function(e){this._down=this._active;this.fire("mousedown",e)};Us.click=function(e){if(this._down===this._active){this.fire("click",e);this._down=null}};Us.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]);if(this._first){this._active=this._touch;this._first=false}this.fire("touchstart",e,true)};Us.touchmove=function(e){this.fire("touchmove",e,true)};Us.touchend=function(e){this.fire("touchend",e,true);this._touch=null};Us.fire=function(e,t,n){var r=n?this._touch:this._active,i=this._handlers[e],a,o;t.vegaType=e;if(e===Fs&&r&&r.href){this.handleHref(t,r,r.href)}else if(e===Ls||e===Is){this.handleTooltip(t,r,e!==Is)}if(i){for(a=0,o=i.length;a<o;++a){i[a].handler.call(this._obj,t,r)}}};Us.on=function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){(r[n]||(r[n]=[])).push({type:e,handler:t})}return this};Us.off=function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){r.splice(i,1)}return this};Us.pickEvent=function(e){var t=zs(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])};Us.pick=function(e,t,n,r,i){var a=this.context(),o=hs[e.marktype];return o.pick.call(this,a,e,t,n,r,i)};var Hs=function(e,t){var n=t.clip;e.save();e.beginPath();if(Object(V["isFunction"])(n)){n(e)}else{var r=t.group;e.rect(0,0,r.width||0,r.height||0)}e.clip()};function Bs(){return typeof window!=="undefined"?window.devicePixelRatio||1:1}var Gs=Bs();var $s=function(e,t,n,r,i){var a=typeof HTMLElement!=="undefined"&&e instanceof HTMLElement&&e.parentNode!=null;var o=e.getContext("2d"),u=a?Gs:i;e.width=t*u;e.height=n*u;if(a&&u!==1){e.style.width=t+"px";e.style.height=n+"px"}o.pixelRatio=u;o.setTransform(u,0,0,u,u*r[0],u*r[1]);return e};function Ys(e){Cs.call(this,e);this._redraw=false;this._dirty=new Ri}var Xs=Object(V["inherits"])(Ys,Cs),Js=Cs.prototype,Qs=new Ri;Xs.initialize=function(e,t,n,r,i){this._canvas=Object(Wi["a"])(1,1);if(e){Es(e,0).appendChild(this._canvas);this._canvas.setAttribute("class","marks")}return Js.initialize.call(this,e,t,n,r,i)};Xs.resize=function(e,t,n,r){Js.resize.call(this,e,t,n,r);$s(this._canvas,this._width,this._height,this._origin,this._scale);this._redraw=true;return this};Xs.canvas=function(){return this._canvas};Xs.context=function(){return this._canvas?this._canvas.getContext("2d"):null};Xs.dirty=function(e){var t=Ks(e.bounds,e.mark.group);this._dirty.union(t)};function Zs(e,t,n){t.expand(1).round();t.translate(-(n[0]%1),-(n[1]%1));e.beginPath();e.rect(t.x1,t.y1,t.width(),t.height());e.clip();return t}function Ks(e,t){if(t==null)return e;var n=Qs.clear().union(e);for(;t!=null;t=t.mark.group){n.translate(t.x||0,t.y||0)}return n}Xs._render=function(e){var t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty;t.save();if(this._redraw||a.empty()){this._redraw=false;a=null}else{a=Zs(t,a,n)}this.clear(-n[0],-n[1],r,i);this.draw(t,e,a);t.restore();this._dirty.clear();return this};Xs.draw=function(e,t,n){var r=hs[t.marktype];if(t.clip)Hs(e,t);r.draw.call(this,e,t,n);if(t.clip)e.restore()};Xs.clear=function(e,t,n,r){var i=this.context();i.clearRect(e,t,n,r);if(this._bgcolor!=null){i.fillStyle=this._bgcolor;i.fillRect(e,t,n,r)}};function el(e,t){Ms.call(this,e,t);var n=this;n._hrefHandler=nl(n,function(e,t){if(t&&t.href)n.handleHref(e,t,t.href)});n._tooltipHandler=nl(n,function(e,t){n.handleTooltip(e,t,e.type!==Is)})}var tl=Object(V["inherits"])(el,Ms);tl.initialize=function(e,t,n){var r=this._svg;if(r){r.removeEventListener(Fs,this._hrefHandler);r.removeEventListener(Ls,this._tooltipHandler);r.removeEventListener(Is,this._tooltipHandler)}this._svg=r=e&&js(e,"svg");if(r){r.addEventListener(Fs,this._hrefHandler);r.addEventListener(Ls,this._tooltipHandler);r.addEventListener(Is,this._tooltipHandler)}return Ms.prototype.initialize.call(this,e,t,n)};tl.canvas=function(){return this._svg};function nl(e,t){return function(n){var r=n.target,i=r.__data__;n.vegaType=n.type;i=Array.isArray(i)?i[0]:i;t.call(e._obj,n,i)}}tl.on=function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){var a={type:e,handler:t,listener:nl(this,t)};(r[n]||(r[n]=[])).push(a);if(this._svg){this._svg.addEventListener(n,a.listener)}}return this};tl.off=function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){if(this._svg){this._svg.removeEventListener(n,r[i].listener)}r.splice(i,1)}return this};function rl(e,t,n){var r="<"+e,i,a;if(t){for(i in t){a=t[i];if(a!=null){r+=" "+i+'="'+a+'"'}}}if(n)r+=" "+n;return r+">"}function il(e){return"</"+e+">"}var al={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};var ol={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"};var ul=Object.keys(ol);var sl=al.xmlns;function ll(e){Cs.call(this,e);this._dirtyID=1;this._dirty=[];this._svg=null;this._root=null;this._defs=null}var fl=Object(V["inherits"])(ll,Cs);var cl=Cs.prototype;fl.initialize=function(e,t,n,r){if(e){this._svg=Ss(e,0,"svg",sl);this._svg.setAttribute("class","marks");Es(e,1);this._root=Ss(this._svg,0,"g",sl);Es(this._svg,1)}this._defs={gradient:{},clipping:{}};this.background(this._bgcolor);return cl.initialize.call(this,e,t,n,r)};fl.background=function(e){if(arguments.length&&this._svg){this._svg.style.setProperty("background-color",e)}return cl.background.apply(this,arguments)};fl.resize=function(e,t,n,r){cl.resize.call(this,e,t,n,r);if(this._svg){this._svg.setAttribute("width",this._width*this._scale);this._svg.setAttribute("height",this._height*this._scale);this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height);this._root.setAttribute("transform","translate("+this._origin+")")}this._dirty=[];return this};fl.canvas=function(){return this._svg};fl.svg=function(){if(!this._svg)return null;var e={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var t in al){e[t]=al[t]}var n=!this._bgcolor?"":rl("rect",{width:this._width,height:this._height,style:"fill: "+this._bgcolor+";"})+il("rect");return rl("svg",e)+n+this._svg.innerHTML+il("svg")};fl._render=function(e){if(this._dirtyCheck()){if(this._dirtyAll)this._resetDefs();this.draw(this._root,e);Es(this._root,1)}this.updateDefs();this._dirty=[];++this._dirtyID;return this};fl.updateDefs=function(){var e=this._svg,t=this._defs,n=t.el,r=0,i;for(i in t.gradient){if(!n)t.el=n=Ss(e,0,"defs",sl);dl(n,t.gradient[i],r++)}for(i in t.clipping){if(!n)t.el=n=Ss(e,0,"defs",sl);hl(n,t.clipping[i],r++)}if(n){if(r===0){e.removeChild(n);t.el=null}else{Es(n,r)}}};function dl(e,t,n){var r,i,a;e=Ss(e,n,"linearGradient",sl);e.setAttribute("id",t.id);e.setAttribute("x1",t.x1);e.setAttribute("x2",t.x2);e.setAttribute("y1",t.y1);e.setAttribute("y2",t.y2);for(r=0,i=t.stops.length;r<i;++r){a=Ss(e,r,"stop",sl);a.setAttribute("offset",t.stops[r].offset);a.setAttribute("stop-color",t.stops[r].color)}Es(e,r)}function hl(e,t,n){var r;e=Ss(e,n,"clipPath",sl);e.setAttribute("id",t.id);if(t.path){r=Ss(e,0,"path",sl);r.setAttribute("d",t.path)}else{r=Ss(e,0,"rect",sl);r.setAttribute("x",0);r.setAttribute("y",0);r.setAttribute("width",t.width);r.setAttribute("height",t.height)}}fl._resetDefs=function(){var e=this._defs;e.gradient={};e.clipping={}};fl.dirty=function(e){if(e.dirty!==this._dirtyID){e.dirty=this._dirtyID;this._dirty.push(e)}};fl.isDirty=function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID};fl._dirtyCheck=function(){this._dirtyAll=true;var e=this._dirty;if(!e.length)return true;var t=++this._dirtyID,n,r,i,a,o,u,s;for(o=0,u=e.length;o<u;++o){n=e[o];r=n.mark;if(r.marktype!==i){i=r.marktype;a=hs[i]}if(r.zdirty&&r.dirty!==t){this._dirtyAll=false;pl(n,t);r.items.forEach(function(e){e.dirty=t})}if(r.zdirty)continue;if(n.exit){if(a.nested&&r.items.length){s=r.items[0];if(s._svg)this._update(a,s._svg,s)}else if(n._svg){s=n._svg.parentNode;if(s)s.removeChild(n._svg)}n._svg=null;continue}n=a.nested?r.items[0]:n;if(n._update===t)continue;if(!n._svg||!n._svg.ownerSVGElement){this._dirtyAll=false;pl(n,t)}else{this._update(a,n._svg,n)}n._update=t}return!this._dirtyAll};function pl(e,t){for(;e&&e.dirty!==t;e=e.mark.group){e.dirty=t;if(e.mark&&e.mark.dirty!==t){e.mark.dirty=t}else return}}fl.draw=function(e,t,n){if(!this.isDirty(t))return t._svg;var r=this,i=this._svg,a=hs[t.marktype],o=t.interactive===false?"none":null,u=a.tag==="g",s=null,l=0,f;f=gl(t,e,n,"g",i);f.setAttribute("class",As(t));if(!u){f.style.setProperty("pointer-events",o)}if(t.clip){f.setAttribute("clip-path",lu(r,t,t.group))}else{f.removeAttribute("clip-path")}function c(e){var t=r.isDirty(e),n=gl(e,f,s,a.tag,i);if(t){r._update(a,n,e);if(u)vl(r,n,e)}s=n;++l}if(a.nested){if(t.items.length)c(t.items[0])}else{Vo(t,c)}Es(f,l);return f};function vl(e,t,n){t=t.lastChild;var r,i=0;Vo(n,function(n){r=e.draw(t,n,r);++i});Es(t,1+i)}function gl(e,t,n,r,i){var a=e._svg,o;if(!a){o=t.ownerDocument;a=ws(o,r,sl);e._svg=a;if(e.mark){a.__data__=e;a.__values__={fill:"default"};if(r==="g"){var u=ws(o,"path",sl);u.setAttribute("class","background");a.appendChild(u);u.__data__=e;var s=ws(o,"g",sl);a.appendChild(s);s.__data__=e}}}if(a.ownerSVGElement!==i||ml(e)&&a.previousSibling!==n){t.insertBefore(a,n?n.nextSibling:t.firstChild)}return a}function ml(e){var t=e.mark||e.group;return t&&t.items.length>1}var yl=null,bl=null;var _l={group:function(e,t,n){bl=t.__values__;yl=t.childNodes[1];e.foreground(kl,n,this);yl=t.childNodes[0];e.background(kl,n,this);var r=n.mark.interactive===false?"none":null;if(r!==bl.events){yl.style.setProperty("pointer-events",r);bl.events=r}},text:function(e,t,n){var r;r=es(n);if(r!==bl.text){t.textContent=r;bl.text=r}xl(t,"font-family",ns(n));xl(t,"font-size",Zu(n)+"px");xl(t,"font-style",n.fontStyle);xl(t,"font-variant",n.fontVariant);xl(t,"font-weight",n.fontWeight)}};function xl(e,t,n){if(n!==bl[t]){if(n==null){e.style.removeProperty(t)}else{e.style.setProperty(t,n+"")}bl[t]=n}}fl._update=function(e,t,n){yl=t;bl=t.__values__;e.attr(kl,n,this);var r=_l[e.type];if(r)r.call(this,e,t,n);this.style(yl,n)};function kl(e,t,n){if(t===bl[e])return;if(t!=null){if(n){yl.setAttributeNS(n,e,t)}else{yl.setAttribute(e,t)}}else{if(n){yl.removeAttributeNS(n,e)}else{yl.removeAttribute(e)}}bl[e]=t}fl.style=function(e,t){if(t==null)return;var n,r,i,a,o;for(n=0,r=ul.length;n<r;++n){i=ul[n];o=t[i];if(i==="font"){o=ns(t)}if(o===bl[i])continue;a=ol[i];if(o==null){if(a==="fill"){e.style.setProperty(a,"none")}else{e.style.removeProperty(a)}}else{if(o.id){this._defs.gradient[o.id]=o;o="url("+Ol()+"#"+o.id+")"}e.style.setProperty(a,o+"")}bl[i]=o}};function Ol(){var e;return typeof window==="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function wl(e){Cs.call(this,e);this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""};this._defs={gradient:{},clipping:{}}}var jl=Object(V["inherits"])(wl,Cs);var Sl=Cs.prototype;jl.resize=function(e,t,n,r){Sl.resize.call(this,e,t,n,r);var i=this._origin,a=this._text;var o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var u in al){o[u]=al[u]}a.head=rl("svg",o);var s=this._bgcolor;if(s==="transparent"||s==="none")s=null;if(s){a.bg=rl("rect",{width:this._width,height:this._height,style:"fill: "+s+";"})+il("rect")}else{a.bg=""}a.root=rl("g",{transform:"translate("+i+")"});a.foot=il("g")+il("svg");return this};jl.background=function(){var e=Sl.background.apply(this,arguments);if(arguments.length&&this._text.head){this.resize(this._width,this._height,this._origin,this._scale)}return e};jl.svg=function(){var e=this._text;return e.head+e.bg+e.defs+e.root+e.body+e.foot};jl._render=function(e){this._text.body=this.mark(e);this._text.defs=this.buildDefs();return this};jl.buildDefs=function(){var e=this._defs,t="",n,r,i,a;for(r in e.gradient){i=e.gradient[r];a=i.stops;t+=rl("linearGradient",{id:r,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(n=0;n<a.length;++n){t+=rl("stop",{offset:a[n].offset,"stop-color":a[n].color})+il("stop")}t+=il("linearGradient")}for(r in e.clipping){i=e.clipping[r];t+=rl("clipPath",{id:r});if(i.path){t+=rl("path",{d:i.path})+il("path")}else{t+=rl("rect",{x:0,y:0,width:i.width,height:i.height})+il("rect")}t+=il("clipPath")}return t.length>0?rl("defs")+t+il("defs"):""};var El;function Al(e,t,n,r){El[r||e]=t}jl.attributes=function(e,t){El={};e(Al,t,this);return El};jl.href=function(e){var t=this,n=e.href,r;if(n){if(r=t._hrefs&&t._hrefs[n]){return r}else{t.sanitizeURL(n).then(function(e){e["xlink:href"]=e.href;e.href=null;(t._hrefs||(t._hrefs={}))[n]=e})}}return null};jl.mark=function(e){var t=this,n=hs[e.marktype],r=n.tag,i=this._defs,a="",o;if(r!=="g"&&e.interactive===false){o='style="pointer-events: none;"'}a+=rl("g",{class:As(e),"clip-path":e.clip?lu(t,e,e.group):null},o);function u(u){var s=t.href(u);if(s)a+=rl("a",s);o=r!=="g"?zl(u,e,r,i):null;a+=rl(r,t.attributes(n.attr,u),o);if(r==="text"){a+=Tl(es(u))}else if(r==="g"){a+=rl("path",t.attributes(n.background,u),zl(u,e,"bgrect",i))+il("path");a+=rl("g",t.attributes(n.foreground,u))+t.markGroup(u)+il("g")}a+=il(r);if(s)a+=il("a")}if(n.nested){if(e.items&&e.items.length)u(e.items[0])}else{Vo(e,u)}return a+il("g")};jl.markGroup=function(e){var t=this,n="";Vo(e,function(e){n+=t.mark(e)});return n};function zl(e,t,n,r){if(e==null)return"";var i,a,o,u,s,l="";if(n==="bgrect"&&t.interactive===false){l+="pointer-events: none; "}if(n==="text"){l+="font-family: "+ns(e)+"; ";l+="font-size: "+Zu(e)+"px; ";if(e.fontStyle)l+="font-style: "+e.fontStyle+"; ";if(e.fontVariant)l+="font-variant: "+e.fontVariant+"; ";if(e.fontWeight)l+="font-weight: "+e.fontWeight+"; "}for(i=0,a=ul.length;i<a;++i){o=ul[i];u=ol[o];s=e[o];if(s==null){if(u==="fill"){l+="fill: none; "}}else if(s==="transparent"&&(u==="fill"||u==="stroke")){l+=u+": none; "}else{if(s.id){r.gradient[s.id]=s;s="url(#"+s.id+")"}l+=u+": "+s+"; "}}return l?'style="'+l.trim()+'"':null}function Tl(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Ml="canvas";var Nl="png";var Dl="svg";var Cl="none";var Pl={Canvas:Ml,PNG:Nl,SVG:Dl,None:Cl};var Rl={};Rl[Ml]=Rl[Nl]={renderer:Ys,headless:Ys,handler:qs};Rl[Dl]={renderer:ll,headless:wl,handler:el};Rl[Cl]={};function Ll(e,t){e=String(e||"").toLowerCase();if(arguments.length>1){Rl[e]=t;return this}else{return Rl[e]}}var Il=new Ri;var Fl=function(e){var t=e.clip;if(Object(V["isFunction"])(t)){t(Do(Il.clear()))}else if(t){Il.set(0,0,e.group.width,e.group.height)}else return;e.bounds.intersect(Il)};var ql=1e-9;function Ul(e,t,n){return e===t?true:n==="path"?Wl(e,t):e instanceof Date&&t instanceof Date?+e===+t:Object(V["isNumber"])(e)&&Object(V["isNumber"])(t)?Math.abs(e-t)<=ql:!e||!t||!Object(V["isObject"])(e)&&!Object(V["isObject"])(t)?e==t:e==null||t==null?false:Vl(e,t)}function Wl(e,t){return Ul(Sa(e),Sa(t))}function Vl(e,t){var n=Object.keys(e),r=Object.keys(t),i,a;if(n.length!==r.length)return false;n.sort();r.sort();for(a=n.length-1;a>=0;a--){if(n[a]!=r[a])return false}for(a=n.length-1;a>=0;a--){i=n[a];if(!Ul(e[i],t[i],i))return false}return typeof e===typeof t}function Hl(e){Wt.call(this,null,e)}var Bl=Object(V["inherits"])(Hl,Wt);Bl.transform=function(e,t){var n=t.dataflow,r=e.mark,i=r.marktype,a=hs[i],o=a.bound,u=r.bounds,s;if(a.nested){if(r.items.length)n.dirty(r.items[0]);u=Gl(r,o);r.items.forEach(function(e){e.bounds.clear().union(u)})}else if(i===di||e.modified()){t.visit(t.MOD,function(e){n.dirty(e)});u.clear();r.items.forEach(function(e){u.union(Gl(e,o))});if(r.role===mi)t.reflow()}else{s=t.changed(t.REM);t.visit(t.ADD,function(e){u.union(Gl(e,o))});t.visit(t.MOD,function(e){s=s||u.alignsWith(e.bounds);n.dirty(e);u.union(Gl(e,o))});if(s){u.clear();r.items.forEach(function(e){u.union(e.bounds)})}}Fl(r);return t.modifies("bounds")};function Gl(e,t,n){return t(e.bounds.clear(),e,n)}var $l=":vega_identifier:";function Yl(e){Wt.call(this,0,e)}Yl.Definition={type:"Identifier",metadata:{modifies:true},params:[{name:"as",type:"string",required:true}]};var Xl=Object(V["inherits"])(Yl,Wt);Xl.transform=function(e,t){var n=Jl(t.dataflow),r=n.value,i=e.as;t.visit(t.ADD,function(e){if(!e[i])e[i]=++r});n.set(this.value=r);return t};function Jl(e){var t=e._signals[$l];if(!t){e._signals[$l]=t=e.add(0)}return t}function Ql(e){Wt.call(this,null,e)}var Zl=Object(V["inherits"])(Ql,Wt);Zl.transform=function(e,t){var n=this.value;if(!n){n=t.dataflow.scenegraph().mark(e.markdef,Kl(e),e.index);n.group.context=e.context;if(!e.context.group)e.context.group=n.group;n.source=this;n.clip=e.clip;n.interactive=e.interactive;this.value=n}var r=n.marktype===di?Ui:qi;t.visit(t.ADD,function(e){r.call(e,n)});if(e.modified("clip")||e.modified("interactive")){n.clip=e.clip;n.interactive=!!e.interactive;n.zdirty=true;t.reflow()}n.items=t.source;return t};function Kl(e){var t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function ef(e){Wt.call(this,null,e)}var tf=Object(V["inherits"])(ef,Wt);var nf={parity:function(e){return e.filter(function(e,t){return t%2?e.opacity=0:1})},greedy:function(e){var t;return e.filter(function(e,n){if(!n||!rf(t.bounds,e.bounds)){t=e;return 1}else{return e.opacity=0}})}};function rf(e,t){return!(e.x2-1<t.x1||e.x1+1>t.x2||e.y2-1<t.y1||e.y1+1>t.y2)}function af(e){for(var t=1,n=e.length,r=e[0].bounds,i;t<n;r=i,++t){if(rf(r,i=e[t].bounds))return true}}function of(e){var t=e.bounds;return t.width()>1&&t.height()>1}function uf(e,t,n){var r=e.range(),i=new Ri;if(t===ti||t===ii){i.set(r[0],-Infinity,r[1],+Infinity)}else{i.set(-Infinity,r[0],+Infinity,r[1])}i.expand(n||1);return function(e){return i.encloses(e.bounds)}}function sf(e){e.forEach(function(e){e.opacity=1});return e}function lf(e,t){return e.reflow(t.modified()).modifies("opacity")}tf.transform=function(e,t){var n=nf[e.method]||nf.parity,r=t.materialize(t.SOURCE).source,i,a;if(!r)return;if(!e.method){if(e.modified("method")){sf(r);t=lf(t,e)}return t}if(e.sort){r=r.slice().sort(e.sort)}if(e.method==="greedy"){r=r.filter(of)}i=sf(r);t=lf(t,e);if(i.length>=3&&af(i)){do{i=n(i)}while(i.length>=3&&af(i));if(i.length<3&&!Object(V["peek"])(r).opacity){if(i.length>1)Object(V["peek"])(i).opacity=0;Object(V["peek"])(r).opacity=1}}if(e.boundScale&&e.boundTolerance>=0){a=uf(e.boundScale,e.boundOrient,+e.boundTolerance);r.forEach(function(e){if(!a(e))e.opacity=0})}return t};function ff(e){Wt.call(this,null,e)}var cf=Object(V["inherits"])(ff,Wt);cf.transform=function(e,t){var n=t.dataflow;t.visit(t.ALL,function(e){n.dirty(e)});if(t.fields&&t.fields["zindex"]){var r=t.source&&t.source[0];if(r)r.mark.zdirty=true}};function df(e){var t=e.items,n=t.length,r=0,i,a;var o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;r<n;++r){i=t[r];a=i.items;if(i.marktype===di){switch(i.role){case hi:case mi:break;case yi:hf(a,o.rowheaders);break;case bi:hf(a,o.rowfooters);break;case xi:hf(a,o.colheaders);break;case ki:hf(a,o.colfooters);break;case _i:o.rowtitle=a[0];break;case Oi:o.coltitle=a[0];break;default:hf(a,o.marks)}}}return o}function hf(e,t){for(var n=0,r=e.length;n<r;++n){t.push(e[n])}}function pf(e){return{x1:0,y1:0,x2:e.width||0,y2:e.height||0}}function vf(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function gf(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):undefined}function mf(e,t){return e.bounds[t]}function yf(e,t,n){var r=Object(V["isObject"])(e)?e[t]:e;return r!=null?r:n!==undefined?n:0}function bf(e){return e<0?Math.ceil(-e):0}function _f(e,t,n){var r=df(t,n),i=r.marks,a=n.bounds===Di,o=a?pf:vf,u=new Ri(0,0,0,0),s=yf(n.align,Ci),l=yf(n.align,Pi),f=yf(n.padding,Ci),c=yf(n.padding,Pi),d=n.offset,h=t.columns||n.columns||i.length,p=h<0?1:Math.ceil(i.length/h),v=p*h,g=[],m=[],y=0,b=0,_=[],x=[],k=0,O=0,w=i.length,j,S,E,A,z,T,M,N,D,C,P,R;for(S=0;S<h;++S){m[S]=0}for(S=0;S<p;++S){x[S]=0}for(S=0;S<w;++S){z=o(i[S]);E=S%h;A=~~(S/h);M=Math.ceil(o(i[S]).x2);N=Math.ceil(o(i[S]).y2);y=Math.max(y,M);k=Math.max(k,N);m[E]=Math.max(m[E],M);x[A]=Math.max(x[A],N);g.push(f+bf(z.x1));_.push(c+bf(z.y1));e.dirty(i[S])}for(S=0;S<w;++S){if(S%h===0)g[S]=b;if(S<h)_[S]=O}if(s===Ni){for(E=1;E<h;++E){for(R=0,S=E;S<w;S+=h){if(R<g[S])R=g[S]}for(S=E;S<w;S+=h){g[S]=R+m[E-1]}}}else if(s===Mi){for(R=0,S=0;S<w;++S){if(S%h&&R<g[S])R=g[S]}for(S=0;S<w;++S){if(S%h)g[S]=R+y}}else{for(s=false,E=1;E<h;++E){for(S=E;S<w;S+=h){g[S]+=m[E-1]}}}if(l===Ni){for(A=1;A<p;++A){for(R=0,S=A*h,j=S+h;S<j;++S){if(R<_[S])R=_[S]}for(S=A*h;S<j;++S){_[S]=R+x[A-1]}}}else if(l===Mi){for(R=0,S=h;S<w;++S){if(R<_[S])R=_[S]}for(S=h;S<w;++S){_[S]=R+k}}else{for(l=false,A=1;A<p;++A){for(S=A*h,j=S+h;S<j;++S){_[S]+=x[A-1]}}}for(D=0,S=0;S<w;++S){T=i[S];M=T.x||0;T.x=D=g[S]+(S%h?D:0);T.bounds.translate(D-M,0)}for(E=0;E<h;++E){for(C=0,S=E;S<w;S+=h){T=i[S];N=T.y||0;T.y=C+=_[S];T.bounds.translate(0,C-N)}}if(yf(n.center,Ci)&&p>1&&s){for(S=0;S<w;++S){T=i[S];z=s===Mi?y:m[S%h];D=z-o(T).x2;if(D>0){T.x+=M=D/2;T.bounds.translate(M,0)}}}if(yf(n.center,Pi)&&h!==1&&l){for(S=0;S<w;++S){T=i[S];z=l===Mi?k:x[~~(S/h)];C=z-o(T).y2;if(C>0){T.y+=N=C/2;T.bounds.translate(0,N)}}}for(S=0;S<w;++S)i[S].mark.bounds.clear();for(S=0;S<w;++S){T=i[S];e.dirty(T);u.union(T.mark.bounds.union(T.bounds))}function L(e,t){return Math.floor(Math.min(e,t))}function I(e,t){return Math.ceil(Math.max(e,t))}o=a?gf:mf;P=yf(n.headerBand,Pi,null);D=xf(e,r.rowheaders,i,h,p,-yf(d,"rowHeader"),L,0,o,"x1",0,h,1,P);P=yf(n.headerBand,Ci,null);C=xf(e,r.colheaders,i,h,h,-yf(d,"columnHeader"),L,1,o,"y1",0,1,h,P);P=yf(n.footerBand,Pi,null);xf(e,r.rowfooters,i,h,p,yf(d,"rowFooter"),I,0,o,"x2",h-1,h,1,P);P=yf(n.footerBand,Ci,null);xf(e,r.colfooters,i,h,h,yf(d,"columnFooter"),I,1,o,"y2",v-h,1,h,P);if(r.rowtitle){R=D-yf(d,"rowTitle");P=yf(n.titleBand,Pi,.5);kf(e,r.rowtitle,R,0,u,P)}if(r.coltitle){R=C-yf(d,"columnTitle");P=yf(n.titleBand,Ci,.5);kf(e,r.coltitle,R,1,u,P)}}function xf(e,t,n,r,i,a,o,u,s,l,f,c,d,h){var p=n.length,v=0,g=0,m,y,b,_,x,k,O,w,j;if(!p)return v;for(m=f;m<p;m+=c){if(n[m])v=o(v,s(n[m],l))}if(!t.length)return v;if(t.length>i){e.warn("Grid headers exceed limit: "+i);t=t.slice(0,i)}v+=a;for(y=0,_=t.length;y<_;++y){e.dirty(t[y]);t[y].mark.bounds.clear()}for(m=f,y=0,_=t.length;y<_;++y,m+=c){k=t[y];x=k.mark.bounds;for(b=m;b>=0&&(O=n[b])==null;b-=d);if(u){w=h==null?O.x:Math.round(O.bounds.x1+h*O.bounds.width());j=v}else{w=v;j=h==null?O.y:Math.round(O.bounds.y1+h*O.bounds.height())}x.union(k.bounds.translate(w-(k.x||0),j-(k.y||0)));k.x=w;k.y=j;e.dirty(k);g=o(g,x[l])}return g}function kf(e,t,n,r,i,a){if(!t)return;e.dirty(t);var o=n,u=n;r?o=Math.round(i.x1+a*i.width()):u=Math.round(i.y1+a*i.height());t.bounds.translate(o-(t.x||0),u-(t.y||0));t.mark.bounds.clear().union(t.bounds);t.x=o;t.y=u;e.dirty(t)}var Of=.5,wf=new Ri;function jf(e){Wt.call(this,null,e)}var Sf=Object(V["inherits"])(jf,Wt);Sf.transform=function(e,t){var n=t.dataflow;e.mark.items.forEach(function(t){if(e.layout)_f(n,t,e.layout);Ef(n,t,e)});if(e.modified())t.reflow();return t};function Ef(e,t,n){var r=t.items,i=Math.max(0,t.width||0),a=Math.max(0,t.height||0),o=(new Ri).set(0,0,i,a),u=o.clone(),s=o.clone(),l=[],f,c,d,h,p,v;for(p=0,v=r.length;p<v;++p){c=r[p];switch(c.role){case hi:h=zf(c)?u:s;h.union(Mf(e,c,i,a));break;case pi:f=c;break;case mi:l.push(c);break;case vi:case gi:case yi:case bi:case _i:case xi:case ki:case Oi:u.union(c.bounds);s.union(c.bounds);break;default:o.union(c.bounds)}}if(l.length){d={leftWidth:Cf(e,l),margin:n.legendMargin||8,left:0,right:0,top:0,bottom:0};for(p=0,v=l.length;p<v;++p){h=Rf(e,l[p],d,u,s,i,a);if(n.autosize&&n.autosize.type===Si){var g=l[p].items[0].datum.orient;if(g===ni||g===ri){o.add(h.x1,0).add(h.x2,0)}else if(g===ti||g===ii){o.add(0,h.y1).add(0,h.y2)}}else{o.union(h)}}}o.union(u).union(s);if(f){o.union(Df(e,f,i,a,o))}If(e,t,o,n)}function Af(e,t,n){if(e[t]===n){return 0}else{e[t]=n;return 1}}function zf(e){var t=e.items[0].datum.orient;return t===ni||t===ri}function Tf(e){var t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function Mf(e,t,n,r){var i=t.items[0],a=i.datum,o=a.orient,u=Tf(a),s=i.range,l=i.offset,f=i.position,c=i.minExtent,d=i.maxExtent,h=a.title&&i.items[u[2]].items[0],p=i.titlePadding,v=i.bounds,g=0,m=0,y,b;wf.clear().union(v);v.clear();if((y=u[0])>-1)v.union(i.items[y].bounds);if((y=u[1])>-1)v.union(i.items[y].bounds);switch(o){case ti:g=f||0;m=-l;b=Math.max(c,Math.min(d,-v.y1));if(h)b=Nf(h,b,p,0,-1,v);v.add(0,-b).add(s,0);break;case ni:g=-l;m=f||0;b=Math.max(c,Math.min(d,-v.x1));if(h)b=Nf(h,b,p,1,-1,v);v.add(-b,0).add(0,s);break;case ri:g=n+l;m=f||0;b=Math.max(c,Math.min(d,v.x2));if(h)b=Nf(h,b,p,1,1,v);v.add(0,0).add(b,s);break;case ii:g=f||0;m=r+l;b=Math.max(c,Math.min(d,v.y2));if(h)b=Nf(h,b,p,0,1,v);v.add(0,0).add(s,b);break;default:g=i.x;m=i.y}Ao(v.translate(g,m),i);if(Af(i,"x",g+Of)|Af(i,"y",m+Of)){i.bounds=wf;e.dirty(i);i.bounds=v;e.dirty(i)}return i.mark.bounds.clear().union(v)}function Nf(e,t,n,r,i,a){var o=e.bounds,u=0,s=0;if(e.auto){t+=n;r?u=(e.x||0)-(e.x=i*t):s=(e.y||0)-(e.y=i*t);o.translate(-u,-s);e.mark.bounds.set(o.x1,o.y1,o.x2,o.y2);if(r){a.add(0,o.y1).add(0,o.y2);t+=o.width()}else{a.add(o.x1,0).add(o.x2,0);t+=o.height()}}else{a.union(o)}return t}function Df(e,t,n,r,i){var a=t.items[0],o=a.orient,u=a.frame,s=a.anchor,l=a.offset,f=a.bounds,c=o===ni||o===ri,d=0,h=c?r:n,p=0,v=0,g;if(u!==di){o===ni?(d=i.y2,h=i.y1):o===ri?(d=i.y1,h=i.y2):(d=i.x1,h=i.x2)}else if(o===ni){d=r,h=0}g=s===li?d:s===ci?h:(d+h)/2;wf.clear().union(f);switch(o){case ti:p=g;v=i.y1-l;break;case ni:p=i.x1-l;v=g;break;case ri:p=i.x2+l;v=g;break;case ii:p=g;v=i.y2+l;break;default:p=a.x;v=a.y}f.translate(p-a.x,v-a.y);if(Af(a,"x",p)|Af(a,"y",v)){a.bounds=wf;e.dirty(a);a.bounds=f;e.dirty(a)}return t.bounds.clear().union(f)}function Cf(e,t){return t.reduce(function(t,n){var r=n.items[0];Pf(e,r,r.items[0].items[0]);if(r.datum.orient===ni){var i=wf.clear();r.items.forEach(function(e){i.union(e.bounds)});t=Math.max(t,Math.ceil(i.width()+2*r.padding-1))}return t},0)}function Pf(e,t,n){var r=t.padding-n.x,i=t.padding-n.y;if(t.datum.title){var a=t.items[1].items[0];i+=t.titlePadding+a.fontSize}if(r||i){n.x+=r;n.y+=i;n.bounds.translate(r,i);n.mark.bounds.translate(r,i);e.dirty(n)}}function Rf(e,t,n,r,i,a,o){var u=t.items[0],s=u.datum,l=s.orient,f=u.offset,c=u.bounds,d=0,h=0,p,v,g;if(l===ti||l===ii){g=i,d=n[l]}else if(l===ni||l===ri){g=r;h=n[l]}wf.clear().union(c);c.clear();u.items.forEach(function(e){c.union(e.bounds)});p=Math.ceil(c.width()+2*u.padding-1);v=Math.ceil(c.height()+2*u.padding-1);if(s.type===ji){Lf(u.items[0].items[0].items[0].items)}switch(l){case ni:d-=n.leftWidth+f-Math.floor(g.x1);n.left+=v+n.margin;break;case ri:d+=f+Math.ceil(g.x2);n.right+=v+n.margin;break;case ti:h-=v+f-Math.floor(g.y1);n.top+=p+n.margin;break;case ii:h+=f+Math.ceil(g.y2);n.bottom+=p+n.margin;break;case ai:d+=f;h+=f;break;case oi:d+=a-p-f;h+=f;break;case ui:d+=f;h+=o-v-f;break;case si:d+=a-p-f;h+=o-v-f;break;default:d=u.x;h=u.y}Ao(c.set(d,h,d+p,h+v),u);if(Af(u,"x",d)|Af(u,"width",p)|Af(u,"y",h)|Af(u,"height",v)){u.bounds=wf;e.dirty(u);u.bounds=c;e.dirty(u)}return u.mark.bounds.clear().union(c)}function Lf(e){var t=e.reduce(function(e,t){e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0);return e},{});e.forEach(function(e){e.width=t[e.column];e.height=e.bounds.y2-e.y})}function If(e,t,n,r){var i=r.autosize||{},a=i.type,o=e._width,u=e._height,s=e.padding();if(e._autosize<1||!a)return;var l=Math.max(0,t.width||0),f=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,Math.ceil(n.x2-l)),d=Math.max(0,t.height||0),h=Math.max(0,Math.ceil(-n.y1)),p=Math.max(0,Math.ceil(n.y2-d));if(i.contains===wi){o-=s.left+s.right;u-=s.top+s.bottom}if(a===Ti){f=0;h=0;l=o;d=u}else if(a===Si){l=Math.max(0,o-f-c);d=Math.max(0,u-h-p)}else if(a===Ei){l=Math.max(0,o-f-c);u=d+h+p}else if(a===Ai){o=l+f+c;d=Math.max(0,u-h-p)}else if(a===zi){o=l+f+c;u=d+h+p}e._resizeView(o,u,l,d,[f,h],i.resize)}var Ff="log";var qf="pow";var Uf="utc";var Wf="sqrt";var Vf="band";var Hf="time";var Bf="point";var Gf="linear";var $f="ordinal";var Yf="quantile";var Xf="quantize";var Jf="threshold";var Qf="bin-linear";var Zf="bin-ordinal";var Kf="sequential";var ec=n("kakv");var tc=n("91jP");function nc(e,t){var n;if(Object(V["isObject"])(t)){n=t.step;t=t.interval}if(Object(V["isString"])(t)){t=e.type==="time"?Object(ec["i"])(t):e.type==="utc"?Object(ec["j"])(t):Object(V["error"])("Only time and utc scales accept interval strings.");if(n)t=t.every(n)}return t}function rc(e,t,n){var r=e.range(),i=r[0],a=Object(V["peek"])(r);if(i>a){r=a;a=i;i=r}t=t.filter(function(t){t=e(t);return!(t<i||t>a)});if(n>0&&t.length>1){var o=[t[0],Object(V["peek"])(t)];while(t.length>n&&t.length>=3){t=t.filter(function(e,t){return!(t%2)})}if(t.length<3){t=o}}return t}function ic(e,t){return e.ticks?e.ticks(t):e.domain()}function ac(e,t,n){var r=e.tickFormat?e.tickFormat(t,n):n?Object(tc["format"])(n):String;return e.type===Ff?oc(r,uc(n)):r}function oc(e,t){return function(n){return e(n)?t(n):""}}function uc(e){var t=Object(tc["formatSpecifier"])(e||",");if(t.precision==null){t.precision=12;switch(t.type){case"%":t.precision-=2;break;case"e":t.precision-=1;break}return sc(Object(tc["format"])(t),Object(tc["format"])(".1f")(1)[1])}else{return Object(tc["format"])(t)}}function sc(e,t){return function(n){var r=e(n),i=r.indexOf(t),a,o;if(i<0)return r;a=lc(r,i);o=a<r.length?r.slice(a):"";while(--a>i)if(r[a]!=="0"){++a;break}return r.slice(0,a)+o}}function lc(e,t){var n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;){r=e.charCodeAt(n);if(r>=48&&r<=57)return n+1}}function fc(e){Wt.call(this,null,e)}var cc=Object(V["inherits"])(fc,Wt);cc.transform=function(e,t){if(this.value&&!e.modified()){return t.StopPropagation}var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,i=e.scale,a=e.count==null?e.values?e.values.length:10:nc(i,e.count),o=e.format||ac(i,a,e.formatSpecifier),u=e.values?rc(i,e.values,a):ic(i,a);if(r)n.rem=r;r=u.map(function(e,t){return Q({index:t/(u.length-1),value:e,label:o(e)})});if(e.extra&&r.length){r.push(Q({index:-1,extra:{value:r[0].value},label:""}))}n.source=r;n.add=r;this.value=r;return n};function dc(e){Wt.call(this,null,e)}var hc=Object(V["inherits"])(dc,Wt);function pc(){return Q({})}function vc(e){return e.exit}hc.transform=function(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||pc,a=e.key||X,o=this.value;if(Object(V["isArray"])(r.encode)){r.encode=null}if(o&&(e.modified("key")||t.modified(a))){Object(V["error"])("DataJoin does not support modified key function or fields.")}if(!o){t=t.addAll();this.value=o=Object(V["fastmap"])().test(vc);o.lookup=function(e){return o.get(a(e))}}t.visit(t.ADD,function(e){var t=a(e),n=o.get(t);if(n){if(n.exit){o.empty--;r.add.push(n)}else{r.mod.push(n)}}else{o.set(t,n=i(e));r.add.push(n)}n.datum=e;n.exit=false});t.visit(t.MOD,function(e){var t=a(e),n=o.get(t);if(n){n.datum=e;r.mod.push(n)}});t.visit(t.REM,function(e){var t=a(e),n=o.get(t);if(e===n.datum&&!n.exit){r.rem.push(n);n.exit=true;++o.empty}});if(t.changed(t.ADD_MOD))r.modifies("datum");if(e.clean&&o.empty>n.cleanThreshold)n.runAfter(o.clean);return r};function gc(e){Wt.call(this,null,e)}var mc=Object(V["inherits"])(gc,Wt);mc.transform=function(e,t){var n=t.fork(t.ADD_REM),r=e.encoders,i=t.encode;if(Object(V["isArray"])(i)){if(n.changed()||i.every(function(e){return r[e]})){i=i[0];n.encode=null}else{return t.StopPropagation}}var a=i==="enter",o=r.update||V["falsy"],u=r.enter||V["falsy"],s=r.exit||V["falsy"],l=(i&&!a?r[i]:o)||V["falsy"];if(t.changed(t.ADD)){t.visit(t.ADD,function(t){u(t,e);o(t,e);if(l!==V["falsy"]&&l!==o)l(t,e)});n.modifies(u.output);n.modifies(o.output);if(l!==V["falsy"]&&l!==o)n.modifies(l.output)}if(t.changed(t.REM)&&s!==V["falsy"]){t.visit(t.REM,function(t){s(t,e)});n.modifies(s.output)}if(a||l!==V["falsy"]){var f=t.MOD|(e.modified()?t.REFLOW:0);if(a){t.visit(f,function(t){var r=u(t,e);if(l(t,e)||r)n.mod.push(t)});if(n.mod.length)n.modifies(u.output)}else{t.visit(f,function(t){if(l(t,e))n.mod.push(t)})}if(n.mod.length)n.modifies(l.output)}return n.changed()?n:t.StopPropagation};var yc="symbol";var bc="discrete";var _c="gradient";var xc={};xc[Yf]=wc;xc[Xf]=Oc;xc[Jf]=jc;xc[Qf]=xc[Zf]=Sc;function kc(e,t){var n=xc[e.type];return n?n(e):ic(e,t)}function Oc(e){var t=e.domain(),n=t[0],r=Object(V["peek"])(t),i=e.range().length,a=new Array(i),o=0;a[0]=-Infinity;while(++o<i)a[o]=(o*r-(o-i)*n)/i;a.max=+Infinity;return a}function wc(e){var t=[-Infinity].concat(e.quantiles());t.max=+Infinity;return t}function jc(e){var t=[-Infinity].concat(e.domain());t.max=+Infinity;return t}function Sc(e){var t=e.domain();t.max=t.pop();return t}function Ec(e,t,n){return n===yc&&xc[e.type]?Ac(t):n===bc?zc(t):Tc(t)}function Ac(e){return function(t,n,r){var i=r[n+1]||r.max||+Infinity,a=Mc(t,e),o=Mc(i,e);return a&&o?a+""+o:o?"< "+o:" "+a}}function zc(e){return function(t,n){return n?e(t):null}}function Tc(e){return function(t){return e(t)}}function Mc(e,t){return isFinite(e)?t(e):null}function Nc(e){var t=e.domain(),n=t.length-1,r=+t[0],i=+Object(V["peek"])(t),a=i-r;if(e.type===Jf){var o=n?a/n:.1;r-=o;i+=o;a=i-r}return function(e){return(e-r)/a}}function Dc(e){Wt.call(this,[],e)}var Cc=Object(V["inherits"])(Dc,Wt);Cc.transform=function(e,t){if(this.value!=null&&!e.modified()){return t.StopPropagation}var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,i=e.type||yc,a=e.scale,o=e.count==null?5:nc(a,e.count),u=e.format||ac(a,o,e.formatSpecifier),s=e.values||kc(a,o,i),l,f,c,d;u=Ec(a,u,i);if(r)n.rem=r;if(i===yc){if(Object(V["isFunction"])(c=e.size)){if(!e.values&&a(s[0])===0){s=s.slice(1)}d=s.reduce(function(t,n){return Math.max(t,c(n,e))},0)}else{c=Object(V["constant"])(d=c||8)}r=s.map(function(t,n){return Q({index:n,label:u(t,n,s),value:t,offset:d,size:c(t,e)})})}else if(i===_c){l=a.domain(),f=Object(ec["e"])(a,l[0],Object(V["peek"])(l));if(s.length<3&&!e.values&&l[0]!==Object(V["peek"])(l)){s=[l[0],Object(V["peek"])(l)]}r=s.map(function(e,t){return Q({index:t,label:u(e,t,s),value:e,perc:f(e)})})}else{c=s.length-1;f=Nc(a);r=s.map(function(e,t){return Q({index:t,label:u(e,t,s),value:e,perc:t?f(e):0,perc2:t===c?1:f(s[t+1])})})}n.source=r;n.add=r;this.value=r;return n};var Pc=Object(V["fastmap"])({line:Wc,"line-radial":Vc,arc:Hc,"arc-radial":Bc,curve:Gc,"curve-radial":$c,"orthogonal-horizontal":Yc,"orthogonal-vertical":Xc,"orthogonal-radial":Jc,"diagonal-horizontal":Qc,"diagonal-vertical":Zc,"diagonal-radial":Kc});function Rc(e){return e.source.x}function Lc(e){return e.source.y}function Ic(e){return e.target.x}function Fc(e){return e.target.y}function qc(e){Wt.call(this,{},e)}qc.Definition={type:"LinkPath",metadata:{modifies:true},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"as",type:"string",default:"path"}]};var Uc=Object(V["inherits"])(qc,Wt);Uc.transform=function(e,t){var n=e.sourceX||Rc,r=e.sourceY||Lc,i=e.targetX||Ic,a=e.targetY||Fc,o=e.as||"path",u=e.orient||"vertical",s=e.shape||"line",l=Pc.get(s+"-"+u)||Pc.get(s);if(!l){Object(V["error"])("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:""))}t.visit(t.SOURCE,function(e){e[o]=l(n(e),r(e),i(e),a(e))});return t.reflow(e.modified()).modifies(o)};function Wc(e,t,n,r){return"M"+e+","+t+"L"+n+","+r}function Vc(e,t,n,r){return Wc(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))}function Hc(e,t,n,r){var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2,u=180*Math.atan2(a,i)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+u+" 0 1"+" "+n+","+r}function Bc(e,t,n,r){return Hc(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))}function Gc(e,t,n,r){var i=n-e,a=r-t,o=.2*(i+a),u=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+u)+" "+(n+u)+","+(r-o)+" "+n+","+r}function $c(e,t,n,r){return Gc(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))}function Yc(e,t,n,r){return"M"+e+","+t+"V"+r+"H"+n}function Xc(e,t,n,r){return"M"+e+","+t+"H"+n+"V"+r}function Jc(e,t,n,r){var i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),u=Math.sin(n),s=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+(s?1:0)+" "+t*o+","+t*u+"L"+r*o+","+r*u}function Qc(e,t,n,r){var i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r}function Zc(e,t,n,r){var i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r}function Kc(e,t,n,r){var i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),u=Math.sin(n),s=(t+r)/2;return"M"+t*i+","+t*a+"C"+s*i+","+s*a+" "+s*o+","+s*u+" "+r*o+","+r*u}function ed(e){Wt.call(this,null,e)}ed.Definition={type:"Pie",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:false},{name:"as",type:"string",array:true,length:2,default:["startAngle","endAngle"]}]};var td=Object(V["inherits"])(ed,Wt);td.transform=function(e,t){var n=e.as||["startAngle","endAngle"],r=n[0],i=n[1],a=e.field||V["one"],o=e.startAngle||0,u=e.endAngle!=null?e.endAngle:2*Math.PI,s=t.source,l=s.map(a),f=l.length,c=o,d=(u-o)/Object(En["o"])(l),h=Object(En["n"])(f),p,v,g;if(e.sort){h.sort(function(e,t){return l[e]-l[t]})}for(p=0;p<f;++p){g=l[h[p]];v=s[h[p]];v[r]=c;v[i]=c+=g*d}this.value=l;return t.reflow(e.modified()).modifies(n)};var nd=n("7p8r");var rd=5;var id=Object(V["toSet"])([Gf,qf,Wf]);var ad=Object(V["toSet"])([Gf,Ff,qf,Wf,Hf,Uf]);var od=Object(V["toSet"])(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function ud(e){Wt.call(this,null,e);this.modified(true)}var sd=Object(V["inherits"])(ud,Wt);sd.transform=function(e,t){var n=t.dataflow,r=this.value,i;if(!r||e.modified("type")){this.value=r=Object(ec["d"])((e.type||Gf).toLowerCase())()}for(i in e)if(!od[i]){if(i==="padding"&&ad[r.type])continue;Object(V["isFunction"])(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}hd(r,e,ld(r,e,n));return t.fork(t.NO_SOURCE|t.NO_FIELDS)};function ld(e,t,n){var r=fd(e,t.domainRaw,n);if(r>-1)return r;var i=t.domain,a=e.type,o=t.zero||t.zero===undefined&&id[a],u,s;if(!i)return 0;if(ad[a]&&t.padding&&i[0]!==Object(V["peek"])(i)){i=cd(a,i,t.range,t.padding,t.exponent)}if(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null){u=(i=i.slice()).length-1||1;if(o){if(i[0]>0)i[0]=0;if(i[u]<0)i[u]=0}if(t.domainMin!=null)i[0]=t.domainMin;if(t.domainMax!=null)i[u]=t.domainMax;if(t.domainMid!=null){s=t.domainMid;if(s<i[0]||s>i[u]){n.warn("Scale domainMid exceeds domain min or max.",s)}i.splice(u,0,s)}}e.domain(dd(a,i,n));if(a===$f){e.unknown(t.domainImplicit?ec["f"]:undefined)}if(t.nice&&e.nice){e.nice(t.nice!==true&&nc(e,t.nice)||null)}return i.length}function fd(e,t,n){if(t){e.domain(dd(e.type,t,n));return t.length}else{return-1}}function cd(e,t,n,r,i){var a=Math.abs(Object(V["peek"])(n)-n[0]),o=a/(a-2*r),u=e===Ff?Object(V["zoomLog"])(t,null,o):e===Wf?Object(V["zoomPow"])(t,null,o,.5):e===qf?Object(V["zoomPow"])(t,null,o,i):Object(V["zoomLinear"])(t,null,o);t=t.slice();t[0]=u[0];t[t.length-1]=u[1];return t}function dd(e,t,n){if(e===Ff){var r=Math.abs(t.reduce(function(e,t){return e+(t<0?-1:t>0?1:0)},0));if(r!==t.length){n.warn("Log scale domain includes zero: "+Object(V["stringValue"])(t))}}return t}function hd(e,t,n){var r=t.round||false,i=t.range;if(t.rangeStep!=null){i=pd(e.type,t,n)}else if(t.scheme){i=vd(e.type,t,n);if(Object(V["isFunction"])(i))return e.interpolator(i)}else if(i&&e.type===Kf){return e.interpolator(Object(nd["interpolateRgbBasis"])(md(i,t.reverse)))}if(i&&t.interpolate&&e.interpolate){e.interpolate(Object(ec["b"])(t.interpolate,t.interpolateGamma))}else if(Object(V["isFunction"])(e.round)){e.round(r)}else if(Object(V["isFunction"])(e.rangeRound)){e.interpolate(r?nd["interpolateRound"]:nd["interpolate"])}if(i)e.range(md(i,t.reverse))}function pd(e,t,n){if(e!==Vf&&e!==Bf){Object(V["error"])("Only band and point scales support rangeStep.")}var r=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,i=e===Bf?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Object(ec["a"])(n,i,r)]}function vd(e,t,n){var r=t.scheme.toLowerCase(),i=Object(ec["g"])(r),a=t.schemeExtent,o;if(!i){Object(V["error"])("Unrecognized scheme name: "+t.scheme)}n=e===Jf?n+1:e===Zf?n-1:e===Yf||e===Xf?+t.schemeCount||rd:n;return e===Kf?gd(i,a,t.reverse):!a&&(o=Object(ec["g"])(r+"-"+n))?o:Object(V["isFunction"])(i)?yd(gd(i,a),n):e===$f?i:i.slice(0,n)}function gd(e,t,n){return Object(V["isFunction"])(e)&&(t||n)?Object(ec["c"])(e,md(t||[0,1],n)):e}function md(e,t){return t?e.slice().reverse():e}function yd(e,t){var n=new Array(t),r=t+1;for(var i=0;i<t;)n[i]=e(++i/r);return n}function bd(e){Wt.call(this,null,e)}var _d=Object(V["inherits"])(bd,Wt);_d.transform=function(e,t){var n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");if(n)t.source.sort(e.sort);this.modified(n);return t};var xd="center",kd="normalize";function Od(e){Wt.call(this,null,e)}Od.Definition={type:"Stack",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:true},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:true,length:2,default:["y0","y1"]}]};var wd=Object(V["inherits"])(Od,Wt);wd.transform=function(e,t){var n=e.as||["y0","y1"],r=n[0],i=n[1],a=e.field||V["one"],o=e.offset===xd?jd:e.offset===kd?Sd:Ed,u,s,l,f;u=Ad(t.source,e.groupby,e.sort,a);for(s=0,l=u.length,f=u.max;s<l;++s){o(u[s],f,a,r,i)}return t.reflow(e.modified()).modifies(n)};function jd(e,t,n,r,i){var a=(t-e.sum)/2,o=e.length,u=0,s;for(;u<o;++u){s=e[u];s[r]=a;s[i]=a+=Math.abs(n(s))}}function Sd(e,t,n,r,i){var a=1/e.sum,o=0,u=e.length,s=0,l=0,f;for(;s<u;++s){f=e[s];f[r]=o;f[i]=o=a*(l+=Math.abs(n(f)))}}function Ed(e,t,n,r,i){var a=0,o=0,u=e.length,s=0,l,f;for(;s<u;++s){f=e[s];l=n(f);if(l<0){f[r]=o;f[i]=o+=l}else{f[r]=a;f[i]=a+=l}}}function Ad(e,t,n,r){var i=[],a=function(e){return e(f)},o,u,s,l,f,c,d,h,p;if(t==null){i.push(e.slice())}else{for(o={},u=0,s=e.length;u<s;++u){f=e[u];c=t.map(a);d=o[c];if(!d){o[c]=d=[];i.push(d)}d.push(f)}}for(c=0,p=0,l=i.length;c<l;++c){d=i[c];for(u=0,h=0,s=d.length;u<s;++u){h+=Math.abs(r(d[u]))}d.sum=h;if(h>p)p=h;if(n)d.sort(n)}i.max=p;return i}var zd=n("baYx");var Td=["size","smooth"];var Md=["x","y","weight","size","cellSize","bandwidth"];function Nd(e){Wt.call(this,null,e)}Nd.Definition={type:"Contour",metadata:{generates:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"values",type:"number",array:true},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"smooth",type:"boolean"},{name:"nice",type:"boolean",default:false},{name:"thresholds",type:"number",array:true}]};var Dd=Object(V["inherits"])(Nd,Wt);Dd.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.count||10,i,a,o;if(e.values){i=Object(zd["b"])();a=Td;o=e.values}else{i=Object(zd["a"])();a=Md;o=t.materialize(t.SOURCE).source}i.thresholds(e.thresholds||(e.nice?r:Cd(r)));a.forEach(function(t){if(e[t]!=null)i[t](e[t])});if(this.value)n.rem=this.value;o=o&&o.length?i(o).map(Q):[];this.value=n.source=n.add=o;return n};function Cd(e){return function(t){var n=Object(En["f"])(t),r=n[0],i=n[1]-r,a=[],o=1;for(;o<=e;++o)a.push(r+i*o/(e+1));return a}}var Pd="Feature";var Rd="FeatureCollection";var Ld="MultiPoint";function Id(e){Wt.call(this,null,e)}Id.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:true,length:2},{name:"geojson",type:"field"}]};var Fd=Object(V["inherits"])(Id,Wt);Fd.transform=function(e,t){var n=this._features,r=this._points,i=e.fields,a=i&&i[0],o=i&&i[1],u=e.geojson,s=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(Object(V["accessorFields"])(u))||a&&t.modified(Object(V["accessorFields"])(a))||o&&t.modified(Object(V["accessorFields"])(o));if(!this.value||l){s=t.SOURCE;this._features=n=[];this._points=r=[]}if(u){t.visit(s,function(e){n.push(u(e))})}if(a&&o){t.visit(s,function(e){var t=a(e),n=o(e);if(t!=null&&n!=null&&(t=+t)===t&&(n=+n)===n){r.push([t,n])}});n=n.concat({type:Pd,geometry:{type:Ld,coordinates:r}})}this.value={type:Rd,features:n}};var qd=n("ZFwI");var Ud=Object(qd["r"])();var Wd=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function Vd(e,t){return function n(){var r=t();r.type=e;r.path=Object(qd["r"])().projection(r);r.copy=r.copy||function(){var e=n();Wd.forEach(function(t){if(r.hasOwnProperty(t))e[t](r[t]())});e.path.pointRadius(r.path.pointRadius());return e};return r}}function Hd(e,t){if(!e||typeof e!=="string"){throw new Error("Projection type must be a name string.")}e=e.toLowerCase();if(arguments.length>1){Gd[e]=Vd(e,t);return this}else{return Gd.hasOwnProperty(e)?Gd[e]:null}}function Bd(e){return e&&e.path||Ud}var Gd={albers:qd["a"],albersusa:qd["b"],azimuthalequalarea:qd["d"],azimuthalequidistant:qd["e"],conicconformal:qd["h"],conicequalarea:qd["i"],conicequidistant:qd["j"],equirectangular:qd["k"],gnomonic:qd["l"],identity:qd["n"],mercator:qd["o"],naturalEarth1:qd["p"],orthographic:qd["q"],stereographic:qd["s"],transversemercator:qd["t"]};for(var $d in Gd){Hd($d,Gd[$d])}function Yd(e){Wt.call(this,null,e)}Yd.Definition={type:"GeoPath",metadata:{modifies:true},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:true},{name:"as",type:"string",default:"path"}]};var Xd=Object(V["inherits"])(Yd,Wt);Xd.transform=function(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||V["identity"],a=e.as||"path",o=n.SOURCE;function u(e){e[a]=r(i(e))}if(!r||e.modified()){this.value=r=Bd(e.projection);n.materialize().reflow()}else{o=i===V["identity"]||t.modified(i.fields)?n.ADD_MOD:n.ADD}var s=Jd(r,e.pointRadius);n.visit(o,u);r.pointRadius(s);return n.modifies(a)};function Jd(e,t){var n=e.pointRadius();e.context(null);if(t!=null){e.pointRadius(t)}return n}function Qd(e){Wt.call(this,null,e)}Qd.Definition={type:"GeoPoint",metadata:{modifies:true},params:[{name:"projection",type:"projection",required:true},{name:"fields",type:"field",array:true,required:true,length:2},{name:"as",type:"string",array:true,length:2,default:["x","y"]}]};var Zd=Object(V["inherits"])(Qd,Wt);Zd.transform=function(e,t){var n=e.projection,r=e.fields[0],i=e.fields[1],a=e.as||["x","y"],o=a[0],u=a[1],s;function l(e){var t=n([r(e),i(e)]);if(t){e[o]=t[0];e[u]=t[1]}else{e[o]=undefined;e[u]=undefined}}if(e.modified()){t=t.materialize().reflow(true).visit(t.SOURCE,l)}else{s=t.modified(r.fields)||t.modified(i.fields);t.visit(s?t.ADD_MOD:t.ADD,l)}return t.modifies(a)};function Kd(e){Wt.call(this,null,e)}Kd.Definition={type:"GeoShape",metadata:{modifies:true},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:true},{name:"as",type:"string",default:"shape"}]};var eh=Object(V["inherits"])(Kd,Wt);eh.transform=function(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||Object(V["field"])("datum"),a=e.as||"shape",o=n.ADD_MOD;if(!r||e.modified()){this.value=r=th(Bd(e.projection),i,e.pointRadius);n.materialize().reflow();o=n.SOURCE}n.visit(o,function(e){e[a]=r});return n.modifies(a)};function th(e,t,n){var r=n==null?function(n){return e(t(n))}:function(r){var i=e.pointRadius(),a=e.pointRadius(n)(t(r));e.pointRadius(i);return a};r.context=function(t){e.context(t);return r};return r}function nh(e){Wt.call(this,[],e);this.generator=Object(qd["m"])()}nh.Definition={type:"Graticule",metadata:{changes:true},params:[{name:"extent",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"extentMajor",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"extentMinor",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"step",type:"number",array:true,length:2},{name:"stepMajor",type:"number",array:true,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:true,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};var rh=Object(V["inherits"])(nh,Wt);rh.transform=function(e,t){var n=this.value,r=this.generator,i;if(!n.length||e.modified()){for(var a in e){if(Object(V["isFunction"])(r[a])){r[a](e[a])}}}i=r();if(n.length){t.mod.push(ee(n[0],i))}else{t.add.push(Q(i))}n[0]=i;return t};function ih(e){Wt.call(this,null,e);this.modified(true)}var ah=Object(V["inherits"])(ih,Wt);ah.transform=function(e,t){var n=this.value;if(!n||e.modified("type")){this.value=n=uh(e.type);Wd.forEach(function(t){if(e[t]!=null)sh(n,t,e[t])})}else{Wd.forEach(function(t){if(e.modified(t))sh(n,t,e[t])})}if(e.pointRadius!=null)n.path.pointRadius(e.pointRadius);if(e.fit)oh(n,e);return t.fork(t.NO_SOURCE|t.NO_FIELDS)};function oh(e,t){var n=lh(t.fit);t.extent?e.fitExtent(t.extent,n):t.size?e.fitSize(t.size,n):0}function uh(e){var t=Hd((e||"mercator").toLowerCase());if(!t)Object(V["error"])("Unrecognized projection type: "+e);return t()}function sh(e,t,n){if(Object(V["isFunction"])(e[t]))e[t](n)}function lh(e){e=Object(V["array"])(e);return e.length===1?e[0]:{type:Rd,features:e.reduce(function(e,t){t&&t.type===Rd?e.push.apply(e,t.features):Object(V["isArray"])(t)?e.push.apply(e,t):e.push(t);return e},[])}}var fh=n("gyWD");var ch={center:fh["a"],collide:fh["b"],nbody:fh["d"],link:fh["c"],x:fh["f"],y:fh["g"]};var dh="forces",hh=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],ph=["static","iterations"],vh=["x","y","vx","vy"];function gh(e){Wt.call(this,null,e)}gh.Definition={type:"Force",metadata:{modifies:true},params:[{name:"static",type:"boolean",default:false},{name:"restart",type:"boolean",default:false},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:true,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:true},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:true},{name:"strength",type:"number",expr:true},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:true,modify:false,default:vh}]};var mh=Object(V["inherits"])(gh,Wt);mh.transform=function(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(hh),a=e.iterations||300;if(!n){this.value=n=bh(t.source,e);n.on("tick",yh(t.dataflow,this));if(!e.static){r=true;n.tick()}t.modifies("index")}else{if(r){t.modifies("index");n.nodes(t.source)}if(i||t.changed(t.MOD)){_h(n,e,0,t)}}if(i||r||e.modified(ph)||t.changed()&&e.restart){n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a));if(e.static){for(n.stop();--a>=0;)n.tick()}else{if(n.stopped())n.restart();if(!r)return t.StopPropagation}}return this.finish(e,t)};mh.finish=function(e,t){var n=t.dataflow;for(var r=this._argops,i=0,a=r.length,o;i<a;++i){o=r[i];if(o.name!==dh||o.op._argval.force!=="link"){continue}for(var u=o.op._argops,s=0,l=u.length,f;s<l;++s){if(u[s].name==="links"&&(f=u[s].op.source)){n.pulse(f,n.changeset().reflow());break}}}return t.reflow(e.modified()).modifies(vh)};function yh(e,t){return function(){e.touch(t).run()}}function bh(e,t){var n=Object(fh["e"])(e),r=false,i=n.stop,a=n.restart;n.stopped=function(){return r};n.restart=function(){r=false;return a()};n.stop=function(){r=true;return i()};return _h(n,t,true).on("end",function(){r=true})}function _h(e,t,n,r){var i=Object(V["array"])(t.forces),a,o,u,s;for(a=0,o=hh.length;a<o;++a){u=hh[a];if(u!==dh&&t.modified(u))e[u](t[u])}for(a=0,o=i.length;a<o;++a){s=dh+a;u=n||t.modified(dh,a)?kh(i[a]):r&&xh(i[a],r)?e.force(s):null;if(u)e.force(s,u)}for(o=e.numForces||0;a<o;++a){e.force(dh+a,null)}e.numForces=i.length;return e}function xh(e,t){var n,r;for(n in e){if(Object(V["isFunction"])(r=e[n])&&t.modified(Object(V["accessorFields"])(r)))return 1}return 0}function kh(e){var t,n;if(!ch.hasOwnProperty(e.force)){Object(V["error"])("Unrecognized force: "+e.force)}t=ch[e.force]();for(n in e){if(Object(V["isFunction"])(t[n]))Oh(t[n],e[n],e)}return t}function Oh(e,t,n){e(Object(V["isFunction"])(t)?function(e){return t(e,n)}:t)}var wh=function(e,t,n){var r={};e.each(function(e){var i=e.data;if(n(i))r[t(i)]=e});e.lookup=r;return e};var jh=n("2UC5");var Sh=n("h3tc");function Eh(e){Wt.call(this,null,e)}Eh.Definition={type:"Nest",metadata:{treesource:true,changes:true},params:[{name:"keys",type:"field",array:true},{name:"generate",type:"boolean"}]};var Ah=Object(V["inherits"])(Eh,Wt);function zh(e){return e.values}Ah.transform=function(e,t){if(!t.source){Object(V["error"])("Nest transform requires an upstream data source.")}var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;if(!a||r||t.changed()){if(a){a.each(function(e){if(e.children&&Y(e.data)){i.rem.push(e.data)}})}this.value=a=Object(Sh["b"])({values:Object(V["array"])(e.keys).reduce(function(e,t){e.key(t);return e},Object(jh["b"])()).entries(i.source)},zh);if(n){a.each(function(e){if(e.children){e=Q(e.data);i.add.push(e);i.source.push(e)}})}wh(a,X,X)}i.source.root=a;return i};function Th(e){Wt.call(this,null,e)}var Mh=Object(V["inherits"])(Th,Wt);Mh.transform=function(e,t){if(!t.source||!t.source.root){Object(V["error"])(this.constructor.name+" transform requires a backing tree data source.")}var n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;if(e.field)i.sum(e.field);if(e.sort)i.sort(e.sort);Nh(n,this.params,e);try{this.value=n(i)}catch(e){Object(V["error"])(e)}i.each(function(e){Dh(e,r,a)});return t.reflow(e.modified()).modifies(a).modifies("leaf")};function Nh(e,t,n){for(var r,i=0,a=t.length;i<a;++i){r=t[i];if(r in n)e[r](n[r])}}function Dh(e,t,n){var r=e.data;for(var i=0,a=t.length-1;i<a;++i){r[n[i]]=e[t[i]]}r[n[a]]=e.children?e.children.length:0}var Ch=["x","y","r","depth","children"];function Ph(e){Th.call(this,e)}Ph.Definition={type:"Pack",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:Ch.length,default:Ch}]};var Rh=Object(V["inherits"])(Ph,Th);Rh.layout=Sh["c"];Rh.params=["size","padding"];Rh.fields=Ch;var Lh=["x0","y0","x1","y1","depth","children"];function Ih(e){Th.call(this,e)}Ih.Definition={type:"Partition",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:false},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:Lh.length,default:Lh}]};var Fh=Object(V["inherits"])(Ih,Th);Fh.layout=Sh["d"];Fh.params=["size","round","padding"];Fh.fields=Lh;function qh(e){Wt.call(this,null,e)}qh.Definition={type:"Stratify",metadata:{treesource:true},params:[{name:"key",type:"field",required:true},{name:"parentKey",type:"field",required:true}]};var Uh=Object(V["inherits"])(qh,Wt);Uh.transform=function(e,t){if(!t.source){Object(V["error"])("Stratify transform requires an upstream data source.")}var n=this.value,r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!this.value||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);i.source=i.source.slice();if(a){if(i.source.length){n=wh(Object(Sh["e"])().id(e.key).parentId(e.parentKey)(i.source),e.key,V["truthy"])}else{n=wh(Object(Sh["e"])()([{}]),e.key,e.key)}}i.source.root=this.value=n;return i};var Wh={tidy:Sh["f"],cluster:Sh["a"]};var Vh=["x","y","depth","children"];function Hh(e){Th.call(this,e)}Hh.Definition={type:"Tree",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:true,length:2},{name:"nodeSize",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:Vh.length,default:Vh}]};var Bh=Object(V["inherits"])(Hh,Th);Bh.layout=function(e){var t=e||"tidy";if(Wh.hasOwnProperty(t))return Wh[t]();else Object(V["error"])("Unrecognized Tree layout method: "+t)};Bh.params=["size","nodeSize","separation"];Bh.fields=Vh;function Gh(e){Wt.call(this,[],e)}Gh.Definition={type:"TreeLinks",metadata:{tree:true,generates:true,changes:true},params:[]};var $h=Object(V["inherits"])(Gh,Wt);$h.transform=function(e,t){var n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};if(!r)Object(V["error"])("TreeLinks transform requires a tree data source.");if(t.changed(t.ADD_REM)){i.rem=n;t.visit(t.SOURCE,function(e){a[X(e)]=1});r.each(function(e){var t=e.data,n=e.parent&&e.parent.data;if(n&&a[X(t)]&&a[X(n)]){i.add.push(Q({source:n,target:t}))}});this.value=i.add}else if(t.changed(t.MOD)){t.visit(t.MOD,function(e){a[X(e)]=1});n.forEach(function(e){if(a[X(e.source)]||a[X(e.target)]){i.mod.push(e)}})}return i};var Yh={binary:Sh["h"],dice:Sh["i"],slice:Sh["k"],slicedice:Sh["l"],squarify:Sh["m"],resquarify:Sh["j"]};var Xh=["x0","y0","x1","y1","depth","children"];function Jh(e){Th.call(this,e)}Jh.Definition={type:"Treemap",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:false},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:Xh.length,default:Xh}]};var Qh=Object(V["inherits"])(Jh,Th);Qh.layout=function(){var e=Object(Sh["g"])();e.ratio=function(t){var n=e.tile();if(n.ratio)e.tile(n.ratio(t))};e.method=function(t){if(Yh.hasOwnProperty(t))e.tile(Yh[t]);else Object(V["error"])("Unrecognized Treemap layout method: "+t)};return e};Qh.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"];Qh.fields=Xh;var Zh=n("tBPv");function Kh(e){Wt.call(this,null,e)}Kh.Definition={type:"Voronoi",metadata:{modifies:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"size",type:"number",array:true,length:2},{name:"extent",type:"array",array:true,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:true,length:2}},{name:"as",type:"string",default:"path"}]};var ep=Object(V["inherits"])(Kh,Wt);var tp=[[-1e5,-1e5],[1e5,1e5]];ep.transform=function(e,t){var n=e.as||"path",r=t.source,i,a,o,u;i=Object(Zh["a"])().x(e.x).y(e.y);if(e.size)i.size(e.size);else i.extent(e.extent||tp);this.value=i=i(r);a=i.polygons();for(o=0,u=r.length;o<u;++o){r[o][n]=a[o]?"M"+a[o].join("L")+"Z":null}return t.reflow(e.modified()).modifies(n)};var np=Math.PI/180,rp=1<<11>>5,ip=1<<11;var ap=function(){var e=[256,256],t,n,r,i,a,o,u,s=fp,l=[],f=Math.random,c={};c.layout=function(){var s=d(Object(Wi["a"])()),c=dp((e[0]>>5)*e[1]),p=null,v=l.length,g=-1,m=[],y=l.map(function(e){return{text:t(e),font:n(e),style:i(e),weight:a(e),rotate:o(e),size:~~r(e),padding:u(e),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:false,sprite:null,datum:e}}).sort(function(e,t){return t.size-e.size});while(++g<v){var b=y[g];b.x=e[0]*(f()+.5)>>1;b.y=e[1]*(f()+.5)>>1;op(s,b,y,g);if(b.hasText&&h(c,b,p)){m.push(b);if(p)sp(p,b);else p=[{x:b.x+b.x0,y:b.y+b.y0},{x:b.x+b.x1,y:b.y+b.y1}];b.x-=e[0]>>1;b.y-=e[1]>>1}}return m};function d(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=(rp<<5)/t;e.height=ip/t;var n=e.getContext("2d");n.fillStyle=n.strokeStyle="red";n.textAlign="center";return{context:n,ratio:t}}function h(t,n,r){var i=n.x,a=n.y,o=Math.sqrt(e[0]*e[0]+e[1]*e[1]),u=s(e),l=f()<.5?1:-1,c=-l,d,h,p;while(d=u(c+=l)){h=~~d[0];p=~~d[1];if(Math.min(Math.abs(h),Math.abs(p))>=o)break;n.x=i+h;n.y=a+p;if(n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>e[0]||n.y+n.y1>e[1])continue;if(!r||!up(n,t,e[0])){if(!r||lp(n,r)){var v=n.sprite,g=n.width>>5,m=e[0]>>5,y=n.x-(g<<4),b=y&127,_=32-b,x=n.y1-n.y0,k=(n.y+n.y0)*m+(y>>5),O;for(var w=0;w<x;w++){O=0;for(var j=0;j<=g;j++){t[k+j]|=O<<_|(j<g?(O=v[w*g+j])>>>b:0)}k+=m}n.sprite=null;return true}}}return false}c.words=function(e){if(arguments.length){l=e;return c}else{return l}};c.size=function(t){if(arguments.length){e=[+t[0],+t[1]];return c}else{return e}};c.font=function(e){if(arguments.length){n=hp(e);return c}else{return n}};c.fontStyle=function(e){if(arguments.length){i=hp(e);return c}else{return i}};c.fontWeight=function(e){if(arguments.length){a=hp(e);return c}else{return a}};c.rotate=function(e){if(arguments.length){o=hp(e);return c}else{return o}};c.text=function(e){if(arguments.length){t=hp(e);return c}else{return t}};c.spiral=function(e){if(arguments.length){s=pp[e]||e;return c}else{return s}};c.fontSize=function(e){if(arguments.length){r=hp(e);return c}else{return r}};c.padding=function(e){if(arguments.length){u=hp(e);return c}else{return u}};c.random=function(e){if(arguments.length){f=e;return c}else{return f}};return c};function op(e,t,n,r){if(t.sprite)return;var i=e.context,a=e.ratio;i.clearRect(0,0,(rp<<5)/a,ip/a);var o=0,u=0,s=0,l=n.length,f,c,d,h,p;--r;while(++r<l){t=n[r];i.save();i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font;f=i.measureText(t.text+"m").width*a;d=t.size<<1;if(t.rotate){var v=Math.sin(t.rotate*np),g=Math.cos(t.rotate*np),m=f*g,y=f*v,b=d*g,_=d*v;f=Math.max(Math.abs(m+_),Math.abs(m-_))+31>>5<<5;d=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else{f=f+31>>5<<5}if(d>s)s=d;if(o+f>=rp<<5){o=0;u+=s;s=0}if(u+d>=ip)break;i.translate((o+(f>>1))/a,(u+(d>>1))/a);if(t.rotate)i.rotate(t.rotate*np);i.fillText(t.text,0,0);if(t.padding){i.lineWidth=2*t.padding;i.strokeText(t.text,0,0)}i.restore();t.width=f;t.height=d;t.xoff=o;t.yoff=u;t.x1=f>>1;t.y1=d>>1;t.x0=-t.x1;t.y0=-t.y1;t.hasText=true;o+=f}var x=i.getImageData(0,0,(rp<<5)/a,ip/a).data,k=[];while(--r>=0){t=n[r];if(!t.hasText)continue;f=t.width;c=f>>5;d=t.y1-t.y0;for(h=0;h<d*c;h++)k[h]=0;o=t.xoff;if(o==null)return;u=t.yoff;var O=0,w=-1;for(p=0;p<d;p++){for(h=0;h<f;h++){var j=c*p+(h>>5),S=x[(u+p)*(rp<<5)+(o+h)<<2]?1<<31-h%32:0;k[j]|=S;O|=S}if(O)w=p;else{t.y0++;d--;p--;u++}}t.y1=t.y0+w;t.sprite=k.slice(0,(t.y1-t.y0)*c)}}function up(e,t,n){n>>=5;var r=e.sprite,i=e.width>>5,a=e.x-(i<<4),o=a&127,u=32-o,s=e.y1-e.y0,l=(e.y+e.y0)*n+(a>>5),f;for(var c=0;c<s;c++){f=0;for(var d=0;d<=i;d++){if((f<<u|(d<i?(f=r[c*i+d])>>>o:0))&t[l+d])return true}l+=n}return false}function sp(e,t){var n=e[0],r=e[1];if(t.x+t.x0<n.x)n.x=t.x+t.x0;if(t.y+t.y0<n.y)n.y=t.y+t.y0;if(t.x+t.x1>r.x)r.x=t.x+t.x1;if(t.y+t.y1>r.y)r.y=t.y+t.y1}function lp(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function fp(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function cp(e){var t=4,n=t*e[0]/e[1],r=0,i=0;return function(e){var a=e<0?-1:1;switch(Math.sqrt(1+4*a*e)-a&3){case 0:r+=n;break;case 1:i+=t;break;case 2:r-=n;break;default:i-=t;break}return[r,i]}}function dp(e){var t=[],n=-1;while(++n<e)t[n]=0;return t}function hp(e){return typeof e==="function"?e:function(){return e}}var pp={archimedean:fp,rectangular:cp};var vp=["x","y","font","fontSize","fontStyle","fontWeight","angle"];var gp=["text","font","rotate","fontSize","fontStyle","fontWeight"];function mp(e){Wt.call(this,ap(),e)}mp.Definition={type:"Wordcloud",metadata:{modifies:true},params:[{name:"size",type:"number",array:true,length:2},{name:"font",type:"string",expr:true,default:"sans-serif"},{name:"fontStyle",type:"string",expr:true,default:"normal"},{name:"fontWeight",type:"string",expr:true,default:"normal"},{name:"fontSize",type:"number",expr:true,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:true,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:true},{name:"as",type:"string",array:true,length:7,default:vp}]};var yp=Object(V["inherits"])(mp,Wt);yp.transform=function(e,t){function n(n){var r=e[n];return Object(V["isFunction"])(r)&&t.modified(r.fields)}var r=e.modified();if(!(r||t.changed(t.ADD_REM)||gp.some(n)))return;var i=t.materialize(t.SOURCE).source,a=this.value,o=e.as||vp,u=e.fontSize||14,s;Object(V["isFunction"])(u)?s=e.fontSizeRange:u=Object(V["constant"])(u);if(s){var l=u,f=Object(ec["d"])("sqrt")().domain(bp(l,i)).range(s);u=function(e){return f(l(e))}}i.forEach(function(e){e[o[0]]=NaN;e[o[1]]=NaN;e[o[3]]=0});var c=a.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(u).random(rn["d"]).layout();var d=a.size(),h=d[0]>>1,p=d[1]>>1,v=0,g=c.length,m,y;for(;v<g;++v){m=c[v];y=m.datum;y[o[0]]=m.x+h;y[o[1]]=m.y+p;y[o[2]]=m.font;y[o[3]]=m.size;y[o[4]]=m.style;y[o[5]]=m.weight;y[o[6]]=m.rotate}return t.reflow(r).modifies(o)};function bp(e,t){var n=+Infinity,r=-Infinity,i=0,a=t.length,o;for(;i<a;++i){o=e(t[i]);if(o<n)n=o;if(o>r)r=o}return[n,r]}function _p(e){return new Uint8Array(e)}function xp(e){return new Uint16Array(e)}function kp(e){return new Uint32Array(e)}function Op(){var e=8,t=[],n=kp(0),r=jp(0,e),i=jp(0,e);return{data:function(){return t},seen:function(){return n=wp(n,t.length)},add:function(e){for(var n=0,r=t.length,i=e.length,a;n<i;++n){a=e[n];a._index=r++;t.push(a)}},remove:function(e,n){var a=t.length,o=Array(a-e),u=t,s,l,f;for(l=0;!n[l]&&l<a;++l){o[l]=t[l];u[l]=l}for(f=l;l<a;++l){s=t[l];if(!n[l]){u[l]=f;r[f]=r[l];i[f]=i[l];o[f]=s;s._index=f++}else{u[l]=-1}r[l]=0}t=o;return u},size:function(){return t.length},curr:function(){return r},prev:function(){return i},reset:function(e){i[e]=r[e]},all:function(){return e<257?255:e<65537?65535:4294967295},set:function(e,t){r[e]|=t},clear:function(e,t){r[e]&=~t},resize:function(t,n){var a=r.length;if(t>a||n>e){e=Math.max(n,e);r=jp(t,e,r);i=jp(t,e)}}}}function wp(e,t,n){if(e.length>=t)return e;n=n||new e.constructor(t);n.set(e);return n}function jp(e,t,n){var r=(t<257?_p:t<65537?xp:kp)(e);if(n)r.set(n);return r}var Sp=function(e,t,n){var r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd:function(e,t){var n=this,i=n.bisect(n.range,e.value),a=e.index,o=i[0],u=i[1],s=a.length,l;for(l=0;l<o;++l)t[a[l]]|=r;for(l=u;l<s;++l)t[a[l]]|=r;return n}}};function Ep(){var e=kp(0),t=[],n=0;function r(r,i,a){if(!i.length)return[];var o=n,u=i.length,s=Array(u),l=kp(u),f,c,d;for(d=0;d<u;++d){s[d]=r(i[d]);l[d]=d}s=Ap(s,l);if(o){f=t;c=e;t=Array(o+u);e=kp(o+u);zp(a,f,c,o,s,l,u,t,e)}else{if(a>0)for(d=0;d<u;++d){l[d]+=a}t=s;e=l}n=o+u;return{index:l,value:s}}function i(r,i){var a=n,o,u,s;for(u=0;!i[e[u]]&&u<a;++u);for(s=u;u<a;++u){if(!i[o=e[u]]){e[s]=o;t[s]=t[u];++s}}n=a-r}function a(t){for(var r=0,i=n;r<i;++r){e[r]=t[e[r]]}}function o(e,r){var i;if(r){i=r.length}else{r=t;i=n}return[Object(En["c"])(r,e[0],0,i),Object(En["d"])(r,e[1],0,i)]}return{insert:r,remove:i,bisect:o,reindex:a,index:function(){return e},size:function(){return n}}}function Ap(e,t){e.sort.call(t,function(t,n){var r=e[t],i=e[n];return r<i?-1:r>i?1:0});return Object(En["l"])(e,t)}function zp(e,t,n,r,i,a,o,u,s){var l=0,f=0,c;for(c=0;l<r&&f<o;++c){if(t[l]<i[f]){u[c]=t[l];s[c]=n[l++]}else{u[c]=i[f];s[c]=a[f++]+e}}for(;l<r;++l,++c){u[c]=t[l];s[c]=n[l]}for(;f<o;++f,++c){u[c]=i[f];s[c]=a[f]+e}}function Tp(e){Wt.call(this,Op(),e);this._indices=null;this._dims=null}Tp.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:true,required:true},{name:"query",type:"array",array:true,required:true,content:{type:"number",array:true,length:2}}]};var Mp=Object(V["inherits"])(Tp,Wt);Mp.transform=function(e,t){if(!this._dims){return this.init(e,t)}else{var n=e.modified("fields")||e.fields.some(function(e){return t.modified(e.fields)});return n?this.reinit(e,t):this.eval(e,t)}};Mp.init=function(e,t){var n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length,u=0,s,l;for(;u<o;++u){s=n[u].fname;l=i[s]||(i[s]=Ep());a.push(Sp(l,u,r[u]))}return this.eval(e,t)};Mp.reinit=function(e,t){var n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,u=this.value,s=u.curr(),l=u.prev(),f=u.all(),c=n.rem=n.add,d=n.mod,h=i.length,p={},v,g,m,y,b,_,x,k,O;l.set(s);if(t.rem.length){b=this.remove(e,t,n)}if(t.add.length){u.add(t.add)}if(t.mod.length){_={};for(y=t.mod,x=0,k=y.length;x<k;++x){_[y[x]._index]=1}}for(x=0;x<h;++x){O=r[x];if(!o[x]||e.modified("fields",x)||t.modified(O.fields)){m=O.fname;if(!(v=p[m])){a[m]=g=Ep();p[m]=v=g.insert(O,t.source,0)}o[x]=Sp(g,x,i[x]).onAdd(v,s)}}for(x=0,k=u.data().length;x<k;++x){if(b[x]){continue}else if(l[x]!==s[x]){c.push(x)}else if(_[x]&&s[x]!==f){d.push(x)}}u.mask=(1<<h)-1;return n};Mp.eval=function(e,t){var n=t.materialize().fork(),r=this._dims.length,i=0;if(t.rem.length){this.remove(e,t,n);i|=(1<<r)-1}if(e.modified("query")&&!e.modified("fields")){i|=this.update(e,t,n)}if(t.add.length){this.insert(e,t,n);i|=(1<<r)-1}if(t.mod.length){this.modify(t,n);i|=(1<<r)-1}this.value.mask=i;return n};Mp.insert=function(e,t,n){var r=t.add,i=this.value,a=this._dims,o=this._indices,u=e.fields,s={},l=n.add,f=i.size(),c=f+r.length,d=a.length,h,p,v;i.resize(c,d);i.add(r);var g=i.curr(),m=i.prev(),y=i.all();for(h=0;h<d;++h){p=u[h].fname;v=s[p]||(s[p]=o[p].insert(u[h],r,f));a[h].onAdd(v,g)}for(;f<c;++f){m[f]=y;if(g[f]!==y)l.push(f)}};Mp.modify=function(e,t){var n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod,u,s,l;for(u=0,s=o.length;u<s;++u){l=o[u]._index;if(i[l]!==a)n.push(l)}};Mp.remove=function(e,t,n){var r=this._indices,i=this.value,a=i.curr(),o=i.prev(),u=i.all(),s={},l=n.rem,f=t.rem,c,d,h,p;for(c=0,d=f.length;c<d;++c){h=f[c]._index;s[h]=1;o[h]=p=a[h];a[h]=u;if(p!==u)l.push(h)}for(h in r){r[h].remove(d,s)}this.reindex(t,d,s);return s};Mp.reindex=function(e,t,n){var r=this._indices,i=this.value;e.runAfter(function(){var e=i.remove(t,n);for(var a in r)r[a].reindex(e)})};Mp.update=function(e,t,n){var r=this._dims,i=e.query,a=t.stamp,o=r.length,u=0,s,l;n.filters=0;for(l=0;l<o;++l){if(e.modified("query",l)){s=l;++u}}if(u===1){u=r[s].one;this.incrementOne(r[s],i[s],n.add,n.rem)}else{for(l=0,u=0;l<o;++l){if(!e.modified("query",l))continue;u|=r[l].one;this.incrementAll(r[l],i[l],a,n.add);n.rem=n.add}}return u};Mp.incrementAll=function(e,t,n,r){var i=this.value,a=i.seen(),o=i.curr(),u=i.prev(),s=e.index(),l=e.bisect(e.range),f=e.bisect(t),c=f[0],d=f[1],h=l[0],p=l[1],v=e.one,g,m,y;if(c<h){for(g=c,m=Math.min(h,d);g<m;++g){y=s[g];if(a[y]!==n){u[y]=o[y];a[y]=n;r.push(y)}o[y]^=v}}else if(c>h){for(g=h,m=Math.min(c,p);g<m;++g){y=s[g];if(a[y]!==n){u[y]=o[y];a[y]=n;r.push(y)}o[y]^=v}}if(d>p){for(g=Math.max(c,p),m=d;g<m;++g){y=s[g];if(a[y]!==n){u[y]=o[y];a[y]=n;r.push(y)}o[y]^=v}}else if(d<p){for(g=Math.max(h,d),m=p;g<m;++g){y=s[g];if(a[y]!==n){u[y]=o[y];a[y]=n;r.push(y)}o[y]^=v}}e.range=t.slice()};Mp.incrementOne=function(e,t,n,r){var i=this.value,a=i.curr(),o=e.index(),u=e.bisect(e.range),s=e.bisect(t),l=s[0],f=s[1],c=u[0],d=u[1],h=e.one,p,v,g;if(l<c){for(p=l,v=Math.min(c,f);p<v;++p){g=o[p];a[g]^=h;n.push(g)}}else if(l>c){for(p=c,v=Math.min(l,d);p<v;++p){g=o[p];a[g]^=h;r.push(g)}}if(f>d){for(p=Math.max(l,d),v=f;p<v;++p){g=o[p];a[g]^=h;n.push(g)}}else if(f<d){for(p=Math.max(c,f),v=d;p<v;++p){g=o[p];a[g]^=h;r.push(g)}}e.range=t.slice()};function Np(e){Wt.call(this,null,e)}Np.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:true,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:true,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};var Dp=Object(V["inherits"])(Np,Wt);Dp.transform=function(e,t){var n=~(e.ignore||0),r=e.filter,i=r.mask;if((i&n)===0)return t.StopPropagation;var a=t.fork(t.ALL),o=r.data(),u=r.curr(),s=r.prev(),l=function(e){return!(u[e]&n)?o[e]:null};a.filter(a.MOD,l);if(!(i&i-1)){a.filter(a.ADD,l);a.filter(a.REM,function(e){return(u[e]&n)===i?o[e]:null})}else{a.filter(a.ADD,function(e){var t=u[e]&n,r=!t&&t^s[e]&n;return r?o[e]:null});a.filter(a.REM,function(e){var t=u[e]&n,r=t&&!(t^(t^s[e]&n));return r?o[e]:null})}return a.filter(a.SOURCE,function(e){return l(e._index)})};var Cp=n("xJ3j");var Pp=/^([A-Za-z]+:)?\/\//;var Rp="file://";var Lp=function(e){return{options:e||{},sanitize:Fp,load:Ip,file:Up,http:qp}};function Ip(e,t){var n=this;return n.sanitize(e,t).then(function(e){var r=e.href;return e.localFile?n.file(r):n.http(r,t)})}function Fp(e,t){t=Object(V["extend"])({},this.options,t);return new Promise(function(n,r){var i={href:null},a,o,u,s;if(e==null||typeof e!=="string"){r("Sanitize failure, invalid URI: "+Object(V["stringValue"])(e));return}o=Pp.test(e);if((s=t.baseURL)&&!o){if(!Hp(e,"/")&&s[s.length-1]!=="/"){e="/"+e}e=s+e}u=(a=Hp(e,Rp))||t.mode==="file"||t.mode!=="http"&&!o&&Vp();if(a){e=e.slice(Rp.length)}else if(Hp(e,"//")){if(t.defaultProtocol==="file"){e=e.slice(2);u=true}else{e=(t.defaultProtocol||"http")+":"+e}}Object.defineProperty(i,"localFile",{value:!!u});i.href=e;if(t.target){i.target=t.target+""}n(i)})}function qp(e,t){return Wp(e,Object(V["extend"])({},this.options.http,t)).then(function(e){if(!e.ok)throw e.status+""+e.statusText;return e.text()})}function Up(e){return new Promise(function(t,n){var r=Vp();r?r.readFile(e,function(e,r){if(e)n(e);else t(r)}):n("No file system access for "+e)})}function Wp(e,t){var r=typeof fetch==="function"?fetch:n(16);return r?r(e,t):Promise.reject("No fetch method available.")}function Vp(){var e="function"==="function"&&n(15);return e&&Object(V["isFunction"])(e.readFile)?e:null}function Hp(e,t){return e==null?false:e.lastIndexOf(t,0)===0}var Bp={boolean:V["toBoolean"],integer:V["toNumber"],number:V["toNumber"],date:V["toDate"],string:V["toString"],unknown:V["identity"]};var Gp=[Qp,ev,Kp,Zp];var $p=["boolean","integer","number","date"];function Yp(e,t){if(!e||!e.length)return"unknown";var n,r,i,a=0,o=e.length,u=Gp.length,s=Gp.map(function(e,t){return t+1});for(r=0,o=e.length;r<o;++r){n=t?e[r][t]:e[r];for(i=0;i<u;++i){if(s[i]&&Jp(n)&&!Gp[i](n)){s[i]=0;++a;if(a===Gp.length)return"string"}}}a=s.reduce(function(e,t){return e===0?t:e},0)-1;return $p[a]}function Xp(e,t){return t.reduce(function(t,n){t[n]=Yp(e,n);return t},{})}function Jp(e){return e!=null&&e===e}function Qp(e){return e==="true"||e==="false"||e===true||e===false}function Zp(e){return!isNaN(Date.parse(e))}function Kp(e){return!isNaN(+e)&&!(e instanceof Date)}function ev(e){return Kp(e)&&(e=+e)===~~e}function tv(e){return function(t,n){var r={delimiter:e};return nv(t,n?Object(V["extend"])(n,r):r)}}function nv(e,t){if(t.header){e=t.header.map(V["stringValue"]).join(t.delimiter)+"\n"+e}return Object(Ue["b"])(t.delimiter).parse(e+"")}var rv=n("G3Yf");var iv=function(e,t){var n,r,i;e=Object(rv["a"])(e,t);n=t&&(i=t.feature)?Be["a"]:t&&(i=t.mesh)?Be["b"]:Object(V["error"])("Missing TopoJSON feature or mesh parameter.");r=(r=e.objects[i])?n(e,r):Object(V["error"])("Invalid TopoJSON object: "+i);return r&&r.features||[r]};var av={dsv:nv,csv:tv(","),tsv:tv("\t"),json:rv["a"],topojson:iv};var ov=function(e,t){if(arguments.length>1){av[e]=t;return this}else{return av.hasOwnProperty(e)?av[e]:null}};var uv=function(e,t,n){t=t||{};var r=ov(t.type||"json");if(!r)Object(V["error"])("Unknown data format type: "+t.type);e=r(e,t);if(t.parse)sv(e,t.parse,n);if(e.hasOwnProperty("columns"))delete e.columns;return e};function sv(e,t,n){if(!e.length)return;n=n||Xe["timeParse"];var r=e.columns||Object.keys(e[0]),i,a,o,u,s,l,f;if(t==="auto")t=Xp(e,r);r=Object.keys(t);i=r.map(function(e){var r=t[e],i,a;if(r&&(r.indexOf("date:")===0||r.indexOf("utc:")===0)){i=r.split(/:(.+)?/,2);a=i[1];if(a[0]==="'"&&a[a.length-1]==="'"||a[0]==='"'&&a[a.length-1]==='"'){a=a.slice(1,-1)}return i[0]==="utc"?Object(Xe["utcParse"])(a):n(a)}if(!Bp[r]){throw Error("Illegal format pattern: "+e+":"+r)}return Bp[r]});for(u=0,l=e.length,f=r.length;u<l;++u){a=e[u];for(s=0;s<f;++s){o=r[s];a[o]=i[s](a[o])}}}function lv(e){this.clear();if(e)this.union(e)}var fv=lv.prototype;fv.clone=function(){return new lv(this)};fv.clear=function(){this.x1=+Number.MAX_VALUE;this.y1=+Number.MAX_VALUE;this.x2=-Number.MAX_VALUE;this.y2=-Number.MAX_VALUE;return this};fv.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE};fv.set=function(e,t,n,r){if(n<e){this.x2=e;this.x1=n}else{this.x1=e;this.x2=n}if(r<t){this.y2=t;this.y1=r}else{this.y1=t;this.y2=r}return this};fv.add=function(e,t){if(e<this.x1)this.x1=e;if(t<this.y1)this.y1=t;if(e>this.x2)this.x2=e;if(t>this.y2)this.y2=t;return this};fv.expand=function(e){this.x1-=e;this.y1-=e;this.x2+=e;this.y2+=e;return this};fv.round=function(){this.x1=Math.floor(this.x1);this.y1=Math.floor(this.y1);this.x2=Math.ceil(this.x2);this.y2=Math.ceil(this.y2);return this};fv.translate=function(e,t){this.x1+=e;this.x2+=e;this.y1+=t;this.y2+=t;return this};fv.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),a=t-t*r+n*i,o=n-t*i-n*r,u=this.x1,s=this.x2,l=this.y1,f=this.y2;return this.clear().add(r*u-i*l+a,i*u+r*l+o).add(r*u-i*f+a,i*u+r*f+o).add(r*s-i*l+a,i*s+r*l+o).add(r*s-i*f+a,i*s+r*f+o)};fv.union=function(e){if(e.x1<this.x1)this.x1=e.x1;if(e.y1<this.y1)this.y1=e.y1;if(e.x2>this.x2)this.x2=e.x2;if(e.y2>this.y2)this.y2=e.y2;return this};fv.intersect=function(e){if(e.x1>this.x1)this.x1=e.x1;if(e.y1>this.y1)this.y1=e.y1;if(e.x2<this.x2)this.x2=e.x2;if(e.y2<this.y2)this.y2=e.y2;return this};fv.encloses=function(e){return e&&(this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2)};fv.alignsWith=function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)};fv.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)};fv.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)};fv.width=function(){return this.x2-this.x1};fv.height=function(){return this.y2-this.y1};var cv=0;var dv=function(e,t){var n=[],r;return r={id:"gradient_"+cv++,x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(e,t){n.push({offset:e,color:t});return r}}};function hv(e){this.mark=e;this.bounds=this.bounds||new lv}function pv(e){hv.call(this,e);this.items=this.items||[]}Object(V["inherits"])(pv,hv);function vv(e){this._pending=0;this._loader=e||Lp()}var gv=vv.prototype;gv.pending=function(){return this._pending};function mv(e){e._pending+=1}function yv(e){e._pending-=1}gv.sanitizeURL=function(e){var t=this;mv(t);return t._loader.sanitize(e,{context:"href"}).then(function(e){yv(t);return e}).catch(function(){yv(t);return null})};gv.loadImage=function(e){var t=this,n=Object(Wi["b"])();mv(t);return t._loader.sanitize(e,{context:"image"}).then(function(e){var r=e.href;if(!r||!n)throw{url:r};var i=new n;i.onload=function(){yv(t);i.loaded=true};i.onerror=function(){yv(t);i.loaded=false};i.src=r;return i}).catch(function(e){yv(t);return{loaded:false,width:0,height:0,src:e&&e.url||""}})};gv.ready=function(){var e=this;return new Promise(function(t){function n(r){if(!e.pending())t(r);else setTimeout(function(){n(true)},10)}n(false)})};var bv={basis:{curve:xa["c"]},"basis-closed":{curve:xa["d"]},"basis-open":{curve:xa["e"]},bundle:{curve:xa["f"],tension:"beta",value:.85},cardinal:{curve:xa["g"],tension:"tension",value:0},"cardinal-open":{curve:xa["i"],tension:"tension",value:0},"cardinal-closed":{curve:xa["h"],tension:"tension",value:0},"catmull-rom":{curve:xa["j"],tension:"alpha",value:.5},"catmull-rom-closed":{curve:xa["k"],tension:"alpha",value:.5},"catmull-rom-open":{curve:xa["l"],tension:"alpha",value:.5},linear:{curve:xa["m"]},"linear-closed":{curve:xa["n"]},monotone:{horizontal:xa["p"],vertical:xa["o"]},natural:{curve:xa["q"]},step:{curve:xa["r"]},"step-after":{curve:xa["s"]},"step-before":{curve:xa["t"]}};function _v(e,t,n){var r=bv.hasOwnProperty(e)&&bv[e],i=null;if(r){i=r.curve||r[t||"vertical"];if(r.tension&&n!=null){i=i[r.tension](n)}}return i}var xv={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},kv=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];var Ov=function(e){var t=[],n,r,i,a,o,u,s,l,f,c,d;n=e.slice().replace(kv[0],"###$1").split(kv[1]).slice(1);for(l=0,c=n.length;l<c;++l){r=n[l];i=r.slice(1).trim().replace(kv[2],"$1###$2").split(kv[3]);u=r.charAt(0);a=[u];for(f=0,d=i.length;f<d;++f){if((o=+i[f])===o){a.push(o)}}s=xv[u.toLowerCase()];if(a.length-1>s){for(f=1,d=a.length;f<d;f+=s){t.push([u].concat(a.slice(f,f+s)))}}else{t.push(a)}}return t};var wv={};var jv={};var Sv=[].join;function Ev(e,t,n,r,i,a,o,u,s){var l=Sv.call(arguments);if(wv[l]){return wv[l]}var f=o*(Math.PI/180);var c=Math.sin(f);var d=Math.cos(f);n=Math.abs(n);r=Math.abs(r);var h=d*(u-e)*.5+c*(s-t)*.5;var p=d*(s-t)*.5-c*(u-e)*.5;var v=h*h/(n*n)+p*p/(r*r);if(v>1){v=Math.sqrt(v);n*=v;r*=v}var g=d/n;var m=c/n;var y=-c/r;var b=d/r;var _=g*u+m*s;var x=y*u+b*s;var k=g*e+m*t;var O=y*e+b*t;var w=(k-_)*(k-_)+(O-x)*(O-x);var j=1/w-.25;if(j<0)j=0;var S=Math.sqrt(j);if(a==i)S=-S;var E=.5*(_+k)-S*(O-x);var A=.5*(x+O)+S*(k-_);var z=Math.atan2(x-A,_-E);var T=Math.atan2(O-A,k-E);var M=T-z;if(M<0&&a===1){M+=2*Math.PI}else if(M>0&&a===0){M-=2*Math.PI}var N=Math.ceil(Math.abs(M/(Math.PI*.5+.001)));var D=[];for(var C=0;C<N;++C){var P=z+C*M/N;var R=z+(C+1)*M/N;D[C]=[E,A,P,R,n,r,c,d]}return wv[l]=D}function Av(e){var t=Sv.call(e);if(jv[t]){return jv[t]}var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],l=e[7];var f=l*o;var c=-s*u;var d=s*o;var h=l*u;var p=Math.cos(i);var v=Math.sin(i);var g=Math.cos(a);var m=Math.sin(a);var y=.5*(a-i);var b=Math.sin(y*.5);var _=8/3*b*b/Math.sin(y);var x=n+p-_*v;var k=r+v+_*p;var O=n+g;var w=r+m;var j=O+_*m;var S=w-_*g;return jv[t]=[f*x+c*k,d*x+h*k,f*j+c*S,d*j+h*S,f*O+c*w,d*O+h*w]}var zv=["l",0,0,0,0,0,0,0];function Tv(e,t){var n=zv[0]=e[0];if(n==="a"||n==="A"){zv[1]=t*e[1];zv[2]=t*e[2];zv[6]=t*e[6];zv[7]=t*e[7]}else{for(var r=1,i=e.length;r<i;++r){zv[r]=t*e[r]}}return zv}var Mv=function(e,t,n,r,i){var a,o=null,u=0,s=0,l=0,f=0,c,d,h,p;if(n==null)n=0;if(r==null)r=0;if(i==null)i=1;if(e.beginPath)e.beginPath();for(var v=0,g=t.length;v<g;++v){a=t[v];if(i!==1)a=Tv(a,i);switch(a[0]){case"l":u+=a[1];s+=a[2];e.lineTo(u+n,s+r);break;case"L":u=a[1];s=a[2];e.lineTo(u+n,s+r);break;case"h":u+=a[1];e.lineTo(u+n,s+r);break;case"H":u=a[1];e.lineTo(u+n,s+r);break;case"v":s+=a[1];e.lineTo(u+n,s+r);break;case"V":s=a[1];e.lineTo(u+n,s+r);break;case"m":u+=a[1];s+=a[2];e.moveTo(u+n,s+r);break;case"M":u=a[1];s=a[2];e.moveTo(u+n,s+r);break;case"c":c=u+a[5];d=s+a[6];l=u+a[3];f=s+a[4];e.bezierCurveTo(u+a[1]+n,s+a[2]+r,l+n,f+r,c+n,d+r);u=c;s=d;break;case"C":u=a[5];s=a[6];l=a[3];f=a[4];e.bezierCurveTo(a[1]+n,a[2]+r,l+n,f+r,u+n,s+r);break;case"s":c=u+a[3];d=s+a[4];l=2*u-l;f=2*s-f;e.bezierCurveTo(l+n,f+r,u+a[1]+n,s+a[2]+r,c+n,d+r);l=u+a[1];f=s+a[2];u=c;s=d;break;case"S":c=a[3];d=a[4];l=2*u-l;f=2*s-f;e.bezierCurveTo(l+n,f+r,a[1]+n,a[2]+r,c+n,d+r);u=c;s=d;l=a[1];f=a[2];break;case"q":c=u+a[3];d=s+a[4];l=u+a[1];f=s+a[2];e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;break;case"Q":c=a[3];d=a[4];e.quadraticCurveTo(a[1]+n,a[2]+r,c+n,d+r);u=c;s=d;l=a[1];f=a[2];break;case"t":c=u+a[1];d=s+a[2];if(o[0].match(/[QqTt]/)===null){l=u;f=s}else if(o[0]==="t"){l=2*u-h;f=2*s-p}else if(o[0]==="q"){l=2*u-l;f=2*s-f}h=l;p=f;e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;l=u+a[1];f=s+a[2];break;case"T":c=a[1];d=a[2];l=2*u-l;f=2*s-f;e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;break;case"a":Nv(e,u+n,s+r,[a[1],a[2],a[3],a[4],a[5],a[6]+u+n,a[7]+s+r]);u+=a[6];s+=a[7];break;case"A":Nv(e,u+n,s+r,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+r]);u=a[6];s=a[7];break;case"z":case"Z":e.closePath();break}o=a}};function Nv(e,t,n,r){var i=Ev(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(var a=0;a<i.length;++a){var o=Av(i[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var Dv=2*Math.PI,Cv=Math.sqrt(3)/2;var Pv={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0);e.arc(0,0,n,0,Dv)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r);e.lineTo(-n,r);e.lineTo(-r,r);e.lineTo(-r,n);e.lineTo(r,n);e.lineTo(r,r);e.lineTo(n,r);e.lineTo(n,-r);e.lineTo(r,-r);e.lineTo(r,-n);e.lineTo(-r,-n);e.lineTo(-r,-r);e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0);e.lineTo(0,-n);e.lineTo(n,0);e.lineTo(0,n);e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Cv*n;e.moveTo(0,-r);e.lineTo(-n,r);e.lineTo(n,r);e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Cv*n;e.moveTo(0,r);e.lineTo(-n,-r);e.lineTo(n,-r);e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Cv*n;e.moveTo(r,0);e.lineTo(-r,-n);e.lineTo(-r,n);e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Cv*n;e.moveTo(-r,0);e.lineTo(r,-n);e.lineTo(r,n);e.closePath()}}};function Rv(e){return Pv.hasOwnProperty(e)?Pv[e]:Iv(e)}var Lv={};function Iv(e){if(!Lv.hasOwnProperty(e)){var t=Ov(e);Lv[e]={draw:function(e,n){Mv(e,t,0,0,Math.sqrt(n)/2)}}}return Lv[e]}function Fv(e){return e.x}function qv(e){return e.y}function Uv(e){return e.width}function Wv(e){return e.height}function Vv(e){return function(){return e}}var Hv=function(){var e=Fv,t=qv,n=Uv,r=Wv,i=Vv(0),a=null;function o(o,u,s){var l,f=u!=null?u:+e.call(this,o),c=s!=null?s:+t.call(this,o),d=+n.call(this,o),h=+r.call(this,o),p=+i.call(this,o);if(!a)a=l=Object(Wa["a"])();if(p<=0){a.rect(f,c,d,h)}else{var v=f+d,g=c+h;a.moveTo(f+p,c);a.lineTo(v-p,c);a.quadraticCurveTo(v,c,v,c+p);a.lineTo(v,g-p);a.quadraticCurveTo(v,g,v-p,g);a.lineTo(f+p,g);a.quadraticCurveTo(f,g,f,g-p);a.lineTo(f,c+p);a.quadraticCurveTo(f,c,f+p,c);a.closePath()}if(l){a=null;return l+""||null}}o.x=function(t){if(arguments.length){e=typeof t==="function"?t:Vv(+t);return o}else{return e}};o.y=function(e){if(arguments.length){t=typeof e==="function"?e:Vv(+e);return o}else{return t}};o.width=function(e){if(arguments.length){n=typeof e==="function"?e:Vv(+e);return o}else{return n}};o.height=function(e){if(arguments.length){r=typeof e==="function"?e:Vv(+e);return o}else{return r}};o.cornerRadius=function(e){if(arguments.length){i=typeof e==="function"?e:Vv(+e);return o}else{return i}};o.context=function(e){if(arguments.length){a=e==null?null:e;return o}else{return a}};return o};var Bv=Math.PI;var Gv=function(){var e,t,n,r,i=null,a,o,u,s;function l(e,t,n){var r=n/2;if(a){var l=u-t,f=e-o;if(l||f){var c=Math.sqrt(l*l+f*f),d=(l/=c)*s,h=(f/=c)*s,p=Math.atan2(f,l);i.moveTo(o-d,u-h);i.lineTo(e-l*r,t-f*r);i.arc(e,t,r,p-Bv,p);i.lineTo(o+d,u+h);i.arc(o,u,s,p,p+Bv)}else{i.arc(e,t,r,0,2*Bv)}i.closePath()}else{a=1}o=e;u=t;s=r}function f(o){var u,s=o.length,f,c=false,d;if(i==null)i=d=Object(Wa["a"])();for(u=0;u<=s;++u){if(!(u<s&&r(f=o[u],u,o))===c){if(c=!c)a=0}if(c)l(+e(f,u,o),+t(f,u,o),+n(f,u,o))}if(d){i=null;return d+""||null}}f.x=function(t){if(arguments.length){e=t;return f}else{return e}};f.y=function(e){if(arguments.length){t=e;return f}else{return t}};f.size=function(e){if(arguments.length){n=e;return f}else{return n}};f.defined=function(e){if(arguments.length){r=e;return f}else{return r}};f.context=function(e){if(arguments.length){if(e==null){i=null}else{i=e}return f}else{return i}};return f};function $v(e){return e.x||0}function Yv(e){return e.y||0}function Xv(e){return e.width||0}function Jv(e){return e.size||1}function Qv(e){return e.height||0}function Zv(e){return(e.x||0)+(e.width||0)}function Kv(e){return(e.y||0)+(e.height||0)}function eg(e){return e.startAngle||0}function tg(e){return e.endAngle||0}function ng(e){return e.padAngle||0}function rg(e){return e.innerRadius||0}function ig(e){return e.outerRadius||0}function ag(e){return e.cornerRadius||0}function og(e){return!(e.defined===false)}function ug(e){return e.size==null?64:e.size}function sg(e){return Rv(e.shape||"circle")}var lg=Object(xa["a"])().startAngle(eg).endAngle(tg).padAngle(ng).innerRadius(rg).outerRadius(ig).cornerRadius(ag),fg=Object(xa["b"])().x($v).y1(Yv).y0(Kv).defined(og),cg=Object(xa["b"])().y(Yv).x1($v).x0(Zv).defined(og),dg=Object(xa["u"])().x($v).y(Yv).defined(og),hg=Hv().x($v).y(Yv).width(Xv).height(Qv).cornerRadius(ag),pg=Object(xa["v"])().type(sg).size(ug),vg=Gv().x($v).y(Yv).defined(og).size(Jv);function gg(e,t){return lg.context(e)(t)}function mg(e,t){var n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?cg:fg).curve(_v(r,n.orient,n.tension)).context(e)(t)}function yg(e,t){var n=t[0],r=n.interpolate||"linear";return dg.curve(_v(r,n.orient,n.tension)).context(e)(t)}function bg(e,t,n,r){return hg.context(e)(t,n,r)}function _g(e,t){return(t.mark.shape||t.shape).context(e)(t)}function xg(e,t){return pg.context(e)(t)}function kg(e,t){return vg.context(e)(t)}var Og=function(e,t){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){e.expand(t.strokeWidth!=null?+t.strokeWidth:1)}return e};var wg,jg=Math.PI*2,Sg=jg/4,Eg=jg-1e-8;function Ag(e){wg=e;return Ag}function zg(){}function Tg(e,t){wg.add(e,t)}Ag.beginPath=zg;Ag.closePath=zg;Ag.moveTo=Tg;Ag.lineTo=Tg;Ag.rect=function(e,t,n,r){Tg(e,t);Tg(e+n,t+r)};Ag.quadraticCurveTo=function(e,t,n,r){Tg(e,t);Tg(n,r)};Ag.bezierCurveTo=function(e,t,n,r,i,a){Tg(e,t);Tg(n,r);Tg(i,a)};Ag.arc=function(e,t,n,r,i,a){if(Math.abs(i-r)>Eg){Tg(e-n,t-n);Tg(e+n,t+n);return}var o=Infinity,u=-Infinity,s=Infinity,l=-Infinity,f,c,d,h;function p(e){d=n*Math.cos(e);h=n*Math.sin(e);if(d<o)o=d;if(d>u)u=d;if(h<s)s=h;if(h>l)l=h}p(r);p(i);if(i!==r){r=r%jg;if(r<0)r+=jg;i=i%jg;if(i<0)i+=jg;if(i<r){a=!a;f=r;r=i;i=f}if(a){i-=jg;f=r-r%Sg;for(c=0;c<4&&f>i;++c,f-=Sg)p(f)}else{f=r-r%Sg+Sg;for(c=0;c<4&&f<i;++c,f=f+Sg)p(f)}}Tg(e+o,t+s);Tg(e+u,t+l)};var Mg=function(e,t,n){var r=n.width(),i=n.height(),a=n.x1+t.x1*r,o=n.y1+t.y1*i,u=n.x1+t.x2*r,s=n.y1+t.y2*i,l=t.stops,f=0,c=l.length,d=e.createLinearGradient(a,o,u,s);for(;f<c;++f){d.addColorStop(l[f].offset,l[f].color)}return d};var Ng=function(e,t,n){return n.id?Mg(e,n,t.bounds):n};var Dg=function(e,t,n){n*=t.fillOpacity==null?1:t.fillOpacity;if(n>0){e.globalAlpha=n;e.fillStyle=Ng(e,t,t.fill);return true}else{return false}};var Cg=[];var Pg=function(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;if(r<=0)return false;n*=t.strokeOpacity==null?1:t.strokeOpacity;if(n>0){e.globalAlpha=n;e.strokeStyle=Ng(e,t,t.stroke);e.lineWidth=r;e.lineCap=t.strokeCap||"butt";e.lineJoin=t.strokeJoin||"miter";e.miterLimit=t.strokeMiterLimit||10;if(e.setLineDash){e.setLineDash(t.strokeDash||Cg);e.lineDashOffset=t.strokeDashOffset||0}return true}else{return false}};function Rg(e,t){return e.zindex-t.zindex||e.index-t.index}function Lg(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,a;for(i=0,a=t.length;i<a;++i){r=t[i];r.index=i;if(r.zindex)n.push(r)}e.zdirty=false;return e.zitems=n.sort(Rg)}function Ig(e,t){var n=e.items,r,i;if(!n||!n.length)return;var a=Lg(e);if(a&&a.length){for(r=0,i=n.length;r<i;++r){if(!n[r].zindex)t(n[r])}n=a}for(r=0,i=n.length;r<i;++r){t(n[r])}}function Fg(e,t){var n=e.items,r,i;if(!n||!n.length)return null;var a=Lg(e);if(a&&a.length)n=a;for(i=n.length;--i>=0;){if(r=t(n[i]))return r}if(n===a){for(n=e.items,i=n.length;--i>=0;){if(!n[i].zindex){if(r=t(n[i]))return r}}}return null}function qg(e){return function(t,n,r){Ig(n,function(n){if(!r||r.intersects(n.bounds)){Wg(e,t,n,n)}})}}function Ug(e){return function(t,n,r){if(n.items.length&&(!r||r.intersects(n.bounds))){Wg(e,t,n.items[0],n.items)}}}function Wg(e,t,n,r){var i=n.opacity==null?1:n.opacity;if(i===0)return;if(e(t,r))return;if(n.fill&&Dg(t,n,i)){t.fill()}if(n.stroke&&Pg(t,n,i)){t.stroke()}}var Vg=function(){return true};function Hg(e){if(!e)e=Vg;return function(t,n,r,i,a,o){r*=t.pixelRatio;i*=t.pixelRatio;return Fg(n,function(n){var u=n.bounds;if(u&&!u.contains(a,o)||!u)return;if(e(t,n,r,i,a,o))return n})}}function Bg(e,t){return function(n,r,i,a){var o=Array.isArray(r)?r[0]:r,u=t==null?o.fill:t,s=o.stroke&&n.isPointInStroke,l,f;if(s){l=o.strokeWidth;f=o.strokeCap;n.lineWidth=l!=null?l:1;n.lineCap=f!=null?f:"butt"}return e(n,r)?false:u&&n.isPointInPath(i,a)||s&&n.isPointInStroke(i,a)}}function Gg(e){return Hg(Bg(e))}var $g=function(e,t){return"translate("+e+","+t+")"};var Yg=function(e){return $g(e.x||0,e.y||0)};var Xg=function(e,t){function n(e,n){e("transform",Yg(n));e("d",t(null,n))}function r(e,n){t(Ag(e),n);return Og(e,n).translate(n.x||0,n.y||0)}function i(e,n){var r=n.x||0,i=n.y||0;e.translate(r,i);e.beginPath();t(e,n);e.translate(-r,-i)}return{type:e,tag:"path",nested:false,attr:n,bound:r,draw:qg(i),pick:Gg(i)}};var Jg=Xg("arc",gg);function Qg(e,t){var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=0,a=e.length;if(a===1)return e[0];while(i<a){var o=i+a>>>1;if(e[o][r]<n)i=o+1;else a=o}i=Math.max(0,i-1);a=Math.min(e.length-1,a);return n-e[i][r]<e[a][r]-n?e[i]:e[a]}function Zg(e,t){var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,a,o;while(--r>=0){if(e[r].defined===false)continue;i=e[r].x-t[0];a=e[r].y-t[1];o=i*i+a*a;if(o<n)return e[r]}return null}function Kg(e,t){var n=e.length,r,i,a;while(--n>=0){if(e[n].defined===false)continue;r=e[n].x-t[0];i=e[n].y-t[1];a=r*r+i*i;r=e[n].size||1;if(a<r*r)return e[n]}return null}var em=function(e,t,n){function r(e,n){var r=n.mark.items;if(r.length)e("d",t(null,r))}function i(e,n){var r=n.items;if(r.length===0){return e}else{t(Ag(e),r);return Og(e,r[0])}}function a(e,n){e.beginPath();t(e,n)}var o=Bg(a);function u(e,t,n,r,i,a){var u=t.items,s=t.bounds;if(!u||!u.length||s&&!s.contains(i,a)){return null}n*=e.pixelRatio;r*=e.pixelRatio;return o(e,u,n,r)?u[0]:null}return{type:e,tag:"path",nested:true,attr:r,bound:i,draw:Ug(a),pick:u,tip:n}};var tm=em("area",mg,Qg);var nm=1;function rm(){nm=1}var im=function(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+nm++),o=i.clipping[a]||(i.clipping[a]={id:a});if(Object(V["isFunction"])(r)){o.path=r(null)}else{o.width=n.width||0;o.height=n.height||0}return"url(#"+a+")"};var am=.5;function om(e,t){e("transform",Yg(t))}function um(e,t){var n=t.stroke?am:0;e("class","background");e("d",bg(null,t,n,n))}function sm(e,t,n){var r=t.clip?im(n,t,t):null;e("clip-path",r)}function lm(e,t){if(!t.clip&&t.items){var n=t.items;for(var r=0,i=n.length;r<i;++r){e.union(n[r].bounds)}}if((t.clip||t.width||t.height)&&!t.noBound){e.add(0,0).add(t.width||0,t.height||0)}Og(e,t);return e.translate(t.x||0,t.y||0)}function fm(e,t){var n=t.stroke?am:0;e.beginPath();bg(e,t,n,n)}var cm=Bg(fm);function dm(e,t,n){var r=this;Ig(t,function(t){var i=t.x||0,a=t.y||0,o=t.width||0,u=t.height||0,s;e.save();e.translate(i,a);if(t.stroke||t.fill){s=t.opacity==null?1:t.opacity;if(s>0){fm(e,t);if(t.fill&&Dg(e,t,s)){e.fill()}if(t.stroke&&Pg(e,t,s)){e.stroke()}}}if(t.clip){e.beginPath();e.rect(0,0,o,u);e.clip()}if(n)n.translate(-i,-a);Ig(t,function(t){r.draw(e,t,n)});if(n)n.translate(i,a);e.restore()})}function hm(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items){return null}var o=this,u=n*e.pixelRatio,s=r*e.pixelRatio;return Fg(t,function(l){var f,c,d,h;h=l.bounds;if(h&&!h.contains(i,a))return;c=l.x||0;d=l.y||0;e.save();e.translate(c,d);c=i-c;d=a-d;f=Fg(l,function(e){return pm(e,c,d)?o.pick(e,n,r,c,d):null});if(!f&&t.interactive!==false&&(l.fill||l.stroke)&&cm(e,l,u,s)){f=l}e.restore();return f||null})}function pm(e,t,n){return(e.interactive!==false||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var vm={type:"group",tag:"g",nested:false,attr:om,bound:lm,draw:dm,pick:hm,background:um,foreground:sm};function gm(e,t){var n=e.image;if(!n||n.url!==e.url){n={loaded:false,width:0,height:0};t.loadImage(e.url).then(function(t){e.image=t;e.image.url=e.url})}return n}function mm(e,t){return e==="center"?t/2:e==="right"?t:0}function ym(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function bm(e,t,n){var r=gm(t,n),i=t.x||0,a=t.y||0,o=(t.width!=null?t.width:r.width)||0,u=(t.height!=null?t.height:r.height)||0,s=t.aspect===false?"none":"xMidYMid";i-=mm(t.align,o);a-=ym(t.baseline,u);e("href",r.src||"","http://www.w3.org/1999/xlink","xlink:href");e("transform",$g(i,a));e("width",o);e("height",u);e("preserveAspectRatio",s)}function _m(e,t){var n=t.image,r=t.x||0,i=t.y||0,a=(t.width!=null?t.width:n&&n.width)||0,o=(t.height!=null?t.height:n&&n.height)||0;r-=mm(t.align,a);i-=ym(t.baseline,o);return e.set(r,i,r+a,i+o)}function xm(e,t,n){var r=this;Ig(t,function(t){if(n&&!n.intersects(t.bounds))return;var i=gm(t,r),a=t.x||0,o=t.y||0,u=(t.width!=null?t.width:i.width)||0,s=(t.height!=null?t.height:i.height)||0,l,f,c,d;a-=mm(t.align,u);o-=ym(t.baseline,s);if(t.aspect!==false){f=i.width/i.height;c=t.width/t.height;if(f===f&&c===c&&f!==c){if(c<f){d=u/f;o+=(s-d)/2;s=d}else{d=s*f;a+=(u-d)/2;u=d}}}if(i.loaded){e.globalAlpha=(l=t.opacity)!=null?l:1;e.drawImage(i,a,o,u,s)}})}var km={type:"image",tag:"image",nested:false,attr:bm,bound:_m,draw:xm,pick:Hg(),get:gm,xOffset:mm,yOffset:ym};var Om=em("line",yg,Zg);function wm(e,t){e("transform",Yg(t));e("d",t.path)}function jm(e,t){var n=t.path;if(n==null)return true;var r=t.pathCache;if(!r||r.path!==n){(t.pathCache=r=Ov(n)).path=n}Mv(e,r,t.x,t.y)}function Sm(e,t){return jm(Ag(e),t)?e.set(0,0,0,0):Og(e,t)}var Em={type:"path",tag:"path",nested:false,attr:wm,bound:Sm,draw:qg(jm),pick:Gg(jm)};function Am(e,t){e("d",bg(null,t))}function zm(e,t){var n,r;return Og(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function Tm(e,t){e.beginPath();bg(e,t)}var Mm={type:"rect",tag:"path",nested:false,attr:Am,bound:zm,draw:qg(Tm),pick:Gg(Tm)};function Nm(e,t){e("transform",Yg(t));e("x2",t.x2!=null?t.x2-(t.x||0):0);e("y2",t.y2!=null?t.y2-(t.y||0):0)}function Dm(e,t){var n,r;return Og(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function Cm(e,t,n){var r,i,a,o;if(t.stroke&&Pg(e,t,n)){r=t.x||0;i=t.y||0;a=t.x2!=null?t.x2:r;o=t.y2!=null?t.y2:i;e.beginPath();e.moveTo(r,i);e.lineTo(a,o);return true}return false}function Pm(e,t,n){Ig(t,function(t){if(n&&!n.intersects(t.bounds))return;var r=t.opacity==null?1:t.opacity;if(r&&Cm(e,t,r)){e.stroke()}})}function Rm(e,t,n,r){if(!e.isPointInStroke)return false;return Cm(e,t,1)&&e.isPointInStroke(n,r)}var Lm={type:"rule",tag:"line",nested:false,attr:Nm,bound:Dm,draw:Pm,pick:Hg(Rm)};var Im=Xg("shape",_g);var Fm=Xg("symbol",xg);var qm,Um;var Wm={height:$m,measureWidth:Bm,estimateWidth:Vm,width:Vm,canvas:Ym};Ym(true);function Vm(e){Um=$m(e);return Hm(Xm(e))}function Hm(e){return~~(.8*e.length*Um)}function Bm(e){qm.font=Zm(e);return Gm(Xm(e))}function Gm(e){return qm.measureText(e).width}function $m(e){return e.fontSize!=null?e.fontSize:11}function Ym(e){qm=e&&(qm=Object(Wi["a"])(1,1))?qm.getContext("2d"):null;Wm.width=qm?Bm:Vm}function Xm(e){var t=e.text;if(t==null){return""}else{return e.limit>0?Jm(e):t+""}}function Jm(e){var t=+e.limit,n=e.text+"",r;if(qm){qm.font=Zm(e);r=Gm}else{Um=$m(e);r=Hm}if(r(n)<t)return n;var i=e.ellipsis||"",a=e.dir==="rtl",o=0,u=n.length,s;t-=r(i);if(a){while(o<u){s=o+u>>>1;if(r(n.slice(s))>t)o=s+1;else u=s}return i+n.slice(o)}else{while(o<u){s=1+(o+u>>>1);if(r(n.slice(0,s))<t)o=s;else u=s-1}return n.slice(0,o)+i}}function Qm(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function Zm(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+$m(e)+"px "+Qm(e,t)}function Km(e){var t=e.baseline,n=$m(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:0)}var ey={left:"start",center:"middle",right:"end"};var ty=new lv;function ny(e,t){var n=t.dx||0,r=(t.dy||0)+Km(t),i=t.x||0,a=t.y||0,o=t.angle||0,u=t.radius||0,s;if(u){s=(t.theta||0)-Math.PI/2;i+=u*Math.cos(s);a+=u*Math.sin(s)}e("text-anchor",ey[t.align]||"start");if(o){s=$g(i,a)+" rotate("+o+")";if(n||r)s+=" "+$g(n,r)}else{s=$g(i+n,a+r)}e("transform",s)}function ry(e,t,n){var r=Wm.height(t),i=t.align,a=t.radius||0,o=t.x||0,u=t.y||0,s=t.dx||0,l=(t.dy||0)+Km(t)-Math.round(.8*r),f,c;if(a){c=(t.theta||0)-Math.PI/2;o+=a*Math.cos(c);u+=a*Math.sin(c)}f=Wm.width(t);if(i==="center"){s-=f/2}else if(i==="right"){s-=f}else{}e.set(s+=o,l+=u,s+f,l+r);if(t.angle&&!n){e.rotate(t.angle*Math.PI/180,o,u)}return e.expand(n||!f?0:1)}function iy(e,t,n){Ig(t,function(t){var r,i,a,o,u,s;if(n&&!n.intersects(t.bounds))return;if(!(s=Xm(t)))return;r=t.opacity==null?1:t.opacity;if(r===0)return;e.font=Zm(t);e.textAlign=t.align||"left";i=t.x||0;a=t.y||0;if(o=t.radius){u=(t.theta||0)-Math.PI/2;i+=o*Math.cos(u);a+=o*Math.sin(u)}if(t.angle){e.save();e.translate(i,a);e.rotate(t.angle*Math.PI/180);i=a=0}i+=t.dx||0;a+=(t.dy||0)+Km(t);if(t.fill&&Dg(e,t,r)){e.fillText(s,i,a)}if(t.stroke&&Pg(e,t,r)){e.strokeText(s,i,a)}if(t.angle)e.restore()})}function ay(e,t,n,r,i,a){if(t.fontSize<=0)return false;if(!t.angle)return true;var o=ry(ty,t,true),u=-t.angle*Math.PI/180,s=Math.cos(u),l=Math.sin(u),f=t.x,c=t.y,d=s*i-l*a+(f-f*s+c*l),h=l*i+s*a+(c-f*l-c*s);return o.contains(d,h)}var oy={type:"text",tag:"text",nested:false,attr:ny,bound:ry,draw:iy,pick:Hg(ay)};var uy=em("trail",kg,Kg);var sy={arc:Jg,area:tm,group:vm,image:km,line:Om,path:Em,rect:Mm,rule:Lm,shape:Im,symbol:Fm,text:oy,trail:uy};var ly=function(e,t,n){var r=sy[e.mark.marktype],i=t||r.bound;if(r.nested)e=e.mark;return i(e.bounds||(e.bounds=new lv),e,n)};var fy={mark:null};var cy=function(e,t,n){var r=sy[e.marktype],i=r.bound,a=e.items,o=a&&a.length,u,s,l,f;if(r.nested){if(o){l=a[0]}else{fy.mark=e;l=fy}f=ly(l,i,n);t=t&&t.union(f)||f;return t}t=t||e.bounds&&e.bounds.clear()||new lv;if(o){for(u=0,s=a.length;u<s;++u){t.union(ly(a[u],i,n))}}return e.bounds=t};var dy=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","interpolate","tension","orient","defined","url","path","x2","y2","size","shape","text","angle","theta","radius","dx","dy","font","fontSize","fontWeight","fontStyle","fontVariant"];function hy(e,t){return JSON.stringify(e,dy,t)}function py(e){var t=typeof e==="string"?JSON.parse(e):e;return vy(t)}function vy(e){var t=e.marktype,n=e.items,r,i,a;if(n){for(i=0,a=n.length;i<a;++i){r=t?"mark":"group";n[i][r]=e;if(n[i].zindex)n[i][r].zdirty=true;if("group"===(t||r))vy(n[i])}}if(t)cy(e);return e}function gy(e){if(arguments.length){this.root=py(e)}else{this.root=yy({marktype:"group",name:"root",role:"frame"});this.root.items=[new pv(this.root)]}}var my=gy.prototype;my.toJSON=function(e){return hy(this.root,e||0)};my.mark=function(e,t,n){t=t||this.root.items[0];var r=yy(e,t);t.items[n]=r;if(r.zindex)r.group.zdirty=true;return r};function yy(e,t){return{bounds:new lv,clip:!!e.clip,group:t,interactive:e.interactive===false?false:true,items:[],marktype:e.marktype,name:e.name||undefined,role:e.role||undefined,zindex:e.zindex||0}}function by(e,t,n){if(!e&&typeof document!=="undefined"&&document.createElement){e=document}return e?n?e.createElementNS(n,t):e.createElement(t):null}function _y(e,t){t=t.toLowerCase();var n=e.childNodes,r=0,i=n.length;for(;r<i;++r)if(n[r].tagName.toLowerCase()===t){return n[r]}}function xy(e,t,n,r){var i=e.childNodes[t],a;if(!i||i.tagName.toLowerCase()!==n.toLowerCase()){a=i||null;i=by(e.ownerDocument,n,r);e.insertBefore(i,a)}return i}function ky(e,t){var n=e.childNodes,r=n.length;while(r>t)e.removeChild(n[--r]);return e}function Oy(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}var wy=function(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]};var jy=function(e,t,n,r){var i=e&&e.mark,a,o;if(i&&(a=sy[i.marktype]).tip){o=wy(t,n);o[0]-=r[0];o[1]-=r[1];while(e=e.mark.group){o[0]-=e.x||0;o[1]-=e.y||0}e=a.tip(i.items,o)}return e};function Sy(e,t){this._active=null;this._handlers={};this._loader=e||Lp();this._tooltip=t||Ey}function Ey(e,t,n,r){e.element().setAttribute("title",r||"")}var Ay=Sy.prototype;Ay.initialize=function(e,t,n){this._el=e;this._obj=n||null;return this.origin(t)};Ay.element=function(){return this._el};Ay.canvas=function(){return this._el&&this._el.firstChild};Ay.origin=function(e){if(arguments.length){this._origin=e||[0,0];return this}else{return this._origin.slice()}};Ay.scene=function(e){if(!arguments.length)return this._scene;this._scene=e;return this};Ay.on=function(){};Ay.off=function(){};Ay._handlerIndex=function(e,t,n){for(var r=e?e.length:0;--r>=0;){if(e[r].type===t&&(!n||e[r].handler===n)){return r}}return-1};Ay.handlers=function(e){var t=this._handlers,n=[],r;if(e){n.push.apply(n,t[this.eventName(e)])}else{for(r in t){n.push.apply(n,t[r])}}return n};Ay.eventName=function(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)};Ay.handleHref=function(e,t,n){this._loader.sanitize(n,{context:"href"}).then(function(t){var n=new MouseEvent(e.type,e),r=by(null,"a");for(var i in t)r.setAttribute(i,t[i]);r.dispatchEvent(n)}).catch(function(){})};Ay.handleTooltip=function(e,t,n){if(t&&t.tooltip!=null){t=jy(t,e,this.canvas(),this._origin);var r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}};Ay.getItemBoundingClientRect=function(e){if(!(t=this.canvas()))return;var t,n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.x1+r[0]+n.left,o=i.y1+r[1]+n.top,u=i.width(),s=i.height();while(e.mark&&(e=e.mark.group)){a+=e.x||0;o+=e.y||0}return{x:a,y:o,width:u,height:s,left:a,top:o,right:a+u,bottom:o+s}};function zy(e){this._el=null;this._bgcolor=null;this._loader=new vv(e)}var Ty=zy.prototype;Ty.initialize=function(e,t,n,r,i){this._el=e;return this.resize(t,n,r,i)};Ty.element=function(){return this._el};Ty.canvas=function(){return this._el&&this._el.firstChild};Ty.background=function(e){if(arguments.length===0)return this._bgcolor;this._bgcolor=e;return this};Ty.resize=function(e,t,n,r){this._width=e;this._height=t;this._origin=n||[0,0];this._scale=r||1;return this};Ty.dirty=function(){};Ty.render=function(e){var t=this;t._call=function(){t._render(e)};t._call();t._call=null;return t};Ty._render=function(){};Ty.renderAsync=function(e){var t=this.render(e);return this._ready?this._ready.then(function(){return t}):Promise.resolve(t)};Ty._load=function(e,t){var n=this,r=n._loader[e](t);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then(function(e){if(e)i();n._ready=null})}return r};Ty.sanitizeURL=function(e){return this._load("sanitizeURL",e)};Ty.loadImage=function(e){return this._load("loadImage",e)};var My=["keydown","keypress","keyup","dragenter","dragleave","dragover","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"];var Ny="mousemove";var Dy="mouseout";var Cy="click";function Py(e,t){Sy.call(this,e,t);this._down=null;this._touch=null;this._first=true}var Ry=Object(V["inherits"])(Py,Sy);Ry.initialize=function(e,t,n){var r=this._canvas=e&&_y(e,"canvas");if(r){var i=this;this.events.forEach(function(e){r.addEventListener(e,function(t){if(Ry[e]){Ry[e].call(i,t)}else{i.fire(e,t)}})})}return Sy.prototype.initialize.call(this,e,t,n)};Ry.canvas=function(){return this._canvas};Ry.context=function(){return this._canvas.getContext("2d")};Ry.events=My;Ry.DOMMouseScroll=function(e){this.fire("mousewheel",e)};function Ly(e,t,n){return function(r){var i=this._active,a=this.pickEvent(r);if(a===i){this.fire(e,r)}else{if(!i||!i.exit){this.fire(n,r)}this._active=a;this.fire(t,r);this.fire(e,r)}}}function Iy(e){return function(t){this.fire(e,t);this._active=null}}Ry.mousemove=Ly("mousemove","mouseover","mouseout");Ry.dragover=Ly("dragover","dragenter","dragleave");Ry.mouseout=Iy("mouseout");Ry.dragleave=Iy("dragleave");Ry.mousedown=function(e){this._down=this._active;this.fire("mousedown",e)};Ry.click=function(e){if(this._down===this._active){this.fire("click",e);this._down=null}};Ry.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]);if(this._first){this._active=this._touch;this._first=false}this.fire("touchstart",e,true)};Ry.touchmove=function(e){this.fire("touchmove",e,true)};Ry.touchend=function(e){this.fire("touchend",e,true);this._touch=null};Ry.fire=function(e,t,n){var r=n?this._touch:this._active,i=this._handlers[e],a,o;t.vegaType=e;if(e===Cy&&r&&r.href){this.handleHref(t,r,r.href)}else if(e===Ny||e===Dy){this.handleTooltip(t,r,e!==Dy)}if(i){for(a=0,o=i.length;a<o;++a){i[a].handler.call(this._obj,t,r)}}};Ry.on=function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){(r[n]||(r[n]=[])).push({type:e,handler:t})}return this};Ry.off=function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){r.splice(i,1)}return this};Ry.pickEvent=function(e){var t=wy(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])};Ry.pick=function(e,t,n,r,i){var a=this.context(),o=sy[e.marktype];return o.pick.call(this,a,e,t,n,r,i)};var Fy=function(e,t){var n=t.clip;e.save();e.beginPath();if(Object(V["isFunction"])(n)){n(e)}else{var r=t.group;e.rect(0,0,r.width||0,r.height||0)}e.clip()};function qy(){return typeof window!=="undefined"?window.devicePixelRatio||1:1}var Uy=qy();var Wy=function(e,t,n,r,i){var a=typeof HTMLElement!=="undefined"&&e instanceof HTMLElement&&e.parentNode!=null;var o=e.getContext("2d"),u=a?Uy:i;e.width=t*u;e.height=n*u;if(a&&u!==1){e.style.width=t+"px";e.style.height=n+"px"}o.pixelRatio=u;o.setTransform(u,0,0,u,u*r[0],u*r[1]);return e};function Vy(e){zy.call(this,e);this._redraw=false;this._dirty=new lv}var Hy=Object(V["inherits"])(Vy,zy),By=zy.prototype,Gy=new lv;Hy.initialize=function(e,t,n,r,i){this._canvas=Object(Wi["a"])(1,1);if(e){ky(e,0).appendChild(this._canvas);this._canvas.setAttribute("class","marks")}return By.initialize.call(this,e,t,n,r,i)};Hy.resize=function(e,t,n,r){By.resize.call(this,e,t,n,r);Wy(this._canvas,this._width,this._height,this._origin,this._scale);this._redraw=true;return this};Hy.canvas=function(){return this._canvas};Hy.context=function(){return this._canvas?this._canvas.getContext("2d"):null};Hy.dirty=function(e){var t=Yy(e.bounds,e.mark.group);this._dirty.union(t)};function $y(e,t,n){t.expand(1).round();t.translate(-(n[0]%1),-(n[1]%1));e.beginPath();e.rect(t.x1,t.y1,t.width(),t.height());e.clip();return t}function Yy(e,t){if(t==null)return e;var n=Gy.clear().union(e);for(;t!=null;t=t.mark.group){n.translate(t.x||0,t.y||0)}return n}Hy._render=function(e){var t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty;t.save();if(this._redraw||a.empty()){this._redraw=false;a=null}else{a=$y(t,a,n)}this.clear(-n[0],-n[1],r,i);this.draw(t,e,a);t.restore();this._dirty.clear();return this};Hy.draw=function(e,t,n){var r=sy[t.marktype];if(t.clip)Fy(e,t);r.draw.call(this,e,t,n);if(t.clip)e.restore()};Hy.clear=function(e,t,n,r){var i=this.context();i.clearRect(e,t,n,r);if(this._bgcolor!=null){i.fillStyle=this._bgcolor;i.fillRect(e,t,n,r)}};function Xy(e,t){Sy.call(this,e,t);var n=this;n._hrefHandler=Qy(n,function(e,t){if(t&&t.href)n.handleHref(e,t,t.href)});n._tooltipHandler=Qy(n,function(e,t){n.handleTooltip(e,t,e.type!==Dy)})}var Jy=Object(V["inherits"])(Xy,Sy);Jy.initialize=function(e,t,n){var r=this._svg;if(r){r.removeEventListener(Cy,this._hrefHandler);r.removeEventListener(Ny,this._tooltipHandler);r.removeEventListener(Dy,this._tooltipHandler)}this._svg=r=e&&_y(e,"svg");if(r){r.addEventListener(Cy,this._hrefHandler);r.addEventListener(Ny,this._tooltipHandler);r.addEventListener(Dy,this._tooltipHandler)}return Sy.prototype.initialize.call(this,e,t,n)};Jy.canvas=function(){return this._svg};function Qy(e,t){return function(n){var r=n.target,i=r.__data__;n.vegaType=n.type;i=Array.isArray(i)?i[0]:i;t.call(e._obj,n,i)}}Jy.on=function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){var a={type:e,handler:t,listener:Qy(this,t)};(r[n]||(r[n]=[])).push(a);if(this._svg){this._svg.addEventListener(n,a.listener)}}return this};Jy.off=function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){if(this._svg){this._svg.removeEventListener(n,r[i].listener)}r.splice(i,1)}return this};function Zy(e,t,n){var r="<"+e,i,a;if(t){for(i in t){a=t[i];if(a!=null){r+=" "+i+'="'+a+'"'}}}if(n)r+=" "+n;return r+">"}function Ky(e){return"</"+e+">"}var eb={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};var tb={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"};var nb=Object.keys(tb);var rb=eb.xmlns;function ib(e){zy.call(this,e);this._dirtyID=1;this._dirty=[];this._svg=null;this._root=null;this._defs=null}var ab=Object(V["inherits"])(ib,zy);var ob=zy.prototype;ab.initialize=function(e,t,n,r){if(e){this._svg=xy(e,0,"svg",rb);this._svg.setAttribute("class","marks");ky(e,1);this._root=xy(this._svg,0,"g",rb);ky(this._svg,1)}this._defs={gradient:{},clipping:{}};this.background(this._bgcolor);return ob.initialize.call(this,e,t,n,r)};ab.background=function(e){if(arguments.length&&this._svg){this._svg.style.setProperty("background-color",e)}return ob.background.apply(this,arguments)};ab.resize=function(e,t,n,r){ob.resize.call(this,e,t,n,r);if(this._svg){this._svg.setAttribute("width",this._width*this._scale);this._svg.setAttribute("height",this._height*this._scale);this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height);this._root.setAttribute("transform","translate("+this._origin+")")}this._dirty=[];return this};ab.canvas=function(){return this._svg};ab.svg=function(){if(!this._svg)return null;var e={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var t in eb){e[t]=eb[t]}var n=!this._bgcolor?"":Zy("rect",{width:this._width,height:this._height,style:"fill: "+this._bgcolor+";"})+Ky("rect");return Zy("svg",e)+n+this._svg.innerHTML+Ky("svg")};ab._render=function(e){if(this._dirtyCheck()){if(this._dirtyAll)this._resetDefs();this.draw(this._root,e);ky(this._root,1)}this.updateDefs();this._dirty=[];++this._dirtyID;return this};ab.updateDefs=function(){var e=this._svg,t=this._defs,n=t.el,r=0,i;for(i in t.gradient){if(!n)t.el=n=xy(e,0,"defs",rb);ub(n,t.gradient[i],r++)}for(i in t.clipping){if(!n)t.el=n=xy(e,0,"defs",rb);sb(n,t.clipping[i],r++)}if(n){if(r===0){e.removeChild(n);t.el=null}else{ky(n,r)}}};function ub(e,t,n){var r,i,a;e=xy(e,n,"linearGradient",rb);e.setAttribute("id",t.id);e.setAttribute("x1",t.x1);e.setAttribute("x2",t.x2);e.setAttribute("y1",t.y1);e.setAttribute("y2",t.y2);for(r=0,i=t.stops.length;r<i;++r){a=xy(e,r,"stop",rb);a.setAttribute("offset",t.stops[r].offset);a.setAttribute("stop-color",t.stops[r].color)}ky(e,r)}function sb(e,t,n){var r;e=xy(e,n,"clipPath",rb);e.setAttribute("id",t.id);if(t.path){r=xy(e,0,"path",rb);r.setAttribute("d",t.path)}else{r=xy(e,0,"rect",rb);r.setAttribute("x",0);r.setAttribute("y",0);r.setAttribute("width",t.width);r.setAttribute("height",t.height)}}ab._resetDefs=function(){var e=this._defs;e.gradient={};e.clipping={}};ab.dirty=function(e){if(e.dirty!==this._dirtyID){e.dirty=this._dirtyID;this._dirty.push(e)}};ab.isDirty=function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID};ab._dirtyCheck=function(){this._dirtyAll=true;var e=this._dirty;if(!e.length)return true;var t=++this._dirtyID,n,r,i,a,o,u,s;for(o=0,u=e.length;o<u;++o){n=e[o];r=n.mark;if(r.marktype!==i){i=r.marktype;a=sy[i]}if(r.zdirty&&r.dirty!==t){this._dirtyAll=false;lb(n,t);r.items.forEach(function(e){e.dirty=t})}if(r.zdirty)continue;if(n.exit){if(a.nested&&r.items.length){s=r.items[0];if(s._svg)this._update(a,s._svg,s)}else if(n._svg){s=n._svg.parentNode;if(s)s.removeChild(n._svg)}n._svg=null;continue}n=a.nested?r.items[0]:n;if(n._update===t)continue;if(!n._svg||!n._svg.ownerSVGElement){this._dirtyAll=false;lb(n,t)}else{this._update(a,n._svg,n)}n._update=t}return!this._dirtyAll};function lb(e,t){for(;e&&e.dirty!==t;e=e.mark.group){e.dirty=t;if(e.mark&&e.mark.dirty!==t){e.mark.dirty=t}else return}}ab.draw=function(e,t,n){if(!this.isDirty(t))return t._svg;var r=this,i=this._svg,a=sy[t.marktype],o=t.interactive===false?"none":null,u=a.tag==="g",s=null,l=0,f;f=cb(t,e,n,"g",i);f.setAttribute("class",Oy(t));if(!u){f.style.setProperty("pointer-events",o)}if(t.clip){f.setAttribute("clip-path",im(r,t,t.group))}else{f.removeAttribute("clip-path")}function c(e){var t=r.isDirty(e),n=cb(e,f,s,a.tag,i);if(t){r._update(a,n,e);if(u)fb(r,n,e)}s=n;++l}if(a.nested){if(t.items.length)c(t.items[0])}else{Ig(t,c)}ky(f,l);return f};function fb(e,t,n){t=t.lastChild;var r,i=0;Ig(n,function(n){r=e.draw(t,n,r);++i});ky(t,1+i)}function cb(e,t,n,r,i){var a=e._svg,o;if(!a){o=t.ownerDocument;a=by(o,r,rb);e._svg=a;if(e.mark){a.__data__=e;a.__values__={fill:"default"};if(r==="g"){var u=by(o,"path",rb);u.setAttribute("class","background");a.appendChild(u);u.__data__=e;var s=by(o,"g",rb);a.appendChild(s);s.__data__=e}}}if(a.ownerSVGElement!==i||db(e)&&a.previousSibling!==n){t.insertBefore(a,n?n.nextSibling:t.firstChild)}return a}function db(e){var t=e.mark||e.group;return t&&t.items.length>1}var hb=null,pb=null;var vb={group:function(e,t,n){pb=t.__values__;hb=t.childNodes[1];e.foreground(mb,n,this);hb=t.childNodes[0];e.background(mb,n,this);var r=n.mark.interactive===false?"none":null;if(r!==pb.events){hb.style.setProperty("pointer-events",r);pb.events=r}},text:function(e,t,n){var r;r=Xm(n);if(r!==pb.text){t.textContent=r;pb.text=r}gb(t,"font-family",Qm(n));gb(t,"font-size",$m(n)+"px");gb(t,"font-style",n.fontStyle);gb(t,"font-variant",n.fontVariant);gb(t,"font-weight",n.fontWeight)}};function gb(e,t,n){if(n!==pb[t]){if(n==null){e.style.removeProperty(t)}else{e.style.setProperty(t,n+"")}pb[t]=n}}ab._update=function(e,t,n){hb=t;pb=t.__values__;e.attr(mb,n,this);var r=vb[e.type];if(r)r.call(this,e,t,n);this.style(hb,n)};function mb(e,t,n){if(t===pb[e])return;if(t!=null){if(n){hb.setAttributeNS(n,e,t)}else{hb.setAttribute(e,t)}}else{if(n){hb.removeAttributeNS(n,e)}else{hb.removeAttribute(e)}}pb[e]=t}ab.style=function(e,t){if(t==null)return;var n,r,i,a,o;for(n=0,r=nb.length;n<r;++n){i=nb[n];o=t[i];if(i==="font"){o=Qm(t)}if(o===pb[i])continue;a=tb[i];if(o==null){if(a==="fill"){e.style.setProperty(a,"none")}else{e.style.removeProperty(a)}}else{if(o.id){this._defs.gradient[o.id]=o;o="url("+yb()+"#"+o.id+")"}e.style.setProperty(a,o+"")}pb[i]=o}};function yb(){var e;return typeof window==="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function bb(e){zy.call(this,e);this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""};this._defs={gradient:{},clipping:{}}}var _b=Object(V["inherits"])(bb,zy);var xb=zy.prototype;_b.resize=function(e,t,n,r){xb.resize.call(this,e,t,n,r);var i=this._origin,a=this._text;var o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var u in eb){o[u]=eb[u]}a.head=Zy("svg",o);var s=this._bgcolor;if(s==="transparent"||s==="none")s=null;if(s){a.bg=Zy("rect",{width:this._width,height:this._height,style:"fill: "+s+";"})+Ky("rect")}else{a.bg=""}a.root=Zy("g",{transform:"translate("+i+")"});a.foot=Ky("g")+Ky("svg");return this};_b.background=function(){var e=xb.background.apply(this,arguments);if(arguments.length&&this._text.head){this.resize(this._width,this._height,this._origin,this._scale)}return e};_b.svg=function(){var e=this._text;return e.head+e.bg+e.defs+e.root+e.body+e.foot};_b._render=function(e){this._text.body=this.mark(e);this._text.defs=this.buildDefs();return this};_b.buildDefs=function(){var e=this._defs,t="",n,r,i,a;for(r in e.gradient){i=e.gradient[r];a=i.stops;t+=Zy("linearGradient",{id:r,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(n=0;n<a.length;++n){t+=Zy("stop",{offset:a[n].offset,"stop-color":a[n].color})+Ky("stop")}t+=Ky("linearGradient")}for(r in e.clipping){i=e.clipping[r];t+=Zy("clipPath",{id:r});if(i.path){t+=Zy("path",{d:i.path})+Ky("path")}else{t+=Zy("rect",{x:0,y:0,width:i.width,height:i.height})+Ky("rect")}t+=Ky("clipPath")}return t.length>0?Zy("defs")+t+Ky("defs"):""};var kb;function Ob(e,t,n,r){kb[r||e]=t}_b.attributes=function(e,t){kb={};e(Ob,t,this);return kb};_b.href=function(e){var t=this,n=e.href,r;if(n){if(r=t._hrefs&&t._hrefs[n]){return r}else{t.sanitizeURL(n).then(function(e){e["xlink:href"]=e.href;e.href=null;(t._hrefs||(t._hrefs={}))[n]=e})}}return null};_b.mark=function(e){var t=this,n=sy[e.marktype],r=n.tag,i=this._defs,a="",o;if(r!=="g"&&e.interactive===false){o='style="pointer-events: none;"'}a+=Zy("g",{class:Oy(e),"clip-path":e.clip?im(t,e,e.group):null},o);function u(u){var s=t.href(u);if(s)a+=Zy("a",s);o=r!=="g"?wb(u,e,r,i):null;a+=Zy(r,t.attributes(n.attr,u),o);if(r==="text"){a+=jb(Xm(u))}else if(r==="g"){a+=Zy("path",t.attributes(n.background,u),wb(u,e,"bgrect",i))+Ky("path");a+=Zy("g",t.attributes(n.foreground,u))+t.markGroup(u)+Ky("g")}a+=Ky(r);if(s)a+=Ky("a")}if(n.nested){if(e.items&&e.items.length)u(e.items[0])}else{Ig(e,u)}return a+Ky("g")};_b.markGroup=function(e){var t=this,n="";Ig(e,function(e){n+=t.mark(e)});return n};function wb(e,t,n,r){if(e==null)return"";var i,a,o,u,s,l="";if(n==="bgrect"&&t.interactive===false){l+="pointer-events: none; "}if(n==="text"){l+="font-family: "+Qm(e)+"; ";l+="font-size: "+$m(e)+"px; ";if(e.fontStyle)l+="font-style: "+e.fontStyle+"; ";if(e.fontVariant)l+="font-variant: "+e.fontVariant+"; ";if(e.fontWeight)l+="font-weight: "+e.fontWeight+"; "}for(i=0,a=nb.length;i<a;++i){o=nb[i];u=tb[o];s=e[o];if(s==null){if(u==="fill"){l+="fill: none; "}}else if(s==="transparent"&&(u==="fill"||u==="stroke")){l+=u+": none; "}else{if(s.id){r.gradient[s.id]=s;s="url(#"+s.id+")"}l+=u+": "+s+"; "}}return l?'style="'+l.trim()+'"':null}function jb(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Sb="canvas";var Eb="png";var Ab="svg";var zb="none";var Tb={Canvas:Sb,PNG:Eb,SVG:Ab,None:zb};var Mb={};Mb[Sb]=Mb[Eb]={renderer:Vy,headless:Vy,handler:Py};Mb[Ab]={renderer:ib,headless:bb,handler:Xy};Mb[zb]={};function Nb(e,t){e=String(e||"").toLowerCase();if(arguments.length>1){Mb[e]=t;return this}else{return Mb[e]}}var Db=new lv;var Cb=function(e){var t=e.clip;if(Object(V["isFunction"])(t)){t(Ag(Db.clear()))}else if(t){Db.set(0,0,e.group.width,e.group.height)}else return;e.bounds.intersect(Db)};var Pb=1e-9;function Rb(e,t,n){return e===t?true:n==="path"?Lb(e,t):e instanceof Date&&t instanceof Date?+e===+t:Object(V["isNumber"])(e)&&Object(V["isNumber"])(t)?Math.abs(e-t)<=Pb:!e||!t||!Object(V["isObject"])(e)&&!Object(V["isObject"])(t)?e==t:e==null||t==null?false:Ib(e,t)}function Lb(e,t){return Rb(Ov(e),Ov(t))}function Ib(e,t){var n=Object.keys(e),r=Object.keys(t),i,a;if(n.length!==r.length)return false;n.sort();r.sort();for(a=n.length-1;a>=0;a--){if(n[a]!=r[a])return false}for(a=n.length-1;a>=0;a--){i=n[a];if(!Rb(e[i],t[i],i))return false}return typeof e===typeof t}var Fb="default";var qb=function(e){var t=e._signals.cursor;if(!t){e._signals.cursor=t=e.add({user:Fb,item:null})}e.on(e.events("view","mousemove"),t,function(e,n){var r=t.value,i=r?Object(V["isString"])(r)?r:r.user:Fb,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}});e.add(null,function(e){var t=e.cursor,n=this.value;if(!Object(V["isString"])(t)){n=t.item;t=t.user}Ub(t&&t!==Fb?t:n||t);return n},{cursor:t})};function Ub(e){if(typeof document!=="undefined"&&document.body){document.body.style.cursor=e}}function Wb(e,t){var n=e._runtime.data;if(!n.hasOwnProperty(t)){Object(V["error"])("Unrecognized data set: "+t)}return n[t]}function Vb(e){return Wb(this,e).values.value}function Hb(e,t){if(!te(t)){Object(V["error"])("Second argument to changes must be a changeset.")}var n=Wb(this,e);n.modified=true;return this.pulse(n.input,t)}function Bb(e,t){return Hb.call(this,e,ne().insert(t))}function Gb(e,t){return Hb.call(this,e,ne().remove(t))}function $b(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function Yb(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Xb(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function Jb(e){var t=Xb(e),n=$b(e),r=Yb(e);e._renderer.background(e._background);e._renderer.resize(n,r,t);e._handler.origin(t);e._resizeListeners.forEach(function(t){try{t(n,r)}catch(t){e.error(t)}})}function Qb(e){this.clear();if(e)this.union(e)}var Zb=Qb.prototype;Zb.clone=function(){return new Qb(this)};Zb.clear=function(){this.x1=+Number.MAX_VALUE;this.y1=+Number.MAX_VALUE;this.x2=-Number.MAX_VALUE;this.y2=-Number.MAX_VALUE;return this};Zb.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE};Zb.set=function(e,t,n,r){if(n<e){this.x2=e;this.x1=n}else{this.x1=e;this.x2=n}if(r<t){this.y2=t;this.y1=r}else{this.y1=t;this.y2=r}return this};Zb.add=function(e,t){if(e<this.x1)this.x1=e;if(t<this.y1)this.y1=t;if(e>this.x2)this.x2=e;if(t>this.y2)this.y2=t;return this};Zb.expand=function(e){this.x1-=e;this.y1-=e;this.x2+=e;this.y2+=e;return this};Zb.round=function(){this.x1=Math.floor(this.x1);this.y1=Math.floor(this.y1);this.x2=Math.ceil(this.x2);this.y2=Math.ceil(this.y2);return this};Zb.translate=function(e,t){this.x1+=e;this.x2+=e;this.y1+=t;this.y2+=t;return this};Zb.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),a=t-t*r+n*i,o=n-t*i-n*r,u=this.x1,s=this.x2,l=this.y1,f=this.y2;return this.clear().add(r*u-i*l+a,i*u+r*l+o).add(r*u-i*f+a,i*u+r*f+o).add(r*s-i*l+a,i*s+r*l+o).add(r*s-i*f+a,i*s+r*f+o)};Zb.union=function(e){if(e.x1<this.x1)this.x1=e.x1;if(e.y1<this.y1)this.y1=e.y1;if(e.x2>this.x2)this.x2=e.x2;if(e.y2>this.y2)this.y2=e.y2;return this};Zb.intersect=function(e){if(e.x1>this.x1)this.x1=e.x1;if(e.y1>this.y1)this.y1=e.y1;if(e.x2<this.x2)this.x2=e.x2;if(e.y2<this.y2)this.y2=e.y2;return this};Zb.encloses=function(e){return e&&(this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2)};Zb.alignsWith=function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)};Zb.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)};Zb.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)};Zb.width=function(){return this.x2-this.x1};Zb.height=function(){return this.y2-this.y1};var Kb=0;var e_=function(e,t){var n=[],r;return r={id:"gradient_"+Kb++,x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(e,t){n.push({offset:e,color:t});return r}}};function t_(e){this.mark=e;this.bounds=this.bounds||new Qb}function n_(e){t_.call(this,e);this.items=this.items||[]}Object(V["inherits"])(n_,t_);var r_=/^([A-Za-z]+:)?\/\//;var i_="file://";var a_=function(e){return{options:e||{},sanitize:u_,load:o_,file:l_,http:s_}};function o_(e,t){var n=this;return n.sanitize(e,t).then(function(e){var r=e.href;return e.localFile?n.file(r):n.http(r,t)})}function u_(e,t){t=Object(V["extend"])({},this.options,t);return new Promise(function(n,r){var i={href:null},a,o,u,s;if(e==null||typeof e!=="string"){r("Sanitize failure, invalid URI: "+Object(V["stringValue"])(e));return}o=r_.test(e);if((s=t.baseURL)&&!o){if(!d_(e,"/")&&s[s.length-1]!=="/"){e="/"+e}e=s+e}u=(a=d_(e,i_))||t.mode==="file"||t.mode!=="http"&&!o&&c_();if(a){e=e.slice(i_.length)}else if(d_(e,"//")){if(t.defaultProtocol==="file"){e=e.slice(2);u=true}else{e=(t.defaultProtocol||"http")+":"+e}}Object.defineProperty(i,"localFile",{value:!!u});i.href=e;if(t.target){i.target=t.target+""}n(i)})}function s_(e,t){return f_(e,Object(V["extend"])({},this.options.http,t)).then(function(e){if(!e.ok)throw e.status+""+e.statusText;return e.text()})}function l_(e){return new Promise(function(t,n){var r=c_();r?r.readFile(e,function(e,r){if(e)n(e);else t(r)}):n("No file system access for "+e)})}function f_(e,t){var r=typeof fetch==="function"?fetch:n(14);return r?r(e,t):Promise.reject("No fetch method available.")}function c_(){var e="function"==="function"&&n(13);return e&&Object(V["isFunction"])(e.readFile)?e:null}function d_(e,t){return e==null?false:e.lastIndexOf(t,0)===0}var h_={boolean:V["toBoolean"],integer:V["toNumber"],number:V["toNumber"],date:V["toDate"],string:V["toString"],unknown:V["identity"]};var p_=[b_,k_,x_,__];var v_=["boolean","integer","number","date"];function g_(e,t){if(!e||!e.length)return"unknown";var n,r,i,a=0,o=e.length,u=p_.length,s=p_.map(function(e,t){return t+1});for(r=0,o=e.length;r<o;++r){n=t?e[r][t]:e[r];for(i=0;i<u;++i){if(s[i]&&y_(n)&&!p_[i](n)){s[i]=0;++a;if(a===p_.length)return"string"}}}a=s.reduce(function(e,t){return e===0?t:e},0)-1;return v_[a]}function m_(e,t){return t.reduce(function(t,n){t[n]=g_(e,n);return t},{})}function y_(e){return e!=null&&e===e}function b_(e){return e==="true"||e==="false"||e===true||e===false}function __(e){return!isNaN(Date.parse(e))}function x_(e){return!isNaN(+e)&&!(e instanceof Date)}function k_(e){return x_(e)&&(e=+e)===~~e}function O_(e){return function(t,n){var r={delimiter:e};return w_(t,n?Object(V["extend"])(n,r):r)}}function w_(e,t){if(t.header){e=t.header.map(V["stringValue"]).join(t.delimiter)+"\n"+e}return Object(Ue["b"])(t.delimiter).parse(e+"")}var j_=n("+aST");var S_=function(e,t){var n,r,i;e=Object(j_["a"])(e,t);n=t&&(i=t.feature)?Be["a"]:t&&(i=t.mesh)?Be["b"]:Object(V["error"])("Missing TopoJSON feature or mesh parameter.");r=(r=e.objects[i])?n(e,r):Object(V["error"])("Invalid TopoJSON object: "+i);return r&&r.features||[r]};var E_={dsv:w_,csv:O_(","),tsv:O_("\t"),json:j_["a"],topojson:S_};var A_=function(e,t){if(arguments.length>1){E_[e]=t;return this}else{return E_.hasOwnProperty(e)?E_[e]:null}};var z_=function(e,t,n){t=t||{};var r=A_(t.type||"json");if(!r)Object(V["error"])("Unknown data format type: "+t.type);e=r(e,t);if(t.parse)T_(e,t.parse,n);if(e.hasOwnProperty("columns"))delete e.columns;return e};function T_(e,t,n){if(!e.length)return;n=n||Xe["timeParse"];var r=e.columns||Object.keys(e[0]),i,a,o,u,s,l,f;if(t==="auto")t=m_(e,r);r=Object.keys(t);i=r.map(function(e){var r=t[e],i,a;if(r&&(r.indexOf("date:")===0||r.indexOf("utc:")===0)){i=r.split(/:(.+)?/,2);a=i[1];if(a[0]==="'"&&a[a.length-1]==="'"||a[0]==='"'&&a[a.length-1]==='"'){a=a.slice(1,-1)}return i[0]==="utc"?Object(Xe["utcParse"])(a):n(a)}if(!h_[r]){throw Error("Illegal format pattern: "+e+":"+r)}return h_[r]});for(u=0,l=e.length,f=r.length;u<l;++u){a=e[u];for(s=0;s<f;++s){o=r[s];a[o]=i[s](a[o])}}}function M_(e){this._pending=0;this._loader=e||a_()}var N_=M_.prototype;N_.pending=function(){return this._pending};function D_(e){e._pending+=1}function C_(e){e._pending-=1}N_.sanitizeURL=function(e){var t=this;D_(t);return t._loader.sanitize(e,{context:"href"}).then(function(e){C_(t);return e}).catch(function(){C_(t);return null})};N_.loadImage=function(e){var t=this,n=Object(Wi["b"])();D_(t);return t._loader.sanitize(e,{context:"image"}).then(function(e){var r=e.href;if(!r||!n)throw{url:r};var i=new n;i.onload=function(){C_(t);i.loaded=true};i.onerror=function(){C_(t);i.loaded=false};i.src=r;return i}).catch(function(e){C_(t);return{loaded:false,width:0,height:0,src:e&&e.url||""}})};N_.ready=function(){var e=this;return new Promise(function(t){function n(r){if(!e.pending())t(r);else setTimeout(function(){n(true)},10)}n(false)})};var P_={basis:{curve:xa["c"]},"basis-closed":{curve:xa["d"]},"basis-open":{curve:xa["e"]},bundle:{curve:xa["f"],tension:"beta",value:.85},cardinal:{curve:xa["g"],tension:"tension",value:0},"cardinal-open":{curve:xa["i"],tension:"tension",value:0},"cardinal-closed":{curve:xa["h"],tension:"tension",value:0},"catmull-rom":{curve:xa["j"],tension:"alpha",value:.5},"catmull-rom-closed":{curve:xa["k"],tension:"alpha",value:.5},"catmull-rom-open":{curve:xa["l"],tension:"alpha",value:.5},linear:{curve:xa["m"]},"linear-closed":{curve:xa["n"]},monotone:{horizontal:xa["p"],vertical:xa["o"]},natural:{curve:xa["q"]},step:{curve:xa["r"]},"step-after":{curve:xa["s"]},"step-before":{curve:xa["t"]}};function R_(e,t,n){var r=P_.hasOwnProperty(e)&&P_[e],i=null;if(r){i=r.curve||r[t||"vertical"];if(r.tension&&n!=null){i=i[r.tension](n)}}return i}var L_={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},I_=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];var F_=function(e){var t=[],n,r,i,a,o,u,s,l,f,c,d;n=e.slice().replace(I_[0],"###$1").split(I_[1]).slice(1);for(l=0,c=n.length;l<c;++l){r=n[l];i=r.slice(1).trim().replace(I_[2],"$1###$2").split(I_[3]);u=r.charAt(0);a=[u];for(f=0,d=i.length;f<d;++f){if((o=+i[f])===o){a.push(o)}}s=L_[u.toLowerCase()];if(a.length-1>s){for(f=1,d=a.length;f<d;f+=s){t.push([u].concat(a.slice(f,f+s)))}}else{t.push(a)}}return t};var q_={};var U_={};var W_=[].join;function V_(e,t,n,r,i,a,o,u,s){var l=W_.call(arguments);if(q_[l]){return q_[l]}var f=o*(Math.PI/180);var c=Math.sin(f);var d=Math.cos(f);n=Math.abs(n);r=Math.abs(r);var h=d*(u-e)*.5+c*(s-t)*.5;var p=d*(s-t)*.5-c*(u-e)*.5;var v=h*h/(n*n)+p*p/(r*r);if(v>1){v=Math.sqrt(v);n*=v;r*=v}var g=d/n;var m=c/n;var y=-c/r;var b=d/r;var _=g*u+m*s;var x=y*u+b*s;var k=g*e+m*t;var O=y*e+b*t;var w=(k-_)*(k-_)+(O-x)*(O-x);var j=1/w-.25;if(j<0)j=0;var S=Math.sqrt(j);if(a==i)S=-S;var E=.5*(_+k)-S*(O-x);var A=.5*(x+O)+S*(k-_);var z=Math.atan2(x-A,_-E);var T=Math.atan2(O-A,k-E);var M=T-z;if(M<0&&a===1){M+=2*Math.PI}else if(M>0&&a===0){M-=2*Math.PI}var N=Math.ceil(Math.abs(M/(Math.PI*.5+.001)));var D=[];for(var C=0;C<N;++C){var P=z+C*M/N;var R=z+(C+1)*M/N;D[C]=[E,A,P,R,n,r,c,d]}return q_[l]=D}function H_(e){var t=W_.call(e);if(U_[t]){return U_[t]}var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],l=e[7];var f=l*o;var c=-s*u;var d=s*o;var h=l*u;var p=Math.cos(i);var v=Math.sin(i);var g=Math.cos(a);var m=Math.sin(a);var y=.5*(a-i);var b=Math.sin(y*.5);var _=8/3*b*b/Math.sin(y);var x=n+p-_*v;var k=r+v+_*p;var O=n+g;var w=r+m;var j=O+_*m;var S=w-_*g;return U_[t]=[f*x+c*k,d*x+h*k,f*j+c*S,d*j+h*S,f*O+c*w,d*O+h*w]}var B_=["l",0,0,0,0,0,0,0];function G_(e,t){var n=B_[0]=e[0];if(n==="a"||n==="A"){B_[1]=t*e[1];B_[2]=t*e[2];B_[6]=t*e[6];B_[7]=t*e[7]}else{for(var r=1,i=e.length;r<i;++r){B_[r]=t*e[r]}}return B_}var $_=function(e,t,n,r,i){var a,o=null,u=0,s=0,l=0,f=0,c,d,h,p;if(n==null)n=0;if(r==null)r=0;if(i==null)i=1;if(e.beginPath)e.beginPath();for(var v=0,g=t.length;v<g;++v){a=t[v];if(i!==1)a=G_(a,i);switch(a[0]){case"l":u+=a[1];s+=a[2];e.lineTo(u+n,s+r);break;case"L":u=a[1];s=a[2];e.lineTo(u+n,s+r);break;case"h":u+=a[1];e.lineTo(u+n,s+r);break;case"H":u=a[1];e.lineTo(u+n,s+r);break;case"v":s+=a[1];e.lineTo(u+n,s+r);break;case"V":s=a[1];e.lineTo(u+n,s+r);break;case"m":u+=a[1];s+=a[2];e.moveTo(u+n,s+r);break;case"M":u=a[1];s=a[2];e.moveTo(u+n,s+r);break;case"c":c=u+a[5];d=s+a[6];l=u+a[3];f=s+a[4];e.bezierCurveTo(u+a[1]+n,s+a[2]+r,l+n,f+r,c+n,d+r);u=c;s=d;break;case"C":u=a[5];s=a[6];l=a[3];f=a[4];e.bezierCurveTo(a[1]+n,a[2]+r,l+n,f+r,u+n,s+r);break;case"s":c=u+a[3];d=s+a[4];l=2*u-l;f=2*s-f;e.bezierCurveTo(l+n,f+r,u+a[1]+n,s+a[2]+r,c+n,d+r);l=u+a[1];f=s+a[2];u=c;s=d;break;case"S":c=a[3];d=a[4];l=2*u-l;f=2*s-f;e.bezierCurveTo(l+n,f+r,a[1]+n,a[2]+r,c+n,d+r);u=c;s=d;l=a[1];f=a[2];break;case"q":c=u+a[3];d=s+a[4];l=u+a[1];f=s+a[2];e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;break;case"Q":c=a[3];d=a[4];e.quadraticCurveTo(a[1]+n,a[2]+r,c+n,d+r);u=c;s=d;l=a[1];f=a[2];break;case"t":c=u+a[1];d=s+a[2];if(o[0].match(/[QqTt]/)===null){l=u;f=s}else if(o[0]==="t"){l=2*u-h;f=2*s-p}else if(o[0]==="q"){l=2*u-l;f=2*s-f}h=l;p=f;e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;l=u+a[1];f=s+a[2];break;case"T":c=a[1];d=a[2];l=2*u-l;f=2*s-f;e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;break;case"a":Y_(e,u+n,s+r,[a[1],a[2],a[3],a[4],a[5],a[6]+u+n,a[7]+s+r]);u+=a[6];s+=a[7];break;case"A":Y_(e,u+n,s+r,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+r]);u=a[6];s=a[7];break;case"z":case"Z":e.closePath();break}o=a}};function Y_(e,t,n,r){var i=V_(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(var a=0;a<i.length;++a){var o=H_(i[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var X_=2*Math.PI,J_=Math.sqrt(3)/2;var Q_={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0);e.arc(0,0,n,0,X_)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r);e.lineTo(-n,r);e.lineTo(-r,r);e.lineTo(-r,n);e.lineTo(r,n);e.lineTo(r,r);e.lineTo(n,r);e.lineTo(n,-r);e.lineTo(r,-r);e.lineTo(r,-n);e.lineTo(-r,-n);e.lineTo(-r,-r);e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0);e.lineTo(0,-n);e.lineTo(n,0);e.lineTo(0,n);e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=J_*n;e.moveTo(0,-r);e.lineTo(-n,r);e.lineTo(n,r);e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=J_*n;e.moveTo(0,r);e.lineTo(-n,-r);e.lineTo(n,-r);e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=J_*n;e.moveTo(r,0);e.lineTo(-r,-n);e.lineTo(-r,n);e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=J_*n;e.moveTo(-r,0);e.lineTo(r,-n);e.lineTo(r,n);e.closePath()}}};function Z_(e){return Q_.hasOwnProperty(e)?Q_[e]:ex(e)}var K_={};function ex(e){if(!K_.hasOwnProperty(e)){var t=F_(e);K_[e]={draw:function(e,n){$_(e,t,0,0,Math.sqrt(n)/2)}}}return K_[e]}function tx(e){return e.x}function nx(e){return e.y}function rx(e){return e.width}function ix(e){return e.height}function ax(e){return function(){return e}}var ox=function(){var e=tx,t=nx,n=rx,r=ix,i=ax(0),a=null;function o(o,u,s){var l,f=u!=null?u:+e.call(this,o),c=s!=null?s:+t.call(this,o),d=+n.call(this,o),h=+r.call(this,o),p=+i.call(this,o);if(!a)a=l=Object(Wa["a"])();if(p<=0){a.rect(f,c,d,h)}else{var v=f+d,g=c+h;a.moveTo(f+p,c);a.lineTo(v-p,c);a.quadraticCurveTo(v,c,v,c+p);a.lineTo(v,g-p);a.quadraticCurveTo(v,g,v-p,g);a.lineTo(f+p,g);a.quadraticCurveTo(f,g,f,g-p);a.lineTo(f,c+p);a.quadraticCurveTo(f,c,f+p,c);a.closePath()}if(l){a=null;return l+""||null}}o.x=function(t){if(arguments.length){e=typeof t==="function"?t:ax(+t);return o}else{return e}};o.y=function(e){if(arguments.length){t=typeof e==="function"?e:ax(+e);return o}else{return t}};o.width=function(e){if(arguments.length){n=typeof e==="function"?e:ax(+e);return o}else{return n}};o.height=function(e){if(arguments.length){r=typeof e==="function"?e:ax(+e);return o}else{return r}};o.cornerRadius=function(e){if(arguments.length){i=typeof e==="function"?e:ax(+e);return o}else{return i}};o.context=function(e){if(arguments.length){a=e==null?null:e;return o}else{return a}};return o};var ux=Math.PI;var sx=function(){var e,t,n,r,i=null,a,o,u,s;function l(e,t,n){var r=n/2;if(a){var l=u-t,f=e-o;if(l||f){var c=Math.sqrt(l*l+f*f),d=(l/=c)*s,h=(f/=c)*s,p=Math.atan2(f,l);i.moveTo(o-d,u-h);i.lineTo(e-l*r,t-f*r);i.arc(e,t,r,p-ux,p);i.lineTo(o+d,u+h);i.arc(o,u,s,p,p+ux)}else{i.arc(e,t,r,0,2*ux)}i.closePath()}else{a=1}o=e;u=t;s=r}function f(o){var u,s=o.length,f,c=false,d;if(i==null)i=d=Object(Wa["a"])();for(u=0;u<=s;++u){if(!(u<s&&r(f=o[u],u,o))===c){if(c=!c)a=0}if(c)l(+e(f,u,o),+t(f,u,o),+n(f,u,o))}if(d){i=null;return d+""||null}}f.x=function(t){if(arguments.length){e=t;return f}else{return e}};f.y=function(e){if(arguments.length){t=e;return f}else{return t}};f.size=function(e){if(arguments.length){n=e;return f}else{return n}};f.defined=function(e){if(arguments.length){r=e;return f}else{return r}};f.context=function(e){if(arguments.length){if(e==null){i=null}else{i=e}return f}else{return i}};return f};function lx(e){return e.x||0}function fx(e){return e.y||0}function cx(e){return e.width||0}function dx(e){return e.size||1}function hx(e){return e.height||0}function px(e){return(e.x||0)+(e.width||0)}function vx(e){return(e.y||0)+(e.height||0)}function gx(e){return e.startAngle||0}function mx(e){return e.endAngle||0}function yx(e){return e.padAngle||0}function bx(e){return e.innerRadius||0}function _x(e){return e.outerRadius||0}function xx(e){return e.cornerRadius||0}function kx(e){return!(e.defined===false)}function Ox(e){return e.size==null?64:e.size}function wx(e){return Z_(e.shape||"circle")}var jx=Object(xa["a"])().startAngle(gx).endAngle(mx).padAngle(yx).innerRadius(bx).outerRadius(_x).cornerRadius(xx),Sx=Object(xa["b"])().x(lx).y1(fx).y0(vx).defined(kx),Ex=Object(xa["b"])().y(fx).x1(lx).x0(px).defined(kx),Ax=Object(xa["u"])().x(lx).y(fx).defined(kx),zx=ox().x(lx).y(fx).width(cx).height(hx).cornerRadius(xx),Tx=Object(xa["v"])().type(wx).size(Ox),Mx=sx().x(lx).y(fx).defined(kx).size(dx);function Nx(e,t){return jx.context(e)(t)}function Dx(e,t){var n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?Ex:Sx).curve(R_(r,n.orient,n.tension)).context(e)(t)}function Cx(e,t){var n=t[0],r=n.interpolate||"linear";return Ax.curve(R_(r,n.orient,n.tension)).context(e)(t)}function Px(e,t,n,r){return zx.context(e)(t,n,r)}function Rx(e,t){return(t.mark.shape||t.shape).context(e)(t)}function Lx(e,t){return Tx.context(e)(t)}function Ix(e,t){return Mx.context(e)(t)}var Fx=function(e,t){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){e.expand(t.strokeWidth!=null?+t.strokeWidth:1)}return e};var qx,Ux=Math.PI*2,Wx=Ux/4,Vx=Ux-1e-8;function Hx(e){qx=e;return Hx}function Bx(){}function Gx(e,t){qx.add(e,t)}Hx.beginPath=Bx;Hx.closePath=Bx;Hx.moveTo=Gx;Hx.lineTo=Gx;Hx.rect=function(e,t,n,r){Gx(e,t);Gx(e+n,t+r)};Hx.quadraticCurveTo=function(e,t,n,r){Gx(e,t);Gx(n,r)};Hx.bezierCurveTo=function(e,t,n,r,i,a){Gx(e,t);Gx(n,r);Gx(i,a)};Hx.arc=function(e,t,n,r,i,a){if(Math.abs(i-r)>Vx){Gx(e-n,t-n);Gx(e+n,t+n);return}var o=Infinity,u=-Infinity,s=Infinity,l=-Infinity,f,c,d,h;function p(e){d=n*Math.cos(e);h=n*Math.sin(e);if(d<o)o=d;if(d>u)u=d;if(h<s)s=h;if(h>l)l=h}p(r);p(i);if(i!==r){r=r%Ux;if(r<0)r+=Ux;i=i%Ux;if(i<0)i+=Ux;if(i<r){a=!a;f=r;r=i;i=f}if(a){i-=Ux;f=r-r%Wx;for(c=0;c<4&&f>i;++c,f-=Wx)p(f)}else{f=r-r%Wx+Wx;for(c=0;c<4&&f<i;++c,f=f+Wx)p(f)}}Gx(e+o,t+s);Gx(e+u,t+l)};var $x=function(e,t,n){var r=n.width(),i=n.height(),a=n.x1+t.x1*r,o=n.y1+t.y1*i,u=n.x1+t.x2*r,s=n.y1+t.y2*i,l=t.stops,f=0,c=l.length,d=e.createLinearGradient(a,o,u,s);for(;f<c;++f){d.addColorStop(l[f].offset,l[f].color)}return d};var Yx=function(e,t,n){return n.id?$x(e,n,t.bounds):n};var Xx=function(e,t,n){n*=t.fillOpacity==null?1:t.fillOpacity;if(n>0){e.globalAlpha=n;e.fillStyle=Yx(e,t,t.fill);return true}else{return false}};var Jx=[];var Qx=function(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;if(r<=0)return false;n*=t.strokeOpacity==null?1:t.strokeOpacity;if(n>0){e.globalAlpha=n;e.strokeStyle=Yx(e,t,t.stroke);e.lineWidth=r;e.lineCap=t.strokeCap||"butt";e.lineJoin=t.strokeJoin||"miter";e.miterLimit=t.strokeMiterLimit||10;if(e.setLineDash){e.setLineDash(t.strokeDash||Jx);e.lineDashOffset=t.strokeDashOffset||0}return true}else{return false}};function Zx(e,t){return e.zindex-t.zindex||e.index-t.index}function Kx(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,a;for(i=0,a=t.length;i<a;++i){r=t[i];r.index=i;if(r.zindex)n.push(r)}e.zdirty=false;return e.zitems=n.sort(Zx)}function ek(e,t){var n=e.items,r,i;if(!n||!n.length)return;var a=Kx(e);if(a&&a.length){for(r=0,i=n.length;r<i;++r){if(!n[r].zindex)t(n[r])}n=a}for(r=0,i=n.length;r<i;++r){t(n[r])}}function tk(e,t){var n=e.items,r,i;if(!n||!n.length)return null;var a=Kx(e);if(a&&a.length)n=a;for(i=n.length;--i>=0;){if(r=t(n[i]))return r}if(n===a){for(n=e.items,i=n.length;--i>=0;){if(!n[i].zindex){if(r=t(n[i]))return r}}}return null}function nk(e){return function(t,n,r){ek(n,function(n){if(!r||r.intersects(n.bounds)){ik(e,t,n,n)}})}}function rk(e){return function(t,n,r){if(n.items.length&&(!r||r.intersects(n.bounds))){ik(e,t,n.items[0],n.items)}}}function ik(e,t,n,r){var i=n.opacity==null?1:n.opacity;if(i===0)return;if(e(t,r))return;if(n.fill&&Xx(t,n,i)){t.fill()}if(n.stroke&&Qx(t,n,i)){t.stroke()}}var ak=function(){return true};function ok(e){if(!e)e=ak;return function(t,n,r,i,a,o){r*=t.pixelRatio;i*=t.pixelRatio;return tk(n,function(n){var u=n.bounds;if(u&&!u.contains(a,o)||!u)return;if(e(t,n,r,i,a,o))return n})}}function uk(e,t){return function(n,r,i,a){var o=Array.isArray(r)?r[0]:r,u=t==null?o.fill:t,s=o.stroke&&n.isPointInStroke,l,f;if(s){l=o.strokeWidth;f=o.strokeCap;n.lineWidth=l!=null?l:1;n.lineCap=f!=null?f:"butt"}return e(n,r)?false:u&&n.isPointInPath(i,a)||s&&n.isPointInStroke(i,a)}}function sk(e){return ok(uk(e))}var lk=function(e,t){return"translate("+e+","+t+")"};var fk=function(e){return lk(e.x||0,e.y||0)};var ck=function(e,t){function n(e,n){e("transform",fk(n));e("d",t(null,n))}function r(e,n){t(Hx(e),n);return Fx(e,n).translate(n.x||0,n.y||0)}function i(e,n){var r=n.x||0,i=n.y||0;e.translate(r,i);e.beginPath();t(e,n);e.translate(-r,-i)}return{type:e,tag:"path",nested:false,attr:n,bound:r,draw:nk(i),pick:sk(i)}};var dk=ck("arc",Nx);function hk(e,t){var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=0,a=e.length;if(a===1)return e[0];while(i<a){var o=i+a>>>1;if(e[o][r]<n)i=o+1;else a=o}i=Math.max(0,i-1);a=Math.min(e.length-1,a);return n-e[i][r]<e[a][r]-n?e[i]:e[a]}function pk(e,t){var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,a,o;while(--r>=0){if(e[r].defined===false)continue;i=e[r].x-t[0];a=e[r].y-t[1];o=i*i+a*a;if(o<n)return e[r]}return null}function vk(e,t){var n=e.length,r,i,a;while(--n>=0){if(e[n].defined===false)continue;r=e[n].x-t[0];i=e[n].y-t[1];a=r*r+i*i;r=e[n].size||1;if(a<r*r)return e[n]}return null}var gk=function(e,t,n){function r(e,n){var r=n.mark.items;if(r.length)e("d",t(null,r))}function i(e,n){var r=n.items;if(r.length===0){return e}else{t(Hx(e),r);return Fx(e,r[0])}}function a(e,n){e.beginPath();t(e,n)}var o=uk(a);function u(e,t,n,r,i,a){var u=t.items,s=t.bounds;if(!u||!u.length||s&&!s.contains(i,a)){return null}n*=e.pixelRatio;r*=e.pixelRatio;return o(e,u,n,r)?u[0]:null}return{type:e,tag:"path",nested:true,attr:r,bound:i,draw:rk(a),pick:u,tip:n}};var mk=gk("area",Dx,hk);var yk=1;function bk(){yk=1}var _k=function(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+yk++),o=i.clipping[a]||(i.clipping[a]={id:a});if(Object(V["isFunction"])(r)){o.path=r(null)}else{o.width=n.width||0;o.height=n.height||0}return"url(#"+a+")"};var xk=.5;function kk(e,t){e("transform",fk(t))}function Ok(e,t){var n=t.stroke?xk:0;e("class","background");e("d",Px(null,t,n,n))}function wk(e,t,n){var r=t.clip?_k(n,t,t):null;e("clip-path",r)}function jk(e,t){if(!t.clip&&t.items){var n=t.items;for(var r=0,i=n.length;r<i;++r){e.union(n[r].bounds)}}if((t.clip||t.width||t.height)&&!t.noBound){e.add(0,0).add(t.width||0,t.height||0)}Fx(e,t);return e.translate(t.x||0,t.y||0)}function Sk(e,t){var n=t.stroke?xk:0;e.beginPath();Px(e,t,n,n)}var Ek=uk(Sk);function Ak(e,t,n){var r=this;ek(t,function(t){var i=t.x||0,a=t.y||0,o=t.width||0,u=t.height||0,s;e.save();e.translate(i,a);if(t.stroke||t.fill){s=t.opacity==null?1:t.opacity;if(s>0){Sk(e,t);if(t.fill&&Xx(e,t,s)){e.fill()}if(t.stroke&&Qx(e,t,s)){e.stroke()}}}if(t.clip){e.beginPath();e.rect(0,0,o,u);e.clip()}if(n)n.translate(-i,-a);ek(t,function(t){r.draw(e,t,n)});if(n)n.translate(i,a);e.restore()})}function zk(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items){return null}var o=this,u=n*e.pixelRatio,s=r*e.pixelRatio;return tk(t,function(l){var f,c,d,h;h=l.bounds;if(h&&!h.contains(i,a))return;c=l.x||0;d=l.y||0;e.save();e.translate(c,d);c=i-c;d=a-d;f=tk(l,function(e){return Tk(e,c,d)?o.pick(e,n,r,c,d):null});if(!f&&t.interactive!==false&&(l.fill||l.stroke)&&Ek(e,l,u,s)){f=l}e.restore();return f||null})}function Tk(e,t,n){return(e.interactive!==false||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var Mk={type:"group",tag:"g",nested:false,attr:kk,bound:jk,draw:Ak,pick:zk,background:Ok,foreground:wk};function Nk(e,t){var n=e.image;if(!n||n.url!==e.url){n={loaded:false,width:0,height:0};t.loadImage(e.url).then(function(t){e.image=t;e.image.url=e.url})}return n}function Dk(e,t){return e==="center"?t/2:e==="right"?t:0}function Ck(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function Pk(e,t,n){var r=Nk(t,n),i=t.x||0,a=t.y||0,o=(t.width!=null?t.width:r.width)||0,u=(t.height!=null?t.height:r.height)||0,s=t.aspect===false?"none":"xMidYMid";i-=Dk(t.align,o);a-=Ck(t.baseline,u);e("href",r.src||"","http://www.w3.org/1999/xlink","xlink:href");e("transform",lk(i,a));e("width",o);e("height",u);e("preserveAspectRatio",s)}function Rk(e,t){var n=t.image,r=t.x||0,i=t.y||0,a=(t.width!=null?t.width:n&&n.width)||0,o=(t.height!=null?t.height:n&&n.height)||0;r-=Dk(t.align,a);i-=Ck(t.baseline,o);return e.set(r,i,r+a,i+o)}function Lk(e,t,n){var r=this;ek(t,function(t){if(n&&!n.intersects(t.bounds))return;var i=Nk(t,r),a=t.x||0,o=t.y||0,u=(t.width!=null?t.width:i.width)||0,s=(t.height!=null?t.height:i.height)||0,l,f,c,d;a-=Dk(t.align,u);o-=Ck(t.baseline,s);if(t.aspect!==false){f=i.width/i.height;c=t.width/t.height;if(f===f&&c===c&&f!==c){if(c<f){d=u/f;o+=(s-d)/2;s=d}else{d=s*f;a+=(u-d)/2;u=d}}}if(i.loaded){e.globalAlpha=(l=t.opacity)!=null?l:1;e.drawImage(i,a,o,u,s)}})}var Ik={type:"image",tag:"image",nested:false,attr:Pk,bound:Rk,draw:Lk,pick:ok(),get:Nk,xOffset:Dk,yOffset:Ck};var Fk=gk("line",Cx,pk);function qk(e,t){e("transform",fk(t));e("d",t.path)}function Uk(e,t){var n=t.path;if(n==null)return true;var r=t.pathCache;if(!r||r.path!==n){(t.pathCache=r=F_(n)).path=n}$_(e,r,t.x,t.y)}function Wk(e,t){return Uk(Hx(e),t)?e.set(0,0,0,0):Fx(e,t)}var Vk={type:"path",tag:"path",nested:false,attr:qk,bound:Wk,draw:nk(Uk),pick:sk(Uk)};function Hk(e,t){e("d",Px(null,t))}function Bk(e,t){var n,r;return Fx(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function Gk(e,t){e.beginPath();Px(e,t)}var $k={type:"rect",tag:"path",nested:false,attr:Hk,bound:Bk,draw:nk(Gk),pick:sk(Gk)};function Yk(e,t){e("transform",fk(t));e("x2",t.x2!=null?t.x2-(t.x||0):0);e("y2",t.y2!=null?t.y2-(t.y||0):0)}function Xk(e,t){var n,r;return Fx(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function Jk(e,t,n){var r,i,a,o;if(t.stroke&&Qx(e,t,n)){r=t.x||0;i=t.y||0;a=t.x2!=null?t.x2:r;o=t.y2!=null?t.y2:i;e.beginPath();e.moveTo(r,i);e.lineTo(a,o);return true}return false}function Qk(e,t,n){ek(t,function(t){if(n&&!n.intersects(t.bounds))return;var r=t.opacity==null?1:t.opacity;if(r&&Jk(e,t,r)){e.stroke()}})}function Zk(e,t,n,r){if(!e.isPointInStroke)return false;return Jk(e,t,1)&&e.isPointInStroke(n,r)}var Kk={type:"rule",tag:"line",nested:false,attr:Yk,bound:Xk,draw:Qk,pick:ok(Zk)};var eO=ck("shape",Rx);var tO=ck("symbol",Lx);var nO,rO;var iO={height:lO,measureWidth:uO,estimateWidth:aO,width:aO,canvas:fO};fO(true);function aO(e){rO=lO(e);return oO(cO(e))}function oO(e){return~~(.8*e.length*rO)}function uO(e){nO.font=pO(e);return sO(cO(e))}function sO(e){return nO.measureText(e).width}function lO(e){return e.fontSize!=null?e.fontSize:11}function fO(e){nO=e&&(nO=Object(Wi["a"])(1,1))?nO.getContext("2d"):null;iO.width=nO?uO:aO}function cO(e){var t=e.text;if(t==null){return""}else{return e.limit>0?dO(e):t+""}}function dO(e){var t=+e.limit,n=e.text+"",r;if(nO){nO.font=pO(e);r=sO}else{rO=lO(e);r=oO}if(r(n)<t)return n;var i=e.ellipsis||"",a=e.dir==="rtl",o=0,u=n.length,s;t-=r(i);if(a){while(o<u){s=o+u>>>1;if(r(n.slice(s))>t)o=s+1;else u=s}return i+n.slice(o)}else{while(o<u){s=1+(o+u>>>1);if(r(n.slice(0,s))<t)o=s;else u=s-1}return n.slice(0,o)+i}}function hO(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function pO(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+lO(e)+"px "+hO(e,t)}function vO(e){var t=e.baseline,n=lO(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:0)}var gO={left:"start",center:"middle",right:"end"};var mO=new Qb;function yO(e,t){var n=t.dx||0,r=(t.dy||0)+vO(t),i=t.x||0,a=t.y||0,o=t.angle||0,u=t.radius||0,s;if(u){s=(t.theta||0)-Math.PI/2;i+=u*Math.cos(s);a+=u*Math.sin(s)}e("text-anchor",gO[t.align]||"start");if(o){s=lk(i,a)+" rotate("+o+")";if(n||r)s+=" "+lk(n,r)}else{s=lk(i+n,a+r)}e("transform",s)}function bO(e,t,n){var r=iO.height(t),i=t.align,a=t.radius||0,o=t.x||0,u=t.y||0,s=t.dx||0,l=(t.dy||0)+vO(t)-Math.round(.8*r),f,c;if(a){c=(t.theta||0)-Math.PI/2;o+=a*Math.cos(c);u+=a*Math.sin(c)}f=iO.width(t);if(i==="center"){s-=f/2}else if(i==="right"){s-=f}else{}e.set(s+=o,l+=u,s+f,l+r);if(t.angle&&!n){e.rotate(t.angle*Math.PI/180,o,u)}return e.expand(n||!f?0:1)}function _O(e,t,n){ek(t,function(t){var r,i,a,o,u,s;if(n&&!n.intersects(t.bounds))return;if(!(s=cO(t)))return;r=t.opacity==null?1:t.opacity;if(r===0)return;e.font=pO(t);e.textAlign=t.align||"left";i=t.x||0;a=t.y||0;if(o=t.radius){u=(t.theta||0)-Math.PI/2;i+=o*Math.cos(u);a+=o*Math.sin(u)}if(t.angle){e.save();e.translate(i,a);e.rotate(t.angle*Math.PI/180);i=a=0}i+=t.dx||0;a+=(t.dy||0)+vO(t);if(t.fill&&Xx(e,t,r)){e.fillText(s,i,a)}if(t.stroke&&Qx(e,t,r)){e.strokeText(s,i,a)}if(t.angle)e.restore()})}function xO(e,t,n,r,i,a){if(t.fontSize<=0)return false;if(!t.angle)return true;var o=bO(mO,t,true),u=-t.angle*Math.PI/180,s=Math.cos(u),l=Math.sin(u),f=t.x,c=t.y,d=s*i-l*a+(f-f*s+c*l),h=l*i+s*a+(c-f*l-c*s);return o.contains(d,h)}var kO={type:"text",tag:"text",nested:false,attr:yO,bound:bO,draw:_O,pick:ok(xO)};var OO=gk("trail",Ix,vk);var wO={arc:dk,area:mk,group:Mk,image:Ik,line:Fk,path:Vk,rect:$k,rule:Kk,shape:eO,symbol:tO,text:kO,trail:OO};var jO=function(e,t,n){var r=wO[e.mark.marktype],i=t||r.bound;if(r.nested)e=e.mark;return i(e.bounds||(e.bounds=new Qb),e,n)};var SO={mark:null};var EO=function(e,t,n){var r=wO[e.marktype],i=r.bound,a=e.items,o=a&&a.length,u,s,l,f;if(r.nested){if(o){l=a[0]}else{SO.mark=e;l=SO}f=jO(l,i,n);t=t&&t.union(f)||f;return t}t=t||e.bounds&&e.bounds.clear()||new Qb;if(o){for(u=0,s=a.length;u<s;++u){t.union(jO(a[u],i,n))}}return e.bounds=t};var AO=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","interpolate","tension","orient","defined","url","path","x2","y2","size","shape","text","angle","theta","radius","dx","dy","font","fontSize","fontWeight","fontStyle","fontVariant"];function zO(e,t){return JSON.stringify(e,AO,t)}function TO(e){var t=typeof e==="string"?JSON.parse(e):e;return MO(t)}function MO(e){var t=e.marktype,n=e.items,r,i,a;if(n){for(i=0,a=n.length;i<a;++i){r=t?"mark":"group";n[i][r]=e;if(n[i].zindex)n[i][r].zdirty=true;if("group"===(t||r))MO(n[i])}}if(t)EO(e);return e}function NO(e){if(arguments.length){this.root=TO(e)}else{this.root=CO({marktype:"group",name:"root",role:"frame"});this.root.items=[new n_(this.root)]}}var DO=NO.prototype;DO.toJSON=function(e){return zO(this.root,e||0)};DO.mark=function(e,t,n){t=t||this.root.items[0];var r=CO(e,t);t.items[n]=r;if(r.zindex)r.group.zdirty=true;return r};function CO(e,t){return{bounds:new Qb,clip:!!e.clip,group:t,interactive:e.interactive===false?false:true,items:[],marktype:e.marktype,name:e.name||undefined,role:e.role||undefined,zindex:e.zindex||0}}function PO(e,t,n){if(!e&&typeof document!=="undefined"&&document.createElement){e=document}return e?n?e.createElementNS(n,t):e.createElement(t):null}function RO(e,t){t=t.toLowerCase();var n=e.childNodes,r=0,i=n.length;for(;r<i;++r)if(n[r].tagName.toLowerCase()===t){return n[r]}}function LO(e,t,n,r){var i=e.childNodes[t],a;if(!i||i.tagName.toLowerCase()!==n.toLowerCase()){a=i||null;i=PO(e.ownerDocument,n,r);e.insertBefore(i,a)}return i}function IO(e,t){var n=e.childNodes,r=n.length;while(r>t)e.removeChild(n[--r]);return e}function FO(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}var qO=function(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]};var UO=function(e,t,n,r){var i=e&&e.mark,a,o;if(i&&(a=wO[i.marktype]).tip){o=qO(t,n);o[0]-=r[0];o[1]-=r[1];while(e=e.mark.group){o[0]-=e.x||0;o[1]-=e.y||0}e=a.tip(i.items,o)}return e};function WO(e,t){this._active=null;this._handlers={};this._loader=e||a_();this._tooltip=t||VO}function VO(e,t,n,r){e.element().setAttribute("title",r||"")}var HO=WO.prototype;HO.initialize=function(e,t,n){this._el=e;this._obj=n||null;return this.origin(t)};HO.element=function(){return this._el};HO.canvas=function(){return this._el&&this._el.firstChild};HO.origin=function(e){if(arguments.length){this._origin=e||[0,0];return this}else{return this._origin.slice()}};HO.scene=function(e){if(!arguments.length)return this._scene;this._scene=e;return this};HO.on=function(){};HO.off=function(){};HO._handlerIndex=function(e,t,n){for(var r=e?e.length:0;--r>=0;){if(e[r].type===t&&(!n||e[r].handler===n)){return r}}return-1};HO.handlers=function(e){var t=this._handlers,n=[],r;if(e){n.push.apply(n,t[this.eventName(e)])}else{for(r in t){n.push.apply(n,t[r])}}return n};HO.eventName=function(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)};HO.handleHref=function(e,t,n){this._loader.sanitize(n,{context:"href"}).then(function(t){var n=new MouseEvent(e.type,e),r=PO(null,"a");for(var i in t)r.setAttribute(i,t[i]);r.dispatchEvent(n)}).catch(function(){})};HO.handleTooltip=function(e,t,n){if(t&&t.tooltip!=null){t=UO(t,e,this.canvas(),this._origin);var r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}};HO.getItemBoundingClientRect=function(e){if(!(t=this.canvas()))return;var t,n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.x1+r[0]+n.left,o=i.y1+r[1]+n.top,u=i.width(),s=i.height();while(e.mark&&(e=e.mark.group)){a+=e.x||0;o+=e.y||0}return{x:a,y:o,width:u,height:s,left:a,top:o,right:a+u,bottom:o+s}};function BO(e){this._el=null;this._bgcolor=null;this._loader=new M_(e)}var GO=BO.prototype;GO.initialize=function(e,t,n,r,i){this._el=e;return this.resize(t,n,r,i)};GO.element=function(){return this._el};GO.canvas=function(){return this._el&&this._el.firstChild};GO.background=function(e){if(arguments.length===0)return this._bgcolor;this._bgcolor=e;return this};GO.resize=function(e,t,n,r){this._width=e;this._height=t;this._origin=n||[0,0];this._scale=r||1;return this};GO.dirty=function(){};GO.render=function(e){var t=this;t._call=function(){t._render(e)};t._call();t._call=null;return t};GO._render=function(){};GO.renderAsync=function(e){var t=this.render(e);return this._ready?this._ready.then(function(){return t}):Promise.resolve(t)};GO._load=function(e,t){var n=this,r=n._loader[e](t);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then(function(e){if(e)i();n._ready=null})}return r};GO.sanitizeURL=function(e){return this._load("sanitizeURL",e)};GO.loadImage=function(e){return this._load("loadImage",e)};var $O=["keydown","keypress","keyup","dragenter","dragleave","dragover","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"];var YO="mousemove";var XO="mouseout";var JO="click";function QO(e,t){WO.call(this,e,t);this._down=null;this._touch=null;this._first=true}var ZO=Object(V["inherits"])(QO,WO);ZO.initialize=function(e,t,n){var r=this._canvas=e&&RO(e,"canvas");if(r){var i=this;this.events.forEach(function(e){r.addEventListener(e,function(t){if(ZO[e]){ZO[e].call(i,t)}else{i.fire(e,t)}})})}return WO.prototype.initialize.call(this,e,t,n)};ZO.canvas=function(){return this._canvas};ZO.context=function(){return this._canvas.getContext("2d")};ZO.events=$O;ZO.DOMMouseScroll=function(e){this.fire("mousewheel",e)};function KO(e,t,n){return function(r){var i=this._active,a=this.pickEvent(r);if(a===i){this.fire(e,r)}else{if(!i||!i.exit){this.fire(n,r)}this._active=a;this.fire(t,r);this.fire(e,r)}}}function ew(e){return function(t){this.fire(e,t);this._active=null}}ZO.mousemove=KO("mousemove","mouseover","mouseout");ZO.dragover=KO("dragover","dragenter","dragleave");ZO.mouseout=ew("mouseout");ZO.dragleave=ew("dragleave");ZO.mousedown=function(e){this._down=this._active;this.fire("mousedown",e)};ZO.click=function(e){if(this._down===this._active){this.fire("click",e);this._down=null}};ZO.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]);if(this._first){this._active=this._touch;this._first=false}this.fire("touchstart",e,true)};ZO.touchmove=function(e){this.fire("touchmove",e,true)};ZO.touchend=function(e){this.fire("touchend",e,true);this._touch=null};ZO.fire=function(e,t,n){var r=n?this._touch:this._active,i=this._handlers[e],a,o;t.vegaType=e;if(e===JO&&r&&r.href){this.handleHref(t,r,r.href)}else if(e===YO||e===XO){this.handleTooltip(t,r,e!==XO)}if(i){for(a=0,o=i.length;a<o;++a){i[a].handler.call(this._obj,t,r)}}};ZO.on=function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){(r[n]||(r[n]=[])).push({type:e,handler:t})}return this};ZO.off=function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){r.splice(i,1)}return this};ZO.pickEvent=function(e){var t=qO(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])};ZO.pick=function(e,t,n,r,i){var a=this.context(),o=wO[e.marktype];return o.pick.call(this,a,e,t,n,r,i)};var tw=function(e,t){var n=t.clip;e.save();e.beginPath();if(Object(V["isFunction"])(n)){n(e)}else{var r=t.group;e.rect(0,0,r.width||0,r.height||0)}e.clip()};function nw(){return typeof window!=="undefined"?window.devicePixelRatio||1:1}var rw=nw();var iw=function(e,t,n,r,i){var a=typeof HTMLElement!=="undefined"&&e instanceof HTMLElement&&e.parentNode!=null;var o=e.getContext("2d"),u=a?rw:i;e.width=t*u;e.height=n*u;if(a&&u!==1){e.style.width=t+"px";e.style.height=n+"px"}o.pixelRatio=u;o.setTransform(u,0,0,u,u*r[0],u*r[1]);return e};function aw(e){BO.call(this,e);this._redraw=false;this._dirty=new Qb}var ow=Object(V["inherits"])(aw,BO),uw=BO.prototype,sw=new Qb;ow.initialize=function(e,t,n,r,i){this._canvas=Object(Wi["a"])(1,1);if(e){IO(e,0).appendChild(this._canvas);this._canvas.setAttribute("class","marks")}return uw.initialize.call(this,e,t,n,r,i)};ow.resize=function(e,t,n,r){uw.resize.call(this,e,t,n,r);iw(this._canvas,this._width,this._height,this._origin,this._scale);this._redraw=true;return this};ow.canvas=function(){return this._canvas};ow.context=function(){return this._canvas?this._canvas.getContext("2d"):null};ow.dirty=function(e){var t=fw(e.bounds,e.mark.group);this._dirty.union(t)};function lw(e,t,n){t.expand(1).round();t.translate(-(n[0]%1),-(n[1]%1));e.beginPath();e.rect(t.x1,t.y1,t.width(),t.height());e.clip();return t}function fw(e,t){if(t==null)return e;var n=sw.clear().union(e);for(;t!=null;t=t.mark.group){n.translate(t.x||0,t.y||0)}return n}ow._render=function(e){var t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty;t.save();if(this._redraw||a.empty()){this._redraw=false;a=null}else{a=lw(t,a,n)}this.clear(-n[0],-n[1],r,i);this.draw(t,e,a);t.restore();this._dirty.clear();return this};ow.draw=function(e,t,n){var r=wO[t.marktype];if(t.clip)tw(e,t);r.draw.call(this,e,t,n);if(t.clip)e.restore()};ow.clear=function(e,t,n,r){var i=this.context();i.clearRect(e,t,n,r);if(this._bgcolor!=null){i.fillStyle=this._bgcolor;i.fillRect(e,t,n,r)}};function cw(e,t){WO.call(this,e,t);var n=this;n._hrefHandler=hw(n,function(e,t){if(t&&t.href)n.handleHref(e,t,t.href)});n._tooltipHandler=hw(n,function(e,t){n.handleTooltip(e,t,e.type!==XO)})}var dw=Object(V["inherits"])(cw,WO);dw.initialize=function(e,t,n){var r=this._svg;if(r){r.removeEventListener(JO,this._hrefHandler);r.removeEventListener(YO,this._tooltipHandler);r.removeEventListener(XO,this._tooltipHandler)}this._svg=r=e&&RO(e,"svg");if(r){r.addEventListener(JO,this._hrefHandler);r.addEventListener(YO,this._tooltipHandler);r.addEventListener(XO,this._tooltipHandler)}return WO.prototype.initialize.call(this,e,t,n)};dw.canvas=function(){return this._svg};function hw(e,t){return function(n){var r=n.target,i=r.__data__;n.vegaType=n.type;i=Array.isArray(i)?i[0]:i;t.call(e._obj,n,i)}}dw.on=function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){var a={type:e,handler:t,listener:hw(this,t)};(r[n]||(r[n]=[])).push(a);if(this._svg){this._svg.addEventListener(n,a.listener)}}return this};dw.off=function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){if(this._svg){this._svg.removeEventListener(n,r[i].listener)}r.splice(i,1)}return this};function pw(e,t,n){var r="<"+e,i,a;if(t){for(i in t){a=t[i];if(a!=null){r+=" "+i+'="'+a+'"'}}}if(n)r+=" "+n;return r+">"}function vw(e){return"</"+e+">"}var gw={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};var mw={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"};var yw=Object.keys(mw);var bw=gw.xmlns;function _w(e){BO.call(this,e);this._dirtyID=1;this._dirty=[];this._svg=null;this._root=null;this._defs=null}var xw=Object(V["inherits"])(_w,BO);var kw=BO.prototype;xw.initialize=function(e,t,n,r){if(e){this._svg=LO(e,0,"svg",bw);this._svg.setAttribute("class","marks");IO(e,1);this._root=LO(this._svg,0,"g",bw);IO(this._svg,1)}this._defs={gradient:{},clipping:{}};this.background(this._bgcolor);return kw.initialize.call(this,e,t,n,r)};xw.background=function(e){if(arguments.length&&this._svg){this._svg.style.setProperty("background-color",e)}return kw.background.apply(this,arguments)};xw.resize=function(e,t,n,r){kw.resize.call(this,e,t,n,r);if(this._svg){this._svg.setAttribute("width",this._width*this._scale);this._svg.setAttribute("height",this._height*this._scale);this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height);this._root.setAttribute("transform","translate("+this._origin+")")}this._dirty=[];return this};xw.canvas=function(){return this._svg};xw.svg=function(){if(!this._svg)return null;var e={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var t in gw){e[t]=gw[t]}var n=!this._bgcolor?"":pw("rect",{width:this._width,height:this._height,style:"fill: "+this._bgcolor+";"})+vw("rect");return pw("svg",e)+n+this._svg.innerHTML+vw("svg")};xw._render=function(e){if(this._dirtyCheck()){if(this._dirtyAll)this._resetDefs();this.draw(this._root,e);IO(this._root,1)}this.updateDefs();this._dirty=[];++this._dirtyID;return this};xw.updateDefs=function(){var e=this._svg,t=this._defs,n=t.el,r=0,i;for(i in t.gradient){if(!n)t.el=n=LO(e,0,"defs",bw);Ow(n,t.gradient[i],r++)}for(i in t.clipping){if(!n)t.el=n=LO(e,0,"defs",bw);ww(n,t.clipping[i],r++)}if(n){if(r===0){e.removeChild(n);t.el=null}else{IO(n,r)}}};function Ow(e,t,n){var r,i,a;e=LO(e,n,"linearGradient",bw);e.setAttribute("id",t.id);e.setAttribute("x1",t.x1);e.setAttribute("x2",t.x2);e.setAttribute("y1",t.y1);e.setAttribute("y2",t.y2);for(r=0,i=t.stops.length;r<i;++r){a=LO(e,r,"stop",bw);a.setAttribute("offset",t.stops[r].offset);a.setAttribute("stop-color",t.stops[r].color)}IO(e,r)}function ww(e,t,n){var r;e=LO(e,n,"clipPath",bw);e.setAttribute("id",t.id);if(t.path){r=LO(e,0,"path",bw);r.setAttribute("d",t.path)}else{r=LO(e,0,"rect",bw);r.setAttribute("x",0);r.setAttribute("y",0);r.setAttribute("width",t.width);r.setAttribute("height",t.height)}}xw._resetDefs=function(){var e=this._defs;e.gradient={};e.clipping={}};xw.dirty=function(e){if(e.dirty!==this._dirtyID){e.dirty=this._dirtyID;this._dirty.push(e)}};xw.isDirty=function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID};xw._dirtyCheck=function(){this._dirtyAll=true;var e=this._dirty;if(!e.length)return true;var t=++this._dirtyID,n,r,i,a,o,u,s;for(o=0,u=e.length;o<u;++o){n=e[o];r=n.mark;if(r.marktype!==i){i=r.marktype;a=wO[i]}if(r.zdirty&&r.dirty!==t){this._dirtyAll=false;jw(n,t);r.items.forEach(function(e){e.dirty=t})}if(r.zdirty)continue;if(n.exit){if(a.nested&&r.items.length){s=r.items[0];if(s._svg)this._update(a,s._svg,s)}else if(n._svg){s=n._svg.parentNode;if(s)s.removeChild(n._svg)}n._svg=null;continue}n=a.nested?r.items[0]:n;if(n._update===t)continue;if(!n._svg||!n._svg.ownerSVGElement){this._dirtyAll=false;jw(n,t)}else{this._update(a,n._svg,n)}n._update=t}return!this._dirtyAll};function jw(e,t){for(;e&&e.dirty!==t;e=e.mark.group){e.dirty=t;if(e.mark&&e.mark.dirty!==t){e.mark.dirty=t}else return}}xw.draw=function(e,t,n){if(!this.isDirty(t))return t._svg;var r=this,i=this._svg,a=wO[t.marktype],o=t.interactive===false?"none":null,u=a.tag==="g",s=null,l=0,f;f=Ew(t,e,n,"g",i);f.setAttribute("class",FO(t));if(!u){f.style.setProperty("pointer-events",o)}if(t.clip){f.setAttribute("clip-path",_k(r,t,t.group))}else{f.removeAttribute("clip-path")}function c(e){var t=r.isDirty(e),n=Ew(e,f,s,a.tag,i);if(t){r._update(a,n,e);if(u)Sw(r,n,e)}s=n;++l}if(a.nested){if(t.items.length)c(t.items[0])}else{ek(t,c)}IO(f,l);return f};function Sw(e,t,n){t=t.lastChild;var r,i=0;ek(n,function(n){r=e.draw(t,n,r);++i});IO(t,1+i)}function Ew(e,t,n,r,i){var a=e._svg,o;if(!a){o=t.ownerDocument;a=PO(o,r,bw);e._svg=a;if(e.mark){a.__data__=e;a.__values__={fill:"default"};if(r==="g"){var u=PO(o,"path",bw);u.setAttribute("class","background");a.appendChild(u);u.__data__=e;var s=PO(o,"g",bw);a.appendChild(s);s.__data__=e}}}if(a.ownerSVGElement!==i||Aw(e)&&a.previousSibling!==n){t.insertBefore(a,n?n.nextSibling:t.firstChild)}return a}function Aw(e){var t=e.mark||e.group;return t&&t.items.length>1}var zw=null,Tw=null;var Mw={group:function(e,t,n){Tw=t.__values__;zw=t.childNodes[1];e.foreground(Dw,n,this);zw=t.childNodes[0];e.background(Dw,n,this);var r=n.mark.interactive===false?"none":null;if(r!==Tw.events){zw.style.setProperty("pointer-events",r);Tw.events=r}},text:function(e,t,n){var r;r=cO(n);if(r!==Tw.text){t.textContent=r;Tw.text=r}Nw(t,"font-family",hO(n));Nw(t,"font-size",lO(n)+"px");Nw(t,"font-style",n.fontStyle);Nw(t,"font-variant",n.fontVariant);Nw(t,"font-weight",n.fontWeight)}};function Nw(e,t,n){if(n!==Tw[t]){if(n==null){e.style.removeProperty(t)}else{e.style.setProperty(t,n+"")}Tw[t]=n}}xw._update=function(e,t,n){zw=t;Tw=t.__values__;e.attr(Dw,n,this);var r=Mw[e.type];if(r)r.call(this,e,t,n);this.style(zw,n)};function Dw(e,t,n){if(t===Tw[e])return;if(t!=null){if(n){zw.setAttributeNS(n,e,t)}else{zw.setAttribute(e,t)}}else{if(n){zw.removeAttributeNS(n,e)}else{zw.removeAttribute(e)}}Tw[e]=t}xw.style=function(e,t){if(t==null)return;var n,r,i,a,o;for(n=0,r=yw.length;n<r;++n){i=yw[n];o=t[i];if(i==="font"){o=hO(t)}if(o===Tw[i])continue;a=mw[i];if(o==null){if(a==="fill"){e.style.setProperty(a,"none")}else{e.style.removeProperty(a)}}else{if(o.id){this._defs.gradient[o.id]=o;o="url("+Cw()+"#"+o.id+")"}e.style.setProperty(a,o+"")}Tw[i]=o}};function Cw(){var e;return typeof window==="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Pw(e){BO.call(this,e);this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""};this._defs={gradient:{},clipping:{}}}var Rw=Object(V["inherits"])(Pw,BO);var Lw=BO.prototype;Rw.resize=function(e,t,n,r){Lw.resize.call(this,e,t,n,r);var i=this._origin,a=this._text;var o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var u in gw){o[u]=gw[u]}a.head=pw("svg",o);var s=this._bgcolor;if(s==="transparent"||s==="none")s=null;if(s){a.bg=pw("rect",{width:this._width,height:this._height,style:"fill: "+s+";"})+vw("rect")}else{a.bg=""}a.root=pw("g",{transform:"translate("+i+")"});a.foot=vw("g")+vw("svg");return this};Rw.background=function(){var e=Lw.background.apply(this,arguments);if(arguments.length&&this._text.head){this.resize(this._width,this._height,this._origin,this._scale)}return e};Rw.svg=function(){var e=this._text;return e.head+e.bg+e.defs+e.root+e.body+e.foot};Rw._render=function(e){this._text.body=this.mark(e);this._text.defs=this.buildDefs();return this};Rw.buildDefs=function(){var e=this._defs,t="",n,r,i,a;for(r in e.gradient){i=e.gradient[r];a=i.stops;t+=pw("linearGradient",{id:r,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(n=0;n<a.length;++n){t+=pw("stop",{offset:a[n].offset,"stop-color":a[n].color})+vw("stop")}t+=vw("linearGradient")}for(r in e.clipping){i=e.clipping[r];t+=pw("clipPath",{id:r});if(i.path){t+=pw("path",{d:i.path})+vw("path")}else{t+=pw("rect",{x:0,y:0,width:i.width,height:i.height})+vw("rect")}t+=vw("clipPath")}return t.length>0?pw("defs")+t+vw("defs"):""};var Iw;function Fw(e,t,n,r){Iw[r||e]=t}Rw.attributes=function(e,t){Iw={};e(Fw,t,this);return Iw};Rw.href=function(e){var t=this,n=e.href,r;if(n){if(r=t._hrefs&&t._hrefs[n]){return r}else{t.sanitizeURL(n).then(function(e){e["xlink:href"]=e.href;e.href=null;(t._hrefs||(t._hrefs={}))[n]=e})}}return null};Rw.mark=function(e){var t=this,n=wO[e.marktype],r=n.tag,i=this._defs,a="",o;if(r!=="g"&&e.interactive===false){o='style="pointer-events: none;"'}a+=pw("g",{class:FO(e),"clip-path":e.clip?_k(t,e,e.group):null},o);function u(u){var s=t.href(u);if(s)a+=pw("a",s);o=r!=="g"?qw(u,e,r,i):null;a+=pw(r,t.attributes(n.attr,u),o);if(r==="text"){a+=Uw(cO(u))}else if(r==="g"){a+=pw("path",t.attributes(n.background,u),qw(u,e,"bgrect",i))+vw("path");a+=pw("g",t.attributes(n.foreground,u))+t.markGroup(u)+vw("g")}a+=vw(r);if(s)a+=vw("a")}if(n.nested){if(e.items&&e.items.length)u(e.items[0])}else{ek(e,u)}return a+vw("g")};Rw.markGroup=function(e){var t=this,n="";ek(e,function(e){n+=t.mark(e)});return n};function qw(e,t,n,r){if(e==null)return"";var i,a,o,u,s,l="";if(n==="bgrect"&&t.interactive===false){l+="pointer-events: none; "}if(n==="text"){l+="font-family: "+hO(e)+"; ";l+="font-size: "+lO(e)+"px; ";if(e.fontStyle)l+="font-style: "+e.fontStyle+"; ";if(e.fontVariant)l+="font-variant: "+e.fontVariant+"; ";if(e.fontWeight)l+="font-weight: "+e.fontWeight+"; "}for(i=0,a=yw.length;i<a;++i){o=yw[i];u=mw[o];s=e[o];if(s==null){if(u==="fill"){l+="fill: none; "}}else if(s==="transparent"&&(u==="fill"||u==="stroke")){l+=u+": none; "}else{if(s.id){r.gradient[s.id]=s;s="url(#"+s.id+")"}l+=u+": "+s+"; "}}return l?'style="'+l.trim()+'"':null}function Uw(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Ww="canvas";var Vw="png";var Hw="svg";var Bw="none";var Gw={Canvas:Ww,PNG:Vw,SVG:Hw,None:Bw};var $w={};$w[Ww]=$w[Vw]={renderer:aw,headless:aw,handler:QO};$w[Hw]={renderer:_w,headless:Pw,handler:cw};$w[Bw]={};function Yw(e,t){e=String(e||"").toLowerCase();if(arguments.length>1){$w[e]=t;return this}else{return $w[e]}}var Xw=new Qb;var Jw=function(e){var t=e.clip;if(Object(V["isFunction"])(t)){t(Hx(Xw.clear()))}else if(t){Xw.set(0,0,e.group.width,e.group.height)}else return;e.bounds.intersect(Xw)};var Qw=1e-9;function Zw(e,t,n){return e===t?true:n==="path"?Kw(e,t):e instanceof Date&&t instanceof Date?+e===+t:Object(V["isNumber"])(e)&&Object(V["isNumber"])(t)?Math.abs(e-t)<=Qw:!e||!t||!Object(V["isObject"])(e)&&!Object(V["isObject"])(t)?e==t:e==null||t==null?false:ej(e,t)}function Kw(e,t){return Zw(F_(e),F_(t))}function ej(e,t){var n=Object.keys(e),r=Object.keys(t),i,a;if(n.length!==r.length)return false;n.sort();r.sort();for(a=n.length-1;a>=0;a--){if(n[a]!=r[a])return false}for(a=n.length-1;a>=0;a--){i=n[a];if(!Zw(e[i],t[i],i))return false}return typeof e===typeof t}var tj=function(e,t,n){var r=e._renderer.canvas(),i,a,o;if(r){o=Xb(e);a=t.changedTouches?t.changedTouches[0]:t;i=qO(a,r);i[0]-=o[0];i[1]-=o[1]}t.dataflow=e;t.vega=nj(e,n,i);t.item=n;return t};function nj(e,t,n){var r=t?t.mark.marktype==="group"?t:t.mark.group:null;function i(e){var n=r,i;if(e)for(i=t;i;i=i.mark.group){if(i.mark.name===e){n=i;break}}return n&&n.mark&&n.mark.interactive?n:{}}function a(e){if(!e)return n;if(Object(V["isString"])(e))e=i(e);var t=n.slice();while(e){t[0]-=e.x||0;t[1]-=e.y||0;e=e.mark&&e.mark.group}return t}return{view:Object(V["constant"])(e),item:Object(V["constant"])(t||{}),group:i,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}var rj="view",ij="timer",aj="window",oj={trap:false};function uj(e){e=Object(V["extend"])({},e);var t=e.defaults;if(t){if(Object(V["isArray"])(t.prevent)){t.prevent=Object(V["toSet"])(t.prevent)}if(Object(V["isArray"])(t.allow)){t.allow=Object(V["toSet"])(t.allow)}}return e}function sj(e,t){var n=e._eventConfig.defaults,r=n&&n.prevent,i=n&&n.allow;return r===false||i===true?false:r===true||i===false?true:r?r[t]:i?!i[t]:e.preventDefault()}function lj(e,t,n){var r=this,i=new me(n),a=function(n,a){if(e===rj&&sj(r,t)){n.preventDefault()}try{i.receive(tj(r,n,a))}catch(e){r.error(e)}finally{r.run()}},o;if(e===ij){r.timer(a,t)}else if(e===rj){r.addEventListener(t,a,oj)}else{if(e===aj){if(typeof window!=="undefined")o=[window]}else if(typeof document!=="undefined"){o=document.querySelectorAll(e)}if(!o){r.warn("Can not resolve event source: "+e)}else{for(var u=0,s=o.length;u<s;++u){o[u].addEventListener(t,a)}r._eventListeners.push({type:t,sources:o,handler:a})}}return i}function fj(e){return e.item}function cj(e){var t=e.item.mark.source;return t.source||t}function dj(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}var hj=function(e,t){e=[e||"hover"];t=[t||"update",e[0]];this.on(this.events("view","mouseover",fj),cj,dj(e));this.on(this.events("view","mouseout",fj),cj,dj(t));return this};var pj=function(){var e=this._tooltip,t=this._timers,n=this._eventListeners,r,i,a;r=t.length;while(--r>=0){t[r].stop()}r=n.length;while(--r>=0){a=n[r];i=a.sources.length;while(--i>=0){a.sources[i].removeEventListener(a.type,a.handler)}}if(e){e.call(this,this._handler,null,null,null)}return this};var vj=function(e,t,n){var r=document.createElement(e);for(var i in t)r.setAttribute(i,t[i]);if(n!=null)r.textContent=n;return r};var gj="vega-bind",mj="vega-bind-name",yj="vega-bind-radio",bj="vega-option-";var _j=function(e,t,n){if(!t)return;var r=n.param,i=n.state;if(!i){i=n.state={elements:null,active:false,set:null,update:function(t){if(t!==e.signal(r.signal)){i.source=true;e.signal(r.signal,t).run()}}};if(r.debounce){i.update=Object(V["debounce"])(r.debounce,i.update)}}xj(i,t,r,e.signal(r.signal));if(!i.active){e.on(e._signals[r.signal],null,function(){i.source?i.source=false:i.set(e.signal(r.signal))});i.active=true}return i};function xj(e,t,n,r){var i=vj("div",{class:gj});i.appendChild(vj("span",{class:mj},n.name||n.signal));t.appendChild(i);var a=kj;switch(n.input){case"checkbox":a=Oj;break;case"select":a=wj;break;case"radio":a=jj;break;case"range":a=Sj;break}a(e,i,n,r)}function kj(e,t,n,r){var i=vj("input");for(var a in n){if(a!=="signal"&&a!=="element"){i.setAttribute(a==="input"?"type":a,n[a])}}i.setAttribute("name",n.signal);i.value=r;t.appendChild(i);i.addEventListener("input",function(){e.update(i.value)});e.elements=[i];e.set=function(e){i.value=e}}function Oj(e,t,n,r){var i={type:"checkbox",name:n.signal};if(r)i.checked=true;var a=vj("input",i);t.appendChild(a);a.addEventListener("change",function(){e.update(a.checked)});e.elements=[a];e.set=function(e){a.checked=!!e||null}}function wj(e,t,n,r){var i=vj("select",{name:n.signal});n.options.forEach(function(e){var t={value:e};if(Ej(e,r))t.selected=true;i.appendChild(vj("option",t,e+""))});t.appendChild(i);i.addEventListener("change",function(){e.update(n.options[i.selectedIndex])});e.elements=[i];e.set=function(e){for(var t=0,r=n.options.length;t<r;++t){if(Ej(n.options[t],e)){i.selectedIndex=t;return}}}}function jj(e,t,n,r){var i=vj("span",{class:yj});t.appendChild(i);e.elements=n.options.map(function(t){var a=bj+n.signal+"-"+t;var o={id:a,type:"radio",name:n.signal,value:t};if(Ej(t,r))o.checked=true;var u=vj("input",o);u.addEventListener("change",function(){e.update(t)});i.appendChild(u);i.appendChild(vj("label",{for:a},t+""));return u});e.set=function(t){var n=e.elements,r=0,i=n.length;for(;r<i;++r){if(Ej(n[r].value,t))n[r].checked=true}}}function Sj(e,t,n,r){r=r!==undefined?r:(+n.max+ +n.min)/2;var i=n.min||Math.min(0,+r)||0,a=n.max||Math.max(100,+r)||100,o=n.step||Object(En["r"])(i,a,100);var u=vj("input",{type:"range",name:n.signal,min:i,max:a,step:o});u.value=r;var s=vj("label",{},+r);t.appendChild(u);t.appendChild(s);function l(){s.textContent=u.value;e.update(+u.value)}u.addEventListener("input",l);u.addEventListener("change",l);e.elements=[u];e.set=function(e){u.value=e;s.textContent=e}}function Ej(e,t){return e===t||e+""===t+""}var Aj=function(e,t,n,r,i){t=t||new r(e.loader());return t.initialize(n,$b(e),Yb(e),Xb(e),i).background(e._background)};var zj=function(e,t){return!t?null:function(){try{t.apply(this,arguments)}catch(t){e.error(t)}}};var Tj=function(e,t,n,r){var i=new r(e.loader(),zj(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,Xb(e),e);if(t){t.handlers().forEach(function(e){i.on(e.type,e.handler)})}return i};var Mj=function(e,t){var n=this,r=n._renderType,i=Yw(r),a,o;e=n._el=e?Nj(n,e):null;if(!i)n.error("Unrecognized renderer type: "+r);a=i.handler||QO;o=e?i.renderer:i.headless;n._renderer=!o?null:Aj(n,n._renderer,e,o);n._handler=Tj(n,n._handler,e,a);n._redraw=true;if(e){t=t?Nj(n,t):e.appendChild(vj("div",{class:"vega-bindings"}));n._bind.forEach(function(e){if(e.param.element){e.element=Nj(n,e.param.element)}});n._bind.forEach(function(e){_j(n,e.element||t,e)})}return n};function Nj(e,t){if(typeof t==="string"){if(typeof document!=="undefined"){t=document.querySelector(t);if(!t){e.error("Signal bind element not found: "+t);return null}}else{e.error("DOM document instance not found.");return null}}if(t){try{t.innerHTML=""}catch(n){t=null;e.error(n)}}return t}var Dj=function(e,t,n){var r=Yw(t),i=r&&r.headless;return!i?Promise.reject("Unrecognized renderer type: "+t):e.runAsync().then(function(){return Aj(e,null,null,i,n).renderAsync(e._scenegraph.root)})};var Cj=function(e,t){return e!==Gw.Canvas&&e!==Gw.SVG&&e!==Gw.PNG?Promise.reject("Unrecognized image type: "+e):Dj(this,e,t).then(function(t){return e===Gw.SVG?Pj(t.svg(),"image/svg+xml"):t.canvas().toDataURL("image/png")})};function Pj(e,t){var n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}var Rj=function(e){return Dj(this,Gw.Canvas,e).then(function(e){return e.canvas()})};var Lj=function(e){return Dj(this,Gw.SVG,e).then(function(e){return e.svg()})};var Ij=function(e,t){e=e||t.autosize;if(Object(V["isObject"])(e)){return e}else{e=e||"pad";return{type:e}}};var Fj=function(e,t){e=e||t.padding;return Object(V["isObject"])(e)?{top:qj(e.top),bottom:qj(e.bottom),left:qj(e.left),right:qj(e.right)}:Uj(qj(e))};function qj(e){return+e||0}function Uj(e){return{top:e,bottom:e,left:e,right:e}}var Wj="outer",Vj=["value","update","react","bind"];function Hj(e,t){Object(V["error"])(e+' for "outer" push: '+Object(V["stringValue"])(t))}var Bj=function(e,t){var n=e.name;if(e.push===Wj){if(!t.signals[n])Hj("No prior signal definition",n);Vj.forEach(function(t){if(e[t]!==undefined)Hj("Invalid property ",t)})}else{var r=t.addSignal(n,e.value);if(e.react===false)r.react=false;if(e.bind)t.addBinding(n,e.bind)}};var Gj=n("jjHi");var $j=n("6jm/");var Yj={};function Xj(e,t,n){var r=e+":"+n,i=Yj[r];if(!i||i[0]!==t){Yj[r]=i=[t,t(n)]}return i[1]}function Jj(e,t){return Xj("format",tc["format"],t)(e)}function Qj(e,t){return Xj("timeFormat",Xe["timeFormat"],t)(e)}function Zj(e,t){return Xj("utcFormat",Xe["utcFormat"],t)(e)}function Kj(e,t){return Xj("timeParse",Xe["timeParse"],t)(e)}function eS(e,t){return Xj("utcParse",Xe["utcParse"],t)(e)}var tS=new Date(2e3,0,1);function nS(e,t,n){tS.setMonth(e);tS.setDate(t);return Qj(tS,n)}function rS(e){return nS(e,1,"%B")}function iS(e){return nS(e,1,"%b")}function aS(e){return nS(0,2+e,"%A")}function oS(e){return nS(0,2+e,"%a")}function uS(e){var t=0,n,r,i,a;if(e&&(n=e.length)){for(r=e[t];r==null||r!==r;r=e[++t]);i=a=r;for(;t<n;++t){r=e[t];if(r!=null){if(r<i)i=r;if(r>a)a=r}}}return[i,a]}function sS(e,t,n,r){var i=t[0],a=t[t.length-1],o;if(i>a){o=i;i=a;a=o}n=n===undefined||n;r=r===undefined||r;return(n?i<=e:i<e)&&(r?e<=a:e<a)}function lS(e,t,n){var r=e[0],i=e[1],a;if(i<r){a=i;i=r;r=a}a=i-r;return a>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-a),r+a]}function fS(e){return e[e.length-1]-e[0]||0}function cS(e){return 1+~~(new Date(e).getMonth()/3)}function dS(e){return 1+~~(new Date(e).getUTCMonth()/3)}function hS(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function pS(){return hS(this.context.dataflow,"warn",arguments)}function vS(){return hS(this.context.dataflow,"info",arguments)}function gS(){return hS(this.context.dataflow,"debug",arguments)}var mS=function(e){var t=this.context.group,n=false;if(t)while(e){if(e===t){n=true;break}e=e.mark.group}return n};function yS(e){var t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)}function bS(e){var t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}var _S=typeof window!=="undefined"&&window||null;function xS(){return _S?_S.screen:{}}function kS(){return _S?[_S.innerWidth,_S.innerHeight]:[undefined,undefined]}function OS(){var e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[undefined,undefined]}var wS=function(e,t,n,r,i,a){if(!n&&n!==0)return a;var o=e[0],u=Object(V["peek"])(e),s=+n,l,f;if(u<o){l=o;o=u;u=l}l=Math.abs(t-o);f=Math.abs(u-t);return l<f&&l<=s?r:f<=s?i:a};var jS=function(){var e=[].slice.call(arguments);e.unshift({});return V["extend"].apply(null,e)};var SS="Literal";var ES="Identifier";var AS="@";var zS="%";var TS=":";function MS(e,t){var n;return Object(V["isFunction"])(e)?e:Object(V["isString"])(e)?(n=t.scales[e])&&n.value:undefined}function NS(e,t,n){var r=zS+n;if(!t.hasOwnProperty(r)){try{t[r]=e.scaleRef(n)}catch(e){}}}function DS(e,t,n,r){if(t[0].type===SS){NS(n,r,t[0].value)}else if(t[0].type===ES){for(e in n.scales){NS(n,r,e)}}}function CS(e,t){var n=MS(e,(t||this).context);return n&&n.range?n.range():[]}function PS(e,t){var n=MS(e,(t||this).context);return n?n.domain():[]}function RS(e,t){var n=MS(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function LS(e,t,n){return Object(ec["a"])(e||0,t||0,n||0)}function IS(e,t){var n=MS(e,(t||this).context);return n?n.copy():undefined}function FS(e,t,n){var r=MS(e,(n||this).context);return r?r(t):undefined}function qS(e,t,n){var r=MS(e,(n||this).context);return!r?undefined:Object(V["isArray"])(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t)}function US(e){this.clear();if(e)this.union(e)}var WS=US.prototype;WS.clone=function(){return new US(this)};WS.clear=function(){this.x1=+Number.MAX_VALUE;this.y1=+Number.MAX_VALUE;this.x2=-Number.MAX_VALUE;this.y2=-Number.MAX_VALUE;return this};WS.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE};WS.set=function(e,t,n,r){if(n<e){this.x2=e;this.x1=n}else{this.x1=e;this.x2=n}if(r<t){this.y2=t;this.y1=r}else{this.y1=t;this.y2=r}return this};WS.add=function(e,t){if(e<this.x1)this.x1=e;if(t<this.y1)this.y1=t;if(e>this.x2)this.x2=e;if(t>this.y2)this.y2=t;return this};WS.expand=function(e){this.x1-=e;this.y1-=e;this.x2+=e;this.y2+=e;return this};WS.round=function(){this.x1=Math.floor(this.x1);this.y1=Math.floor(this.y1);this.x2=Math.ceil(this.x2);this.y2=Math.ceil(this.y2);return this};WS.translate=function(e,t){this.x1+=e;this.x2+=e;this.y1+=t;this.y2+=t;return this};WS.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),a=t-t*r+n*i,o=n-t*i-n*r,u=this.x1,s=this.x2,l=this.y1,f=this.y2;return this.clear().add(r*u-i*l+a,i*u+r*l+o).add(r*u-i*f+a,i*u+r*f+o).add(r*s-i*l+a,i*s+r*l+o).add(r*s-i*f+a,i*s+r*f+o)};WS.union=function(e){if(e.x1<this.x1)this.x1=e.x1;if(e.y1<this.y1)this.y1=e.y1;if(e.x2>this.x2)this.x2=e.x2;if(e.y2>this.y2)this.y2=e.y2;return this};WS.intersect=function(e){if(e.x1>this.x1)this.x1=e.x1;if(e.y1>this.y1)this.y1=e.y1;if(e.x2<this.x2)this.x2=e.x2;if(e.y2<this.y2)this.y2=e.y2;return this};WS.encloses=function(e){return e&&(this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2)};WS.alignsWith=function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)};WS.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)};WS.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)};WS.width=function(){return this.x2-this.x1};WS.height=function(){return this.y2-this.y1};var VS=0;var HS=function(e,t){var n=[],r;return r={id:"gradient_"+VS++,x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(e,t){n.push({offset:e,color:t});return r}}};function BS(e){this.mark=e;this.bounds=this.bounds||new US}function GS(e){BS.call(this,e);this.items=this.items||[]}Object(V["inherits"])(GS,BS);var $S=/^([A-Za-z]+:)?\/\//;var YS="file://";var XS=function(e){return{options:e||{},sanitize:QS,load:JS,file:KS,http:ZS}};function JS(e,t){var n=this;return n.sanitize(e,t).then(function(e){var r=e.href;return e.localFile?n.file(r):n.http(r,t)})}function QS(e,t){t=Object(V["extend"])({},this.options,t);return new Promise(function(n,r){var i={href:null},a,o,u,s;if(e==null||typeof e!=="string"){r("Sanitize failure, invalid URI: "+Object(V["stringValue"])(e));return}o=$S.test(e);if((s=t.baseURL)&&!o){if(!nE(e,"/")&&s[s.length-1]!=="/"){e="/"+e}e=s+e}u=(a=nE(e,YS))||t.mode==="file"||t.mode!=="http"&&!o&&tE();if(a){e=e.slice(YS.length)}else if(nE(e,"//")){if(t.defaultProtocol==="file"){e=e.slice(2);u=true}else{e=(t.defaultProtocol||"http")+":"+e}}Object.defineProperty(i,"localFile",{value:!!u});i.href=e;if(t.target){i.target=t.target+""}n(i)})}function ZS(e,t){return eE(e,Object(V["extend"])({},this.options.http,t)).then(function(e){if(!e.ok)throw e.status+""+e.statusText;return e.text()})}function KS(e){return new Promise(function(t,n){var r=tE();r?r.readFile(e,function(e,r){if(e)n(e);else t(r)}):n("No file system access for "+e)})}function eE(e,t){var r=typeof fetch==="function"?fetch:n(12);return r?r(e,t):Promise.reject("No fetch method available.")}function tE(){var e="function"==="function"&&n(11);return e&&Object(V["isFunction"])(e.readFile)?e:null}function nE(e,t){return e==null?false:e.lastIndexOf(t,0)===0}var rE={boolean:V["toBoolean"],integer:V["toNumber"],number:V["toNumber"],date:V["toDate"],string:V["toString"],unknown:V["identity"]};var iE=[lE,dE,cE,fE];var aE=["boolean","integer","number","date"];function oE(e,t){if(!e||!e.length)return"unknown";var n,r,i,a=0,o=e.length,u=iE.length,s=iE.map(function(e,t){return t+1});for(r=0,o=e.length;r<o;++r){n=t?e[r][t]:e[r];for(i=0;i<u;++i){if(s[i]&&sE(n)&&!iE[i](n)){s[i]=0;++a;if(a===iE.length)return"string"}}}a=s.reduce(function(e,t){return e===0?t:e},0)-1;return aE[a]}function uE(e,t){return t.reduce(function(t,n){t[n]=oE(e,n);return t},{})}function sE(e){return e!=null&&e===e}function lE(e){return e==="true"||e==="false"||e===true||e===false}function fE(e){return!isNaN(Date.parse(e))}function cE(e){return!isNaN(+e)&&!(e instanceof Date)}function dE(e){return cE(e)&&(e=+e)===~~e}function hE(e){return function(t,n){var r={delimiter:e};return pE(t,n?Object(V["extend"])(n,r):r)}}function pE(e,t){if(t.header){e=t.header.map(V["stringValue"]).join(t.delimiter)+"\n"+e}return Object(Ue["b"])(t.delimiter).parse(e+"")}var vE=n("EawG");var gE=function(e,t){var n,r,i;e=Object(vE["a"])(e,t);n=t&&(i=t.feature)?Be["a"]:t&&(i=t.mesh)?Be["b"]:Object(V["error"])("Missing TopoJSON feature or mesh parameter.");r=(r=e.objects[i])?n(e,r):Object(V["error"])("Invalid TopoJSON object: "+i);return r&&r.features||[r]};var mE={dsv:pE,csv:hE(","),tsv:hE("\t"),json:vE["a"],topojson:gE};var yE=function(e,t){if(arguments.length>1){mE[e]=t;return this}else{return mE.hasOwnProperty(e)?mE[e]:null}};var bE=function(e,t,n){t=t||{};var r=yE(t.type||"json");if(!r)Object(V["error"])("Unknown data format type: "+t.type);e=r(e,t);if(t.parse)_E(e,t.parse,n);if(e.hasOwnProperty("columns"))delete e.columns;return e};function _E(e,t,n){if(!e.length)return;n=n||Xe["timeParse"];var r=e.columns||Object.keys(e[0]),i,a,o,u,s,l,f;if(t==="auto")t=uE(e,r);r=Object.keys(t);i=r.map(function(e){var r=t[e],i,a;if(r&&(r.indexOf("date:")===0||r.indexOf("utc:")===0)){i=r.split(/:(.+)?/,2);a=i[1];if(a[0]==="'"&&a[a.length-1]==="'"||a[0]==='"'&&a[a.length-1]==='"'){a=a.slice(1,-1)}return i[0]==="utc"?Object(Xe["utcParse"])(a):n(a)}if(!rE[r]){throw Error("Illegal format pattern: "+e+":"+r)}return rE[r]});for(u=0,l=e.length,f=r.length;u<l;++u){a=e[u];for(s=0;s<f;++s){o=r[s];a[o]=i[s](a[o])}}}function xE(e){this._pending=0;this._loader=e||XS()}var kE=xE.prototype;kE.pending=function(){return this._pending};function OE(e){e._pending+=1}function wE(e){e._pending-=1}kE.sanitizeURL=function(e){var t=this;OE(t);return t._loader.sanitize(e,{context:"href"}).then(function(e){wE(t);return e}).catch(function(){wE(t);return null})};kE.loadImage=function(e){var t=this,n=Object(Wi["b"])();OE(t);return t._loader.sanitize(e,{context:"image"}).then(function(e){var r=e.href;if(!r||!n)throw{url:r};var i=new n;i.onload=function(){wE(t);i.loaded=true};i.onerror=function(){wE(t);i.loaded=false};i.src=r;return i}).catch(function(e){wE(t);return{loaded:false,width:0,height:0,src:e&&e.url||""}})};kE.ready=function(){var e=this;return new Promise(function(t){function n(r){if(!e.pending())t(r);else setTimeout(function(){n(true)},10)}n(false)})};var jE={basis:{curve:xa["c"]},"basis-closed":{curve:xa["d"]},"basis-open":{curve:xa["e"]},bundle:{curve:xa["f"],tension:"beta",value:.85},cardinal:{curve:xa["g"],tension:"tension",value:0},"cardinal-open":{curve:xa["i"],tension:"tension",value:0},"cardinal-closed":{curve:xa["h"],tension:"tension",value:0},"catmull-rom":{curve:xa["j"],tension:"alpha",value:.5},"catmull-rom-closed":{curve:xa["k"],tension:"alpha",value:.5},"catmull-rom-open":{curve:xa["l"],tension:"alpha",value:.5},linear:{curve:xa["m"]},"linear-closed":{curve:xa["n"]},monotone:{horizontal:xa["p"],vertical:xa["o"]},natural:{curve:xa["q"]},step:{curve:xa["r"]},"step-after":{curve:xa["s"]},"step-before":{curve:xa["t"]}};function SE(e,t,n){var r=jE.hasOwnProperty(e)&&jE[e],i=null;if(r){i=r.curve||r[t||"vertical"];if(r.tension&&n!=null){i=i[r.tension](n)}}return i}var EE={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},AE=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];var zE=function(e){var t=[],n,r,i,a,o,u,s,l,f,c,d;n=e.slice().replace(AE[0],"###$1").split(AE[1]).slice(1);for(l=0,c=n.length;l<c;++l){r=n[l];i=r.slice(1).trim().replace(AE[2],"$1###$2").split(AE[3]);u=r.charAt(0);a=[u];for(f=0,d=i.length;f<d;++f){if((o=+i[f])===o){a.push(o)}}s=EE[u.toLowerCase()];if(a.length-1>s){for(f=1,d=a.length;f<d;f+=s){t.push([u].concat(a.slice(f,f+s)))}}else{t.push(a)}}return t};var TE={};var ME={};var NE=[].join;function DE(e,t,n,r,i,a,o,u,s){var l=NE.call(arguments);if(TE[l]){return TE[l]}var f=o*(Math.PI/180);var c=Math.sin(f);var d=Math.cos(f);n=Math.abs(n);r=Math.abs(r);var h=d*(u-e)*.5+c*(s-t)*.5;var p=d*(s-t)*.5-c*(u-e)*.5;var v=h*h/(n*n)+p*p/(r*r);if(v>1){v=Math.sqrt(v);n*=v;r*=v}var g=d/n;var m=c/n;var y=-c/r;var b=d/r;var _=g*u+m*s;var x=y*u+b*s;var k=g*e+m*t;var O=y*e+b*t;var w=(k-_)*(k-_)+(O-x)*(O-x);var j=1/w-.25;if(j<0)j=0;var S=Math.sqrt(j);if(a==i)S=-S;var E=.5*(_+k)-S*(O-x);var A=.5*(x+O)+S*(k-_);var z=Math.atan2(x-A,_-E);var T=Math.atan2(O-A,k-E);var M=T-z;if(M<0&&a===1){M+=2*Math.PI}else if(M>0&&a===0){M-=2*Math.PI}var N=Math.ceil(Math.abs(M/(Math.PI*.5+.001)));var D=[];for(var C=0;C<N;++C){var P=z+C*M/N;var R=z+(C+1)*M/N;D[C]=[E,A,P,R,n,r,c,d]}return TE[l]=D}function CE(e){var t=NE.call(e);if(ME[t]){return ME[t]}var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],l=e[7];var f=l*o;var c=-s*u;var d=s*o;var h=l*u;var p=Math.cos(i);var v=Math.sin(i);var g=Math.cos(a);var m=Math.sin(a);var y=.5*(a-i);var b=Math.sin(y*.5);var _=8/3*b*b/Math.sin(y);var x=n+p-_*v;var k=r+v+_*p;var O=n+g;var w=r+m;var j=O+_*m;var S=w-_*g;return ME[t]=[f*x+c*k,d*x+h*k,f*j+c*S,d*j+h*S,f*O+c*w,d*O+h*w]}var PE=["l",0,0,0,0,0,0,0];function RE(e,t){var n=PE[0]=e[0];if(n==="a"||n==="A"){PE[1]=t*e[1];PE[2]=t*e[2];PE[6]=t*e[6];PE[7]=t*e[7]}else{for(var r=1,i=e.length;r<i;++r){PE[r]=t*e[r]}}return PE}var LE=function(e,t,n,r,i){var a,o=null,u=0,s=0,l=0,f=0,c,d,h,p;if(n==null)n=0;if(r==null)r=0;if(i==null)i=1;if(e.beginPath)e.beginPath();for(var v=0,g=t.length;v<g;++v){a=t[v];if(i!==1)a=RE(a,i);switch(a[0]){case"l":u+=a[1];s+=a[2];e.lineTo(u+n,s+r);break;case"L":u=a[1];s=a[2];e.lineTo(u+n,s+r);break;case"h":u+=a[1];e.lineTo(u+n,s+r);break;case"H":u=a[1];e.lineTo(u+n,s+r);break;case"v":s+=a[1];e.lineTo(u+n,s+r);break;case"V":s=a[1];e.lineTo(u+n,s+r);break;case"m":u+=a[1];s+=a[2];e.moveTo(u+n,s+r);break;case"M":u=a[1];s=a[2];e.moveTo(u+n,s+r);break;case"c":c=u+a[5];d=s+a[6];l=u+a[3];f=s+a[4];e.bezierCurveTo(u+a[1]+n,s+a[2]+r,l+n,f+r,c+n,d+r);u=c;s=d;break;case"C":u=a[5];s=a[6];l=a[3];f=a[4];e.bezierCurveTo(a[1]+n,a[2]+r,l+n,f+r,u+n,s+r);break;case"s":c=u+a[3];d=s+a[4];l=2*u-l;f=2*s-f;e.bezierCurveTo(l+n,f+r,u+a[1]+n,s+a[2]+r,c+n,d+r);l=u+a[1];f=s+a[2];u=c;s=d;break;case"S":c=a[3];d=a[4];l=2*u-l;f=2*s-f;e.bezierCurveTo(l+n,f+r,a[1]+n,a[2]+r,c+n,d+r);u=c;s=d;l=a[1];f=a[2];break;case"q":c=u+a[3];d=s+a[4];l=u+a[1];f=s+a[2];e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;break;case"Q":c=a[3];d=a[4];e.quadraticCurveTo(a[1]+n,a[2]+r,c+n,d+r);u=c;s=d;l=a[1];f=a[2];break;case"t":c=u+a[1];d=s+a[2];if(o[0].match(/[QqTt]/)===null){l=u;f=s}else if(o[0]==="t"){l=2*u-h;f=2*s-p}else if(o[0]==="q"){l=2*u-l;f=2*s-f}h=l;p=f;e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;l=u+a[1];f=s+a[2];break;case"T":c=a[1];d=a[2];l=2*u-l;f=2*s-f;e.quadraticCurveTo(l+n,f+r,c+n,d+r);u=c;s=d;break;case"a":IE(e,u+n,s+r,[a[1],a[2],a[3],a[4],a[5],a[6]+u+n,a[7]+s+r]);u+=a[6];s+=a[7];break;case"A":IE(e,u+n,s+r,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+r]);u=a[6];s=a[7];break;case"z":case"Z":e.closePath();break}o=a}};function IE(e,t,n,r){var i=DE(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(var a=0;a<i.length;++a){var o=CE(i[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var FE=2*Math.PI,qE=Math.sqrt(3)/2;var UE={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0);e.arc(0,0,n,0,FE)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r);e.lineTo(-n,r);e.lineTo(-r,r);e.lineTo(-r,n);e.lineTo(r,n);e.lineTo(r,r);e.lineTo(n,r);e.lineTo(n,-r);e.lineTo(r,-r);e.lineTo(r,-n);e.lineTo(-r,-n);e.lineTo(-r,-r);e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0);e.lineTo(0,-n);e.lineTo(n,0);e.lineTo(0,n);e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=qE*n;e.moveTo(0,-r);e.lineTo(-n,r);e.lineTo(n,r);e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=qE*n;e.moveTo(0,r);e.lineTo(-n,-r);e.lineTo(n,-r);e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=qE*n;e.moveTo(r,0);e.lineTo(-r,-n);e.lineTo(-r,n);e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=qE*n;e.moveTo(-r,0);e.lineTo(r,-n);e.lineTo(r,n);e.closePath()}}};function WE(e){return UE.hasOwnProperty(e)?UE[e]:HE(e)}var VE={};function HE(e){if(!VE.hasOwnProperty(e)){var t=zE(e);VE[e]={draw:function(e,n){LE(e,t,0,0,Math.sqrt(n)/2)}}}return VE[e]}function BE(e){return e.x}function GE(e){return e.y}function $E(e){return e.width}function YE(e){return e.height}function XE(e){return function(){return e}}var JE=function(){var e=BE,t=GE,n=$E,r=YE,i=XE(0),a=null;function o(o,u,s){var l,f=u!=null?u:+e.call(this,o),c=s!=null?s:+t.call(this,o),d=+n.call(this,o),h=+r.call(this,o),p=+i.call(this,o);if(!a)a=l=Object(Wa["a"])();if(p<=0){a.rect(f,c,d,h)}else{var v=f+d,g=c+h;a.moveTo(f+p,c);a.lineTo(v-p,c);a.quadraticCurveTo(v,c,v,c+p);a.lineTo(v,g-p);a.quadraticCurveTo(v,g,v-p,g);a.lineTo(f+p,g);a.quadraticCurveTo(f,g,f,g-p);a.lineTo(f,c+p);a.quadraticCurveTo(f,c,f+p,c);a.closePath()}if(l){a=null;return l+""||null}}o.x=function(t){if(arguments.length){e=typeof t==="function"?t:XE(+t);return o}else{return e}};o.y=function(e){if(arguments.length){t=typeof e==="function"?e:XE(+e);return o}else{return t}};o.width=function(e){if(arguments.length){n=typeof e==="function"?e:XE(+e);return o}else{return n}};o.height=function(e){if(arguments.length){r=typeof e==="function"?e:XE(+e);return o}else{return r}};o.cornerRadius=function(e){if(arguments.length){i=typeof e==="function"?e:XE(+e);return o}else{return i}};o.context=function(e){if(arguments.length){a=e==null?null:e;return o}else{return a}};return o};var QE=Math.PI;var ZE=function(){var e,t,n,r,i=null,a,o,u,s;function l(e,t,n){var r=n/2;if(a){var l=u-t,f=e-o;if(l||f){var c=Math.sqrt(l*l+f*f),d=(l/=c)*s,h=(f/=c)*s,p=Math.atan2(f,l);i.moveTo(o-d,u-h);i.lineTo(e-l*r,t-f*r);i.arc(e,t,r,p-QE,p);i.lineTo(o+d,u+h);i.arc(o,u,s,p,p+QE)}else{i.arc(e,t,r,0,2*QE)}i.closePath()}else{a=1}o=e;u=t;s=r}function f(o){var u,s=o.length,f,c=false,d;if(i==null)i=d=Object(Wa["a"])();for(u=0;u<=s;++u){if(!(u<s&&r(f=o[u],u,o))===c){if(c=!c)a=0}if(c)l(+e(f,u,o),+t(f,u,o),+n(f,u,o))}if(d){i=null;return d+""||null}}f.x=function(t){if(arguments.length){e=t;return f}else{return e}};f.y=function(e){if(arguments.length){t=e;return f}else{return t}};f.size=function(e){if(arguments.length){n=e;return f}else{return n}};f.defined=function(e){if(arguments.length){r=e;return f}else{return r}};f.context=function(e){if(arguments.length){if(e==null){i=null}else{i=e}return f}else{return i}};return f};function KE(e){return e.x||0}function eA(e){return e.y||0}function tA(e){return e.width||0}function nA(e){return e.size||1}function rA(e){return e.height||0}function iA(e){return(e.x||0)+(e.width||0)}function aA(e){return(e.y||0)+(e.height||0)}function oA(e){return e.startAngle||0}function uA(e){return e.endAngle||0}function sA(e){return e.padAngle||0}function lA(e){return e.innerRadius||0}function fA(e){return e.outerRadius||0}function cA(e){return e.cornerRadius||0}function dA(e){return!(e.defined===false)}function hA(e){return e.size==null?64:e.size}function pA(e){return WE(e.shape||"circle")}var vA=Object(xa["a"])().startAngle(oA).endAngle(uA).padAngle(sA).innerRadius(lA).outerRadius(fA).cornerRadius(cA),gA=Object(xa["b"])().x(KE).y1(eA).y0(aA).defined(dA),mA=Object(xa["b"])().y(eA).x1(KE).x0(iA).defined(dA),yA=Object(xa["u"])().x(KE).y(eA).defined(dA),bA=JE().x(KE).y(eA).width(tA).height(rA).cornerRadius(cA),_A=Object(xa["v"])().type(pA).size(hA),xA=ZE().x(KE).y(eA).defined(dA).size(nA);function kA(e,t){return vA.context(e)(t)}function OA(e,t){var n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?mA:gA).curve(SE(r,n.orient,n.tension)).context(e)(t)}function wA(e,t){var n=t[0],r=n.interpolate||"linear";return yA.curve(SE(r,n.orient,n.tension)).context(e)(t)}function jA(e,t,n,r){return bA.context(e)(t,n,r)}function SA(e,t){return(t.mark.shape||t.shape).context(e)(t)}function EA(e,t){return _A.context(e)(t)}function AA(e,t){return xA.context(e)(t)}var zA=function(e,t){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){e.expand(t.strokeWidth!=null?+t.strokeWidth:1)}return e};var TA,MA=Math.PI*2,NA=MA/4,DA=MA-1e-8;function CA(e){TA=e;return CA}function PA(){}function RA(e,t){TA.add(e,t)}CA.beginPath=PA;CA.closePath=PA;CA.moveTo=RA;CA.lineTo=RA;CA.rect=function(e,t,n,r){RA(e,t);RA(e+n,t+r)};CA.quadraticCurveTo=function(e,t,n,r){RA(e,t);RA(n,r)};CA.bezierCurveTo=function(e,t,n,r,i,a){RA(e,t);RA(n,r);RA(i,a)};CA.arc=function(e,t,n,r,i,a){if(Math.abs(i-r)>DA){RA(e-n,t-n);RA(e+n,t+n);return}var o=Infinity,u=-Infinity,s=Infinity,l=-Infinity,f,c,d,h;function p(e){d=n*Math.cos(e);h=n*Math.sin(e);if(d<o)o=d;if(d>u)u=d;if(h<s)s=h;if(h>l)l=h}p(r);p(i);if(i!==r){r=r%MA;if(r<0)r+=MA;i=i%MA;if(i<0)i+=MA;if(i<r){a=!a;f=r;r=i;i=f}if(a){i-=MA;f=r-r%NA;for(c=0;c<4&&f>i;++c,f-=NA)p(f)}else{f=r-r%NA+NA;for(c=0;c<4&&f<i;++c,f=f+NA)p(f)}}RA(e+o,t+s);RA(e+u,t+l)};var LA=function(e,t,n){var r=n.width(),i=n.height(),a=n.x1+t.x1*r,o=n.y1+t.y1*i,u=n.x1+t.x2*r,s=n.y1+t.y2*i,l=t.stops,f=0,c=l.length,d=e.createLinearGradient(a,o,u,s);for(;f<c;++f){d.addColorStop(l[f].offset,l[f].color)}return d};var IA=function(e,t,n){return n.id?LA(e,n,t.bounds):n};var FA=function(e,t,n){n*=t.fillOpacity==null?1:t.fillOpacity;if(n>0){e.globalAlpha=n;e.fillStyle=IA(e,t,t.fill);return true}else{return false}};var qA=[];var UA=function(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;if(r<=0)return false;n*=t.strokeOpacity==null?1:t.strokeOpacity;if(n>0){e.globalAlpha=n;e.strokeStyle=IA(e,t,t.stroke);e.lineWidth=r;e.lineCap=t.strokeCap||"butt";e.lineJoin=t.strokeJoin||"miter";e.miterLimit=t.strokeMiterLimit||10;if(e.setLineDash){e.setLineDash(t.strokeDash||qA);e.lineDashOffset=t.strokeDashOffset||0}return true}else{return false}};function WA(e,t){return e.zindex-t.zindex||e.index-t.index}function VA(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,a;for(i=0,a=t.length;i<a;++i){r=t[i];r.index=i;if(r.zindex)n.push(r)}e.zdirty=false;return e.zitems=n.sort(WA)}function HA(e,t){var n=e.items,r,i;if(!n||!n.length)return;var a=VA(e);if(a&&a.length){for(r=0,i=n.length;r<i;++r){if(!n[r].zindex)t(n[r])}n=a}for(r=0,i=n.length;r<i;++r){t(n[r])}}function BA(e,t){var n=e.items,r,i;if(!n||!n.length)return null;var a=VA(e);if(a&&a.length)n=a;for(i=n.length;--i>=0;){if(r=t(n[i]))return r}if(n===a){for(n=e.items,i=n.length;--i>=0;){if(!n[i].zindex){if(r=t(n[i]))return r}}}return null}function GA(e){return function(t,n,r){HA(n,function(n){if(!r||r.intersects(n.bounds)){YA(e,t,n,n)}})}}function $A(e){return function(t,n,r){if(n.items.length&&(!r||r.intersects(n.bounds))){YA(e,t,n.items[0],n.items)}}}function YA(e,t,n,r){var i=n.opacity==null?1:n.opacity;if(i===0)return;if(e(t,r))return;if(n.fill&&FA(t,n,i)){t.fill()}if(n.stroke&&UA(t,n,i)){t.stroke()}}var XA=function(){return true};function JA(e){if(!e)e=XA;return function(t,n,r,i,a,o){r*=t.pixelRatio;i*=t.pixelRatio;return BA(n,function(n){var u=n.bounds;if(u&&!u.contains(a,o)||!u)return;if(e(t,n,r,i,a,o))return n})}}function QA(e,t){return function(n,r,i,a){var o=Array.isArray(r)?r[0]:r,u=t==null?o.fill:t,s=o.stroke&&n.isPointInStroke,l,f;if(s){l=o.strokeWidth;f=o.strokeCap;n.lineWidth=l!=null?l:1;n.lineCap=f!=null?f:"butt"}return e(n,r)?false:u&&n.isPointInPath(i,a)||s&&n.isPointInStroke(i,a)}}function ZA(e){return JA(QA(e))}var KA=function(e,t){return"translate("+e+","+t+")"};var ez=function(e){return KA(e.x||0,e.y||0)};var tz=function(e,t){function n(e,n){e("transform",ez(n));e("d",t(null,n))}function r(e,n){t(CA(e),n);return zA(e,n).translate(n.x||0,n.y||0)}function i(e,n){var r=n.x||0,i=n.y||0;e.translate(r,i);e.beginPath();t(e,n);e.translate(-r,-i)}return{type:e,tag:"path",nested:false,attr:n,bound:r,draw:GA(i),pick:ZA(i)}};var nz=tz("arc",kA);function rz(e,t){var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=0,a=e.length;if(a===1)return e[0];while(i<a){var o=i+a>>>1;if(e[o][r]<n)i=o+1;else a=o}i=Math.max(0,i-1);a=Math.min(e.length-1,a);return n-e[i][r]<e[a][r]-n?e[i]:e[a]}function iz(e,t){var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,a,o;while(--r>=0){if(e[r].defined===false)continue;i=e[r].x-t[0];a=e[r].y-t[1];o=i*i+a*a;if(o<n)return e[r]}return null}function az(e,t){var n=e.length,r,i,a;while(--n>=0){if(e[n].defined===false)continue;r=e[n].x-t[0];i=e[n].y-t[1];a=r*r+i*i;r=e[n].size||1;if(a<r*r)return e[n]}return null}var oz=function(e,t,n){function r(e,n){var r=n.mark.items;if(r.length)e("d",t(null,r))}function i(e,n){var r=n.items;if(r.length===0){return e}else{t(CA(e),r);return zA(e,r[0])}}function a(e,n){e.beginPath();t(e,n)}var o=QA(a);function u(e,t,n,r,i,a){var u=t.items,s=t.bounds;if(!u||!u.length||s&&!s.contains(i,a)){return null}n*=e.pixelRatio;r*=e.pixelRatio;return o(e,u,n,r)?u[0]:null}return{type:e,tag:"path",nested:true,attr:r,bound:i,draw:$A(a),pick:u,tip:n}};var uz=oz("area",OA,rz);var sz=1;function lz(){sz=1}var fz=function(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+sz++),o=i.clipping[a]||(i.clipping[a]={id:a});if(Object(V["isFunction"])(r)){o.path=r(null)}else{o.width=n.width||0;o.height=n.height||0}return"url(#"+a+")"};var cz=.5;function dz(e,t){e("transform",ez(t))}function hz(e,t){var n=t.stroke?cz:0;e("class","background");e("d",jA(null,t,n,n))}function pz(e,t,n){var r=t.clip?fz(n,t,t):null;e("clip-path",r)}function vz(e,t){if(!t.clip&&t.items){var n=t.items;for(var r=0,i=n.length;r<i;++r){e.union(n[r].bounds)}}if((t.clip||t.width||t.height)&&!t.noBound){e.add(0,0).add(t.width||0,t.height||0)}zA(e,t);return e.translate(t.x||0,t.y||0)}function gz(e,t){var n=t.stroke?cz:0;e.beginPath();jA(e,t,n,n)}var mz=QA(gz);function yz(e,t,n){var r=this;HA(t,function(t){var i=t.x||0,a=t.y||0,o=t.width||0,u=t.height||0,s;e.save();e.translate(i,a);if(t.stroke||t.fill){s=t.opacity==null?1:t.opacity;if(s>0){gz(e,t);if(t.fill&&FA(e,t,s)){e.fill()}if(t.stroke&&UA(e,t,s)){e.stroke()}}}if(t.clip){e.beginPath();e.rect(0,0,o,u);e.clip()}if(n)n.translate(-i,-a);HA(t,function(t){r.draw(e,t,n)});if(n)n.translate(i,a);e.restore()})}function bz(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items){return null}var o=this,u=n*e.pixelRatio,s=r*e.pixelRatio;return BA(t,function(l){var f,c,d,h;h=l.bounds;if(h&&!h.contains(i,a))return;c=l.x||0;d=l.y||0;e.save();e.translate(c,d);c=i-c;d=a-d;f=BA(l,function(e){return _z(e,c,d)?o.pick(e,n,r,c,d):null});if(!f&&t.interactive!==false&&(l.fill||l.stroke)&&mz(e,l,u,s)){f=l}e.restore();return f||null})}function _z(e,t,n){return(e.interactive!==false||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var xz={type:"group",tag:"g",nested:false,attr:dz,bound:vz,draw:yz,pick:bz,background:hz,foreground:pz};function kz(e,t){var n=e.image;if(!n||n.url!==e.url){n={loaded:false,width:0,height:0};t.loadImage(e.url).then(function(t){e.image=t;e.image.url=e.url})}return n}function Oz(e,t){return e==="center"?t/2:e==="right"?t:0}function wz(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function jz(e,t,n){var r=kz(t,n),i=t.x||0,a=t.y||0,o=(t.width!=null?t.width:r.width)||0,u=(t.height!=null?t.height:r.height)||0,s=t.aspect===false?"none":"xMidYMid";i-=Oz(t.align,o);a-=wz(t.baseline,u);e("href",r.src||"","http://www.w3.org/1999/xlink","xlink:href");e("transform",KA(i,a));e("width",o);e("height",u);e("preserveAspectRatio",s)}function Sz(e,t){var n=t.image,r=t.x||0,i=t.y||0,a=(t.width!=null?t.width:n&&n.width)||0,o=(t.height!=null?t.height:n&&n.height)||0;r-=Oz(t.align,a);i-=wz(t.baseline,o);return e.set(r,i,r+a,i+o)}function Ez(e,t,n){var r=this;HA(t,function(t){if(n&&!n.intersects(t.bounds))return;var i=kz(t,r),a=t.x||0,o=t.y||0,u=(t.width!=null?t.width:i.width)||0,s=(t.height!=null?t.height:i.height)||0,l,f,c,d;a-=Oz(t.align,u);o-=wz(t.baseline,s);if(t.aspect!==false){f=i.width/i.height;c=t.width/t.height;if(f===f&&c===c&&f!==c){if(c<f){d=u/f;o+=(s-d)/2;s=d}else{d=s*f;a+=(u-d)/2;u=d}}}if(i.loaded){e.globalAlpha=(l=t.opacity)!=null?l:1;e.drawImage(i,a,o,u,s)}})}var Az={type:"image",tag:"image",nested:false,attr:jz,bound:Sz,draw:Ez,pick:JA(),get:kz,xOffset:Oz,yOffset:wz};var zz=oz("line",wA,iz);function Tz(e,t){e("transform",ez(t));e("d",t.path)}function Mz(e,t){var n=t.path;if(n==null)return true;var r=t.pathCache;if(!r||r.path!==n){(t.pathCache=r=zE(n)).path=n}LE(e,r,t.x,t.y)}function Nz(e,t){return Mz(CA(e),t)?e.set(0,0,0,0):zA(e,t)}var Dz={type:"path",tag:"path",nested:false,attr:Tz,bound:Nz,draw:GA(Mz),pick:ZA(Mz)};function Cz(e,t){e("d",jA(null,t))}function Pz(e,t){var n,r;return zA(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function Rz(e,t){e.beginPath();jA(e,t)}var Lz={type:"rect",tag:"path",nested:false,attr:Cz,bound:Pz,draw:GA(Rz),pick:ZA(Rz)};function Iz(e,t){e("transform",ez(t));e("x2",t.x2!=null?t.x2-(t.x||0):0);e("y2",t.y2!=null?t.y2-(t.y||0):0)}function Fz(e,t){var n,r;return zA(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function qz(e,t,n){var r,i,a,o;if(t.stroke&&UA(e,t,n)){r=t.x||0;i=t.y||0;a=t.x2!=null?t.x2:r;o=t.y2!=null?t.y2:i;e.beginPath();e.moveTo(r,i);e.lineTo(a,o);return true}return false}function Uz(e,t,n){HA(t,function(t){if(n&&!n.intersects(t.bounds))return;var r=t.opacity==null?1:t.opacity;if(r&&qz(e,t,r)){e.stroke()}})}function Wz(e,t,n,r){if(!e.isPointInStroke)return false;return qz(e,t,1)&&e.isPointInStroke(n,r)}var Vz={type:"rule",tag:"line",nested:false,attr:Iz,bound:Fz,draw:Uz,pick:JA(Wz)};var Hz=tz("shape",SA);var Bz=tz("symbol",EA);var Gz,$z;var Yz={height:Kz,measureWidth:Qz,estimateWidth:Xz,width:Xz,canvas:eT};eT(true);function Xz(e){$z=Kz(e);return Jz(tT(e))}function Jz(e){return~~(.8*e.length*$z)}function Qz(e){Gz.font=iT(e);return Zz(tT(e))}function Zz(e){return Gz.measureText(e).width}function Kz(e){return e.fontSize!=null?e.fontSize:11}function eT(e){Gz=e&&(Gz=Object(Wi["a"])(1,1))?Gz.getContext("2d"):null;Yz.width=Gz?Qz:Xz}function tT(e){var t=e.text;if(t==null){return""}else{return e.limit>0?nT(e):t+""}}function nT(e){var t=+e.limit,n=e.text+"",r;if(Gz){Gz.font=iT(e);r=Zz}else{$z=Kz(e);r=Jz}if(r(n)<t)return n;var i=e.ellipsis||"",a=e.dir==="rtl",o=0,u=n.length,s;t-=r(i);if(a){while(o<u){s=o+u>>>1;if(r(n.slice(s))>t)o=s+1;else u=s}return i+n.slice(o)}else{while(o<u){s=1+(o+u>>>1);if(r(n.slice(0,s))<t)o=s;else u=s-1}return n.slice(0,o)+i}}function rT(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function iT(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Kz(e)+"px "+rT(e,t)}function aT(e){var t=e.baseline,n=Kz(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:0)}var oT={left:"start",center:"middle",right:"end"};var uT=new US;function sT(e,t){var n=t.dx||0,r=(t.dy||0)+aT(t),i=t.x||0,a=t.y||0,o=t.angle||0,u=t.radius||0,s;if(u){s=(t.theta||0)-Math.PI/2;i+=u*Math.cos(s);a+=u*Math.sin(s)}e("text-anchor",oT[t.align]||"start");if(o){s=KA(i,a)+" rotate("+o+")";if(n||r)s+=" "+KA(n,r)}else{s=KA(i+n,a+r)}e("transform",s)}function lT(e,t,n){var r=Yz.height(t),i=t.align,a=t.radius||0,o=t.x||0,u=t.y||0,s=t.dx||0,l=(t.dy||0)+aT(t)-Math.round(.8*r),f,c;if(a){c=(t.theta||0)-Math.PI/2;o+=a*Math.cos(c);u+=a*Math.sin(c)}f=Yz.width(t);if(i==="center"){s-=f/2}else if(i==="right"){s-=f}else{}e.set(s+=o,l+=u,s+f,l+r);if(t.angle&&!n){e.rotate(t.angle*Math.PI/180,o,u)}return e.expand(n||!f?0:1)}function fT(e,t,n){HA(t,function(t){var r,i,a,o,u,s;if(n&&!n.intersects(t.bounds))return;if(!(s=tT(t)))return;r=t.opacity==null?1:t.opacity;if(r===0)return;e.font=iT(t);e.textAlign=t.align||"left";i=t.x||0;a=t.y||0;if(o=t.radius){u=(t.theta||0)-Math.PI/2;i+=o*Math.cos(u);a+=o*Math.sin(u)}if(t.angle){e.save();e.translate(i,a);e.rotate(t.angle*Math.PI/180);i=a=0}i+=t.dx||0;a+=(t.dy||0)+aT(t);if(t.fill&&FA(e,t,r)){e.fillText(s,i,a)}if(t.stroke&&UA(e,t,r)){e.strokeText(s,i,a)}if(t.angle)e.restore()})}function cT(e,t,n,r,i,a){if(t.fontSize<=0)return false;if(!t.angle)return true;var o=lT(uT,t,true),u=-t.angle*Math.PI/180,s=Math.cos(u),l=Math.sin(u),f=t.x,c=t.y,d=s*i-l*a+(f-f*s+c*l),h=l*i+s*a+(c-f*l-c*s);return o.contains(d,h)}var dT={type:"text",tag:"text",nested:false,attr:sT,bound:lT,draw:fT,pick:JA(cT)};var hT=oz("trail",AA,az);var pT={arc:nz,area:uz,group:xz,image:Az,line:zz,path:Dz,rect:Lz,rule:Vz,shape:Hz,symbol:Bz,text:dT,trail:hT};var vT=function(e,t,n){var r=pT[e.mark.marktype],i=t||r.bound;if(r.nested)e=e.mark;return i(e.bounds||(e.bounds=new US),e,n)};var gT={mark:null};var mT=function(e,t,n){var r=pT[e.marktype],i=r.bound,a=e.items,o=a&&a.length,u,s,l,f;if(r.nested){if(o){l=a[0]}else{gT.mark=e;l=gT}f=vT(l,i,n);t=t&&t.union(f)||f;return t}t=t||e.bounds&&e.bounds.clear()||new US;if(o){for(u=0,s=a.length;u<s;++u){t.union(vT(a[u],i,n))}}return e.bounds=t};var yT=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","interpolate","tension","orient","defined","url","path","x2","y2","size","shape","text","angle","theta","radius","dx","dy","font","fontSize","fontWeight","fontStyle","fontVariant"];function bT(e,t){return JSON.stringify(e,yT,t)}function _T(e){var t=typeof e==="string"?JSON.parse(e):e;return xT(t)}function xT(e){var t=e.marktype,n=e.items,r,i,a;if(n){for(i=0,a=n.length;i<a;++i){r=t?"mark":"group";n[i][r]=e;if(n[i].zindex)n[i][r].zdirty=true;if("group"===(t||r))xT(n[i])}}if(t)mT(e);return e}function kT(e){if(arguments.length){this.root=_T(e)}else{this.root=wT({marktype:"group",name:"root",role:"frame"});this.root.items=[new GS(this.root)]}}var OT=kT.prototype;OT.toJSON=function(e){return bT(this.root,e||0)};OT.mark=function(e,t,n){t=t||this.root.items[0];var r=wT(e,t);t.items[n]=r;if(r.zindex)r.group.zdirty=true;return r};function wT(e,t){return{bounds:new US,clip:!!e.clip,group:t,interactive:e.interactive===false?false:true,items:[],marktype:e.marktype,name:e.name||undefined,role:e.role||undefined,zindex:e.zindex||0}}function jT(e,t,n){if(!e&&typeof document!=="undefined"&&document.createElement){e=document}return e?n?e.createElementNS(n,t):e.createElement(t):null}function ST(e,t){t=t.toLowerCase();var n=e.childNodes,r=0,i=n.length;for(;r<i;++r)if(n[r].tagName.toLowerCase()===t){return n[r]}}function ET(e,t,n,r){var i=e.childNodes[t],a;if(!i||i.tagName.toLowerCase()!==n.toLowerCase()){a=i||null;i=jT(e.ownerDocument,n,r);e.insertBefore(i,a)}return i}function AT(e,t){var n=e.childNodes,r=n.length;while(r>t)e.removeChild(n[--r]);return e}function zT(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}var TT=function(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]};var MT=function(e,t,n,r){var i=e&&e.mark,a,o;if(i&&(a=pT[i.marktype]).tip){o=TT(t,n);o[0]-=r[0];o[1]-=r[1];while(e=e.mark.group){o[0]-=e.x||0;o[1]-=e.y||0}e=a.tip(i.items,o)}return e};function NT(e,t){this._active=null;this._handlers={};this._loader=e||XS();this._tooltip=t||DT}function DT(e,t,n,r){e.element().setAttribute("title",r||"")}var CT=NT.prototype;CT.initialize=function(e,t,n){this._el=e;this._obj=n||null;return this.origin(t)};CT.element=function(){return this._el};CT.canvas=function(){return this._el&&this._el.firstChild};CT.origin=function(e){if(arguments.length){this._origin=e||[0,0];return this}else{return this._origin.slice()}};CT.scene=function(e){if(!arguments.length)return this._scene;this._scene=e;return this};CT.on=function(){};CT.off=function(){};CT._handlerIndex=function(e,t,n){for(var r=e?e.length:0;--r>=0;){if(e[r].type===t&&(!n||e[r].handler===n)){return r}}return-1};CT.handlers=function(e){var t=this._handlers,n=[],r;if(e){n.push.apply(n,t[this.eventName(e)])}else{for(r in t){n.push.apply(n,t[r])}}return n};CT.eventName=function(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)};CT.handleHref=function(e,t,n){this._loader.sanitize(n,{context:"href"}).then(function(t){var n=new MouseEvent(e.type,e),r=jT(null,"a");for(var i in t)r.setAttribute(i,t[i]);r.dispatchEvent(n)}).catch(function(){})};CT.handleTooltip=function(e,t,n){if(t&&t.tooltip!=null){t=MT(t,e,this.canvas(),this._origin);var r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}};CT.getItemBoundingClientRect=function(e){if(!(t=this.canvas()))return;var t,n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.x1+r[0]+n.left,o=i.y1+r[1]+n.top,u=i.width(),s=i.height();while(e.mark&&(e=e.mark.group)){a+=e.x||0;o+=e.y||0}return{x:a,y:o,width:u,height:s,left:a,top:o,right:a+u,bottom:o+s}};function PT(e){this._el=null;this._bgcolor=null;this._loader=new xE(e)}var RT=PT.prototype;RT.initialize=function(e,t,n,r,i){this._el=e;return this.resize(t,n,r,i)};RT.element=function(){return this._el};RT.canvas=function(){return this._el&&this._el.firstChild};RT.background=function(e){if(arguments.length===0)return this._bgcolor;this._bgcolor=e;return this};RT.resize=function(e,t,n,r){this._width=e;this._height=t;this._origin=n||[0,0];this._scale=r||1;return this};RT.dirty=function(){};RT.render=function(e){var t=this;t._call=function(){t._render(e)};t._call();t._call=null;return t};RT._render=function(){};RT.renderAsync=function(e){var t=this.render(e);return this._ready?this._ready.then(function(){return t}):Promise.resolve(t)};RT._load=function(e,t){var n=this,r=n._loader[e](t);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then(function(e){if(e)i();n._ready=null})}return r};RT.sanitizeURL=function(e){return this._load("sanitizeURL",e)};RT.loadImage=function(e){return this._load("loadImage",e)};var LT=["keydown","keypress","keyup","dragenter","dragleave","dragover","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"];var IT="mousemove";var FT="mouseout";var qT="click";function UT(e,t){NT.call(this,e,t);this._down=null;this._touch=null;this._first=true}var WT=Object(V["inherits"])(UT,NT);WT.initialize=function(e,t,n){var r=this._canvas=e&&ST(e,"canvas");if(r){var i=this;this.events.forEach(function(e){r.addEventListener(e,function(t){if(WT[e]){WT[e].call(i,t)}else{i.fire(e,t)}})})}return NT.prototype.initialize.call(this,e,t,n)};WT.canvas=function(){return this._canvas};WT.context=function(){return this._canvas.getContext("2d")};WT.events=LT;WT.DOMMouseScroll=function(e){this.fire("mousewheel",e)};function VT(e,t,n){return function(r){var i=this._active,a=this.pickEvent(r);if(a===i){this.fire(e,r)}else{if(!i||!i.exit){this.fire(n,r)}this._active=a;this.fire(t,r);this.fire(e,r)}}}function HT(e){return function(t){this.fire(e,t);this._active=null}}WT.mousemove=VT("mousemove","mouseover","mouseout");WT.dragover=VT("dragover","dragenter","dragleave");WT.mouseout=HT("mouseout");WT.dragleave=HT("dragleave");WT.mousedown=function(e){this._down=this._active;this.fire("mousedown",e)};WT.click=function(e){if(this._down===this._active){this.fire("click",e);this._down=null}};WT.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]);if(this._first){this._active=this._touch;this._first=false}this.fire("touchstart",e,true)};WT.touchmove=function(e){this.fire("touchmove",e,true)};WT.touchend=function(e){this.fire("touchend",e,true);this._touch=null};WT.fire=function(e,t,n){var r=n?this._touch:this._active,i=this._handlers[e],a,o;t.vegaType=e;if(e===qT&&r&&r.href){this.handleHref(t,r,r.href)}else if(e===IT||e===FT){this.handleTooltip(t,r,e!==FT)}if(i){for(a=0,o=i.length;a<o;++a){i[a].handler.call(this._obj,t,r)}}};WT.on=function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){(r[n]||(r[n]=[])).push({type:e,handler:t})}return this};WT.off=function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){r.splice(i,1)}return this};WT.pickEvent=function(e){var t=TT(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])};WT.pick=function(e,t,n,r,i){var a=this.context(),o=pT[e.marktype];return o.pick.call(this,a,e,t,n,r,i)};var BT=function(e,t){var n=t.clip;e.save();e.beginPath();if(Object(V["isFunction"])(n)){n(e)}else{var r=t.group;e.rect(0,0,r.width||0,r.height||0)}e.clip()};function GT(){return typeof window!=="undefined"?window.devicePixelRatio||1:1}var $T=GT();var YT=function(e,t,n,r,i){var a=typeof HTMLElement!=="undefined"&&e instanceof HTMLElement&&e.parentNode!=null;var o=e.getContext("2d"),u=a?$T:i;e.width=t*u;e.height=n*u;if(a&&u!==1){e.style.width=t+"px";e.style.height=n+"px"}o.pixelRatio=u;o.setTransform(u,0,0,u,u*r[0],u*r[1]);return e};function XT(e){PT.call(this,e);this._redraw=false;this._dirty=new US}var JT=Object(V["inherits"])(XT,PT),QT=PT.prototype,ZT=new US;JT.initialize=function(e,t,n,r,i){this._canvas=Object(Wi["a"])(1,1);if(e){AT(e,0).appendChild(this._canvas);this._canvas.setAttribute("class","marks")}return QT.initialize.call(this,e,t,n,r,i)};JT.resize=function(e,t,n,r){QT.resize.call(this,e,t,n,r);YT(this._canvas,this._width,this._height,this._origin,this._scale);this._redraw=true;return this};JT.canvas=function(){return this._canvas};JT.context=function(){return this._canvas?this._canvas.getContext("2d"):null};JT.dirty=function(e){var t=eM(e.bounds,e.mark.group);this._dirty.union(t)};function KT(e,t,n){t.expand(1).round();t.translate(-(n[0]%1),-(n[1]%1));e.beginPath();e.rect(t.x1,t.y1,t.width(),t.height());e.clip();return t}function eM(e,t){if(t==null)return e;var n=ZT.clear().union(e);for(;t!=null;t=t.mark.group){n.translate(t.x||0,t.y||0)}return n}JT._render=function(e){var t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty;t.save();if(this._redraw||a.empty()){this._redraw=false;a=null}else{a=KT(t,a,n)}this.clear(-n[0],-n[1],r,i);this.draw(t,e,a);t.restore();this._dirty.clear();return this};JT.draw=function(e,t,n){var r=pT[t.marktype];if(t.clip)BT(e,t);r.draw.call(this,e,t,n);if(t.clip)e.restore()};JT.clear=function(e,t,n,r){var i=this.context();i.clearRect(e,t,n,r);if(this._bgcolor!=null){i.fillStyle=this._bgcolor;i.fillRect(e,t,n,r)}};function tM(e,t){NT.call(this,e,t);var n=this;n._hrefHandler=rM(n,function(e,t){if(t&&t.href)n.handleHref(e,t,t.href)});n._tooltipHandler=rM(n,function(e,t){n.handleTooltip(e,t,e.type!==FT)})}var nM=Object(V["inherits"])(tM,NT);nM.initialize=function(e,t,n){var r=this._svg;if(r){r.removeEventListener(qT,this._hrefHandler);r.removeEventListener(IT,this._tooltipHandler);r.removeEventListener(FT,this._tooltipHandler)}this._svg=r=e&&ST(e,"svg");if(r){r.addEventListener(qT,this._hrefHandler);r.addEventListener(IT,this._tooltipHandler);r.addEventListener(FT,this._tooltipHandler)}return NT.prototype.initialize.call(this,e,t,n)};nM.canvas=function(){return this._svg};function rM(e,t){return function(n){var r=n.target,i=r.__data__;n.vegaType=n.type;i=Array.isArray(i)?i[0]:i;t.call(e._obj,n,i)}}nM.on=function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){var a={type:e,handler:t,listener:rM(this,t)};(r[n]||(r[n]=[])).push(a);if(this._svg){this._svg.addEventListener(n,a.listener)}}return this};nM.off=function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){if(this._svg){this._svg.removeEventListener(n,r[i].listener)}r.splice(i,1)}return this};function iM(e,t,n){var r="<"+e,i,a;if(t){for(i in t){a=t[i];if(a!=null){r+=" "+i+'="'+a+'"'}}}if(n)r+=" "+n;return r+">"}function aM(e){return"</"+e+">"}var oM={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};var uM={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"};var sM=Object.keys(uM);var lM=oM.xmlns;function fM(e){PT.call(this,e);this._dirtyID=1;this._dirty=[];this._svg=null;this._root=null;this._defs=null}var cM=Object(V["inherits"])(fM,PT);var dM=PT.prototype;cM.initialize=function(e,t,n,r){if(e){this._svg=ET(e,0,"svg",lM);this._svg.setAttribute("class","marks");AT(e,1);this._root=ET(this._svg,0,"g",lM);AT(this._svg,1)}this._defs={gradient:{},clipping:{}};this.background(this._bgcolor);return dM.initialize.call(this,e,t,n,r)};cM.background=function(e){if(arguments.length&&this._svg){this._svg.style.setProperty("background-color",e)}return dM.background.apply(this,arguments)};cM.resize=function(e,t,n,r){dM.resize.call(this,e,t,n,r);if(this._svg){this._svg.setAttribute("width",this._width*this._scale);this._svg.setAttribute("height",this._height*this._scale);this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height);this._root.setAttribute("transform","translate("+this._origin+")")}this._dirty=[];return this};cM.canvas=function(){return this._svg};cM.svg=function(){if(!this._svg)return null;var e={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var t in oM){e[t]=oM[t]}var n=!this._bgcolor?"":iM("rect",{width:this._width,height:this._height,style:"fill: "+this._bgcolor+";"})+aM("rect");return iM("svg",e)+n+this._svg.innerHTML+aM("svg")};cM._render=function(e){if(this._dirtyCheck()){if(this._dirtyAll)this._resetDefs();this.draw(this._root,e);AT(this._root,1)}this.updateDefs();this._dirty=[];++this._dirtyID;return this};cM.updateDefs=function(){var e=this._svg,t=this._defs,n=t.el,r=0,i;for(i in t.gradient){if(!n)t.el=n=ET(e,0,"defs",lM);hM(n,t.gradient[i],r++)}for(i in t.clipping){if(!n)t.el=n=ET(e,0,"defs",lM);pM(n,t.clipping[i],r++)}if(n){if(r===0){e.removeChild(n);t.el=null}else{AT(n,r)}}};function hM(e,t,n){var r,i,a;e=ET(e,n,"linearGradient",lM);e.setAttribute("id",t.id);e.setAttribute("x1",t.x1);e.setAttribute("x2",t.x2);e.setAttribute("y1",t.y1);e.setAttribute("y2",t.y2);for(r=0,i=t.stops.length;r<i;++r){a=ET(e,r,"stop",lM);a.setAttribute("offset",t.stops[r].offset);a.setAttribute("stop-color",t.stops[r].color)}AT(e,r)}function pM(e,t,n){var r;e=ET(e,n,"clipPath",lM);e.setAttribute("id",t.id);if(t.path){r=ET(e,0,"path",lM);r.setAttribute("d",t.path)}else{r=ET(e,0,"rect",lM);r.setAttribute("x",0);r.setAttribute("y",0);r.setAttribute("width",t.width);r.setAttribute("height",t.height)}}cM._resetDefs=function(){var e=this._defs;e.gradient={};e.clipping={}};cM.dirty=function(e){if(e.dirty!==this._dirtyID){e.dirty=this._dirtyID;this._dirty.push(e)}};cM.isDirty=function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID};cM._dirtyCheck=function(){this._dirtyAll=true;var e=this._dirty;if(!e.length)return true;var t=++this._dirtyID,n,r,i,a,o,u,s;for(o=0,u=e.length;o<u;++o){n=e[o];r=n.mark;if(r.marktype!==i){i=r.marktype;a=pT[i]}if(r.zdirty&&r.dirty!==t){this._dirtyAll=false;vM(n,t);r.items.forEach(function(e){e.dirty=t})}if(r.zdirty)continue;if(n.exit){if(a.nested&&r.items.length){s=r.items[0];if(s._svg)this._update(a,s._svg,s)}else if(n._svg){s=n._svg.parentNode;if(s)s.removeChild(n._svg)}n._svg=null;continue}n=a.nested?r.items[0]:n;if(n._update===t)continue;if(!n._svg||!n._svg.ownerSVGElement){this._dirtyAll=false;vM(n,t)}else{this._update(a,n._svg,n)}n._update=t}return!this._dirtyAll};function vM(e,t){for(;e&&e.dirty!==t;e=e.mark.group){e.dirty=t;if(e.mark&&e.mark.dirty!==t){e.mark.dirty=t}else return}}cM.draw=function(e,t,n){if(!this.isDirty(t))return t._svg;var r=this,i=this._svg,a=pT[t.marktype],o=t.interactive===false?"none":null,u=a.tag==="g",s=null,l=0,f;f=mM(t,e,n,"g",i);f.setAttribute("class",zT(t));if(!u){f.style.setProperty("pointer-events",o)}if(t.clip){f.setAttribute("clip-path",fz(r,t,t.group))}else{f.removeAttribute("clip-path")}function c(e){var t=r.isDirty(e),n=mM(e,f,s,a.tag,i);if(t){r._update(a,n,e);if(u)gM(r,n,e)}s=n;++l}if(a.nested){if(t.items.length)c(t.items[0])}else{HA(t,c)}AT(f,l);return f};function gM(e,t,n){t=t.lastChild;var r,i=0;HA(n,function(n){r=e.draw(t,n,r);++i});AT(t,1+i)}function mM(e,t,n,r,i){var a=e._svg,o;if(!a){o=t.ownerDocument;a=jT(o,r,lM);e._svg=a;if(e.mark){a.__data__=e;a.__values__={fill:"default"};if(r==="g"){var u=jT(o,"path",lM);u.setAttribute("class","background");a.appendChild(u);u.__data__=e;var s=jT(o,"g",lM);a.appendChild(s);s.__data__=e}}}if(a.ownerSVGElement!==i||yM(e)&&a.previousSibling!==n){t.insertBefore(a,n?n.nextSibling:t.firstChild)}return a}function yM(e){var t=e.mark||e.group;return t&&t.items.length>1}var bM=null,_M=null;var xM={group:function(e,t,n){_M=t.__values__;bM=t.childNodes[1];e.foreground(OM,n,this);bM=t.childNodes[0];e.background(OM,n,this);var r=n.mark.interactive===false?"none":null;if(r!==_M.events){bM.style.setProperty("pointer-events",r);_M.events=r}},text:function(e,t,n){var r;r=tT(n);if(r!==_M.text){t.textContent=r;_M.text=r}kM(t,"font-family",rT(n));kM(t,"font-size",Kz(n)+"px");kM(t,"font-style",n.fontStyle);kM(t,"font-variant",n.fontVariant);kM(t,"font-weight",n.fontWeight)}};function kM(e,t,n){if(n!==_M[t]){if(n==null){e.style.removeProperty(t)}else{e.style.setProperty(t,n+"")}_M[t]=n}}cM._update=function(e,t,n){bM=t;_M=t.__values__;e.attr(OM,n,this);var r=xM[e.type];if(r)r.call(this,e,t,n);this.style(bM,n)};function OM(e,t,n){if(t===_M[e])return;if(t!=null){if(n){bM.setAttributeNS(n,e,t)}else{bM.setAttribute(e,t)}}else{if(n){bM.removeAttributeNS(n,e)}else{bM.removeAttribute(e)}}_M[e]=t}cM.style=function(e,t){if(t==null)return;var n,r,i,a,o;for(n=0,r=sM.length;n<r;++n){i=sM[n];o=t[i];if(i==="font"){o=rT(t)}if(o===_M[i])continue;a=uM[i];if(o==null){if(a==="fill"){e.style.setProperty(a,"none")}else{e.style.removeProperty(a)}}else{if(o.id){this._defs.gradient[o.id]=o;o="url("+wM()+"#"+o.id+")"}e.style.setProperty(a,o+"")}_M[i]=o}};function wM(){var e;return typeof window==="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function jM(e){PT.call(this,e);this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""};this._defs={gradient:{},clipping:{}}}var SM=Object(V["inherits"])(jM,PT);var EM=PT.prototype;SM.resize=function(e,t,n,r){EM.resize.call(this,e,t,n,r);var i=this._origin,a=this._text;var o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var u in oM){o[u]=oM[u]}a.head=iM("svg",o);var s=this._bgcolor;if(s==="transparent"||s==="none")s=null;if(s){a.bg=iM("rect",{width:this._width,height:this._height,style:"fill: "+s+";"})+aM("rect")}else{a.bg=""}a.root=iM("g",{transform:"translate("+i+")"});a.foot=aM("g")+aM("svg");return this};SM.background=function(){var e=EM.background.apply(this,arguments);if(arguments.length&&this._text.head){this.resize(this._width,this._height,this._origin,this._scale)}return e};SM.svg=function(){var e=this._text;return e.head+e.bg+e.defs+e.root+e.body+e.foot};SM._render=function(e){this._text.body=this.mark(e);this._text.defs=this.buildDefs();return this};SM.buildDefs=function(){var e=this._defs,t="",n,r,i,a;for(r in e.gradient){i=e.gradient[r];a=i.stops;t+=iM("linearGradient",{id:r,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(n=0;n<a.length;++n){t+=iM("stop",{offset:a[n].offset,"stop-color":a[n].color})+aM("stop")}t+=aM("linearGradient")}for(r in e.clipping){i=e.clipping[r];t+=iM("clipPath",{id:r});if(i.path){t+=iM("path",{d:i.path})+aM("path")}else{t+=iM("rect",{x:0,y:0,width:i.width,height:i.height})+aM("rect")}t+=aM("clipPath")}return t.length>0?iM("defs")+t+aM("defs"):""};var AM;function zM(e,t,n,r){AM[r||e]=t}SM.attributes=function(e,t){AM={};e(zM,t,this);return AM};SM.href=function(e){var t=this,n=e.href,r;if(n){if(r=t._hrefs&&t._hrefs[n]){return r}else{t.sanitizeURL(n).then(function(e){e["xlink:href"]=e.href;e.href=null;(t._hrefs||(t._hrefs={}))[n]=e})}}return null};SM.mark=function(e){var t=this,n=pT[e.marktype],r=n.tag,i=this._defs,a="",o;if(r!=="g"&&e.interactive===false){o='style="pointer-events: none;"'}a+=iM("g",{class:zT(e),"clip-path":e.clip?fz(t,e,e.group):null},o);function u(u){var s=t.href(u);if(s)a+=iM("a",s);o=r!=="g"?TM(u,e,r,i):null;a+=iM(r,t.attributes(n.attr,u),o);if(r==="text"){a+=MM(tT(u))}else if(r==="g"){a+=iM("path",t.attributes(n.background,u),TM(u,e,"bgrect",i))+aM("path");a+=iM("g",t.attributes(n.foreground,u))+t.markGroup(u)+aM("g")}a+=aM(r);if(s)a+=aM("a")}if(n.nested){if(e.items&&e.items.length)u(e.items[0])}else{HA(e,u)}return a+aM("g")};SM.markGroup=function(e){var t=this,n="";HA(e,function(e){n+=t.mark(e)});return n};function TM(e,t,n,r){if(e==null)return"";var i,a,o,u,s,l="";if(n==="bgrect"&&t.interactive===false){l+="pointer-events: none; "}if(n==="text"){l+="font-family: "+rT(e)+"; ";l+="font-size: "+Kz(e)+"px; ";if(e.fontStyle)l+="font-style: "+e.fontStyle+"; ";if(e.fontVariant)l+="font-variant: "+e.fontVariant+"; ";if(e.fontWeight)l+="font-weight: "+e.fontWeight+"; "}for(i=0,a=sM.length;i<a;++i){o=sM[i];u=uM[o];s=e[o];if(s==null){if(u==="fill"){l+="fill: none; "}}else if(s==="transparent"&&(u==="fill"||u==="stroke")){l+=u+": none; "}else{if(s.id){r.gradient[s.id]=s;s="url(#"+s.id+")"}l+=u+": "+s+"; "}}return l?'style="'+l.trim()+'"':null}function MM(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var NM="canvas";var DM="png";var CM="svg";var PM="none";var RM={Canvas:NM,PNG:DM,SVG:CM,None:PM};var LM={};LM[NM]=LM[DM]={renderer:XT,headless:XT,handler:UT};LM[CM]={renderer:fM,headless:jM,handler:tM};LM[PM]={};function IM(e,t){e=String(e||"").toLowerCase();if(arguments.length>1){LM[e]=t;return this}else{return LM[e]}}var FM=new US;var qM=function(e){var t=e.clip;if(Object(V["isFunction"])(t)){t(CA(FM.clear()))}else if(t){FM.set(0,0,e.group.width,e.group.height)}else return;e.bounds.intersect(FM)};var UM=1e-9;function WM(e,t,n){return e===t?true:n==="path"?VM(e,t):e instanceof Date&&t instanceof Date?+e===+t:Object(V["isNumber"])(e)&&Object(V["isNumber"])(t)?Math.abs(e-t)<=UM:!e||!t||!Object(V["isObject"])(e)&&!Object(V["isObject"])(t)?e==t:e==null||t==null?false:HM(e,t)}function VM(e,t){return WM(zE(e),zE(t))}function HM(e,t){var n=Object.keys(e),r=Object.keys(t),i,a;if(n.length!==r.length)return false;n.sort();r.sort();for(a=n.length-1;a>=0;a--){if(n[a]!=r[a])return false}for(a=n.length-1;a>=0;a--){i=n[a];if(!WM(e[i],t[i],i))return false}return typeof e===typeof t}var BM=function(e,t,n,r,i){e=MS(e,(i||this).context);var a=HS(t,n),o=e.domain(),u=o[0],s=o[o.length-1],l=Object(ec["e"])(e,u,s);if(e.ticks){o=e.ticks(+r||15);if(u!==o[0])o.unshift(u);if(s!==o[o.length-1])o.push(s)}for(var f=0,c=o.length;f<c;++f){a.stop(l(o[f]),e(o[f]))}return a};function GM(e,t){return function(n,r,i){if(n){var a=MS(n,(i||this).context);return a&&a.path[e](r)}else{return t(r)}}}var $M=GM("area",qd["c"]);var YM=GM("bounds",qd["f"]);var XM=GM("centroid",qd["g"]);function JM(e,t,n){var r=MS(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}function QM(e){var t=null;return function(n){return n?LE(n,t=t||zE(e)):e}}function ZM(e){var t=this.context.data[e];return t?t.values.value:[]}function KM(e,t,n,r){if(t[0].type!==SS){Object(V["error"])("First argument to data functions must be a string literal.")}var i=t[0].value,a=TS+i;if(!r.hasOwnProperty(a)){r[a]=n.getData(i).tuplesRef()}}function eN(e,t,n){var r=this.context.data[e]["index:"+t],i=r?r.value.get(n):undefined;return i?i.count:i}function tN(e,t,n,r){if(t[0].type!==SS)Object(V["error"])("First argument to indata must be a string literal.");if(t[1].type!==SS)Object(V["error"])("Second argument to indata must be a string literal.");var i=t[0].value,a=t[1].value,o=AS+a;if(!r.hasOwnProperty(o)){r[o]=n.getData(i).indataRef(n,a)}}function nN(e,t){var n=this.context.dataflow,r=this.context.data[e],i=r.input;n.pulse(i,n.changeset().remove(V["truthy"]).insert(t));return 1}var rN={};function iN(e){return e.data}function aN(e,t){var n=ZM.call(t,e);return n.root&&n.root.lookup||rN}function oN(e,t,n){var r=aN(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(iN):undefined}function uN(e,t){var n=aN(e,this)[t];return n?n.ancestors().map(iN):undefined}var sN=function(e,t,n){if(e){var r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return n!==undefined?n:e};function lN(e,t){return e===t||e!==e&&t!==t?true:Object(V["isArray"])(e)&&Object(V["isArray"])(t)&&e.length===t.length?fN(e,t):false}function fN(e,t){for(var n=0,r=e.length;n<r;++n){if(!lN(e[n],t[n]))return false}return true}function cN(e){return function(t){for(var n in e){if(!lN(t[n],e[n]))return false}return true}}var dN=function(e,t,n,r,i,a){var o=this.context.dataflow,u=this.context.data[e],s=u.input,l=u.changes,f=o.stamp(),c,d;if(o._trigger===false||!(s.value.length||t||r)){return 0}if(!l||l.stamp<f){u.changes=l=o.changeset();l.stamp=f;o.runAfter(function(){u.modified=true;o.pulse(s,l).run()},true,1)}if(n){c=n===true?V["truthy"]:Object(V["isArray"])(n)||Y(n)?n:cN(n);l.remove(c)}if(t){l.insert(t)}if(r){c=cN(r);if(s.value.some(c)){l.remove(c)}else{l.insert(r)}}if(i){for(d in a){l.modify(i,d,a[d])}}return 1};var hN="bin_",pN="intersect",vN="union",gN="index:unit";function mN(e,t){var n=t.fields,r=t.values,i=t.getter||(t.getter=[]),a=n.length,o=0,u;for(;o<a;++o){i[o]=i[o]||Object(V["field"])(n[o]);u=i[o](e);if(Object(V["isDate"])(u))u=Object(V["toNumber"])(u);if(Object(V["isDate"])(r[o]))r[o]=Object(V["toNumber"])(r[o]);if(t[hN+n[o]]){if(Object(V["isDate"])(r[o][0]))r[o]=r[o].map(V["toNumber"]);if(!sS(u,r[o],true,false))return false}else if(u!==r[o]){return false}}return true}function yN(e,t){var n=t.intervals,r=n.length,i=0,a,o,u;for(;i<r;++i){o=n[i].extent;a=n[i].getter||(n[i].getter=Object(V["field"])(n[i].field));u=a(e);if(!o||o[0]===o[1])return false;if(Object(V["isDate"])(u))u=Object(V["toNumber"])(u);if(Object(V["isDate"])(o[0]))o=n[i].extent=o.map(V["toNumber"]);if(Object(V["isNumber"])(o[0])&&!sS(u,o))return false;else if(Object(V["isString"])(o[0])&&o.indexOf(u)<0)return false}return true}function bN(e,t,n,r){var i=this.context.data[e],a=i?i.values.value:[],o=i?i[gN]&&i[gN].value:undefined,u=n===pN,s=a.length,l=0,f,c,d,h,p;for(;l<s;++l){f=a[l];if(o&&u){c=c||{};d=c[h=f.unit]||0;if(d===-1)continue;p=r(t,f);c[h]=p?-1:++d;if(p&&o.size===1)return true;if(!p&&d===o.get(h).count)return false}else{p=r(t,f);if(u^p)return p}}return s&&u}function _N(e,t,n){return bN.call(this,e,t,n,mN)}function xN(e,t,n){return bN.call(this,e,t,n,yN)}function kN(e,t,n,r){if(t[0].type!==SS)Object(V["error"])("First argument to indata must be a string literal.");var i=t[0].value,a=t.length>=2&&t[t.length-1].value,o="unit",u=AS+o;if(a===pN&&!r.hasOwnProperty(u)){r[u]=n.getData(i).indataRef(n,o)}KM(e,t,n,r)}function ON(e,t,n,r){var i=this.context.data[e],a=i?i.values.value:[],o=i?i[gN]&&i[gN].value:undefined,u=a[0],s=0,l,f,c,d,h;if(!u)return undefined;for(l=t?u.encodings.length:u.fields.length;s<l;++s){if(t&&u.encodings[s]===t||n&&u.fields[s]===n){f=s;d=u[hN+u.fields[s]];break}}if(o&&o.size===1){r=vN}if(o&&r===pN){h=a.reduce(function(e,t){var n=e[t.unit]||(e[t.unit]=[]);n.push({unit:t.unit,value:t.values[f]});return e},{});c=Object.keys(h).map(function(e){return{unit:e,value:d?SN(h[e],vN):jN(h[e],vN)}})}else{c=a.map(function(e){return{unit:e.unit,value:e.values[f]}})}return d?SN(c,r):jN(c,r)}function wN(e,t,n,r){var i=this.context.data[e],a=i?i.values.value:[],o=a[0],u=0,s,l,f,c,d;if(!o)return undefined;for(s=o.intervals.length;u<s;++u){l=o.intervals[u];if(t&&l.encoding===t||n&&l.field===n){if(!l.extent)return undefined;f=u;d=l.extent.length>2;break}}c=a.reduce(function(e,t){var n=t.intervals[f].extent,r=d?n.map(function(e){return{unit:t.unit,value:e}}):{unit:t.unit,value:n};if(d){e.push.apply(e,r)}else{e.push(r)}return e},[]);return d?jN(c,r):SN(c,r)}function jN(e,t){var n={},r=0,i={},a=[],o=0,u=e.length,s,l,f,c;for(;o<u;++o){s=e[o];l=s.unit;c=s.value;if(!n[l])n[l]=++r;if(!(f=i[c])){i[c]=f={value:c,units:{},count:0}}if(!f.units[l])f.units[l]=++f.count}for(c in i){f=i[c];if(t===pN&&f.count!==r)continue;a.push(f.value)}return a.length?a:undefined}function SN(e,t){var n=t===pN?AN:EN,r=0,i=e.length,a,o,u,s;for(;r<i;++r){a=e[r].value;if(Object(V["isDate"])(a[0]))a=a.map(V["toNumber"]);u=a[0];s=a[1];if(u>s){s=a[0];u=a[1]}o=o?n(o,u,s):[u,s]}return o&&o.length&&+o[0]!==+o[1]?o:undefined}function EN(e,t,n){if(e[0]>t)e[0]=t;if(e[1]<n)e[1]=n;return e}function AN(e,t,n){if(n<e[0]||e[1]<t){return[]}else{if(e[0]<t)e[0]=t;if(e[1]>n)e[1]=n}return e}var zN={random:function(){return Object(rn["d"])()},isArray:V["isArray"],isBoolean:V["isBoolean"],isDate:V["isDate"],isNumber:V["isNumber"],isObject:V["isObject"],isRegExp:V["isRegExp"],isString:V["isString"],isTuple:Y,toBoolean:V["toBoolean"],toDate:V["toDate"],toNumber:V["toNumber"],toString:V["toString"],pad:V["pad"],peek:V["peek"],truncate:V["truncate"],rgb:$j["f"],lab:$j["e"],hcl:$j["c"],hsl:$j["d"],sequence:En["n"],format:Jj,utcFormat:Zj,utcParse:eS,timeFormat:Qj,timeParse:Kj,monthFormat:rS,monthAbbrevFormat:iS,dayFormat:aS,dayAbbrevFormat:oS,quarter:cS,utcquarter:dS,warn:pS,info:vS,debug:gS,extent:uS,inScope:mS,clampRange:lS,pinchDistance:yS,pinchAngle:bS,screen:xS,containerSize:OS,windowSize:kS,span:fS,merge:jS,flush:wS,bandspace:LS,inrange:sS,setdata:nN,pathShape:QM,panLinear:V["panLinear"],panLog:V["panLog"],panPow:V["panPow"],zoomLinear:V["zoomLinear"],zoomLog:V["zoomLog"],zoomPow:V["zoomPow"],encode:sN,modify:dN};var TN=["view","item","group","xy","x","y"],MN="event.vega.",NN="this.",DN={};function CN(e,t,n){if(arguments.length===1){return zN[e]}zN[e]=t;if(n)DN[e]=n;if(LN)LN.functions[e]=NN+e;return this}CN("bandwidth",RS,DS);CN("copy",IS,DS);CN("domain",PS,DS);CN("range",CS,DS);CN("invert",qS,DS);CN("scale",FS,DS);CN("gradient",BM,DS);CN("geoArea",$M,DS);CN("geoBounds",YM,DS);CN("geoCentroid",XM,DS);CN("geoShape",JM,DS);CN("indata",eN,tN);CN("data",ZM,KM);CN("vlSingle",_N,KM);CN("vlSingleDomain",ON,KM);CN("vlMulti",_N,kN);CN("vlMultiDomain",ON,kN);CN("vlInterval",xN,KM);CN("vlIntervalDomain",wN,KM);CN("treePath",oN,KM);CN("treeAncestors",uN,KM);function PN(e){var t=Object(Gj["c"])(e);TN.forEach(function(e){t[e]=MN+e});for(var n in zN){t[n]=NN+n}return t}var RN={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_["+Object(V["stringValue"])("$"+e)+"]"},functions:PN,constants:Gj["b"],visitors:DN};var LN=Object(Gj["a"])(RN);var IN="$";var FN=function(e,t,n){var r={},i,a;try{e=Object(V["isString"])(e)?e:Object(V["stringValue"])(e)+"";i=Object(Gj["d"])(e)}catch(t){Object(V["error"])("Expression parse error: "+e)}i.visit(function e(n){if(n.type!=="CallExpression")return;var i=n.callee.name,a=RN.visitors[i];if(a)a(i,n.arguments,t,r)});a=LN(i);a.globals.forEach(function(e){var n=IN+e;if(!r.hasOwnProperty(n)&&t.getSignal(e)){r[n]=t.signalRef(e)}});return{$expr:n?n+"return("+a.code+");":a.code,$fields:a.fields,$params:r}};function qN(e,t,n,r){this.id=-1;this.type=e;this.value=t;this.params=n;if(r)this.parent=r}function UN(e,t,n,r){return new qN(e,t,n,r)}function WN(e,t){return UN("operator",e,t)}function VN(e){var t={$ref:e.id};if(e.id<0)(e.refs=e.refs||[]).push(t);return t}var HN={$tupleid:1,toString:function(){return":_tupleid_:"}};function BN(e,t){return t?{$field:e,$name:t}:{$field:e}}var GN=BN("key");function $N(e,t){return{$compare:e,$order:t}}function YN(e,t){var n={$key:e};if(t)n.$flat=true;return n}var XN="ascending";var JN="descending";function QN(e){return!Object(V["isObject"])(e)?"":(e.order===JN?"-":"+")+ZN(e.op,e.field)}function ZN(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var KN="scope";var eD="view";function tD(e){return e&&e.signal}function nD(e){if(tD(e))return true;if(Object(V["isObject"])(e))for(var t in e){if(nD(e[t]))return true}return false}function rD(e,t){return e!=null?e:t}function iD(e){return e&&e.signal||e}var aD="timer";function oD(e,t){var n=e.merge?sD:e.stream?lD:e.type?fD:Object(V["error"])("Invalid stream specification: "+Object(V["stringValue"])(e));return n(e,t)}function uD(e){return e===KN?eD:e||eD}function sD(e,t){var n=e.merge.map(function(e){return oD(e,t)});var r=cD({merge:n},e,t);return t.addStream(r).id}function lD(e,t){var n=oD(e.stream,t),r=cD({stream:n},e,t);return t.addStream(r).id}function fD(e,t){var n,r;if(e.type===aD){n=t.event(aD,e.throttle);e={between:e.between,filter:e.filter}}else{n=t.event(uD(e.source),e.type)}r=cD({stream:n},e,t);return Object.keys(r).length===1?n:t.addStream(r).id}function cD(e,t,n){var r=t.between;if(r){if(r.length!==2){Object(V["error"])('Stream "between" parameter must have 2 entries: '+Object(V["stringValue"])(t))}e.between=[oD(r[0],n),oD(r[1],n)]}r=t.filter?Object(V["array"])(t.filter):[];if(t.marktype||t.markname||t.markrole){r.push(dD(t.marktype,t.markname,t.markrole))}if(t.source===KN){r.push("inScope(event.item)")}if(r.length){e.filter=FN("("+r.join(")&&(")+")").$expr}if((r=t.throttle)!=null){e.throttle=+r}if((r=t.debounce)!=null){e.debounce=+r}if(t.consume){e.consume=true}return e}function dD(e,t,n){var r="event.item";return r+(e&&e!=="*"?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}var hD=n("8Sdu");var pD="var datum=event.item&&event.item.datum;";var vD=function(e,t,n){var r=e.events,i=e.update,a=e.encode,o=[],u="",s;if(!r){Object(V["error"])("Signal update missing events specification.")}if(Object(V["isString"])(r)){r=Object(hD["selector"])(r,t.isSubscope()?KN:eD)}r=Object(V["array"])(r).filter(function(e){if(e.signal||e.scale){o.push(e);return 0}else{return 1}});if(r.length){o.push(r.length>1?{merge:r}:r[0])}if(a!=null){if(i)Object(V["error"])("Signal encode and update are mutually exclusive.");i="encode(item(),"+Object(V["stringValue"])(a)+")"}u=Object(V["isString"])(i)?FN(i,t,pD):i.expr!=null?FN(i.expr,t,pD):i.value!=null?i.value:i.signal!=null?{$expr:"_.value",$params:{value:t.signalRef(i.signal)}}:Object(V["error"])("Invalid signal update specification.");s={target:n,update:u};if(e.force){s.options={force:true}}o.forEach(function(e){t.addUpdate(Object(V["extend"])(gD(e,t),s))})};function gD(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):oD(e,t)}}var mD=function(e,t){var n=t.getSignal(e.name);if(e.update){var r=FN(e.update,t);n.update=r.$expr;n.params=r.$params}if(e.on){e.on.forEach(function(e){vD(e,t,n.id)})}};function yD(e){return function(t,n,r){return UN(e,n,t||undefined,r)}}var bD=yD("aggregate");var _D=yD("axisticks");var xD=yD("bound");var kD=yD("collect");var OD=yD("compare");var wD=yD("datajoin");var jD=yD("encode");var SD=yD("expression");var ED=yD("extent");var AD=yD("facet");var zD=yD("field");var TD=yD("key");var MD=yD("legendentries");var ND=yD("load");var DD=yD("mark");var CD=yD("multiextent");var PD=yD("multivalues");var RD=yD("overlap");var LD=yD("params");var ID=yD("prefacet");var FD=yD("projection");var qD=yD("proxy");var UD=yD("relay");var WD=yD("render");var VD=yD("scale");var HD=yD("sieve");var BD=yD("sortitems");var GD=yD("viewlayout");var $D=yD("values");var YD=0;var XD=["identity","ordinal","band","point","bin-linear","bin-ordinal","quantize","quantile","threshold","linear","pow","sqrt","log","sequential","time","utc"];var JD=Object(V["toSet"])(XD),QD=Object(V["toSet"])(XD.slice(4,9)),ZD=Object(V["toSet"])(XD.slice(9)),KD=Object(V["toSet"])(XD.slice(1,6));function eC(e){return KD.hasOwnProperty(e)}function tC(e){return QD.hasOwnProperty(e)}function nC(e){return ZD.hasOwnProperty(e)}function rC(e){return e==="quantile"}function iC(e,t){var n=e.type||"linear";if(!JD.hasOwnProperty(n)){Object(V["error"])("Unrecognized scale type: "+Object(V["stringValue"])(n))}t.addScale(e.name,{type:n,domain:undefined})}function aC(e,t){var n=t.getScale(e.name).params,r;n.domain=lC(e.domain,e,t);if(e.range!=null){n.range=_C(e,t,n)}if(e.interpolate!=null){bC(e.interpolate,n)}if(e.nice!=null){yC(e.nice,n)}for(r in e){if(n.hasOwnProperty(r)||r==="name")continue;n[r]=oC(e[r],t)}}function oC(e,t){return!Object(V["isObject"])(e)?e:e.signal?t.signalRef(e.signal):Object(V["error"])("Unsupported object: "+Object(V["stringValue"])(e))}function uC(e,t){return e.signal?t.signalRef(e.signal):e.map(function(e){return oC(e,t)})}function sC(e){Object(V["error"])("Can not find data set: "+Object(V["stringValue"])(e))}function lC(e,t,n){if(!e){if(t.domainMin!=null||t.domainMax!=null){Object(V["error"])("No scale domain defined for domainMin/domainMax to override.")}return}return e.signal?n.signalRef(e.signal):(Object(V["isArray"])(e)?fC:e.fields?dC:cC)(e,t,n)}function fC(e,t,n){return e.map(function(e){return oC(e,n)})}function cC(e,t,n){var r=n.getData(e.data);if(!r)sC(e.data);return eC(t.type)?r.valuesRef(n,e.field,vC(e.sort,false)):rC(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function dC(e,t,n){var r=e.data,i=e.fields.reduce(function(e,t){t=Object(V["isString"])(t)?{data:r,field:t}:Object(V["isArray"])(t)||t.signal?hC(t,n):t;e.push(t);return e},[]);return(eC(t.type)?pC:rC(t.type)?gC:mC)(e,n,i)}function hC(e,t){var n="_:vega:_"+YD++,r=kD({});if(Object(V["isArray"])(e)){r.value={$ingest:e}}else if(e.signal){var i="setdata("+Object(V["stringValue"])(n)+","+e.signal+")";r.params.input=t.signalRef(i)}t.addDataPipeline(n,[r,HD({})]);return{data:n,field:"data"}}function pC(e,t,n){var r,i,a,o;r=n.map(function(e){var n=t.getData(e.data);if(!n)sC(e.data);return n.countsRef(t,e.field)});i=t.add(bD({groupby:GN,ops:["sum"],fields:[t.fieldRef("count")],as:["count"],pulse:r}));a=t.add(kD({pulse:VN(i)}));o=t.add($D({field:GN,sort:t.sortRef(vC(e.sort,true)),pulse:VN(a)}));return VN(o)}function vC(e,t){if(e){if(!e.field&&!e.op){if(Object(V["isObject"])(e))e.field="key";else e={field:"key"}}else if(!e.field&&e.op!=="count"){Object(V["error"])("No field provided for sort aggregate op: "+e.op)}else if(t&&e.field){Object(V["error"])("Multiple domain scales can not sort by field.")}else if(t&&e.op&&e.op!=="count"){Object(V["error"])("Multiple domain scales support op count only.")}}return e}function gC(e,t,n){var r=n.map(function(e){var n=t.getData(e.data);if(!n)sC(e.data);return n.domainRef(t,e.field)});return VN(t.add(PD({values:r})))}function mC(e,t,n){var r=n.map(function(e){var n=t.getData(e.data);if(!n)sC(e.data);return n.extentRef(t,e.field)});return VN(t.add(CD({extents:r})))}function yC(e,t){t.nice=Object(V["isObject"])(e)?{interval:oC(e.interval),step:oC(e.step)}:oC(e)}function bC(e,t){t.interpolate=oC(e.type||e);if(e.gamma!=null){t.interpolateGamma=oC(e.gamma)}}function _C(e,t,n){var r=e.range,i=t.config.range;if(r.signal){return t.signalRef(r.signal)}else if(Object(V["isString"])(r)){if(i&&i.hasOwnProperty(r)){e=Object(V["extend"])({},e,{range:i[r]});return _C(e,t,n)}else if(r==="width"){r=[0,{signal:"width"}]}else if(r==="height"){r=eC(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]}else{Object(V["error"])("Unrecognized scale range value: "+Object(V["stringValue"])(r))}}else if(r.scheme){n.scheme=oC(r.scheme,t);if(r.extent)n.schemeExtent=uC(r.extent,t);if(r.count)n.schemeCount=oC(r.count,t);return}else if(r.step){n.rangeStep=oC(r.step,t);return}else if(eC(e.type)&&!Object(V["isArray"])(r)){return lC(r,e,t)}else if(!Object(V["isArray"])(r)){Object(V["error"])("Unsupported range type: "+Object(V["stringValue"])(r))}return r.map(function(e){return oC(e,t)})}var xC=function(e,t){var n={};for(var r in e){if(r==="name")continue;n[r]=kC(e[r],r,t)}t.addProjection(e.name,n)};function kC(e,t,n){return Object(V["isArray"])(e)?e.map(function(e){return kC(e,t,n)}):!Object(V["isObject"])(e)?e:e.signal?n.signalRef(e.signal):t==="fit"?e:Object(V["error"])("Unsupported parameter object: "+Object(V["stringValue"])(e))}var OC="top";var wC="left";var jC="right";var SC="bottom";var EC="center";var AC="vertical";var zC="start";var TC="middle";var MC="end";var NC="index";var DC="label";var CC="offset";var PC="perc";var RC="perc2";var LC="size";var IC="value";var FC="guide-label";var qC="guide-title";var UC="group-title";var WC="symbol";var VC="gradient";var HC="discrete";var BC=["size","shape","fill","stroke","strokeDash","opacity"];var GC={name:1,interactive:1};var $C=Object(V["toSet"])(["rule"]),YC=Object(V["toSet"])(["group","image","rect"]);var XC=function(e,t){var n="";if($C[t])return n;if(e.x2){if(e.x){if(YC[t]){n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"}n+="o.width=o.x2-o.x;"}else{n+="o.x=o.x2-(o.width||0);"}}if(e.xc){n+="o.x=o.xc-(o.width||0)/2;"}if(e.y2){if(e.y){if(YC[t]){n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"}n+="o.height=o.y2-o.y;"}else{n+="o.y=o.y2-(o.height||0);"}}if(e.yc){n+="o.y=o.yc-(o.height||0)/2;"}return n};var JC=function(e,t,n,r){function i(e,i,a,o){var u=aP(null,i,t,n,r),s=aP(null,a,t,n,r),l=aP(null,o,t,n,r);return"this."+e+"("+[u,s,l].join(",")+").toString()"}return e.c?i("hcl",e.h,e.c,e.l):e.h||e.s?i("hsl",e.h,e.s,e.l):e.l||e.a?i("lab",e.l,e.a,e.b):e.r||e.g||e.b?i("rgb",e.r,e.g,e.b):null};var QC=function(e,t,n,r){var i=FN(e,t);i.$fields.forEach(function(e){r[e]=1});Object(V["extend"])(n,i.$params);return i.$expr};var ZC=function(e,t,n,r){return KC(Object(V["isObject"])(e)?e:{datum:e},t,n,r)};function KC(e,t,n,r){var i,a,o;if(e.signal){i="datum";o=QC(e.signal,t,n,r)}else if(e.group||e.parent){a=Math.max(1,e.level||1);i="item";while(a-- >0){i+=".mark.group"}if(e.parent){o=e.parent;i+=".datum"}else{o=e.group}}else if(e.datum){i="datum";o=e.datum}else{Object(V["error"])("Invalid field reference: "+Object(V["stringValue"])(e))}if(!e.signal){if(Object(V["isString"])(o)){r[o]=1;o=Object(V["splitAccessPath"])(o).map(V["stringValue"]).join("][")}else{o=KC(o,t,n,r)}}return i+"["+o+"]"}var eP=function(e,t,n,r,i){var a=nP(e.scale,n,r,i),o,u,s;if(e.range!=null){o=+e.range;u=a+".range()";t=o===0?u+"[0]":"($="+u+","+(o===1?"$[$.length-1]":"$[0]+"+o+"*($[$.length-1]-$[0])")+")"}else{if(t!==undefined)t=a+"("+t+")";if(e.band&&(s=tP(e.scale,n))){u=a+".bandwidth";o=+e.band;o=u+"()"+(o===1?"":"*"+o);if(s<0)o="("+u+"?"+o+":0)";t=(t?t+"+":"")+o;if(e.extra){t="(datum.extra?"+a+"(datum.extra.value):"+t+")"}}if(t==null)t="0"}return t};function tP(e,t){if(!Object(V["isString"])(e))return-1;var n=t.scaleType(e);return n==="band"||n==="point"?1:0}function nP(e,t,n,r){var i;if(Object(V["isString"])(e)){i=zS+e;if(!n.hasOwnProperty(i)){n[i]=t.scaleRef(e)}i=Object(V["stringValue"])(i)}else{for(i in t.scales){n[zS+i]=t.scaleRef(i)}i=Object(V["stringValue"])(zS)+"+"+(e.signal?"("+QC(e.signal,t,n,r)+")":ZC(e,t,n,r))}return"_["+i+"]"}var rP=function(e,t,n,r){return"this.gradient("+nP(e.gradient,t,n,r)+","+Object(V["stringValue"])(e.start)+","+Object(V["stringValue"])(e.stop)+","+Object(V["stringValue"])(e.count)+")"};var iP=function(e,t,n,r){return Object(V["isObject"])(e)?"("+aP(null,e,t,n,r)+")":e};var aP=function(e,t,n,r,i){if(t.gradient!=null){return rP(t,n,r,i)}var a=t.signal?QC(t.signal,n,r,i):t.color?JC(t.color,n,r,i):t.field!=null?ZC(t.field,n,r,i):t.value!==undefined?Object(V["stringValue"])(t.value):undefined;if(t.scale!=null){a=eP(t,a,n,r,i)}if(a===undefined){a=null}if(t.exponent!=null){a="Math.pow("+a+","+iP(t.exponent,n,r,i)+")"}if(t.mult!=null){a+="*"+iP(t.mult,n,r,i)}if(t.offset!=null){a+="+"+iP(t.offset,n,r,i)}if(t.round){a="Math.round("+a+")"}return a};var oP=function(e,t,n){return e+"["+Object(V["stringValue"])(t)+"]="+n+";"};var uP=function(e,t,n,r,i){var a="";t.forEach(function(t){var o=aP(e,t,n,r,i);a+=t.test?QC(t.test,n,r,i)+"?"+o+":":o});if(Object(V["peek"])(a)===":"){a+="null"}return oP("o",e,a)};function sP(e,t,n,r){var i={},a="var o=item,datum=o.datum,$;",o,u,s;for(o in e){u=e[o];if(Object(V["isArray"])(u)){a+=uP(o,u,r,n,i)}else{s=aP(o,u,r,n,i);a+=oP("o",o,s)}}a+=XC(e,t);a+="return 1;";return{$expr:a,$fields:Object.keys(i),$output:Object.keys(e)}}var lP="mark";var fP="frame";var cP="scope";var dP="axis";var hP="axis-domain";var pP="axis-grid";var vP="axis-label";var gP="axis-tick";var mP="axis-title";var yP="legend";var bP="legend-band";var _P="legend-entry";var xP="legend-gradient";var kP="legend-label";var OP="legend-symbol";var wP="legend-title";var jP="title";function SP(e){return Object(V["isObject"])(e)?Object(V["extend"])({},e):{value:e}}function EP(e,t,n,r){if(n!=null){if(Object(V["isObject"])(n)&&!Object(V["isArray"])(n)){e.update[t]=n}else{e[r||"enter"][t]={value:n}}return 1}else{return 0}}function AP(e,t,n){for(var r in t){if(n&&n.hasOwnProperty(r))continue;e[r]=Object(V["extend"])(e[r]||{},t[r])}return e}function zP(e,t,n,r,i,a){var o,u;a=a||{};a.encoders={$encode:o={}};e=TP(e,t,n,r,i.config);for(u in e){o[u]=sP(e[u],t,a,i)}return a}function TP(e,t,n,r,i){var a={},o,u,s;if(n=="legend"||String(n).indexOf("axis")===0){n=null}s=n===fP?i.group:n===lP?Object(V["extend"])({},i.mark,i[t]):null;for(o in s){u=NP(o,e)||(o==="fill"||o==="stroke")&&(NP("fill",e)||NP("stroke",e));if(!u)a[o]=MP(s[o])}Object(V["array"])(r).forEach(function(t){var n=i.style&&i.style[t];for(var r in n){if(!NP(r,e)){a[r]=MP(n[r])}}});e=Object(V["extend"])({},e);e.enter=Object(V["extend"])(a,e.enter);return e}function MP(e){return e&&e.signal?{signal:e.signal}:{value:e}}function NP(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}var DP=function(e,t,n,r,i,a,o){return{type:e,name:o?o.name:undefined,role:t,style:o&&o.style||n,key:r,from:i,interactive:!!(o&&o.interactive),encode:AP(a,o,GC)}};function CP(e,t,n){return rD(t[e],n[e])}function PP(e,t){return rD(e.direction,t)===AC}function RP(e,t){return rD(e.gradientLength,t.gradientLength||t.gradientWidth)}function LP(e,t){return rD(e.gradientThickness,t.gradientThickness||t.gradientHeight)}function IP(e,t){return rD(e.columns,rD(t.columns,+PP(e,t.symbolDirection)))}function FP(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function qP(e,t,n){var r=t.config.style[n];return r&&r[e]}var UP="group";var WP="rect";var VP="rule";var HP="symbol";var BP="text";var GP=function(e,t,n,r){var i={value:0},a=PP(e,n.gradientDirection),o=LP(e,n),u=RP(e,n),s,l,f,c,d,h;if(a){f=[0,1];c=[0,0];d=o;h=u}else{f=[0,0];c=[1,0];d=u;h=o}s={enter:l={opacity:i,x:i,y:i,width:SP(d),height:SP(h)},update:Object(V["extend"])({},l,{opacity:{value:1},fill:{gradient:t,start:f,stop:c}}),exit:{opacity:i}};EP(s,"stroke",CP("gradientStrokeColor",e,n));EP(s,"strokeWidth",CP("gradientStrokeWidth",e,n));EP(s,"opacity",CP("gradientOpacity",e,n),"update");return DP(WP,xP,null,undefined,undefined,s,r)};var $P=function(e,t,n,r,i){var a={value:0},o=PP(e,n.gradientDirection),u=LP(e,n),s=RP(e,n),l,f,c,d,h,p,v="";o?(c="y",h="y2",d="x",p="width",v="1-"):(c="x",h="x2",d="y",p="height");f={opacity:a,fill:{scale:t,field:IC}};f[c]={signal:v+"datum."+PC,mult:s};f[d]=a;f[h]={signal:v+"datum."+RC,mult:s};f[p]=SP(u);l={enter:f,update:Object(V["extend"])({},f,{opacity:{value:1}}),exit:{opacity:a}};EP(l,"stroke",CP("gradientStrokeColor",e,n));EP(l,"strokeWidth",CP("gradientStrokeWidth",e,n));EP(l,"opacity",CP("gradientOpacity",e,n),"update");return DP(WP,bP,null,IC,i,l,r)};var YP="datum."+PC+'<=0?"left"'+":datum."+PC+'>=1?"right":"center"';var XP="datum."+PC+'<=0?"bottom"'+":datum."+PC+'>=1?"top":"middle"';var JP=function(e,t,n,r){var i={value:0},a=PP(e,t.gradientDirection),o=SP(LP(e,t)),u=RP(e,t),s=CP("labelOverlap",e,t),l,f,c,d,h,p="";l={enter:f={opacity:i},update:c={opacity:{value:1},text:{field:DC}},exit:{opacity:i}};EP(l,"fill",CP("labelColor",e,t));EP(l,"font",CP("labelFont",e,t));EP(l,"fontSize",CP("labelFontSize",e,t));EP(l,"fontWeight",CP("labelFontWeight",e,t));EP(l,"fillOpacity",CP("labelOpacity",e,t));EP(l,"limit",rD(e.labelLimit,t.gradientLabelLimit));if(a){f.align={value:"left"};f.baseline=c.baseline={signal:XP};d="y";h="x";p="1-"}else{f.align=c.align={signal:YP};f.baseline={value:"top"};d="x";h="y"}f[d]=c[d]={signal:p+"datum."+PC,mult:u};f[h]=c[h]=o;o.offset=rD(e.labelOffset,t.gradientLabelOffset)||0;e=DP(BP,kP,FC,IC,r,l,n);if(s)e.overlap={method:s,order:"datum."+NC};return e};var QP=function(e,t,n,r,i,a,o,u){return{type:UP,name:n,role:e,style:t,from:r,interactive:i||false,encode:a,marks:o,layout:u}};var ZP={value:0};var KP=function(e,t,n,r,i){var a=n.entries,o=!!(a&&a.interactive),u=a?a.name:undefined,s=CP("clipHeight",e,t),l=CP("symbolOffset",e,t),f={data:"value"},c={},d=i+"?"+"datum."+CC+":"+"datum."+LC,h=s?SP(s):{field:LC},p="datum."+NC,v="max(1,"+i+")",g,m,y,b,_,x,k;h.mult=.5;c={enter:g={opacity:ZP,x:{signal:d,mult:.5,offset:l},y:h},update:m={opacity:{value:1},x:g.x,y:g.y},exit:{opacity:ZP}};if(!e.fill){EP(c,"fill",t.symbolBaseFillColor);EP(c,"stroke",t.symbolBaseStrokeColor)}EP(c,"shape",CP("symbolType",e,t));EP(c,"size",CP("symbolSize",e,t));EP(c,"strokeWidth",CP("symbolStrokeWidth",e,t));EP(c,"fill",CP("symbolFillColor",e,t));EP(c,"stroke",CP("symbolStrokeColor",e,t));EP(c,"opacity",CP("symbolOpacity",e,t),"update");BC.forEach(function(t){if(e[t]){m[t]=g[t]={scale:e[t],field:IC}}});b=DP(HP,OP,null,IC,f,c,n.symbols);if(s)b.clip=true;y=SP(l);y.offset=CP("labelOffset",e,t);c={enter:g={opacity:ZP,x:{signal:d,offset:y},y:h},update:m={opacity:{value:1},text:{field:DC},x:g.x,y:g.y},exit:{opacity:ZP}};EP(c,"align",CP("labelAlign",e,t));EP(c,"baseline",CP("labelBaseline",e,t));EP(c,"fill",CP("labelColor",e,t));EP(c,"font",CP("labelFont",e,t));EP(c,"fontSize",CP("labelFontSize",e,t));EP(c,"fontWeight",CP("labelFontWeight",e,t));EP(c,"limit",CP("labelLimit",e,t));EP(c,"fillOpacity",CP("labelOpacity",e,t));_=DP(BP,kP,FC,IC,f,c,n.labels);c={enter:{noBound:{value:true},width:ZP,height:s?SP(s):ZP,opacity:ZP},exit:{opacity:ZP},update:m={opacity:{value:1},row:{signal:null},column:{signal:null}}};if(PP(e,t.symbolDirection)){x="ceil(item.mark.items.length/"+v+")";m.row.signal=p+"%"+x;m.column.signal="floor("+p+"/"+x+")";k={field:["row",p]}}else{m.row.signal="floor("+p+"/"+v+")";m.column.signal=p+"%"+v;k={field:p}}m.column.signal=i+"?"+m.column.signal+":"+p;r={facet:{data:r,name:"value",groupby:NC}};e=QP(cP,null,u,r,o,AP(c,a,GC),[b,_]);e.sort=k;return e};function eR(e,t){return{align:CP("gridAlign",e,t),center:{row:true,column:false},columns:IP(e,t),padding:{row:CP("rowPadding",e,t),column:CP("columnPadding",e,t)}}}var tR=function(e,t,n,r){var i={value:0},a,o;a={enter:o={opacity:i,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},update:{opacity:{value:1},text:SP(e.title),x:o.x,y:o.y},exit:{opacity:i}};EP(a,"align",CP("titleAlign",e,t));EP(a,"baseline",CP("titleBaseline",e,t));EP(a,"fill",CP("titleColor",e,t));EP(a,"font",CP("titleFont",e,t));EP(a,"fontSize",CP("titleFontSize",e,t));EP(a,"fontWeight",CP("titleFontWeight",e,t));EP(a,"limit",CP("titleLimit",e,t));EP(a,"fillOpacity",CP("titleOpacity",e,t));return DP(BP,wP,qC,null,r,a,n)};var nR=function(e,t){var n;if(Object(V["isObject"])(e)){if(e.signal){n=e.signal}else if(e.path){n="pathShape("+rR(e.path)+")"}else if(e.sphere){n="geoShape("+rR(e.sphere)+', {type: "Sphere"})'}}return n?t.signalRef(n):!!e};function rR(e){return Object(V["isObject"])(e)&&e.signal?e.signal:Object(V["stringValue"])(e)}var iR=function(e){var t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")?t:e.type===UP?cP:t||lP};var aR=function(e){return{marktype:e.type,name:e.name||undefined,role:e.role||iR(e),zindex:+e.zindex||undefined}};var oR=function(e,t){return e&&e.signal?t.signalRef(e.signal):e===false?false:true};var uR=function(e,t){var n=Bt(e.type);if(!n)Object(V["error"])("Unrecognized transform type: "+Object(V["stringValue"])(e.type));var r=UN(n.type.toLowerCase(),null,sR(n,e,t));if(e.signal)t.addSignal(e.signal,t.proxy(r));r.metadata=n.metadata||{};return r};function sR(e,t,n){var r={},i,a,o;for(a=0,o=e.params.length;a<o;++a){i=e.params[a];r[i.name]=lR(i,t,n)}return r}function lR(e,t,n){var r=e.type,i=t[e.name];if(r==="index"){return cR(e,t,n)}else if(i===undefined){if(e.required){Object(V["error"])("Missing required "+Object(V["stringValue"])(t.type)+" parameter: "+Object(V["stringValue"])(e.name))}return}else if(r==="param"){return dR(e,t,n)}else if(r==="projection"){return n.projectionRef(t[e.name])}return e.array&&!tD(i)?i.map(function(t){return fR(e,t,n)}):fR(e,i,n)}function fR(e,t,n){var r=e.type;if(tD(t)){return mR(r)?Object(V["error"])("Expression references can not be signals."):yR(r)?n.fieldRef(t):bR(r)?n.compareRef(t):n.signalRef(t.signal)}else{var i=e.expr||yR(r);return i&&pR(t)?n.exprRef(t.expr,t.as):i&&vR(t)?BN(t.field,t.as):mR(r)?FN(t,n):gR(r)?VN(n.getData(t).values):yR(r)?BN(t):bR(r)?n.compareRef(t):t}}function cR(e,t,n){if(!Object(V["isString"])(t.from)){Object(V["error"])('Lookup "from" parameter must be a string literal.')}return n.getData(t.from).lookupRef(n,t.key)}function dR(e,t,n){var r=t[e.name];if(e.array){if(!Object(V["isArray"])(r)){Object(V["error"])("Expected an array of sub-parameters. Instead: "+Object(V["stringValue"])(r))}return r.map(function(t){return hR(e,t,n)})}else{return hR(e,r,n)}}function hR(e,t,n){var r,i,a,o,u;for(o=0,u=e.params.length;o<u;++o){i=e.params[o];for(a in i.key){if(i.key[a]!==t[a]){i=null;break}}if(i)break}if(!i)Object(V["error"])("Unsupported parameter: "+Object(V["stringValue"])(t));r=Object(V["extend"])(sR(i,t,n),i.key);return VN(n.add(LD(r)))}function pR(e){return e&&e.expr}function vR(e){return e&&e.field}function gR(e){return e==="data"}function mR(e){return e==="expr"}function yR(e){return e==="field"}function bR(e){return e==="compare"}var _R=function(e,t,n){var r,i,a,o,u;if(!e){o=VN(n.add(kD(null,[{}])))}else if(r=e.facet){if(!t)Object(V["error"])("Only group marks can be faceted.");if(r.field!=null){o=u=xR(r,n)}else{if(!e.data){a=uR(Object(V["extend"])({type:"aggregate",groupby:Object(V["array"])(r.groupby)},r.aggregate),n);a.params.key=n.keyRef(r.groupby);a.params.pulse=xR(r,n);o=u=VN(n.add(a))}else{u=VN(n.getData(e.data).aggregate)}i=n.keyRef(r.groupby,true)}}if(!o){o=xR(e,n)}return{key:i,pulse:o,parent:u}};function xR(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:VN(t.getData(e.data).output)}function kR(e,t,n,r,i){this.scope=e;this.input=t;this.output=n;this.values=r;this.aggregate=i;this.index={}}kR.fromEntries=function(e,t){var n=t.length,r=1,i=t[0],a=t[n-1],o=t[n-2],u=null;e.add(t[0]);for(;r<n;++r){t[r].params.pulse=VN(t[r-1]);e.add(t[r]);if(t[r].type==="aggregate")u=t[r]}return new kR(e,i,o,a,u)};var OR=kR.prototype;OR.countsRef=function(e,t,n){var r=this,i=r.counts||(r.counts={}),a=wR(t),o,u,s;if(a!=null){e=r.scope;o=i[a]}if(!o){s={groupby:e.fieldRef(t,"key"),pulse:VN(r.output)};if(n&&n.field)jR(e,s,n);u=e.add(bD(s));o=e.add(kD({pulse:VN(u)}));o={agg:u,ref:VN(o)};if(a!=null)i[a]=o}else if(n&&n.field){jR(e,o.agg.params,n)}return o.ref};function wR(e){return Object(V["isString"])(e)?e:null}function jR(e,t,n){var r=ZN(n.op,n.field),i;if(t.ops){for(var a=0,o=t.as.length;a<o;++a){if(t.as[a]===r)return}}else{t.ops=["count"];t.fields=[null];t.as=["count"]}if(n.op){t.ops.push((i=n.op.signal)?e.signalRef(i):n.op);t.fields.push(e.fieldRef(n.field));t.as.push(r)}}function SR(e,t,n,r,i,a,o){var u=t[n]||(t[n]={}),s=QN(a),l=wR(i),f,c;if(l!=null){e=t.scope;l=l+(s?"|"+s:"");f=u[l]}if(!f){var d=a?{field:GN,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:VN(t.output)};if(s)d.sort=e.sortRef(a);c=e.add(UN(r,undefined,d));if(o)t.index[i]=c;f=VN(c);if(l!=null)u[l]=f}return f}OR.tuplesRef=function(){return VN(this.values)};OR.extentRef=function(e,t){return SR(e,this,"extent","extent",t,false)};OR.domainRef=function(e,t){return SR(e,this,"domain","values",t,false)};OR.valuesRef=function(e,t,n){return SR(e,this,"vals","values",t,n||true)};OR.lookupRef=function(e,t){return SR(e,this,"lookup","tupleindex",t,false)};OR.indataRef=function(e,t){return SR(e,this,"indata","tupleindex",t,true,true)};var ER=function(e,t,n){var r=e.from.facet,i=r.name,a=xR(r,t),o,u,s,l;if(!r.name){Object(V["error"])("Facet must have a name: "+Object(V["stringValue"])(r))}if(!r.data){Object(V["error"])("Facet must reference a data set: "+Object(V["stringValue"])(r))}if(r.field){l=t.add(ID({field:t.fieldRef(r.field),pulse:a}))}else if(r.groupby){l=t.add(AD({key:t.keyRef(r.groupby),group:VN(t.proxy(n.parent)),pulse:a}))}else{Object(V["error"])("Facet must specify groupby or field: "+Object(V["stringValue"])(r))}o=t.fork();u=o.add(kD());s=o.add(HD({pulse:VN(u)}));o.addData(i,new kR(o,u,u,s));o.addSignal("parent",null);l.params.subflow={$subflow:nL(e,o).toRuntime()}};var AR=function(e,t,n){var r=t.add(ID({pulse:n.pulse})),i=t.fork();i.add(HD());i.addSignal("parent",null);r.params.subflow={$subflow:nL(e,i).toRuntime()}};var zR=function(e,t,n){var r=e.remove,i=e.insert,a=e.toggle,o=e.modify,u=e.values,s=t.add(WN()),l,f;l="if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,u].map(function(e){return e==null?"null":e}).join(",")+"),0)";f=FN(l,t);s.update=f.$expr;s.params=f.$params};var TR=function(e,t){var n=iR(e),r=e.type===UP,i=e.from&&e.from.facet,a=e.layout||n===cP||n===fP,o=n===lP||a||i,u=e.overlap,s,l,f,c,d,h,p,v,g,m,y,b,_;f=_R(e.from,r,t);l=t.add(wD({key:f.key||(e.key?BN(e.key):undefined),pulse:f.pulse,clean:!r}));g=VN(l);l=c=t.add(kD({pulse:g}));l=t.add(DD({markdef:aR(e),interactive:oR(e.interactive,t),clip:nR(e.clip,t),context:{$context:true},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:VN(l)}));m=VN(l);l=t.add(jD(zP(e.encode,e.type,n,e.style,t,{pulse:m})));l.params.parent=t.encode();if(e.transform){e.transform.forEach(function(e){var n=uR(e,t);if(n.metadata.generates||n.metadata.changes){Object(V["error"])("Mark transforms should not generate new data.")}n.params.pulse=VN(l);t.add(l=n)})}if(e.sort){l=t.add(BD({sort:t.compareRef(e.sort,true),pulse:VN(l)}))}y=VN(l);if(i||a){a=t.add(GD({layout:t.objectProperty(e.layout),legendMargin:t.config.legendMargin,mark:m,pulse:y}));b=VN(a)}d=t.add(xD({mark:m,pulse:b||y}));_=VN(d);if(r){if(o){s=t.operators;s.pop();if(a)s.pop()}t.pushState(y,b||_,g);i?ER(e,t,f):o?AR(e,t,f):nL(e,t);t.popState();if(o){if(a)s.push(a);s.push(d)}}if(u){_=MR(u,_,t)}h=t.add(WD({pulse:_}));p=t.add(HD({pulse:VN(h)},undefined,t.parent()));if(e.name!=null){v=e.name;t.addData(v,new kR(t,c,h,p));if(e.on)e.on.forEach(function(e){if(e.insert||e.remove||e.toggle){Object(V["error"])("Marks only support modify triggers.")}zR(e,t,v)})}};function MR(e,t,n){var r=e.method,i=e.bound,a;var o={method:tD(r)?n.signalRef(r.signal):r,pulse:t};if(e.order){o.sort=n.compareRef({field:e.order})}if(i){a=i.tolerance;o.boundTolerance=tD(a)?n.signalRef(a.signal):+a;o.boundScale=n.scaleRef(i.scale);o.boundOrient=i.orient}return VN(n.add(RD(o)))}var NR=function(e,t){var n=t.config.legend,r=e.encode||{},i=r.legend||{},a=i.name||undefined,o=i.interactive,u=i.style,s,l,f,c,d,h,p,v,g;var m=BC.reduce(function(t,n){return t||e[n]},0);if(!m)Object(V["error"])("Missing valid scale for legend.");d=DR(e,t.scaleType(m));h={orient:CP("orient",e,n),title:e.title!=null,type:d};p=VN(t.add(kD(null,[h])));i=AP(PR(e,n),i,GC);s={enter:{x:{value:0},y:{value:0}}};v=VN(t.add(MD(f={type:d,scale:t.scaleRef(m),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),formatSpecifier:t.property(e.format)})));if(d===VC){c=[GP(e,m,n,r.gradient),JP(e,n,r.labels,v)];f.count=f.count||t.signalRef("max(2,2*floor(("+iD(RP(e,n))+")/100))")}else if(d===HC){c=[$P(e,m,n,r.gradient,v),JP(e,n,r.labels,v)]}else{l=eR(e,n);c=[KP(e,n,r,v,iD(l.columns))];f.size=RR(e,t,c[0].marks)}c=[QP(_P,null,null,p,o,s,c,l)];if(h.title){c.push(tR(e,n,r.title,p))}g=QP(yP,u,a,p,o,i,c);if(e.zindex)g.zindex=e.zindex;return TR(g,t)};function DR(e,t){var n=e.type||WC;if(!e.type&&CR(e)===1&&(e.fill||e.stroke)){n=nC(t)?VC:tC(t)?HC:WC}return n!==VC?n:tC(t)?HC:VC}function CR(e){return BC.reduce(function(t,n){return t+(e[n]?1:0)},0)}function PR(e,t){var n={enter:{},update:{}};EP(n,"offset",CP("offset",e,t));EP(n,"padding",CP("padding",e,t));EP(n,"titlePadding",CP("titlePadding",e,t));EP(n,"fill",CP("fillColor",e,t));EP(n,"stroke",CP("strokeColor",e,t));EP(n,"strokeWidth",CP("strokeWidth",e,t));EP(n,"cornerRadius",CP("cornerRadius",e,t));EP(n,"strokeDash",t.strokeDash);return n}function RR(e,t,n){var r,i,a,o;a=FP("strokeWidth",n[0].encode);i=e.size?'scale("'+e.size+'",datum)':FP("size",n[0].encode,t);r=LR(n[1].encode,t,FC);o="max("+"ceil(sqrt("+iD(i)+")+"+iD(a)+"),"+iD(r)+")";return FN(o,t)}function LR(e,t,n){return FP("fontSize",e)||qP("fontSize",t,n)}function IR(e,t,n){return'item.anchor==="'+zC+'"?'+e+':item.anchor==="'+MC+'"?'+t+":"+n}var FR=IR(Object(V["stringValue"])(wC),Object(V["stringValue"])(jC),Object(V["stringValue"])(EC));var qR=IR('+(item.orient==="'+jC+'")','+(item.orient!=="'+wC+'")',"0.5");var UR=function(e,t){e=Object(V["isString"])(e)?{text:e}:e;var n=t.config.title,r=Object(V["extend"])({},e.encode),i,a,o;i={orient:CP("orient",e,n)};a=VN(t.add(kD(null,[i])));r.name=e.name;r.interactive=e.interactive;o=WR(e,n,r,a);if(e.zindex)o.zindex=e.zindex;return TR(o,t)};function WR(e,t,n,r){var i={value:0},a=e.text,o=CP("orient",e,t),u=CP("anchor",e,t),s=o===wC||o===OC?-1:1,l=o===OC||o===SC,f={group:l?"width":"height"},c,d,h,p,v;p={field:f,mult:{signal:qR}};v=s<0?i:l?{field:{group:"height"}}:{field:{group:"width"}};c={enter:d={opacity:i},update:h={opacity:{value:1},text:SP(a),anchor:SP(u),orient:SP(o),extent:{field:f},align:{signal:FR}},exit:{opacity:i}};if(l){h.x=p;h.y=v;d.angle=i;d.baseline={value:o===OC?SC:OC}}else{h.x=v;h.y=p;d.angle={value:s*90};d.baseline={value:SC}}EP(c,"align",CP("align",e,t),"update");EP(c,"angle",CP("angle",e,t));EP(c,"baseline",CP("baseline",e,t));EP(c,"fill",CP("color",e,t));EP(c,"font",CP("font",e,t));EP(c,"fontSize",CP("fontSize",e,t));EP(c,"fontWeight",CP("fontWeight",e,t));EP(c,"frame",CP("frame",e,t));EP(c,"limit",CP("limit",e,t));EP(c,"offset",CP("offset",e,t)||0);return DP(BP,jP,e.style||UC,null,r,c,n)}function VR(e,t){var n=[];if(e.transform){e.transform.forEach(function(e){n.push(uR(e,t))})}if(e.on){e.on.forEach(function(n){zR(n,t,e.name)})}t.addDataPipeline(e.name,HR(e,t,n))}function HR(e,t,n){var r=[],i=null,a=false,o=false,u,s,l,f,c;if(e.values){r.push(i=BR({$ingest:e.values,$format:e.format}))}else if(e.url){i=nD(e.url)||nD(e.format)?{$load:VN(t.add(GR(t,e,i)))}:{$request:e.url,$format:e.format};r.push(i=BR(i))}else if(e.source){i=u=Object(V["array"])(e.source).map(function(e){return VN(t.getData(e).output)});r.push(null)}for(s=0,l=n.length;s<l;++s){f=n[s];c=f.metadata;if(!i&&!c.source){r.push(i=BR())}r.push(f);if(c.generates)o=true;if(c.modifies&&!o)a=true;if(c.source)i=f;else if(c.changes)i=null}if(u){l=u.length-1;r[0]=UD({derive:a,pulse:l?u:u[0]});if(a||l){r.splice(1,0,BR())}}if(!i)r.push(BR());r.push(HD({}));return r}function BR(e){var t=kD({},e);t.metadata={source:true};return t}function GR(e,t){return ND({url:e.property(t.url),format:e.objectProperty(t.format)})}var $R=function(e,t){var n=t.config,r=e.orient,i=r===OC||r===SC?n.axisX:n.axisY,a=n["axis"+r[0].toUpperCase()+r.slice(1)],o=t.scaleType(e.scale)==="band"&&n.axisBand;return i||a||o?Object(V["extend"])({},n.axis,i,a,o):n.axis};var YR=function(e,t,n,r){var i=e.orient,a={value:0},o,u,s,l,f,c;o={enter:u={opacity:a},update:s={opacity:{value:1}},exit:{opacity:a}};EP(o,"stroke",CP("domainColor",e,t));EP(o,"strokeWidth",CP("domainWidth",e,t));EP(o,"strokeOpacity",CP("domainOpacity",e,t));if(i===OC||i===SC){l="x";c="y"}else{l="y";c="x"}f=l+"2";u[c]=a;s[l]=u[l]=XR(e,0);s[f]=u[f]=XR(e,1);return DP(VP,hP,null,null,r,o,n)};function XR(e,t){return{scale:e.scale,range:t}}var JR=function(e,t,n,r){var i=e.orient,a=e.gridScale,o=i===wC||i===OC?1:-1,u=o*e.offset||0,s={value:0},l,f,c,d,h,p,v,g,m;l={enter:f={opacity:s},update:d={opacity:{value:1}},exit:c={opacity:s}};EP(l,"stroke",CP("gridColor",e,t));EP(l,"strokeDash",CP("gridDash",e,t));EP(l,"strokeOpacity",CP("gridOpacity",e,t));EP(l,"strokeWidth",CP("gridWidth",e,t));h={scale:e.scale,field:IC,band:CP("bandPosition",e,t),round:CP("tickRound",e,t),extra:CP("tickExtra",e,t),offset:CP("tickOffset",e,t)};if(i===OC||i===SC){p="x";v="y";m="height"}else{p="y";v="x";m="width"}g=v+"2";d[p]=f[p]=c[p]=h;if(a){f[v]={scale:a,range:0,mult:o,offset:u};d[g]=f[g]={scale:a,range:1,mult:o,offset:u}}else{f[v]={value:u};d[g]=f[g]={signal:m,mult:o,offset:u}}return DP(VP,pP,null,IC,r,l,n)};var QR=function(e,t,n,r,i){var a=e.orient,o=a===wC||a===OC?-1:1,u={value:0},s,l,f,c,d,h;s={enter:l={opacity:u},update:c={opacity:{value:1}},exit:f={opacity:u}};EP(s,"stroke",CP("tickColor",e,t));EP(s,"strokeOpacity",CP("tickOpacity",e,t));EP(s,"strokeWidth",CP("tickWidth",e,t));d=SP(i);d.mult=o;h={scale:e.scale,field:IC,band:CP("bandPosition",e,t),round:CP("tickRound",e,t),extra:CP("tickExtra",e,t),offset:CP("tickOffset",e,t)};if(a===OC||a===SC){c.y=l.y=u;c.y2=l.y2=d;c.x=l.x=f.x=h}else{c.x=l.x=u;c.x2=l.x2=d;c.y=l.y=f.y=h}return DP(VP,gP,null,IC,r,s,n)};function ZR(e,t,n,r,i){return{signal:'flush(range("'+e+'"), '+'scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}var KR=function(e,t,n,r,i){var a=e.orient,o=a===wC||a===OC?-1:1,u=a===OC||a===SC,s=e.scale,l=iD(CP("labelFlush",e,t)),f=iD(CP("labelFlushOffset",e,t)),c=l===0||!!l,d=CP("labelAlign",e,t),h=CP("labelBaseline",e,t),p={value:0},v,g,m,y,b,_,x,k,O;m=SP(i);m.mult=o;m.offset=SP(CP("labelPadding",e,t)||0);m.offset.mult=o;y={scale:s,field:IC,band:.5,offset:CP("tickOffset",e,t)};if(u){b=d||(c?ZR(s,l,'"left"','"right"','"center"'):"center");_=h||(a===OC?"bottom":"top");x=!d}else{b=d||(a===jC?"left":"right");_=h||(c?ZR(s,l,'"top"','"bottom"','"middle"'):"middle");x=!h}x=x&&c&&f?ZR(s,l,"-"+f,f,0):null;v={enter:g={opacity:p,x:u?y:m,y:u?m:y},update:{opacity:{value:1},text:{field:DC},x:g.x,y:g.y},exit:{opacity:p,x:g.x,y:g.y}};EP(v,u?"dx":"dy",x);EP(v,"align",b);EP(v,"baseline",_);EP(v,"angle",CP("labelAngle",e,t));EP(v,"fill",CP("labelColor",e,t));EP(v,"font",CP("labelFont",e,t));EP(v,"fontSize",CP("labelFontSize",e,t));EP(v,"fontWeight",CP("labelFontWeight",e,t));EP(v,"limit",CP("labelLimit",e,t));EP(v,"fillOpacity",CP("labelOpacity",e,t));k=CP("labelBound",e,t);O=CP("labelOverlap",e,t);e=DP(BP,vP,FC,IC,r,v,n);if(O||k){e.overlap={method:O,order:"datum.index",bound:k?{scale:s,orient:a,tolerance:k}:null}}return e};var eL=function(e,t,n,r){var i=e.orient,a=i===wC||i===OC?-1:1,o=i===OC||i===SC,u={value:0},s,l,f,c;s={enter:l={opacity:u},update:f={opacity:{value:1},text:SP(e.title)},exit:{opacity:u}};c={scale:e.scale,range:.5};if(o){f.x=c;l.angle={value:0};l.baseline={value:i===OC?"bottom":"top"}}else{f.y=c;l.angle={value:a*90};l.baseline={value:"bottom"}}EP(s,"align",CP("titleAlign",e,t));EP(s,"angle",CP("titleAngle",e,t));EP(s,"baseline",CP("titleBaseline",e,t));EP(s,"fill",CP("titleColor",e,t));EP(s,"font",CP("titleFont",e,t));EP(s,"fontSize",CP("titleFontSize",e,t));EP(s,"fontWeight",CP("titleFontWeight",e,t));EP(s,"limit",CP("titleLimit",e,t));EP(s,"fillOpacity",CP("titleOpacity",e,t));!EP(s,"x",CP("titleX",e,t),"update")&&o&&!NP("x",n)&&(s.enter.auto={value:true});!EP(s,"y",CP("titleY",e,t),"update")&&!o&&!NP("y",n)&&(s.enter.auto={value:true});return DP(BP,mP,qC,null,r,s,n)};var tL=function(e,t){var n=$R(e,t),r=e.encode||{},i=r.axis||{},a=i.name||undefined,o=i.interactive,u=i.style,s,l,f,c,d,h;s={orient:e.orient,ticks:!!CP("ticks",e,n),labels:!!CP("labels",e,n),grid:!!CP("grid",e,n),domain:!!CP("domain",e,n),title:!!rD(e.title,false)};l=VN(t.add(kD({},[s])));i=AP({update:{range:{signal:'abs(span(range("'+e.scale+'")))'},offset:SP(rD(e.offset,0)),position:SP(rD(e.position,0)),titlePadding:SP(CP("titlePadding",e,n)),minExtent:SP(CP("minExtent",e,n)),maxExtent:SP(CP("maxExtent",e,n))}},r.axis,GC);f=VN(t.add(_D({scale:t.scaleRef(e.scale),extra:t.property(CP("tickExtra",e,n)),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),formatSpecifier:t.property(e.format)})));h=[];if(s.grid){h.push(JR(e,n,r.grid,f))}if(s.ticks){c=CP("tickSize",e,n);h.push(QR(e,n,r.ticks,f,c))}if(s.labels){c=s.ticks?c:0;h.push(KR(e,n,r.labels,f,c))}if(s.domain){h.push(YR(e,n,r.domain,l))}if(s.title){h.push(eL(e,n,r.title,l))}d=QP(dP,u,a,l,o,i,h);if(e.zindex)d.zindex=e.zindex;return TR(d,t)};var nL=function(e,t,n){var r=Object(V["array"])(e.signals),i=Object(V["array"])(e.scales);if(!n)r.forEach(function(e){Bj(e,t)});Object(V["array"])(e.projections).forEach(function(e){xC(e,t)});i.forEach(function(e){iC(e,t)});Object(V["array"])(e.data).forEach(function(e){VR(e,t)});i.forEach(function(e){aC(e,t)});r.forEach(function(e){mD(e,t)});Object(V["array"])(e.axes).forEach(function(e){tL(e,t)});Object(V["array"])(e.marks).forEach(function(e){TR(e,t)});Object(V["array"])(e.legends).forEach(function(e){NR(e,t)});if(e.title){UR(e.title,t)}t.parseLambdas();return t};var rL=Object(V["toSet"])(["width","height","padding","autosize"]);function iL(e,t){var n=t.config,r,i,a,o,u;t.background=e.background||n.background;t.eventConfig=n.events;u=VN(t.root=t.add(WN()));t.addSignal("width",e.width||0);t.addSignal("height",e.height||0);t.addSignal("padding",Fj(e.padding,n));t.addSignal("autosize",Ij(e.autosize,n));Object(V["array"])(e.signals).forEach(function(e){if(!rL[e.name])Bj(e,t)});i=t.add(kD());a=AP({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode);a=t.add(jD(zP(a,UP,fP,e.style,t,{pulse:VN(i)})));o=t.add(GD({layout:t.objectProperty(e.layout),legendMargin:n.legendMargin,autosize:t.signalRef("autosize"),mark:u,pulse:VN(a)}));t.operators.pop();t.pushState(VN(a),VN(o),null);nL(e,t,true);t.operators.push(o);r=t.add(xD({mark:u,pulse:VN(o)}));r=t.add(WD({pulse:VN(r)}));r=t.add(HD({pulse:VN(r)}));t.addData("root",new kR(t,i,i,r));return t}function aL(e){this.config=e;this.bindings=[];this.field={};this.signals={};this.lambdas={};this.scales={};this.events={};this.data={};this.streams=[];this.updates=[];this.operators=[];this.background=null;this.eventConfig=null;this._id=0;this._subid=0;this._nextsub=[0];this._parent=[];this._encode=[];this._lookup=[];this._markpath=[]}function oL(e){this.config=e.config;this.field=Object.create(e.field);this.signals=Object.create(e.signals);this.lambdas=Object.create(e.lambdas);this.scales=Object.create(e.scales);this.events=Object.create(e.events);this.data=Object.create(e.data);this.streams=[];this.updates=[];this.operators=[];this._id=0;this._subid=++e._nextsub[0];this._nextsub=e._nextsub;this._parent=e._parent.slice();this._encode=e._encode.slice();this._lookup=e._lookup.slice();this._markpath=e._markpath}var uL=aL.prototype=oL.prototype;uL.fork=function(){return new oL(this)};uL.isSubscope=function(){return this._subid>0};uL.toRuntime=function(){this.finish();return{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig}};uL.id=function(){return(this._subid?this._subid+":":0)+this._id++};uL.add=function(e){this.operators.push(e);e.id=this.id();if(e.refs){e.refs.forEach(function(t){t.$ref=e.id});e.refs=null}return e};uL.proxy=function(e){var t=e instanceof qN?VN(e):e;return this.add(qD({value:t}))};uL.addStream=function(e){this.streams.push(e);e.id=this.id();return e};uL.addUpdate=function(e){this.updates.push(e);return e};uL.finish=function(){var e,t;if(this.root)this.root.root=true;for(e in this.signals){this.signals[e].signal=e}for(e in this.scales){this.scales[e].scale=e}function n(e,t,n){var r,i;if(e){r=e.data||(e.data={});i=r[t]||(r[t]=[]);i.push(n)}}for(e in this.data){t=this.data[e];n(t.input,e,"input");n(t.output,e,"output");n(t.values,e,"values");for(var r in t.index){n(t.index[r],e,"index:"+r)}}return this};uL.pushState=function(e,t,n){this._encode.push(VN(this.add(HD({pulse:e}))));this._parent.push(t);this._lookup.push(n?VN(this.proxy(n)):null);this._markpath.push(-1)};uL.popState=function(){this._encode.pop();this._parent.pop();this._lookup.pop();this._markpath.pop()};uL.parent=function(){return Object(V["peek"])(this._parent)};uL.encode=function(){return Object(V["peek"])(this._encode)};uL.lookup=function(){return Object(V["peek"])(this._lookup)};uL.markpath=function(){var e=this._markpath;return++e[e.length-1]};uL.fieldRef=function(e,t){if(Object(V["isString"])(e))return BN(e,t);if(!e.signal){Object(V["error"])("Unsupported field reference: "+Object(V["stringValue"])(e))}var n=e.signal,r=this.field[n],i;if(!r){i={name:this.signalRef(n)};if(t)i.as=t;this.field[n]=r=VN(this.add(zD(i)))}return r};uL.compareRef=function(e,t){function n(e){if(tD(e)){i=true;return VN(r[e.signal])}else{return e}}var r=this.signals,i=false,a=Object(V["array"])(e.field).map(n),o=Object(V["array"])(e.order).map(n);if(t){a.push(HN)}return i?VN(this.add(OD({fields:a,orders:o}))):$N(a,o)};uL.keyRef=function(e,t){function n(e){if(tD(e)){i=true;return VN(r[e.signal])}else{return e}}var r=this.signals,i=false;e=Object(V["array"])(e).map(n);return i?VN(this.add(TD({fields:e,flat:t}))):YN(e,t)};uL.sortRef=function(e){if(!e)return e;var t=[ZN(e.op,e.field),HN],n=e.order||XN;return n.signal?VN(this.add(OD({fields:t,orders:[n=this.signalRef(n.signal),n]}))):$N(t,[n,n])};uL.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:e,type:t});this.events[n]=r}return this.events[n]};uL.addSignal=function(e,t){if(this.signals.hasOwnProperty(e)){Object(V["error"])("Duplicate signal name: "+Object(V["stringValue"])(e))}var n=t instanceof qN?t:this.add(WN(t));return this.signals[e]=n};uL.getSignal=function(e){if(!this.signals[e]){Object(V["error"])("Unrecognized signal name: "+Object(V["stringValue"])(e))}return this.signals[e]};uL.signalRef=function(e){if(this.signals[e]){return VN(this.signals[e])}else if(!this.lambdas.hasOwnProperty(e)){this.lambdas[e]=this.add(WN(null))}return VN(this.lambdas[e])};uL.parseLambdas=function(){var e=Object.keys(this.lambdas);for(var t=0,n=e.length;t<n;++t){var r=e[t],i=FN(r,this),a=this.lambdas[r];a.params=i.$params;a.update=i.$expr}};uL.property=function(e){return e&&e.signal?this.signalRef(e.signal):e};uL.objectProperty=function(e){return!e||!Object(V["isObject"])(e)?e:this.signalRef(e.signal||sL(e))};function sL(e){return(Object(V["isArray"])(e)?lL:fL)(e)}function lL(e){var t="[",n=0,r=e.length,i;for(;n<r;++n){i=e[n];t+=(n>0?",":"")+(Object(V["isObject"])(i)?i.signal||sL(i):Object(V["stringValue"])(i))}return t+"]"}function fL(e){var t="{",n=0,r,i;for(r in e){i=e[r];t+=(++n>1?",":"")+Object(V["stringValue"])(r)+":"+(Object(V["isObject"])(i)?i.signal||sL(i):Object(V["stringValue"])(i))}return t+"}"}uL.exprRef=function(e,t){var n={expr:FN(e,this)};if(t)n.expr.$name=t;return VN(this.add(SD(n)))};uL.addBinding=function(e,t){if(!this.bindings){Object(V["error"])("Nested signals do not support binding: "+Object(V["stringValue"])(e))}this.bindings.push(Object(V["extend"])({signal:e},t))};uL.addScaleProj=function(e,t){if(this.scales.hasOwnProperty(e)){Object(V["error"])("Duplicate scale or projection name: "+Object(V["stringValue"])(e))}this.scales[e]=this.add(t)};uL.addScale=function(e,t){this.addScaleProj(e,VD(t))};uL.addProjection=function(e,t){this.addScaleProj(e,FD(t))};uL.getScale=function(e){if(!this.scales[e]){Object(V["error"])("Unrecognized scale name: "+Object(V["stringValue"])(e))}return this.scales[e]};uL.projectionRef=uL.scaleRef=function(e){return VN(this.getScale(e))};uL.projectionType=uL.scaleType=function(e){return this.getScale(e).params.type};uL.addData=function(e,t){if(this.data.hasOwnProperty(e)){Object(V["error"])("Duplicate data set name: "+Object(V["stringValue"])(e))}return this.data[e]=t};uL.getData=function(e){if(!this.data[e]){Object(V["error"])("Undefined data set name: "+Object(V["stringValue"])(e))}return this.data[e]};uL.addDataPipeline=function(e,t){if(this.data.hasOwnProperty(e)){Object(V["error"])("Duplicate data set name: "+Object(V["stringValue"])(e))}return this.addData(e,kR.fromEntries(this,t))};var cL=function(e){var t=bL();(e||[]).forEach(function(e){var n,r,i;if(e){for(n in e){if(n==="style"){i=t.style||(t.style={});for(n in e.style){i[n]=Object(V["extend"])(i[n]||{},e.style[n])}}else{r=e[n];t[n]=Object(V["isObject"])(r)&&!Object(V["isArray"])(r)?Object(V["extend"])(Object(V["isObject"])(t[n])?t[n]:{},r):r}}}});return t};var dL="sans-serif",hL=30,pL=2,vL="#4c78a8",gL="#000",mL="#888",yL="#ddd";function bL(){return{padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:vL},area:{fill:vL},image:null,line:{stroke:vL,strokeWidth:pL},path:{stroke:vL},rect:{fill:vL},rule:{stroke:gL},shape:{stroke:vL},symbol:{fill:vL,size:64},text:{fill:gL,font:dL,fontSize:11},style:{"guide-label":{fill:gL,font:dL,fontSize:10},"guide-title":{fill:gL,font:dL,fontSize:11,fontWeight:"bold"},"group-title":{fill:gL,font:dL,fontSize:13,fontWeight:"bold"},point:{size:hL,strokeWidth:pL,shape:"circle"},circle:{size:hL,strokeWidth:pL},square:{size:hL,strokeWidth:pL,shape:"square"},cell:{fill:"transparent",stroke:yL}},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:true,domainWidth:1,domainColor:mL,grid:false,gridWidth:1,gridColor:yL,labels:true,labelAngle:0,labelLimit:180,labelPadding:2,ticks:true,tickColor:mL,tickOffset:0,tickRound:true,tickSize:5,tickWidth:1,titleAlign:"center",titlePadding:4},axisBand:{tickOffset:-1},legend:{orient:"right",offset:18,padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:yL,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:true,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:mL,titleAlign:"left",titleBaseline:"top",titleLimit:180,titlePadding:5},title:{orient:"top",anchor:"middle",offset:4},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues",extent:[.2,1]},heatmap:{scheme:"viridis"},ramp:{scheme:"blues",extent:[.2,1]},diverging:{scheme:"blueorange"},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}var _L=function(e,t){if(!Object(V["isObject"])(e))Object(V["error"])("Input Vega specification must be an object.");return iL(e,new aL(cL([t,e.config]))).toRuntime()};function xL(e,t,n){if(t[t.length-1]!==";"){t="return("+t+");"}var r=Function.apply(null,e.concat(t));return n&&n.functions?r.bind(n.functions):r}function kL(e,t){return xL(["_"],e,t)}function OL(e,t){return xL(["datum","_"],e,t)}function wL(e,t){return xL(["event"],e,t)}function jL(e,t){return xL(["_","event"],e,t)}function SL(e,t){return xL(["item","_"],e,t)}function EL(e,t,n){n=n||{};var r,i;for(r in e){i=e[r];n[r]=Object(V["isArray"])(i)?i.map(function(e){return AL(e,t,n)}):AL(i,t,n)}return n}function AL(e,t,n){if(!e||!Object(V["isObject"])(e))return e;for(var r=0,i=zL.length,a;r<i;++r){a=zL[r];if(e.hasOwnProperty(a.key)){return a.parse(e,t,n)}}return e}var zL=[{key:"$ref",parse:TL},{key:"$key",parse:NL},{key:"$expr",parse:ML},{key:"$field",parse:DL},{key:"$encode",parse:PL},{key:"$compare",parse:CL},{key:"$context",parse:RL},{key:"$subflow",parse:LL},{key:"$tupleid",parse:IL}];function TL(e,t){return t.get(e.$ref)||Object(V["error"])("Operator not defined: "+e.$ref)}function ML(e,t,n){if(e.$params){EL(e.$params,t,n)}var r="e:"+e.$expr+"_"+e.$name;return t.fn[r]||(t.fn[r]=Object(V["accessor"])(OL(e.$expr,t),e.$fields,e.$name))}function NL(e,t){var n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Object(V["key"])(e.$key,e.$flat))}function DL(e,t){if(!e.$field)return null;var n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Object(V["field"])(e.$field,e.$name))}function CL(e,t){var n="c:"+e.$compare+"_"+e.$order,r=Object(V["array"])(e.$compare).map(function(e){return e&&e.$tupleid?X:e});return t.fn[n]||(t.fn[n]=Object(V["compare"])(r,e.$order))}function PL(e,t){var n=e.$encode,r={},i,a;for(i in n){a=n[i];r[i]=Object(V["accessor"])(SL(a.$expr,t),a.$fields);r[i].output=a.$output}return r}function RL(e,t){return t}function LL(e,t){var n=e.$subflow;return function(e,r,i){var a=GL(n,t.fork()),o=a.get(n.operators[0].id),u=a.signals.parent;if(u)u.set(i);return o}}function IL(){return X}function FL(e){return(e+"").toLowerCase()}function qL(e){return FL(e)==="operator"}function UL(e){return FL(e)==="collect"}var WL=function(e,t){if(qL(e.type)||!e.type){t.operator(e,e.update?kL(e.update,t):null)}else{t.transform(e,e.type)}};function VL(e,t){var n,r;if(e.params){if(!(n=t.get(e.id))){Object(V["error"])("Invalid operator id: "+e.id)}r=EL(e.params,t);t.dataflow.connect(n,n.parameters(r))}}var HL=function(e,t){var n=e.filter!=null?wL(e.filter,t):undefined,r=e.stream!=null?t.get(e.stream):undefined,i;if(e.source){r=t.events(e.source,e.type,n)}else if(e.merge){i=e.merge.map(t.get.bind(t));r=i[0].merge.apply(i[0],i.slice(1))}if(e.between){i=e.between.map(t.get.bind(t));r=r.between(i[0],i[1])}if(e.filter){r=r.filter(n)}if(e.throttle!=null){r=r.throttle(+e.throttle)}if(e.debounce!=null){r=r.debounce(+e.debounce)}if(r==null){Object(V["error"])("Invalid stream definition: "+JSON.stringify(e))}if(e.consume)r.consume(true);t.stream(e,r)};var BL=function(e,t){var n=Object(V["isObject"])(n=e.source)?n.$ref:n,r=t.get(n),i=null,a=e.update,o=undefined;if(!r)Object(V["error"])("Source not defined: "+e.source);if(e.target&&e.target.$expr){i=wL(e.target.$expr,t)}else{i=t.get(e.target)}if(a&&a.$expr){if(a.$params){o=EL(a.$params,t)}a=jL(a.$expr,t)}t.update(e,r,i,a,o)};var GL=function(e,t){var n=e.operators||[];if(e.background){t.background=e.background}if(e.eventConfig){t.eventConfig=e.eventConfig}n.forEach(function(e){WL(e,t)});n.forEach(function(e){VL(e,t)});(e.streams||[]).forEach(function(e){HL(e,t)});(e.updates||[]).forEach(function(e){BL(e,t)});return t.resolve()};var $L={skip:true};function YL(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach(function(n){var i=t.signals[n];if(e.signals(n,i)){r[n]=i.value}})}if(e.data){var i=n.data={};Object.keys(t.data).forEach(function(n){var r=t.data[n];if(e.data(n,r)){i[n]=r.input.value}})}if(t.subcontext&&e.recurse!==false){n.subcontext=t.subcontext.map(function(t){return t.getState(e)})}return n}function XL(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach(function(e){n.update(t.signals[e],i[e],$L)});Object.keys(r||{}).forEach(function(e){n.pulse(t.data[e].input,n.changeset().remove(V["truthy"]).insert(r[e]))});(e.subcontext||[]).forEach(function(e,n){var r=t.subcontext[n];if(r)r.setState(e)})}var JL=function(e,t,n){return new QL(e,t,n)};function QL(e,t,n){this.dataflow=e;this.transforms=t;this.events=e.events.bind(e);this.signals={};this.scales={};this.nodes={};this.data={};this.fn={};if(n){this.functions=Object.create(n);this.functions.context=this}}function ZL(e){this.dataflow=e.dataflow;this.transforms=e.transforms;this.functions=e.functions;this.events=e.events;this.signals=Object.create(e.signals);this.scales=Object.create(e.scales);this.nodes=Object.create(e.nodes);this.data=Object.create(e.data);this.fn=Object.create(e.fn);if(e.functions){this.functions=Object.create(e.functions);this.functions.context=this}}QL.prototype=ZL.prototype={fork:function(){var e=new ZL(this);(this.subcontext||(this.subcontext=[])).push(e);return e},get:function(e){return this.nodes[e]},set:function(e,t){return this.nodes[e]=t},add:function(e,t){var n=this,r=n.dataflow,i;n.set(e.id,t);if(UL(e.type)&&(i=e.value)){if(i.$ingest){r.ingest(t,i.$ingest,i.$format)}else if(i.$load){n.get(i.$load.$ref).target=t}else if(i.$request){r.request(t,i.$request,i.$format)}else{r.pulse(t,r.changeset().insert(i))}}if(e.root){n.root=t}if(e.parent){var a=n.get(e.parent.$ref);if(a){r.connect(a,[t]);t.targets().add(a)}else{(n.unresolved=n.unresolved||[]).push(function(){a=n.get(e.parent.$ref);r.connect(a,[t]);t.targets().add(a)})}}if(e.signal){n.signals[e.signal]=t}if(e.scale){n.scales[e.scale]=t}if(e.data){for(var o in e.data){i=n.data[o]||(n.data[o]={});e.data[o].forEach(function(e){i[e]=t})}}},resolve:function(){(this.unresolved||[]).forEach(function(e){e()});delete this.unresolved;return this},operator:function(e,t,n){this.add(e,this.dataflow.add(e.value,t,n,e.react))},transform:function(e,t,n){this.add(e,this.dataflow.add(this.transforms[FL(t)],n))},stream:function(e,t){this.set(e.id,t)},update:function(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},getState:YL,setState:XL};var KL=function(e,t,n){var r=n||zN;return GL(t,JL(e,Ht,r))};function eI(e){var t=this._runtime.scales;if(!t.hasOwnProperty(e)){Object(V["error"])("Unrecognized scale or projection: "+e)}return t[e].value}var tI="width",nI="height",rI="padding",iI={skip:true};function aI(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===rI?r.left+r.right:0)}function oI(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===rI?r.top+r.bottom:0)}function uI(e){var t=e._signals,n=t[tI],r=t[nI],i=t[rI];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,function(t){e._width=t.size;e._viewWidth=aI(e,t.size);a()},{size:n});e._resizeHeight=e.add(null,function(t){e._height=t.size;e._viewHeight=oI(e,t.size);a()},{size:r});var o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1;e._resizeHeight.rank=r.rank+1;o.rank=i.rank+1}function sI(e,t,n,r,i,a){this.runAfter(function(o){var u=0;o._autosize=0;if(o.width()!==n){u=1;o.signal(tI,n,iI);o._resizeWidth.skip(true)}if(o.height()!==r){u=1;o.signal(nI,r,iI);o._resizeHeight.skip(true)}if(o._viewWidth!==e){o._resize=1;o._viewWidth=e}if(o._viewHeight!==t){o._resize=1;o._viewHeight=t}if(o._origin[0]!==i[0]||o._origin[1]!==i[1]){o._resize=1;o._origin=i}if(u)o.run("enter");if(a)o.runAfter(function(){o.resize()})},false,1)}function lI(e){return this._runtime.getState(e||{data:fI,signals:cI,recurse:true})}function fI(e,t){return t.modified&&Object(V["isArray"])(t.input.value)&&e.indexOf("_:vega:_")}function cI(e,t){return!(e==="parent"||t instanceof Ht.proxy)}function dI(e){var t=this;t.runAfter(function(){t._trigger=false;t._runtime.setState(e);t.run().runAfter(function(){t._trigger=true})});return this}var hI=n("dGpj");var pI=function(e,t){function n(t){e({timestamp:Date.now(),elapsed:t})}this._timers.push(Object(hI["a"])(n,t))};var vI=function(e,t,n,r){var i=e.element();if(i)i.setAttribute("title",gI(r))};function gI(e){return e==null?"":Object(V["isArray"])(e)?yI(e):Object(V["isObject"])(e)&&!Object(V["isDate"])(e)?mI(e):e+""}function mI(e){return Object.keys(e).map(function(t){var n=e[t];return t+": "+(Object(V["isArray"])(n)?yI(n):bI(n))}).join("\n")}function yI(e){return"["+e.map(bI).join(", ")+"]"}function bI(e){return Object(V["isArray"])(e)?"[]":Object(V["isObject"])(e)&&!Object(V["isDate"])(e)?"{}":e}function _I(e,t){var n=this;t=t||{};Ft.call(n);n.loader(t.loader||n._loader);n.logLevel(t.logLevel||0);n._el=null;n._renderType=t.renderer||Gw.Canvas;n._scenegraph=new NO;var r=n._scenegraph.root;n._renderer=null;n._tooltip=t.tooltip||vI,n._redraw=true;n._handler=(new QO).scene(r);n._preventDefault=false;n._timers=[];n._eventListeners=[];n._resizeListeners=[];var i=KL(n,e,t.functions);n._runtime=i;n._signals=i.signals;n._bind=(e.bindings||[]).map(function(e){return{state:null,param:Object(V["extend"])({},e)}});if(i.root)i.root.set(r);r.source=i.data.root.input;n.pulse(i.data.root.input,n.changeset().insert(r.items));n._background=i.background||null;n._eventConfig=uj(i.eventConfig);n._width=n.width();n._height=n.height();n._viewWidth=aI(n,n._width);n._viewHeight=oI(n,n._height);n._origin=[0,0];n._resize=0;n._autosize=1;uI(n);qb(n)}var xI=Object(V["inherits"])(_I,Ft);xI.run=function(e){Ft.prototype.run.call(this,e);if(this._pending){this.resize()}else if(this._redraw||this._resize){try{this.render()}catch(e){this.error(e)}}return this};xI.render=function(){if(this._renderer){if(this._resize){this._resize=0;Jb(this)}this._renderer.render(this._scenegraph.root)}this._redraw=false;return this};xI.dirty=function(e){this._redraw=true;this._renderer&&this._renderer.dirty(e)};xI.container=function(){return this._el};xI.scenegraph=function(){return this._scenegraph};xI.origin=function(){return this._origin.slice()};function kI(e,t){return e._signals.hasOwnProperty(t)?e._signals[t]:Object(V["error"])("Unrecognized signal name: "+Object(V["stringValue"])(t))}xI.signal=function(e,t,n){var r=kI(this,e);return arguments.length===1?r.value:this.update(r,t,n)};xI.background=function(e){if(arguments.length){this._background=e;this._resize=1;return this}else{return this._background}};xI.width=function(e){return arguments.length?this.signal("width",e):this.signal("width")};xI.height=function(e){return arguments.length?this.signal("height",e):this.signal("height")};xI.padding=function(e){return arguments.length?this.signal("padding",e):this.signal("padding")};xI.autosize=function(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")};xI.renderer=function(e){if(!arguments.length)return this._renderType;if(!Yw(e))Object(V["error"])("Unrecognized renderer type: "+e);if(e!==this._renderType){this._renderType=e;this._resetRenderer()}return this};xI.tooltip=function(e){if(!arguments.length)return this._tooltip;if(e!==this._tooltip){this._tooltip=e;this._resetRenderer()}return this};xI.loader=function(e){if(!arguments.length)return this._loader;if(e!==this._loader){Ft.prototype.loader.call(this,e);this._resetRenderer()}return this};xI.resize=function(){this._autosize=1;return this.touch(kI(this,"autosize"))};xI._resetRenderer=function(){if(this._renderer){this._renderer=null;this.initialize(this._el)}};xI._resizeView=sI;xI.addEventListener=function(e,t,n){var r=t;if(!(n&&n.trap===false)){r=zj(this,t);r.raw=t}this._handler.on(e,r);return this};xI.removeEventListener=function(e,t){var n=this._handler.handlers(e),r=n.length,i,a;while(--r>=0){a=n[r].type;i=n[r].handler;if(e===a&&(t===i||t===i.raw)){this._handler.off(a,i);break}}return this};xI.addResizeListener=function(e){var t=this._resizeListeners;if(t.indexOf(e)<0){t.push(e)}return this};xI.removeResizeListener=function(e){var t=this._resizeListeners,n=t.indexOf(e);if(n>=0){t.splice(n,1)}return this};function OI(e,t){var n=e._targets||[],r=n.filter(function(e){var n=e._update;return n&&n.handler===t});return r.length?r[0]:null}xI.addSignalListener=function(e,t){var n=kI(this,e),r=OI(n,t);if(!r){r=zj(this,function(){t(e,n.value)});r.handler=t;this.on(n,null,r)}return this};xI.removeSignalListener=function(e,t){var n=kI(this,e),r=OI(n,t);if(r)n._targets.remove(r);return this};xI.preventDefault=function(e){if(arguments.length){this._preventDefault=e;return this}else{return this._preventDefault}};xI.timer=pI;xI.events=lj;xI.finalize=pj;xI.hover=hj;xI.data=Vb;xI.change=Hb;xI.insert=Bb;xI.remove=Gb;xI.scale=eI;xI.initialize=Mj;xI.toImageURL=Cj;xI.toCanvas=Rj;xI.toSVG=Lj;xI.getState=lI;xI.setState=dI;Object(V["extend"])(Ht,r,i,a,o,u,s,l,f,c);var wI=n("rE/H");var jI=n.n(wI);function SI(e){return!!e.or}function EI(e){return!!e.and}function AI(e){return!!e.not}function zI(e,t){if(AI(e)){zI(e.not,t)}else if(EI(e)){for(var n=0,r=e.and;n<r.length;n++){var i=r[n];zI(i,t)}}else if(SI(e)){for(var a=0,o=e.or;a<o.length;a++){var i=o[a];zI(i,t)}}else{t(e)}}function TI(e,t){if(AI(e)){return{not:TI(e.not,t)}}else if(EI(e)){return{and:e.and.map(function(e){return TI(e,t)})}}else if(SI(e)){return{or:e.or.map(function(e){return TI(e,t)})}}else{return t(e)}}function MI(e,t){var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];if(e.hasOwnProperty(a)){n[a]=e[a]}}return n}function NI(e,t){var n=I["__assign"]({},e);for(var r=0,i=t;r<i.length;r++){var a=i[r];delete n[a]}return n}var DI=jI.a;function CI(e){if(Object(V["isNumber"])(e)){return e}var t=Object(V["isString"])(e)?e:jI()(e);if(t.length<100){return t}var n=0;for(var r=0;r<t.length;r++){var i=t.charCodeAt(r);n=(n<<5)-n+i;n=n&n}return n}function PI(e,t){return e.indexOf(t)>-1}function RI(e,t){return e.filter(function(e){return!PI(t,e)})}function LI(e,t){return e.concat(RI(t,e))}function II(e,t){var n=0;for(var r=0;r<e.length;r++){if(t(e[r],r,n++)){return true}}return false}function FI(e,t){var n=0;for(var r=0;r<e.length;r++){if(!t(e[r],r,n++)){return false}}return true}function qI(e){return[].concat.apply([],e)}function UI(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}for(var r=0,i=t;r<i.length;r++){var a=i[r];e=WI(e,a)}return e}function WI(e,t){if(typeof t!=="object"||t===null){return e}for(var n in t){if(!t.hasOwnProperty(n)){continue}if(t[n]===undefined){continue}if(typeof t[n]!=="object"||Object(V["isArray"])(t[n])||t[n]===null){e[n]=t[n]}else if(typeof e[n]!=="object"||e[n]===null){e[n]=UI(Object(V["isArray"])(t[n].constructor)?[]:{},t[n])}else{UI(e[n],t[n])}}return e}function VI(e,t){var n=[];var r={};var i;for(var a=0,o=e;a<o.length;a++){var u=o[a];i=t(u);if(i in r){continue}r[i]=1;n.push(u)}return n}function HI(e,t){for(var n in e){if(e.hasOwnProperty(n)){if(t[n]&&e[n]&&t[n]!==e[n]){return true}}}return false}function BI(e,t){for(var n in e){if(n in t){return true}}return false}function GI(e){return!isNaN(e)}function $I(e,t){if(e.length!==t.length){return true}e.sort();t.sort();for(var n=0;n<e.length;n++){if(t[n]!==e[n]){return true}}return false}var YI=Object.keys;function XI(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}function JI(e){return YI(e)}function QI(e){return JSON.parse(JSON.stringify(e))}function ZI(e){return e===true||e===false}function KI(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function eF(e,t){if(AI(e)){return"!("+eF(e.not,t)+")"}else if(EI(e)){return"("+e.and.map(function(e){return eF(e,t)}).join(") && (")+")"}else if(SI(e)){return"("+e.or.map(function(e){return eF(e,t)}).join(") || (")+")"}else{return t(e)}}function tF(e,t){if(t.length===0){return true}var n=t.shift();if(tF(e[n],t)){delete e[n]}return Object.keys(e).length===0}function nF(e){return e.charAt(0).toUpperCase()+e.substr(1)}function rF(e,t){if(t===void 0){t="datum"}var n=Object(V["splitAccessPath"])(e);var r=[];for(var i=1;i<=n.length;i++){var a="["+n.slice(0,i).map(V["stringValue"]).join("][")+"]";r.push(""+t+a)}return r.join(" && ")}function iF(e,t){if(t===void 0){t="datum"}return t+"["+Object(V["stringValue"])(Object(V["splitAccessPath"])(e).join("."))+"]"}function aF(e){return""+Object(V["splitAccessPath"])(e).map(function(e){return e.replace(".","\\.")}).join("\\.")}function oF(e){return""+Object(V["splitAccessPath"])(e).join(".")}function uF(e){if(!e){return 0}return Object(V["splitAccessPath"])(e).length}var sF={argmax:1,argmin:1,average:1,count:1,distinct:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1};var lF=JI(sF);function fF(e){return!!sF[e]}var cF=["count","valid","missing","distinct"];function dF(e){return e&&PI(cF,e)}var hF=["count","sum","distinct","valid","missing"];var pF=["mean","average","median","q1","q3","min","max"];var vF=Object(V["toSet"])(pF);var gF=["domain","grid","labels","ticks","title"];var mF={grid:"grid",gridScale:"grid",domain:"main",labels:"main",labelFlush:"main",labelOverlap:"main",minExtent:"main",maxExtent:"main",offset:"main",ticks:"main",title:"main",values:"both",scale:"both",zindex:"both"};var yF={orient:1,domain:1,format:1,grid:1,labelBound:1,labelFlush:1,labelPadding:1,labels:1,labelOverlap:1,maxExtent:1,minExtent:1,offset:1,position:1,tickCount:1,ticks:1,tickSize:1,title:1,titlePadding:1,values:1,zindex:1};var bF=I["__assign"]({},yF,{encoding:1,labelAngle:1,titleMaxLength:1});var _F=I["__assign"]({scale:1},yF,{gridScale:1,encode:1});function xF(e){return!!bF[e]}var kF=JI(_F);var OF=JI(bF);var wF;(function(e){e.ROW="row";e.COLUMN="column";e.X="x";e.Y="y";e.X2="x2";e.Y2="y2";e.LATITUDE="latitude";e.LONGITUDE="longitude";e.LATITUDE2="latitude2";e.LONGITUDE2="longitude2";e.COLOR="color";e.FILL="fill";e.STROKE="stroke";e.SHAPE="shape";e.SIZE="size";e.OPACITY="opacity";e.TEXT="text";e.ORDER="order";e.DETAIL="detail";e.KEY="key";e.TOOLTIP="tooltip";e.HREF="href"})(wF||(wF={}));var jF=wF.X;var SF=wF.Y;var EF=wF.X2;var AF=wF.Y2;var zF=wF.LATITUDE;var TF=wF.LATITUDE2;var MF=wF.LONGITUDE;var NF=wF.LONGITUDE2;var DF=wF.ROW;var CF=wF.COLUMN;var PF=wF.SHAPE;var RF=wF.SIZE;var LF=wF.COLOR;var IF=wF.FILL;var FF=wF.STROKE;var qF=wF.TEXT;var UF=wF.DETAIL;var WF=wF.KEY;var VF=wF.ORDER;var HF=wF.OPACITY;var BF=wF.TOOLTIP;var GF=wF.HREF;var $F={longitude:1,longitude2:1,latitude:1,latitude2:1};var YF=JI($F);var XF=I["__assign"]({x:1,y:1,x2:1,y2:1},$F,{color:1,fill:1,stroke:1,opacity:1,size:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1});function JF(e){return e==="color"||e==="fill"||e==="stroke"}var QF={row:1,column:1};var ZF=I["__assign"]({},XF,QF);var KF=JI(ZF);var eq=ZF.order,tq=ZF.detail,nq=I["__rest"](ZF,["order","detail"]);var rq=JI(nq);function iq(e){return!!ZF[e]}var aq=JI(XF);var oq=XF.x,uq=XF.y,sq=XF.x2,lq=XF.y2,fq=XF.latitude,cq=XF.longitude,dq=XF.latitude2,hq=XF.longitude2,pq=I["__rest"](XF,["x","y","x2","y2","latitude","longitude","latitude2","longitude2"]);var vq=JI(pq);var gq={x:1,y:1};var mq=JI(gq);var yq=pq.text,bq=pq.tooltip,_q=pq.href,xq=pq.detail,kq=pq.key,Oq=pq.order,wq=I["__rest"](pq,["text","tooltip","href","detail","key","order"]);var jq=JI(wq);var Sq=I["__assign"]({},gq,wq);var Eq=JI(Sq);function Aq(e){return!!Sq[e]}function zq(e,t){return t in Tq(e)}function Tq(e){switch(e){case LF:case IF:case FF:case UF:case WF:case BF:case GF:case VF:case HF:case DF:case CF:return{point:true,tick:true,rule:true,circle:true,square:true,bar:true,rect:true,line:true,trail:true,area:true,text:true,geoshape:true};case jF:case SF:case zF:case MF:return{point:true,tick:true,rule:true,circle:true,square:true,bar:true,rect:true,line:true,trail:true,area:true,text:true};case EF:case AF:case TF:case NF:return{rule:true,bar:true,rect:true,area:true};case RF:return{point:true,tick:true,rule:true,circle:true,square:true,bar:true,text:true,line:true,trail:true};case PF:return{point:true,geoshape:true};case qF:return{text:true}}}function Mq(e){switch(e){case jF:case SF:case RF:case HF:case EF:case AF:return"continuous";case DF:case CF:case PF:case qF:case BF:case GF:return"discrete";case LF:case IF:case FF:return"flexible";case zF:case MF:case TF:case NF:case UF:case WF:case VF:return undefined}throw new Error("rangeType not implemented for "+e)}function Nq(e){if(Object(V["isBoolean"])(e)){return"bin"}return"bin"+YI(e).map(function(t){return KI("_"+t+"_"+e[t])}).join("")}function Dq(e){return e&&!Object(V["isBoolean"])(e)}function Cq(e){switch(e){case DF:case CF:case RF:case LF:case IF:case FF:case HF:case PF:return 6;default:return 10}}var Pq;(function(e){e.AREA="area";e.BAR="bar";e.LINE="line";e.POINT="point";e.RECT="rect";e.RULE="rule";e.TEXT="text";e.TICK="tick";e.TRAIL="trail";e.CIRCLE="circle";e.SQUARE="square";e.GEOSHAPE="geoshape"})(Pq||(Pq={}));var Rq=Pq.AREA;var Lq=Pq.BAR;var Iq=Pq.LINE;var Fq=Pq.POINT;var qq=Pq.TEXT;var Uq=Pq.TICK;var Wq=Pq.TRAIL;var Vq=Pq.RECT;var Hq=Pq.RULE;var Bq=Pq.GEOSHAPE;var Gq=Pq.CIRCLE;var $q=Pq.SQUARE;var Yq={area:1,bar:1,line:1,point:1,text:1,tick:1,trail:1,rect:1,geoshape:1,rule:1,circle:1,square:1};function Xq(e){return!!Yq[e]}function Jq(e){return PI(["line","area","trail"],e)}var Qq=JI(Yq);function Zq(e){return e["type"]}var Kq=Object(V["toSet"])(Qq);function eU(e){var t=Zq(e)?e.type:e;return t in Kq}var tU=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"];var nU=["fill","fillOpacity"];var rU=[].concat(tU,nU);var iU=["filled","color"];var aU={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],text:["shortTimeLabels"],tick:["bandSize","thickness"]};var oU={color:"#4c78a8"};var uU={binSpacing:1,continuousBandSize:5};var sU={thickness:1};var lU=Object(V["logger"])(V["Warn"]);var fU=lU;var cU=function(){function e(){this.warns=[];this.infos=[];this.debugs=[]}e.prototype.level=function(){return this};e.prototype.warn=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n;(n=this.warns).push.apply(n,e);return this};e.prototype.info=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n;(n=this.infos).push.apply(n,e);return this};e.prototype.debug=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n;(n=this.debugs).push.apply(n,e);return this};return e}();function dU(e){return function(){fU=new cU;e(fU);pU()}}function hU(e){fU=e;return fU}function pU(){fU=lU;return fU}function vU(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}fU.warn.apply(fU,arguments)}function gU(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}fU.info.apply(fU,arguments)}function mU(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}fU.debug.apply(fU,arguments)}var yU;(function(e){e.INVALID_SPEC="Invalid spec";e.FIT_NON_SINGLE='Autosize "fit" only works for single views and layered views.';e.CANNOT_FIX_RANGE_STEP_WITH_FIT='Cannot use a fixed value of "rangeStep" when "autosize" is "fit".';function t(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'}e.cannotProjectOnChannelWithoutField=t;function n(e){return'The "nearest" transform is not supported for '+e+" marks."}e.nearestNotSupportForContinuous=n;function r(e){return'Cannot find a selection named "'+e+'"'}e.selectionNotFound=r;e.SCALE_BINDINGS_CONTINUOUS="Scale bindings are currently only supported for scales with unbinned, continuous domains.";function i(e){return'Unknown repeated value "'+e+'".'}e.noSuchRepeatedValue=i;e.CONCAT_CANNOT_SHARE_AXIS="Axes cannot be shared in concatenated views.";e.REPEAT_CANNOT_SHARE_AXIS="Axes cannot be shared in repeated views.";function a(e){return'Cannot set title "anchor" for a '+e+" spec"}e.cannotSetTitleAnchor=a;function o(e){return'Unrecognized parse "'+e+'".'}e.unrecognizedParse=o;function u(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."}e.differentParse=u;function s(e){return"Ignoring an invalid transform: "+DI(e)+"."}e.invalidTransformIgnored=s;e.NO_FIELDS_NEEDS_AS='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function l(e){return"Layer's shared "+e.join(",")+" channel "+(e.length===1?"is":"are")+" overriden"}e.encodingOverridden=l;function f(e){var t=e.parentProjection,n=e.projection;return"Layer's shared projection "+DI(t)+" is overridden by a child projection "+DI(n)+"."}e.projectionOverridden=f;function c(e,t,n){return"Channel "+e+" is a "+t+". Converted to {value: "+DI(n)+"}."}e.primitiveChannelDef=c;function d(e){return'Invalid field type "'+e+'"'}e.invalidFieldType=d;function h(e,t,n){var r=n.scaleType?n.scaleType+" scale":n.zeroFalse?"scale with zero=false":"scale with custom domain that excludes zero";return"A "+r+" is used to encode "+e+"'s "+t+". This can be misleading as the "+(t==="x"?"width":"height")+" of the "+e+" can be arbitrary based on the scale domain. You may want to use point mark instead."}e.nonZeroScaleUsedWithLengthMark=h;function p(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.'}e.invalidFieldTypeForCountAggregate=p;function v(e){return'Invalid aggregation operator "'+e+'"'}e.invalidAggregate=v;function g(e,t,n){return'Invalid field type "'+e+'" for channel "'+t+'", using "'+n+'" instead.'}e.emptyOrInvalidFieldType=g;function m(e,t){var n=t.fill,r=t.stroke;return"Dropping color "+e+" as the plot also has "+(n&&r?"fill and stroke":n?"fill":"stroke")}e.droppingColor=m;function y(e,t){return"Dropping "+DI(e)+' from channel "'+t+'" since it does not contain data field or value.'}e.emptyFieldDef=y;function b(e,t,n){return e+"-encoding with type "+t+" is deprecated. Replacing with "+n+"-encoding."}e.latLongDeprecated=b;e.LINE_WITH_VARYING_SIZE="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function _(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."}e.incompatibleChannel=_;function x(e){return e+"-encoding is dropped as "+e+" is not a valid encoding channel."}e.invalidEncodingChannel=x;function k(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}e.facetChannelShouldBeDiscrete=k;function O(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+(t==="ordinal"?"order":"magnitude")+"."}e.discreteChannelCannotEncode=O;e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.";function w(e,t){var n=e&&t?"x2 and y2":e?"x2":"y2";return"Line mark is for continuous lines and thus cannot be used with "+n+". We will use the rule mark (line segments) instead."}e.lineWithRange=w;function j(e,t){return'Specified orient "'+e+'" overridden with "'+t+'"'}e.orientOverridden=j;e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain";function S(e){return'Cannot use the scale property "'+e+'" with non-color channel.'}e.cannotUseScalePropertyWithNonColor=S;function E(e){return"Using unaggregated domain with raw field has no effect ("+DI(e)+")."}e.unaggregateDomainHasNoEffectForRawField=E;function A(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'}e.unaggregateDomainWithNonSharedDomainOp=A;function z(e){return"Unaggregated domain is currently unsupported for log scale ("+DI(e)+")."}e.unaggregatedDomainWithLogScale=z;function T(e){return'Cannot apply size to non-oriented mark "'+e+'".'}e.cannotApplySizeToNonOrientedMark=T;function M(e){return'rangeStep for "'+e+'" is dropped as top-level '+(e==="x"?"width":"height")+" is provided."}e.rangeStepDropped=M;function N(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'}e.scaleTypeNotWorkWithChannel=N;function D(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'}e.scaleTypeNotWorkWithFieldDef=D;function C(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}e.scalePropertyNotWorkWithScaleType=C;function P(e,t){return'Scale type "'+t+'" does not work with mark "'+e+'".'}e.scaleTypeNotWorkWithMark=P;function R(e,t,n,r){return"Conflicting "+t.toString()+' property "'+e.toString()+'" ('+DI(n)+" and "+DI(r)+").  Using "+DI(n)+"."}e.mergeConflictingProperty=R;function L(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'}e.independentScaleMeansIndependentGuide=L;function I(e){return"Dropping sort property "+DI(e)+" as unioned domains only support boolean or op 'count'."}e.domainSortDropped=I;e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains";e.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.";function F(e){return'Cannot stack "'+e+'" if there is already "'+e+'2"'}e.cannotStackRangedMark=F;function q(e){return"Cannot stack non-linear scale ("+e+")"}e.cannotStackNonLinearScale=q;function U(e){return'Stacking is applied even though the aggregate function is non-summative ("'+e+'")'}e.stackNonSummativeAggregate=U;function W(e,t){return"Invalid "+e+": "+DI(t)}e.invalidTimeUnit=W;function V(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."}e.dayReplacedWithDate=V;function H(e){return"Dropping day from datetime "+DI(e)+" as day cannot be combined with other units."}e.droppedDay=H})(yU||(yU={}));var bU=2006;function _U(e){return!!e&&(!!e.year||!!e.quarter||!!e.month||!!e.date||!!e.day||!!e.hours||!!e.minutes||!!e.seconds||!!e.milliseconds)}var xU=["january","february","march","april","may","june","july","august","september","october","november","december"];var kU=xU.map(function(e){return e.substr(0,3)});var OU=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];var wU=OU.map(function(e){return e.substr(0,3)});function jU(e){if(Object(V["isNumber"])(e)){if(e>4){vU(yU.invalidTimeUnit("quarter",e))}return e-1+""}else{throw new Error(yU.invalidTimeUnit("quarter",e))}}function SU(e){if(Object(V["isNumber"])(e)){return e-1+""}else{var t=e.toLowerCase();var n=xU.indexOf(t);if(n!==-1){return n+""}var r=t.substr(0,3);var i=kU.indexOf(r);if(i!==-1){return i+""}throw new Error(yU.invalidTimeUnit("month",e))}}function EU(e){if(Object(V["isNumber"])(e)){return e%7+""}else{var t=e.toLowerCase();var n=OU.indexOf(t);if(n!==-1){return n+""}var r=t.substr(0,3);var i=wU.indexOf(r);if(i!==-1){return i+""}throw new Error(yU.invalidTimeUnit("day",e))}}function AU(e,t){if(t===void 0){t=false}var n=[];if(t&&e.day!==undefined){if(YI(e).length>1){vU(yU.droppedDay(e));e=QI(e);delete e.day}}if(e.year!==undefined){n.push(e.year)}else if(e.day!==undefined){n.push(bU)}else{n.push(0)}if(e.month!==undefined){var r=t?SU(e.month):e.month;n.push(r)}else if(e.quarter!==undefined){var i=t?jU(e.quarter):e.quarter;n.push(i+"*3")}else{n.push(0)}if(e.date!==undefined){n.push(e.date)}else if(e.day!==undefined){var a=t?EU(e.day):e.day;n.push(a+"+1")}else{n.push(1)}for(var o=0,u=["hours","minutes","seconds","milliseconds"];o<u.length;o++){var s=u[o];if(e[s]!==undefined){n.push(e[s])}else{n.push(0)}}if(e.utc){return"utc("+n.join(", ")+")"}else{return"datetime("+n.join(", ")+")"}}var zU;(function(e){e.YEAR="year";e.MONTH="month";e.DAY="day";e.DATE="date";e.HOURS="hours";e.MINUTES="minutes";e.SECONDS="seconds";e.MILLISECONDS="milliseconds";e.YEARMONTH="yearmonth";e.YEARMONTHDATE="yearmonthdate";e.YEARMONTHDATEHOURS="yearmonthdatehours";e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes";e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds";e.MONTHDATE="monthdate";e.HOURSMINUTES="hoursminutes";e.HOURSMINUTESSECONDS="hoursminutesseconds";e.MINUTESSECONDS="minutesseconds";e.SECONDSMILLISECONDS="secondsmilliseconds";e.QUARTER="quarter";e.YEARQUARTER="yearquarter";e.QUARTERMONTH="quartermonth";e.YEARQUARTERMONTH="yearquartermonth";e.UTCYEAR="utcyear";e.UTCMONTH="utcmonth";e.UTCDAY="utcday";e.UTCDATE="utcdate";e.UTCHOURS="utchours";e.UTCMINUTES="utcminutes";e.UTCSECONDS="utcseconds";e.UTCMILLISECONDS="utcmilliseconds";e.UTCYEARMONTH="utcyearmonth";e.UTCYEARMONTHDATE="utcyearmonthdate";e.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours";e.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes";e.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds";e.UTCMONTHDATE="utcmonthdate";e.UTCHOURSMINUTES="utchoursminutes";e.UTCHOURSMINUTESSECONDS="utchoursminutesseconds";e.UTCMINUTESSECONDS="utcminutesseconds";e.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds";e.UTCQUARTER="utcquarter";e.UTCYEARQUARTER="utcyearquarter";e.UTCQUARTERMONTH="utcquartermonth";e.UTCYEARQUARTERMONTH="utcyearquartermonth"})(zU||(zU={}));var TU={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};var MU=JI(TU);function NU(e){return!!TU[e]}var DU={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};function CU(e){return!!DU[e]}var PU={yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1};var RU={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1};var LU=I["__assign"]({},DU,RU);function IU(e){return!!LU[e]}function FU(e){return e.substr(3)}var qU=I["__assign"]({},TU,DU,PU,RU);var UU=JI(qU);function WU(e){return!!qU[e]}var VU={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};function HU(e,t){var n=IU(e);var r=n?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0);for(var i=0,a=MU;i<a.length;i++){var o=a[i];if($U(e,o)){switch(o){case zU.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case zU.QUARTER:{var u=BU("month",n),s=u.getDateMethod,l=u.setDateMethod;r[l](Math.floor(t[s]()/3)*3);break}default:var f=BU(o,n),c=f.getDateMethod,d=f.setDateMethod;r[d](t[c]())}}}return r}function BU(e,t){var n=VU[e];var r=t?"setUTC"+n.substr(3):n;var i="get"+(t?"UTC":"")+n.substr(3);return{setDateMethod:r,getDateMethod:i}}function GU(e){return MU.reduce(function(t,n){if($U(e,n)){return t.concat(n)}return t},[])}function $U(e,t){var n=e.indexOf(t);return n>-1&&(t!==zU.SECONDS||n===0||e.charAt(n-1)!=="i")}function YU(e,t){var n=rF(t);var r=IU(e)?"utc":"";function i(e){if(e===zU.QUARTER){return"("+r+"quarter("+n+")-1)"}else{return""+r+e+"("+n+")"}}var a=MU.reduce(function(t,n){if($U(e,n)){t[n]=i(n)}return t},{});return AU(a)}function XU(e,t,n,r){if(!e){return undefined}var i=[];var a="";var o=$U(e,zU.YEAR);if($U(e,zU.QUARTER)){a="'Q' + quarter("+t+")"}if($U(e,zU.MONTH)){i.push(n!==false?"%b":"%B")}if($U(e,zU.DAY)){i.push(n?"%a":"%A")}else if($U(e,zU.DATE)){i.push("%d"+(o?",":""))}if(o){i.push(n?"%y":"%Y")}var u=[];if($U(e,zU.HOURS)){u.push("%H")}if($U(e,zU.MINUTES)){u.push("%M")}if($U(e,zU.SECONDS)){u.push("%S")}if($U(e,zU.MILLISECONDS)){u.push("%L")}var s=[];if(i.length>0){s.push(i.join(" "))}if(u.length>0){s.push(u.join(":"))}if(s.length>0){if(a){a+=" + ' ' + "}if(r){a+="utcFormat("+t+", '"+s.join(" ")+"')"}else{a+="timeFormat("+t+", '"+s.join(" ")+"')"}}return a||undefined}function JU(e){if(e!=="day"&&e.indexOf("day")>=0){vU(yU.dayReplacedWithDate(e));return e.replace("day","date")}return e}var QU;(function(e){e.QUANTITATIVE="quantitative";e.ORDINAL="ordinal";e.TEMPORAL="temporal";e.NOMINAL="nominal";e.LATITUDE="latitude";e.LONGITUDE="longitude";e.GEOJSON="geojson"})(QU||(QU={}));var ZU={quantitative:1,ordinal:1,temporal:1,nominal:1,latitude:1,longitude:1,geojson:1};function KU(e){return!!ZU[e]}var eW=QU.QUANTITATIVE;var tW=QU.ORDINAL;var nW=QU.TEMPORAL;var rW=QU.NOMINAL;var iW=QU.GEOJSON;function aW(e){if(e){e=e.toLowerCase();switch(e){case"q":case eW:return"quantitative";case"t":case nW:return"temporal";case"o":case tW:return"ordinal";case"n":case rW:return"nominal";case QU.LATITUDE:return"latitude";case QU.LONGITUDE:return"longitude";case iW:return"geojson"}}return undefined}function oW(e){return e["selection"]}function uW(e){return e&&!Object(V["isString"])(e)&&"repeat"in e}function sW(e){var t=e.field,n=e.timeUnit,r=e.bin,i=e.aggregate;return I["__assign"]({},n?{timeUnit:n}:{},r?{bin:r}:{},i?{aggregate:i}:{},{field:t})}function lW(e){return!!e&&!!e.condition}function fW(e){return!!e&&!!e.condition&&!Object(V["isArray"])(e.condition)&&dW(e.condition)}function cW(e){return!!e&&!!e.condition&&(Object(V["isArray"])(e.condition)||pW(e.condition))}function dW(e){return!!e&&(!!e["field"]||e["aggregate"]==="count")}function hW(e){return dW(e)&&Object(V["isString"])(e.field)}function pW(e){return e&&"value"in e&&e["value"]!==undefined}function vW(e){return!!e&&(!!e["scale"]||!!e["sort"])}function gW(e){return!!e["op"]}function mW(e,t){if(t===void 0){t={}}var n=e.field;var r=t.prefix;var i=t.suffix;if(_W(e)){n="count_*"}else{var a=undefined;if(!t.nofn){if(gW(e)){a=e.op}else if(e.bin){a=Nq(e.bin);i=t.binSuffix||""}else if(e.aggregate){a=String(e.aggregate)}else if(e.timeUnit){a=String(e.timeUnit)}}if(a){n=n?a+"_"+n:a}}if(i){n=n+"_"+i}if(r){n=r+"_"+n}if(t.expr){return iF(n,t.expr)}else{return aF(n)}}function yW(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return true;case"quantitative":return!!e.bin;case"latitude":case"longitude":case"temporal":return false}throw new Error(yU.invalidFieldType(e.type))}function bW(e){return!yW(e)}function _W(e){return e.aggregate==="count"}function xW(e,t){var n=e.field,r=e.bin,i=e.timeUnit,a=e.aggregate;if(a==="count"){return t.countTitle}else if(r){return n+" (binned)"}else if(i){var o=GU(i).join("-");return n+" ("+o+")"}else if(a){return nF(a)+" of "+n}return n}function kW(e,t){var n=e.aggregate||e.timeUnit||e.bin&&"bin";if(n){return n.toUpperCase()+"("+e.field+")"}else{return e.field}}var OW=function(e,t){switch(t.fieldTitle){case"plain":return e.field;case"functional":return kW(e,t);default:return xW(e,t)}};var wW=OW;function jW(e){wW=e}function SW(){jW(OW)}function EW(e,t){return wW(e,t)}function AW(e,t){if(e.timeUnit){return"temporal"}if(e.bin){return"quantitative"}switch(Mq(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function zW(e){if(dW(e)){return e}else if(fW(e)){return e.condition}return undefined}function TW(e,t){if(Object(V["isString"])(e)||Object(V["isNumber"])(e)||Object(V["isBoolean"])(e)){var n=Object(V["isString"])(e)?"string":Object(V["isNumber"])(e)?"number":"boolean";vU(yU.primitiveChannelDef(t,n,e));return{value:e}}if(dW(e)){return MW(e,t)}else if(fW(e)){return I["__assign"]({},e,{condition:MW(e.condition,t)})}return e}function MW(e,t){if(e.aggregate&&!fF(e.aggregate)){var n=e.aggregate,r=I["__rest"](e,["aggregate"]);vU(yU.invalidAggregate(e.aggregate));e=r}if(e.timeUnit){e=I["__assign"]({},e,{timeUnit:JU(e.timeUnit)})}if(e.bin){e=I["__assign"]({},e,{bin:NW(e.bin,t)})}if(e.type){var i=aW(e.type);if(e.type!==i){e=I["__assign"]({},e,{type:i})}if(e.type!=="quantitative"){if(dF(e.aggregate)){vU(yU.invalidFieldTypeForCountAggregate(e.type,e.aggregate));e=I["__assign"]({},e,{type:"quantitative"})}}}else{var a=AW(e,t);vU(yU.emptyOrInvalidFieldType(e.type,t,a));e=I["__assign"]({},e,{type:a})}var o=CW(e,t),u=o.compatible,s=o.warning;if(!u){vU(s)}return e}function NW(e,t){if(Object(V["isBoolean"])(e)){return{maxbins:Cq(t)}}else if(!e.maxbins&&!e.step){return I["__assign"]({},e,{maxbins:Cq(t)})}else{return e}}var DW={compatible:true};function CW(e,t){var n=e.type;switch(t){case"row":case"column":if(bW(e)){return{compatible:false,warning:yU.facetChannelShouldBeDiscrete(t)}}return DW;case"x":case"y":case"color":case"fill":case"stroke":case"text":case"detail":case"key":case"tooltip":case"href":return DW;case"longitude":case"longitude2":case"latitude":case"latitude2":if(n!==eW){return{compatible:false,warning:"Channel "+t+" should be used with a quantitative field only, not "+e.type+" field."}}return DW;case"opacity":case"size":case"x2":case"y2":if(n==="nominal"&&!e["sort"]||n==="geojson"){return{compatible:false,warning:"Channel "+t+" should not be used with an unsorted discrete field."}}return DW;case"shape":if(e.type!=="nominal"&&e.type!=="geojson"){return{compatible:false,warning:"Shape channel should be used with only either nominal or geojson data"}}return DW;case"order":if(e.type==="nominal"&&!("sort"in e)){return{compatible:false,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}return DW}throw new Error("channelCompatability not implemented for channel "+t)}function PW(e){return e.type==="quantitative"||!!e.bin}function RW(e){return e.type==="temporal"||!!e.timeUnit}function LW(e,t){var n=t.timeUnit,r=t.type,i=t.time,a=t.undefinedIfExprNotRequired;var o;var u=undefined;if(_U(e)){u=AU(e,true)}else if(Object(V["isString"])(e)||Object(V["isNumber"])(e)){if(n||r==="temporal"){if(NU(n)){u=AU((o={},o[n]=e,o),true)}else if(CU(n)){u=LW(e,{timeUnit:FU(n)})}else{u="datetime("+JSON.stringify(e)+")"}}}if(u){return i?"time("+u+")":u}return a?undefined:JSON.stringify(e)}function IW(e,t){var n=e.timeUnit,r=e.type;return t.map(function(e){var t=LW(e,{timeUnit:n,type:r,undefinedIfExprNotRequired:true});if(t!==undefined){return{signal:t}}return e})}function FW(e,t){var n=e&&e[t];if(n){if(Object(V["isArray"])(n)){return II(n,function(e){return!!e.field})}else{return dW(n)||fW(n)}}return false}function qW(e){return II(KF,function(t){if(FW(e,t)){var n=e[t];if(Object(V["isArray"])(n)){return II(n,function(e){return!!e.aggregate})}else{var r=zW(n);return r&&!!r.aggregate}}return false})}function UW(e,t){return YI(e).reduce(function(n,r){var i;if(!iq(r)){vU(yU.invalidEncodingChannel(r));return n}if(!zq(r,t)){vU(yU.incompatibleChannel(r,t));return n}if(r==="size"&&t==="line"){var a=zW(e[r]);if(a&&a.aggregate){vU(yU.LINE_WITH_VARYING_SIZE);return n}}if(r==="color"&&("fill"in e||"stroke"in e)){vU(yU.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e}));return n}var o=e[r];if(r==="detail"||r==="order"&&!Object(V["isArray"])(o)&&!pW(o)||r==="tooltip"&&Object(V["isArray"])(o)){if(o){n[r]=(Object(V["isArray"])(o)?o:[o]).reduce(function(e,t){if(!dW(t)){vU(yU.emptyFieldDef(t,r))}else{e.push(MW(t,r))}return e},[])}}else{var a=zW(e[r]);if(a&&PI([QU.LATITUDE,QU.LONGITUDE],a.type)){var u=r,s=n[u],l=I["__rest"](n,[typeof u==="symbol"?u:u+""]);var f=r==="x"?"longitude":r==="y"?"latitude":r==="x2"?"longitude2":r==="y2"?"latitude2":undefined;vU(yU.latLongDeprecated(r,a.type,f));return I["__assign"]({},l,(i={},i[f]=I["__assign"]({},TW(a,r),{type:"quantitative"}),i))}if(!dW(o)&&!pW(o)&&!lW(o)){vU(yU.emptyFieldDef(o,r));return n}n[r]=TW(o,r)}return n},{})}function WW(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function VW(e){var t=[];KF.forEach(function(n){if(FW(e,n)){var r=e[n];(Object(V["isArray"])(r)?r:[r]).forEach(function(e){if(dW(e)){t.push(e)}else if(fW(e)){t.push(e.condition)}})}});return t}function HW(e,t,n){if(!e){return}var r=function(r){if(Object(V["isArray"])(e[r])){e[r].forEach(function(e){t.call(n,e,r)})}else{t.call(n,e[r],r)}};for(var i=0,a=YI(e);i<a.length;i++){var o=a[i];r(o)}}function BW(e,t,n,r){if(!e){return n}return YI(e).reduce(function(n,i){var a=e[i];if(Object(V["isArray"])(a)){return a.reduce(function(e,n){return t.call(r,e,n,i)},n)}else{return t.call(r,n,a,i)}},n)}function GW(e,t){var n;var r=e[t];return r!==undefined?(n={},n[t]={value:r},n):{}}var $W="box-plot";function YW(e){return!!e["type"]}var XW=["boxWhisker","box","boxMid"];var JW={box:["size","color","extent"],boxWhisker:["color"],boxMid:["color"]};var QW=["x","y","color","detail","opacity","size"];function ZW(e){return I["__assign"]({},e,{encoding:BW(e.encoding,function(e,t,n){if(QW.indexOf(n)>-1){e[n]=t}else{vU(yU.incompatibleChannel(n,$W))}return e},{})})}function KW(e,t){var n,r,i,a;e=ZW(e);var o=e.mark,u=e.encoding,s=e.selection,l=e.projection,f=I["__rest"](e,["mark","encoding","selection","projection"]);var c=undefined;if(Object(V["isNumber"])(t.box.extent)){c=t.box.extent}if(YW(o)){if(o.extent){if(o.extent==="min-max"){c=undefined}}}var d=eV(e);var h=nV(e,d,c),p=h.transform,v=h.continuousAxisChannelDef,g=h.continuousAxis,m=h.encodingWithoutContinuousAxis;var y=m.color,b=m.size,_=I["__rest"](m,["color","size"]);var x=b?{size:b}:GW(t.box,"size");var k={};if(v.scale){k["scale"]=v.scale}if(v.axis){k["axis"]=v.axis}return I["__assign"]({},f,{transform:p,layer:[{mark:{type:"rule",style:"boxWhisker"},encoding:I["__assign"]((n={},n[g]=I["__assign"]({field:"lower_whisker_"+v.field,type:v.type},k),n[g+"2"]={field:"lower_box_"+v.field,type:v.type},n),_,GW(t.boxWhisker,"color"))},{mark:{type:"rule",style:"boxWhisker"},encoding:I["__assign"]((r={},r[g]={field:"upper_box_"+v.field,type:v.type},r[g+"2"]={field:"upper_whisker_"+v.field,type:v.type},r),_,GW(t.boxWhisker,"color"))},I["__assign"]({},s?{selection:s}:{},{mark:{type:"bar",style:"box"},encoding:I["__assign"]((i={},i[g]={field:"lower_box_"+v.field,type:v.type},i[g+"2"]={field:"upper_box_"+v.field,type:v.type},i),m,m.color?{}:GW(t.box,"color"),x)}),{mark:{type:"tick",style:"boxMid"},encoding:I["__assign"]((a={},a[g]={field:"mid_box_"+v.field,type:v.type},a),_,GW(t.boxMid,"color"),x)}]})}function eV(e){var t=e.mark,n=e.encoding,r=e.projection,i=I["__rest"](e,["mark","encoding","projection"]);if(dW(n.x)&&bW(n.x)){if(dW(n.y)&&bW(n.y)){if(n.x.aggregate===undefined&&n.y.aggregate===$W){return"vertical"}else if(n.y.aggregate===undefined&&n.x.aggregate===$W){return"horizontal"}else if(n.x.aggregate===$W&&n.y.aggregate===$W){throw new Error("Both x and y cannot have aggregate")}else{if(YW(t)&&t.orient){return t.orient}return"vertical"}}return"horizontal"}else if(dW(n.y)&&bW(n.y)){return"vertical"}else{throw new Error("Need a valid continuous axis for boxplots")}}function tV(e,t){var n=e.mark,r=e.encoding,i=e.projection,a=I["__rest"](e,["mark","encoding","projection"]);var o;var u;if(t==="vertical"){u="y";o=r.y}else{u="x";o=r.x}if(o&&o.aggregate){var s=o.aggregate,l=I["__rest"](o,["aggregate"]);if(s!==$W){vU("Continuous axis should not have customized aggregation function "+s)}o=l}return{continuousAxisChannelDef:o,continuousAxis:u}}function nV(e,t,n){var r=tV(e,t),i=r.continuousAxisChannelDef,a=r.continuousAxis;var o=e.encoding;var u=n===undefined;var s=[{op:"q1",field:i.field,as:"lower_box_"+i.field},{op:"q3",field:i.field,as:"upper_box_"+i.field},{op:"median",field:i.field,as:"mid_box_"+i.field}];var l=[];s.push({op:"min",field:i.field,as:(u?"lower_whisker_":"min_")+i.field});s.push({op:"max",field:i.field,as:(u?"upper_whisker_":"max_")+i.field});if(!u){l=[{calculate:"datum.upper_box_"+i.field+" - datum.lower_box_"+i.field,as:"iqr_"+i.field},{calculate:"min(datum.upper_box_"+i.field+" + datum.iqr_"+i.field+" * "+n+", datum.max_"+i.field+")",as:"upper_whisker_"+i.field},{calculate:"max(datum.lower_box_"+i.field+" - datum.iqr_"+i.field+" * "+n+", datum.min_"+i.field+")",as:"lower_whisker_"+i.field}]}var f=[];var c=[];var d=[];var h={};HW(o,function(e,t){if(t===a){return}if(dW(e)){if(e.aggregate&&e.aggregate!==$W){s.push({op:e.aggregate,field:e.field,as:mW(e)})}else if(e.aggregate===undefined){var n=mW(e);var r=e.bin;if(r){var i=e.field;c.push({bin:r,field:i,as:n})}else if(e.timeUnit){var u=e.timeUnit,i=e.field;d.push({timeUnit:u,field:i,as:n})}f.push(n)}h[t]={field:mW(e),type:e.type}}else{h[t]=o[t]}});return{transform:[].concat(c,d,[{aggregate:s,groupby:f}],l),continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:h}}var rV="error-bar";function iV(e){var t=e.mark,n=e.selection,r=e.projection,i=e.encoding,a=I["__rest"](e,["mark","selection","projection","encoding"]);var o=i.size,u=I["__rest"](i,["size"]);var s=i.x2,l=i.y2,f=I["__rest"](i,["x2","y2"]);var c=f.x,d=f.y,h=I["__rest"](f,["x","y"]);if(!i.x2&&!i.y2){throw new Error("Neither x2 or y2 provided")}return I["__assign"]({},a,{layer:[{mark:"rule",encoding:u},{mark:"tick",encoding:f},{mark:"tick",encoding:i.x2?I["__assign"]({x:i.x2,y:i.y},h):I["__assign"]({x:i.x,y:i.y2},h)}]})}var aV={};function oV(e,t){aV[e]=t}function uV(e){delete aV[e]}var sV=XW;var lV=I["__assign"]({},JW);oV($W,KW);oV(rV,iV);function fV(e,t){var n=Zq(e.mark)?e.mark.type:e.mark;var r=aV[n];if(r){return r(e,t)}throw new Error('Invalid mark type "'+n+'"')}var cV=["shortTimeLabels"];var dV={};var hV={entryPadding:1,format:1,offset:1,orient:1,padding:1,tickCount:1,title:1,type:1,values:1,zindex:1};var pV=I["__assign"]({},hV,{opacity:1,shape:1,stroke:1,fill:1,size:1,encode:1});var vV=JI(hV);var gV=JI(pV);var mV;(function(e){e.LINEAR="linear";e.BIN_LINEAR="bin-linear";e.LOG="log";e.POW="pow";e.SQRT="sqrt";e.TIME="time";e.UTC="utc";e.SEQUENTIAL="sequential";e.QUANTILE="quantile";e.QUANTIZE="quantize";e.THRESHOLD="threshold";e.ORDINAL="ordinal";e.BIN_ORDINAL="bin-ordinal";e.POINT="point";e.BAND="band"})(mV||(mV={}));var yV={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"};var bV=YI(yV);function _V(e,t){var n=yV[e];var r=yV[t];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}var xV={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};function kV(e){return xV[e]}var OV=["linear","bin-linear","log","pow","sqrt","time","utc"];var wV=Object(V["toSet"])(OV);var jV=OV.concat(["sequential"]);var SV=Object(V["toSet"])(jV);var EV=["ordinal","bin-ordinal","point","band"];var AV=Object(V["toSet"])(EV);var zV=Object(V["toSet"])(["bin-linear","bin-ordinal"]);var TV=["time","utc"];function MV(e){return e in AV}function NV(e){return e in zV}function DV(e){return e in SV}function CV(e){return e in wV}var PV={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4};function RV(e){return e&&!!e["name"]}function LV(e){return e&&e["selection"]}var IV={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};var FV=JI(IV);var qV=IV.type,UV=IV.domain,WV=IV.range,VV=IV.rangeStep,HV=IV.scheme,BV=I["__rest"](IV,["type","domain","range","rangeStep","scheme"]);var GV=JI(BV);var $V=KV();function YV(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return true;case"scheme":return PI(["sequential","ordinal","bin-ordinal","quantile","quantize"],e);case"interpolate":return PI(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return CV(e)||e==="band"||e==="point";case"padding":return CV(e)||PI(["point","band"],e);case"paddingOuter":case"rangeStep":return PI(["point","band"],e);case"paddingInner":return e==="band";case"clamp":return CV(e)||e==="sequential";case"nice":return CV(e)||e==="sequential"||e==="quantize";case"exponent":return e==="pow";case"base":return e==="log";case"zero":return DV(e)&&!PI(["log","time","utc","bin-linear","threshold","quantile"],e)}throw new Error("Invalid scale property "+t+".")}function XV(e,t){switch(t){case"interpolate":case"scheme":if(!JF(e)){return yU.cannotUseScalePropertyWithNonColor(e)}return undefined;case"type":case"domain":case"range":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return undefined}throw new Error('Invalid scale property "'+t+'".')}function JV(e,t,n){if(PI([QU.ORDINAL,QU.NOMINAL],t)){return e===undefined||MV(e)}else if(t===QU.TEMPORAL){return PI([mV.TIME,mV.UTC,mV.SEQUENTIAL,undefined],e)}else if(t===QU.QUANTITATIVE){if(n){return PI([mV.BIN_LINEAR,mV.BIN_ORDINAL,mV.LINEAR],e)}return PI([mV.LOG,mV.POW,mV.SQRT,mV.QUANTILE,mV.QUANTIZE,mV.LINEAR,mV.SEQUENTIAL,undefined],e)}return true}function QV(e,t){switch(e){case wF.X:case wF.Y:case wF.SIZE:case wF.OPACITY:return CV(t)||PI(["band","point"],t);case wF.COLOR:case wF.FILL:case wF.STROKE:return t!=="band";case wF.SHAPE:return t==="ordinal"}return false}function ZV(e,t,n){return $V[eH(e,t,n)]}function KV(){var e={};for(var t=0,n=KF;t<n.length;t++){var r=n[t];for(var i=0,a=YI(ZU);i<a.length;i++){var o=a[i];for(var u=0,s=bV;u<s.length;u++){var l=s[u];for(var f=0,c=[false,true];f<c.length;f++){var d=c[f];var h=eH(r,o,d);if(QV(r,l)&&JV(l,o,d)){e[h]=e[h]||[];e[h].push(l)}}}}}return e}function eH(e,t,n){var r=e+"_"+t;return n?r+"_bin":r}var tH="_vgsid_";var nH={single:{on:"click",fields:[tH],resolve:"global",empty:"all"},multi:{on:"click",fields:[tH],toggle:"event.shiftKey",resolve:"global",empty:"all"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global"}};function rH(e){var t=e.anchor,n=e.offset,r=e.orient,i=e.color,a=I["__rest"](e,["anchor","offset","orient","color"]);var o=I["__assign"]({},a,i?{fill:i}:{});var u=I["__assign"]({},t?{anchor:t}:{},n?{offset:n}:{},r?{orient:r}:{});return{mark:o,nonMark:u}}var iH={width:200,height:200};var aH={padding:5,timeFormat:"",countTitle:"Number of Records",invalidValues:"filter",view:iH,mark:oU,area:{},bar:uU,circle:{},geoshape:{},line:{},point:{},rect:{},rule:{color:"black"},square:{},text:{color:"black"},tick:sU,trail:{},box:{size:14,extent:1.5},boxWhisker:{},boxMid:{color:"white"},scale:PV,projection:{},axis:{},axisX:{},axisY:{minExtent:30},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:dV,selection:nH,style:{},title:{}};function oH(e){return UI(QI(aH),e)}var uH=["view"].concat(Qq,sV);var sH=["padding","numberFormat","timeFormat","countTitle","stack","scale","selection","invalidValues","overlay"];var lH=I["__assign"]({view:["width","height"]},aU,lV);function fH(e){e=QI(e);for(var t=0,n=sH;t<n.length;t++){var r=n[t];delete e[r]}if(e.axis){for(var i=0,a=cV;i<a.length;i++){var r=a[i];delete e.axis[r]}}if(e.legend){for(var o=0,u=cV;o<u.length;o++){var r=u[o];delete e.legend[r]}}if(e.mark){for(var s=0,l=iU;s<l.length;s++){var r=l[s];delete e.mark[r]}}for(var f=0,c=uH;f<c.length;f++){var d=c[f];for(var h=0,p=iU;h<p.length;h++){var r=p[h];delete e[d][r]}var v=lH[d];if(v){for(var g=0,m=v;g<m.length;g++){var r=m[g];delete e[d][r]}}cH(e,d)}cH(e,"title","group-title");for(var r in e){if(Object(V["isObject"])(e[r])&&YI(e[r]).length===0){delete e[r]}}return YI(e).length>0?e:undefined}function cH(e,t,n){var r=t==="title"?rH(e.title).mark:e[t];if(t==="view"){n="cell"}var i=I["__assign"]({},r,e.style[t]);if(YI(i).length>0){e.style[n||t]=i}delete e[t]}var dH={zero:1,center:1,normalize:1};function hH(e){return!!dH[e]}var pH=[Lq,Rq,Hq,Fq,Gq,$q,Iq,qq,Uq];var vH=[Lq,Rq];function gH(e){var t=e.x;var n=e.y;if(dW(t)&&dW(n)){if(t.type==="quantitative"&&n.type==="quantitative"){if(t.stack){return"x"}else if(n.stack){return"y"}if(!!t.aggregate!==!!n.aggregate){return t.aggregate?"x":"y"}}else if(t.type==="quantitative"){return"x"}else if(n.type==="quantitative"){return"y"}}else if(dW(t)&&t.type==="quantitative"){return"x"}else if(dW(n)&&n.type==="quantitative"){return"y"}return undefined}function mH(e,t,n){var r=Zq(e)?e.type:e;if(!PI(pH,r)){return null}var i=gH(t);if(!i){return null}var a=t[i];var o=hW(a)?mW(a,{}):undefined;var u=i==="x"?"y":"x";var s=t[u];var l=hW(s)?mW(s,{}):undefined;var f=vq.reduce(function(e,n){if(FW(t,n)){var r=t[n];(Object(V["isArray"])(r)?r:[r]).forEach(function(t){var r=zW(t);if(r.aggregate){return}var i=hW(r)?mW(r,{}):undefined;if(!i||i!==l&&i!==o){e.push({channel:n,fieldDef:r})}})}return e},[]);if(f.length===0){return null}var c=undefined;if(a.stack!==undefined){c=a.stack}else if(PI(vH,r)){c=n===undefined?"zero":n}else{c=n}if(!c||!hH(c)){return null}if(a.scale&&a.scale.type&&a.scale.type!==mV.LINEAR){vU(yU.cannotStackNonLinearScale(a.scale.type))}if(FW(t,i===jF?EF:AF)){if(a.stack!==undefined){vU(yU.cannotStackRangedMark(i))}return null}if(a.aggregate&&!PI(hF,a.aggregate)){vU(yU.stackNonSummativeAggregate(a.aggregate))}return{groupbyChannel:s?u:undefined,fieldChannel:i,impute:Jq(r),stackBy:f,offset:c}}function yH(e){return e["facet"]!==undefined}function bH(e){return!!e["mark"]}function _H(e){return e["layer"]!==undefined}function xH(e){return e["repeat"]!==undefined}function kH(e){return OH(e)||wH(e)}function OH(e){return e["vconcat"]!==undefined}function wH(e){return e["hconcat"]!==undefined}function jH(e,t){if(yH(e)){return SH(e,t)}if(_H(e)){return zH(e,t)}if(xH(e)){return TH(e,t)}if(OH(e)){return MH(e,t)}if(wH(e)){return NH(e,t)}if(bH(e)){var n=FW(e.encoding,DF);var r=FW(e.encoding,CF);if(n||r){return DH(e,t)}return LH(e,t)}throw new Error(yU.INVALID_SPEC)}function SH(e,t){var n=e.spec,r=I["__rest"](e,["spec"]);return I["__assign"]({},r,{spec:jH(n,t)})}function EH(e){var t=e.parentEncoding,n=e.encoding;if(t&&n){var r=YI(t).reduce(function(e,t){if(n[t]){e.push(t)}return e},[]);if(r.length>0){vU(yU.encodingOverridden(r))}}var i=I["__assign"]({},t||{},n||{});return YI(i).length>0?i:undefined}function AH(e){var t=e.parentProjection,n=e.projection;if(t&&n){vU(yU.projectionOverridden({parentProjection:t,projection:n}))}return n||t}function zH(e,t,n,r){var i=e.layer,a=e.encoding,o=e.projection,u=I["__rest"](e,["layer","encoding","projection"]);var s=EH({parentEncoding:n,encoding:a});var l=AH({parentProjection:r,projection:o});return I["__assign"]({},u,{layer:i.map(function(e){if(_H(e)){return zH(e,t,s,l)}return LH(e,t,s,l)})})}function TH(e,t){var n=e.spec,r=I["__rest"](e,["spec"]);return I["__assign"]({},r,{spec:jH(n,t)})}function MH(e,t){var n=e.vconcat,r=I["__rest"](e,["vconcat"]);return I["__assign"]({},r,{vconcat:n.map(function(e){return jH(e,t)})})}function NH(e,t){var n=e.hconcat,r=I["__rest"](e,["hconcat"]);return I["__assign"]({},r,{hconcat:n.map(function(e){return jH(e,t)})})}function DH(e,t){var n=e.encoding,r=n.row,i=n.column,a=I["__rest"](n,["row","column"]);var o=e.mark,u=e.width,s=e.projection,l=e.height,f=e.selection,c=e.encoding,d=I["__rest"](e,["mark","width","projection","height","selection","encoding"]);return I["__assign"]({},d,{facet:I["__assign"]({},r?{row:r}:{},i?{column:i}:{}),spec:LH(I["__assign"]({},s?{projection:s}:{},{mark:o},u?{width:u}:{},l?{height:l}:{},{encoding:a},f?{selection:f}:{}),t)})}function CH(e){return eU(e.mark)}function PH(e,t,n){if(e.point==="transparent"){return{opacity:0}}else if(e.point){return Object(V["isObject"])(e.point)?e.point:{}}else if(e.point!==undefined){return null}else{if(t.point||n.shape){return Object(V["isObject"])(t.point)?t.point:{}}return null}}function RH(e,t){if(e.line){return e.line===true?{}:e.line}else if(e.line!==undefined){return null}else{if(t.line){return t.line===true?{}:t.line}return null}}function LH(e,t,n,r){var i=e.encoding,a=e.projection;var o=Zq(e.mark)?e.mark.type:e.mark;if(n||r){var u=AH({parentProjection:r,projection:a});var s=EH({parentEncoding:n,encoding:i});return LH(I["__assign"]({},e,u?{projection:u}:{},s?{encoding:s}:{}),t)}if(CH(e)){if(WW(i)){return IH(e)}if(o==="line"&&(i.x2||i.y2)){vU(yU.lineWithRange(!!i.x2,!!i.y2));return LH(I["__assign"]({mark:"rule"},e),t,n,r)}if(Jq(o)){return qH(e,t)}return e}else{return fV(e,t)}}function IH(e){var t=FW(e.encoding,jF);var n=FW(e.encoding,SF);var r=FW(e.encoding,EF);var i=FW(e.encoding,AF);if(r&&!t||i&&!n){var a=QI(e);if(r&&!t){a.encoding.x=a.encoding.x2;delete a.encoding.x2}if(i&&!n){a.encoding.y=a.encoding.y2;delete a.encoding.y2}return a}return e}function FH(e){var t=e.point,n=e.line,r=I["__rest"](e,["point","line"]);return YI(r).length>1?r:r.type}function qH(e,t){if(t===void 0){t={}}var n;var r=e.selection,i=e.projection,a=e.encoding,o=e.mark,u=I["__rest"](e,["selection","projection","encoding","mark"]);var s=Zq(o)?o:{type:o};var l=PH(s,t[s.type],a);var f=s.type==="area"&&RH(s,t[s.type]);if(!l&&!f){return I["__assign"]({},e,{mark:FH(s)})}var c=[I["__assign"]({},r?{selection:r}:{},{mark:FH(I["__assign"]({},s,s.type==="area"?{opacity:.7}:{})),encoding:NI(a,["shape"])})];var d=mH(s,a,t?t.stack:undefined);var h=a;if(d){var p=d.fieldChannel,v=d.offset;h=I["__assign"]({},a,(n={},n[p]=I["__assign"]({},a[p],v?{stack:v}:{}),n))}if(f){c.push(I["__assign"]({},i?{projection:i}:{},{mark:I["__assign"]({type:"line"},MI(s,["clip","interpolate"]),f),encoding:h}))}if(l){c.push(I["__assign"]({},i?{projection:i}:{},{mark:I["__assign"]({type:"point",opacity:1,filled:true},MI(s,["clip"]),l),encoding:h}))}return I["__assign"]({},u,{layer:c})}function UH(e,t){t.forEach(function(t){var n=["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,n){if(t[n]!==undefined){e[n]=t[n]}return e},{});var r=CI(n);e[r]=e[r]||t});return e}function WH(e,t){if(t===void 0){t={}}if(_H(e)){e.layer.forEach(function(e){if(bH(e)){UH(t,VW(e.encoding))}else{WH(e,t)}})}else if(yH(e)){UH(t,VW(e.facet));WH(e.spec,t)}else if(xH(e)){WH(e.spec,t)}else if(kH(e)){var n=OH(e)?e.vconcat:e.hconcat;n.forEach(function(e){return WH(e,t)})}else{UH(t,VW(e.encoding))}return t}function VH(e){return XI(WH(e))}function HH(e,t){t=t||e.config;if(eU(e.mark)){return mH(e.mark,e.encoding,t?t.stack:undefined)!==null}return false}function BH(e){var t=e||{},n=t.align,r=n===void 0?undefined:n,i=t.center,a=i===void 0?undefined:i,o=t.bounds,u=o===void 0?undefined:o,s=t.spacing,l=s===void 0?undefined:s;return{align:r,bounds:u,center:a,spacing:l}}function GH(e){return Object(V["isString"])(e)?{type:e}:e||{}}function $H(e,t,n){if(n===void 0){n=true}var r=I["__assign"]({type:"pad"},GH(t),GH(e));if(r.type==="fit"){if(!n){vU(yU.FIT_NON_SINGLE);r.type="pad"}}return r}var YH=["background","padding","datasets"];function XH(e){return YH.reduce(function(t,n){if(e&&e[n]!==undefined){t[n]=e[n]}return t},{})}function JH(e){return!!e["url"]}function QH(e){return!!e["values"]}function ZH(e){return!!e["name"]&&!JH(e)&&!QH(e)}var KH="main";var eB="raw";function tB(e){return!!e["signal"]}function nB(e){return!!e["step"]}function rB(e){if(!Object(V["isArray"])(e)){return"fields"in e&&!("data"in e)}return false}function iB(e){if(!Object(V["isArray"])(e)){return"fields"in e&&"data"in e}return false}function aB(e){if(!Object(V["isArray"])(e)){return"field"in e&&"data"in e}return false}function oB(e){if(!Object(V["isArray"])(e)){return"signal"in e}return false}var uB={opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeMiterLimit:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,cursor:1,href:1,tooltip:1,cornerRadius:1};var sB=JI(uB);function lB(e,t){if(Object(V["isArray"])(e)){return e.map(function(e){return EW(e,t)}).join(", ")}return e}function fB(e,t,n,r){if(r===void 0){r={header:false}}var i=e.combine(),a=i.orient,o=i.scale,u=i.title,s=i.zindex,l=I["__rest"](i,["orient","scale","title","zindex"]);YI(l).forEach(function(e){var n=mF[e];if(n&&n!==t&&n!=="both"){delete l[e]}});if(t==="grid"){if(!l.grid){return undefined}if(l.encode){var f=l.encode.grid;l.encode=I["__assign"]({},f?{grid:f}:{});if(YI(l.encode).length===0){delete l.encode}}return I["__assign"]({scale:o,orient:a},l,{domain:false,labels:false,maxExtent:0,minExtent:0,ticks:false,zindex:s!==undefined?s:0})}else{if(!r.header&&e.mainExtracted){return undefined}if(l.encode){for(var c=0,d=gF;c<d.length;c++){var h=d[c];if(!e.hasAxisPart(h)){delete l.encode[h]}}if(YI(l.encode).length===0){delete l.encode}}var p=lB(u,n);return I["__assign"]({scale:o,orient:a,grid:false},p?{title:p}:{},l,{zindex:s!==undefined?s:1})}}function cB(e,t){var n=e.x,r=n===void 0?[]:n,i=e.y,a=i===void 0?[]:i;return r.map(function(e){return fB(e,"main",t)}).concat(r.map(function(e){return fB(e,"grid",t)}),a.map(function(e){return fB(e,"main",t)}),a.map(function(e){return fB(e,"grid",t)})).filter(function(e){return e})}var dB={titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontWeight:"fontWeight",titleLimit:"limit"};var hB={labelAngle:"angle",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelLimit:"limit"};var pB=Object.keys(dB);var vB=Object.keys(hB);function gB(e){return!!e&&(e["op"]==="count"||!!e["field"])&&!!e["op"]}function mB(e){return!!e&&Object(V["isArray"])(e)}function yB(e,t,n,r,i,a){if(dW(t)&&i&&e===i.fieldChannel){return kB(t,n,{suffix:"end"})}return jB(e,t,n,r,i,a)}function bB(e,t,n,r,i,a,o){if(dW(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)){return kB(t,r,{suffix:"start"})}return jB(e,n,r,i,a,o)}function _B(e,t){var n=e+"Offset";var r=t[n];if(r){return r}return undefined}function xB(e,t,n,r){var i=n==="start"?undefined:"end";return kB(e,t,{binSuffix:i},r?{offset:r}:{})}function kB(e,t,n,r){var i=I["__assign"]({},t?{scale:t}:{},{field:mW(e,n)});if(r){return I["__assign"]({},i,r)}return i}function OB(e,t){if(t===void 0){t=true}return{scale:e,band:t}}function wB(e,t){return{signal:"("+('scale("'+t+'", '+mW(e,{expr:"datum"})+")")+" + "+('scale("'+t+'", '+mW(e,{binSuffix:"end",expr:"datum"})+")")+")/2"}}function jB(e,t,n,r,i,a){if(t){if(dW(t)){if(t.bin){if(PI([jF,SF],e)&&t.type===eW){if(i&&i.impute){return kB(t,n,{binSuffix:"mid"})}return wB(t,n)}return kB(t,n,uG(t,e)?{binSuffix:"range"}:{})}if(r){var o=r.get("type");if(MV(o)){if(o==="band"){return kB(t,n,{binSuffix:"range"},{band:.5})}return kB(t,n,{binSuffix:"range"})}}return kB(t,n,{})}else if(pW(t)){var u=t.value;if(PI(["x","x2"],e)&&u==="width"){return{field:{group:"width"}}}else if(PI(["y","y2"],e)&&u==="height"){return{field:{group:"height"}}}return{value:u}}}return Object(V["isFunction"])(a)?a():a}function SB(e,t){if(e){if(dW(e)){return JB(e,e.format,"datum",t)}else if(pW(e)){return{value:e.value}}}return undefined}function EB(e){return I["__assign"]({},e,{mult:.5})}function AB(e){if(e.get("zero")!==false){return true}var t=e.domains;if(Object(V["isArray"])(t)){return II(t,function(e){return Object(V["isArray"])(e)&&e.length===2&&e[0]<=0&&e[1]>=0})}return false}function zB(e,t,n,r,i){return function(){if(Object(V["isString"])(e)){if(n){var a=r.get("type");if(PI([mV.LOG,mV.TIME,mV.UTC],a)){if(i==="bar"||i==="area"){vU(yU.nonZeroScaleUsedWithLengthMark(i,t,{scaleType:a}))}}else{if(AB(r)){return{scale:n,value:0}}if(i==="bar"||i==="area"){vU(yU.nonZeroScaleUsedWithLengthMark(i,t,{zeroFalse:r.explicit.zero===false}))}}}if(e==="zeroOrMin"){return t==="x"?{value:0}:{field:{group:"height"}}}else{return t==="x"?{field:{group:"width"}}:{value:0}}}return e}}function TB(e,t){if(t===void 0){t={valueOnly:false}}var n,r;var i=e.markDef,a=e.encoding,o=e.config;var u=i.filled,s=i.type;var l={fill:XB("fill",i,o),stroke:XB("stroke",i,o),color:XB("color",i,o)};var f=PI(["bar","point","circle","square","geoshape"],s)?"transparent":undefined;var c={fill:i.fill||l.fill||f,stroke:i.stroke||l.stroke};var d=u?"fill":"stroke";var h=I["__assign"]({},c.fill?{fill:{value:c.fill}}:{},c.stroke?{stroke:{value:c.stroke}}:{});if(a.fill||a.stroke){if(i.color){vU(yU.droppingColor("property",{fill:"fill"in a,stroke:"stroke"in a}))}return I["__assign"]({},RB("fill",e,{defaultValue:c.fill||f}),RB("stroke",e,{defaultValue:c.stroke}))}else if(a.color){return I["__assign"]({},h,RB("color",e,{vgChannel:d,defaultValue:i[d]||i.color||l[d]||l.color||(u?f:undefined)}))}else if(i.fill||i.stroke){if(i.color){vU(yU.droppingColor("property",{fill:"fill"in i,stroke:"stroke"in i}))}return h}else if(i.color){return I["__assign"]({},h,(n={},n[d]={value:i.color},n))}else if(l.fill||l.stroke){return h}else if(l.color){return I["__assign"]({},f?{fill:{value:"transparent"}}:{},(r={},r[d]={value:l.color},r))}return{}}function MB(e,t){return I["__assign"]({},NB(e.markDef,t),TB(e),RB("opacity",e),IB(e),FB(e,"href"))}function NB(e,t){return sB.reduce(function(n,r){if(e[r]!==undefined&&t[r]!=="ignore"){n[r]={value:e[r]}}return n},{})}function DB(e,t){var n;if(t!==undefined){return n={},n[e]={value:t},n}return undefined}function CB(e){return e+" !== null && !isNaN("+e+")"}function PB(e){if(e.config.invalidValues==="filter"){var t=["x","y"].map(function(t){var n=e.getScaleComponent(t);if(n){var r=n.get("type");if(DV(r)){return e.vgField(t,{expr:"datum"})}}return undefined}).filter(function(e){return!!e}).map(CB);if(t.length>0){return{defined:{signal:t.join(" && ")}}}}return{}}function RB(e,t,n){if(n===void 0){n={}}var r=n.defaultValue,i=n.vgChannel;var a=n.defaultRef||(r!==undefined?{value:r}:undefined);var o=t.encoding[e];return LB(t,o,i||e,function(n){return jB(e,n,t.scaleName(e),t.getScaleComponent(e),null,a)})}function LB(e,t,n,r){var i,a;var o=t&&t.condition;var u=r(t);if(o){var s=Object(V["isArray"])(o)?o:[o];var l=s.map(function(t){var n=r(t);var i=oW(t)?bX(e,t.selection):IX(e,t.test);return I["__assign"]({test:i},n)});return i={},i[n]=l.concat(u!==undefined?[u]:[]),i}else{return u!==undefined?(a={},a[n]=u,a):{}}}function IB(e){var t="tooltip";var n=e.encoding[t];if(Object(V["isArray"])(n)){var r=n.map(function(t){var n=t.title!==undefined?t.title:mW(t,{binSuffix:"range"});var r=SB(t,e.config).signal;return'"'+n+'": '+r});return{tooltip:{signal:"{"+r.join(", ")+"}"}}}else{return qB(e,t,n)}}function FB(e,t){if(t===void 0){t="text"}var n=e.encoding[t];return qB(e,t,n)}function qB(e,t,n){return LB(e,n,t,function(t){return SB(t,e.config)})}function UB(e,t,n){var r,i,a;var o=n.scaleName(t);var u=t==="x"?"width":"height";if(n.encoding.size||n.markDef.size!==undefined){var s=n.markDef.orient;if(s){var l=(r={},r[t+"c"]=kB(e,o,{},{band:.5}),r);if(zW(n.encoding.size)){return I["__assign"]({},l,RB("size",n,{vgChannel:u}))}else if(pW(n.encoding.size)){return I["__assign"]({},l,RB("size",n,{vgChannel:u}))}else if(n.markDef.size!==undefined){return I["__assign"]({},l,(i={},i[u]={value:n.markDef.size},i))}}else{vU(yU.cannotApplySizeToNonOrientedMark(n.markDef.type))}}return a={},a[t]=kB(e,o,{binSuffix:"range"}),a[u]=OB(o),a}function WB(e,t,n,r){var i=e==="x"?"xc":"yc";var a=e==="x"?"width":"height";return I["__assign"]({},HB(e,t,n,i),RB("size",t,{defaultRef:r,vgChannel:a}))}function VB(e,t,n,r,i){if(t==="x"){return{x2:xB(e,n,"start",i?0:r),x:xB(e,n,"end",i?r:0)}}else{return{y2:xB(e,n,"start",i?r:0),y:xB(e,n,"end",i?0:r)}}}function HB(e,t,n,r){var i;var a=t.encoding,o=t.mark,u=t.stack;var s=a[e];var l=t.scaleName(e);var f=t.getScaleComponent(e);var c=_B(e,t.markDef);var d=!s&&(a.latitude||a.longitude)?{field:t.getName(e)}:I["__assign"]({},yB(e,a[e],l,f,u,zB(n,e,l,f,o)),c?{offset:c}:{});return i={},i[r||e]=d,i}function BB(e,t,n){var r;var i=e.encoding,a=e.mark,o=e.stack;var u=n==="x2"?"x":"y";var s=i[u];var l=e.scaleName(u);var f=e.getScaleComponent(u);var c=_B(n,e.markDef);var d=!s&&(i.latitude||i.longitude)?{field:e.getName(n)}:I["__assign"]({},bB(n,s,i[n],l,f,o,zB(t,u,l,f,a)),c?{offset:c}:{});return r={},r[n]=d,r}function GB(e,t,n){for(var r=0,i=n;r<i.length;r++){var a=i[r];var o=t[a];if(o!==undefined){e[a]={value:o}}}return e}function $B(e,t,n){for(var r=0,i=n;r<i.length;r++){var a=i[r];var o=XB(a,t.markDef,t.config);if(o!==undefined){e[a]={value:o}}}return e}function YB(e){return[].concat(e.type,e.style||[])}function XB(e,t,n){var r=n.mark[e];var i=n[t.type];if(i[e]!==undefined){r=i[e]}var a=YB(t);for(var o=0,u=a;o<u.length;o++){var s=u[o];var l=n.style[s];var f=e;if(l&&l[f]!==undefined){r=l[f]}}return r}function JB(e,t,n,r){var i=ZB(e,t,r);if(e.bin){var a=mW(e,{expr:n});var o=mW(e,{expr:n,binSuffix:"end"});return{signal:tG(a,o,i,r)}}else if(e.type==="quantitative"){return{signal:""+KB(mW(e,{expr:n,binSuffix:"range"}),i)}}else if(RW(e)){var u=vW(e)&&e["scale"]&&e["scale"].type===mV.UTC;return{signal:nG(mW(e,{expr:n}),e.timeUnit,t,r.text.shortTimeLabels,r.timeFormat,u,true)}}else{return{signal:"''+"+mW(e,{expr:n})}}}function QB(e,t){if(e!==undefined){return e}return t}function ZB(e,t,n){if(e.type===eW){if(t){return t}return n.numberFormat}return undefined}function KB(e,t){return"format("+e+', "'+(t||"")+'")'}function eG(e,t,n){return KB(e,t||n.numberFormat)}function tG(e,t,n,r){return e+" === null || isNaN("+e+') ? "null" : '+eG(e,n,r)+' + " - " + '+eG(t,n,r)}function nG(e,t,n,r,i,a,o){if(o===void 0){o=false}if(!t||n){n=n||i;if(n||o){return(a?"utc":"time")+"Format("+e+", '"+n+"')"}else{return undefined}}else{return XU(t,e,r,a)}}function rG(e,t){return(Object(V["isArray"])(e)?e:[e]).reduce(function(e,n){e.field.push(mW(n,t));e.order.push(n.sort||"ascending");return e},{field:[],order:[]})}function iG(e,t){var n=e.slice();t.forEach(function(e){for(var t=0,r=n;t<r.length;t++){var i=r[t];if(DI(i)===DI(e)){return}}n.push(e)});return n}function aG(e,t){return e===t?e:e+", "+t}function oG(e,t){if(Object(V["isArray"])(e.value)&&Object(V["isArray"])(t.value)){return{explicit:e.explicit,value:iG(e.value,t.value)}}else if(!Object(V["isArray"])(e.value)&&!Object(V["isArray"])(t.value)){return{explicit:e.explicit,value:aG(e.value,t.value)}}throw new Error("It should never reach here")}function uG(e,t){if(!e.bin){console.warn("Only use this method with binned field defs");return false}return Aq(t)&&PI(["ordinal","nominal"],e.type)}function sG(e,t){return YI(e).reduce(function(n,r){var i=e[r];return I["__assign"]({},n,LB(t,i,r,function(e){return{value:e.value}}))},{})}var lG=function(){function e(e,t){this.debugName=t;this._children=[];this._parent=null;if(e){this.parent=e}}e.prototype.clone=function(){throw new Error("Cannot clone node")};e.prototype.producedFields=function(){return{}};e.prototype.dependentFields=function(){return{}};Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e;e.addChild(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:true,configurable:true});e.prototype.numChildren=function(){return this._children.length};e.prototype.addChild=function(e){this._children.push(e)};e.prototype.removeChild=function(e){this._children.splice(this._children.indexOf(e),1)};e.prototype.remove=function(){for(var e=0,t=this._children;e<t.length;e++){var n=t[e];n.parent=this._parent}this._parent.removeChild(this)};e.prototype.insertAsParentOf=function(e){var t=e.parent;t.removeChild(this);this.parent=t;e.parent=this};e.prototype.swapWithParent=function(){var e=this._parent;var t=e.parent;for(var n=0,r=this._children;n<r.length;n++){var i=r[n];i.parent=e}this._children=[];e.removeChild(this);e.parent.removeChild(e);this.parent=t;e.parent=this};return e}();var fG=function(e){I["__extends"](t,e);function t(t,n,r,i){var a=e.call(this,t,n)||this;a.type=r;a.refCounts=i;a._source=a._name=n;if(a.refCounts&&!(a._name in a.refCounts)){a.refCounts[a._name]=0}return a}t.prototype.clone=function(){var e=new this.constructor;e.debugName="clone_"+this.debugName;e._source=this._source;e._name="clone_"+this._name;e.type=this.type;e.refCounts=this.refCounts;e.refCounts[e._name]=0;return e};t.prototype.getSource=function(){this.refCounts[this._name]++;return this._source};t.prototype.isRequired=function(){return!!this.refCounts[this._name]};t.prototype.setSource=function(e){this._source=e};return t}(lG);var cG=function(e){I["__extends"](t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,QI(this.transform))};t.parseAllForSortIndex=function(e,n){n.forEachFieldDef(function(n,r){if(!vW(n)){return}if(mB(n.sort)){var i=n.field,a=n.timeUnit;var o=n.sort;var u=o.map(function(e,t){return UX({field:i,timeUnit:a,equal:e})+" ? "+t+" : "}).join("")+o.length;e=new t(e,{calculate:u,as:dG(n,r)})}});return e};t.prototype.producedFields=function(){var e={};e[this.transform.as]=true;return e};t.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}};return t}(lG);function dG(e,t,n){return mW(e,{prefix:t,suffix:"sort_index",expr:n})}var hG=["row","column"];var pG=["header","footer"];function vG(e){if(e==="top"||e==="left"){return"header"}return"footer"}function gG(e,t){var n=e.component.layoutHeaders[t].title;var r=t==="row"?"left":undefined;var i=e.config?e.config:undefined;var a=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:undefined;return{name:t+"-title",type:"group",role:t+"-title",title:I["__assign"]({text:n,offset:10,orient:r,style:"guide-title"},kG(i,a,pB,dB))}}function mG(e,t){var n=e.component.layoutHeaders[t];var r=[];for(var i=0,a=pG;i<a.length;i++){var o=a[i];if(n[o]){for(var u=0,s=n[o];u<s.length;u++){var l=s[u];r.push(xG(e,t,o,n,l))}}}return r}function yG(e){e=(e%360+360)%360;if((e+90)%180===0){return{}}else if(e<90||270<e){return{align:{value:"right"}}}else if(135<=e&&e<225){return{align:{value:"left"}}}return{}}function bG(e){e=(e%360+360)%360;if(45<=e&&e<=135){return{baseline:"top"}}return{baseline:"middle"}}function _G(e,t){var n=e.sort;if(gB(n)){return{field:mW(n,{expr:"datum"}),order:n.order||"ascending"}}else if(Object(V["isArray"])(n)){return{field:dG(e,t,"datum"),order:"ascending"}}else{return{field:mW(e,{expr:"datum"}),order:n||"ascending"}}}function xG(e,t,n,r,i){var a;if(i){var o=null;var u=r.facetFieldDef;if(u&&i.labels){var s=u.header,l=s===void 0?{}:s;var f=l.format,c=l.labelAngle;var d=e.config?e.config:undefined;var h=I["__assign"]({},yG(c));o=I["__assign"]({text:JB(u,f,"parent",e.config),offset:10,orient:t==="row"?"left":"top",style:"guide-label"},kG(d,u,vB,hB),YI(h).length>0?{encode:{update:h}}:{})}var p=i.axes;var v=p&&p.length>0;if(o||v){var g=t==="row"?"height":"width";return I["__assign"]({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:_G(u,t)}:{},o?{title:o}:{},i.sizeSignal?{encode:{update:(a={},a[g]=i.sizeSignal,a)}}:{},v?{axes:p}:{})}}return null}function kG(e,t,n,r){var i={};for(var a=0,o=n;a<o.length;a++){var u=o[a];if(e&&e.header){if(e.header[u]){i[r[u]]=e.header[u]}}if(t&&t.header){if(t.header[u]){i[r[u]]=t.header[u]}}}return i}function OG(e){return[].concat(wG(e,"width"),wG(e,"height"))}function wG(e,t){var n=t==="width"?"x":"y";var r=e.component.layoutSize.get(t);if(!r||r==="merged"){return[]}var i=e.getSizeSignalRef(t).signal;if(r==="range-step"){var a=e.getScaleComponent(n);if(a){var o=a.get("type");var u=a.get("range");if(MV(o)&&nB(u)){var s=e.scaleName(n);if(xY(e.parent)){var l=e.parent.component.resolve;if(l.scale[n]==="independent"){return[jG(s,u)]}}return[jG(s,u),{name:i,update:SG(s,a,"domain('"+s+"').length")}]}}throw new Error("layout size is range step although there is no rangeStep.")}else{return[{name:i,value:r}]}}function jG(e,t){return{name:e+"_step",value:t.step}}function SG(e,t,n){var r=t.get("type");var i=t.get("padding");var a=t.get("paddingOuter");a=a!==undefined?a:i;var o=t.get("paddingInner");o=r==="band"?o!==undefined?o:i:1;return"bandspace("+n+", "+o+", "+a+") * "+e+"_step"}function EG(e,t){if(wY(t)||xY(t)){return"shared"}else if(OY(t)||kY(t)){return PI(mq,e)?"independent":"shared"}throw new Error("invalid model type for resolve")}function AG(e,t){var n=e.scale[t];var r=PI(mq,t)?"axis":"legend";if(n==="independent"){if(e[r][t]==="shared"){vU(yU.independentScaleMeansIndependentGuide(t))}return"independent"}return e[r][t]||"shared"}var zG=function(){function e(e,t){if(e===void 0){e={}}if(t===void 0){t={}}this.explicit=e;this.implicit=t}e.prototype.clone=function(){return new e(QI(this.explicit),QI(this.implicit))};e.prototype.combine=function(){return I["__assign"]({},this.explicit,this.implicit)};e.prototype.get=function(e){return this.explicit[e]!==undefined?this.explicit[e]:this.implicit[e]};e.prototype.getWithExplicit=function(e){if(this.explicit[e]!==undefined){return{explicit:true,value:this.explicit[e]}}else if(this.implicit[e]!==undefined){return{explicit:false,value:this.implicit[e]}}return{explicit:false,value:undefined}};e.prototype.setWithExplicit=function(e,t){if(t.value!==undefined){this.set(e,t.value,t.explicit)}};e.prototype.set=function(e,t,n){delete this[n?"implicit":"explicit"][e];this[n?"explicit":"implicit"][e]=t;return this};e.prototype.copyKeyFromSplit=function(e,t){if(t.explicit[e]!==undefined){this.set(e,t.explicit[e],true)}else if(t.implicit[e]!==undefined){this.set(e,t.implicit[e],false)}};e.prototype.copyKeyFromObject=function(e,t){if(t[e]!==undefined){this.set(e,t[e],true)}};e.prototype.copyAll=function(e){for(var t=0,n=YI(e.combine());t<n.length;t++){var r=n[t];var i=e.getWithExplicit(r);this.setWithExplicit(r,i)}};return e}();function TG(e){return{explicit:true,value:e}}function MG(e){return{explicit:false,value:e}}function NG(e){return function(t,n,r,i){var a=e(t.value,n.value);if(a>0){return t}else if(a<0){return n}return DG(t,n,r,i)}}function DG(e,t,n,r){if(e.explicit&&t.explicit){vU(yU.mergeConflictingProperty(n,r,e.value,t.value))}return e}function CG(e,t,n,r,i){if(i===void 0){i=DG}if(e===undefined||e.value===undefined){return t}if(e.explicit&&!t.explicit){return e}else if(t.explicit&&!e.explicit){return t}else if(DI(e.value)===DI(t.value)){return e}else{return i(e,t,n,r)}}var PG=function(e){I["__extends"](t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(zG);function RG(e,t,n,r,i){if(i==="gradient"){return undefined}var a=I["__assign"]({},$B({},n,rU),TB(n));switch(n.mark){case Lq:case Uq:case qq:a.shape={value:"square"};break;case Gq:case $q:a.shape={value:n.mark};break;case Fq:case Iq:case Bq:case Rq:break}var o=n.markDef,u=n.encoding;var s=o.filled;if(a.fill){if(r==="fill"||s&&r===LF){delete a.fill}else{if(a.fill["field"]){delete a.fill}else if(Object(V["isArray"])(a.fill)){var l=qG(u.fill||u.color)||o.fill||s&&o.color;if(l){a.fill={value:l}}}}}if(a.stroke){if(r==="stroke"||!s&&r===LF){delete a.stroke}else{if(a.stroke["field"]){delete a.stroke}else if(Object(V["isArray"])(a.stroke)){var f=qG(u.stroke||u.color)||o.stroke||!s&&o.color;if(f){a.stroke={value:f}}}}}if(a.fill&&a.fill["value"]!=="transparent"&&!a.stroke){a.stroke={value:"transparent"}}if(r!==PF){var c=qG(u.shape)||o.shape;if(c){a.shape={value:c}}}if(r!==HF){var d=FG(u.opacity)||o.opacity;if(d){a.opacity={value:d}}}a=I["__assign"]({},a,t);return YI(a).length>0?a:undefined}function LG(e,t,n,r,i){var a={};if(i==="gradient"){var o=FG(n.encoding.opacity)||n.markDef.opacity;if(o){a.opacity={value:o}}}a=I["__assign"]({},a,t);return YI(a).length>0?a:undefined}function IG(e,t,n,r,i){var a=n.legend(r);var o=n.config;var u={};if(RW(e)){var s=n.getScaleComponent(r).get("type")===mV.UTC;var l=nG("datum.value",e.timeUnit,a.format,o.legend.shortTimeLabels,o.timeFormat,s);t=I["__assign"]({},l?{text:{signal:l}}:{},t)}u=I["__assign"]({},u,t);return YI(u).length>0?u:undefined}function FG(e){return UG(e,function(e,t){return Math.max(e,t.value)})}function qG(e){return UG(e,function(e,t){return e!==undefined?e:t.value})}function UG(e,t){if(cW(e)){return(Object(V["isArray"])(e.condition)?e.condition:[e.condition]).reduce(t,e.value)}else if(pW(e)){return e.value}return undefined}function WG(e,t){var n=e.values;if(n){return IW(t,n)}return undefined}function VG(e,t,n){if(JF(t)&&(e==="quantitative"&&!NV(n)||e==="temporal"&&PI(["time","utc"],n))){return"gradient"}return undefined}function HG(e){if(_Y(e)){e.component.legends=BG(e)}else{e.component.legends=XG(e)}}function BG(e){var t=e.encoding;return[LF,IF,FF,RF,PF,HF].reduce(function(n,r){var i=t[r];if(e.legend(r)&&e.getScaleComponent(r)&&!(dW(i)&&(r===PF&&i.type===iW))){n[r]=$G(e,r)}return n},{})}function GG(e,t){var n;switch(t){case LF:var r=e.scaleName(LF);return e.markDef.filled?{fill:r}:{stroke:r};case IF:case FF:case RF:case PF:case HF:return n={},n[t]=e.scaleName(t),n}}function $G(e,t){var n=e.fieldDef(t);var r=e.legend(t);var i=new PG({},GG(e,t));vV.forEach(function(n){var a=YG(n,r,t,e);if(a!==undefined){var o=n==="values"?!!r.values:n==="title"&&a===e.fieldDef(t).title?true:a===r[n];if(o||e.config.legend[n]===undefined){i.set(n,a,o)}}});var a=r.encoding||{};var o=["labels","legend","title","symbols","gradient"].reduce(function(r,o){var u=sG(a[o]||{},e);var s=D[o]?D[o](n,u,e,t,i.get("type")):u;if(s!==undefined&&YI(s).length>0){r[o]={update:s}}return r},{});if(YI(o).length>0){i.set("encode",o,!!r.encoding)}return i}function YG(e,t,n,r){var i=r.fieldDef(n);switch(e){case"format":return ZB(i,t.format,r.config);case"title":var a=i.title!==undefined?i.title:t.title||(t.title===undefined?undefined:null);return QB(a,EW(i,r.config))||undefined;case"values":return WG(t,i);case"type":return QB(t.type,VG(i.type,n,r.getScaleComponent(n).get("type")))}return t[e]}function XG(e){var t=e.component,n=t.legends,r=t.resolve;var i=function(t){HG(t);YI(t.component.legends).forEach(function(i){r.legend[i]=AG(e.component.resolve,i);if(r.legend[i]==="shared"){n[i]=JG(n[i],t.component.legends[i]);if(!n[i]){r.legend[i]="independent";delete n[i]}}})};for(var a=0,o=e.children;a<o.length;a++){var u=o[a];i(u)}YI(n).forEach(function(t){for(var n=0,i=e.children;n<i.length;n++){var a=i[n];if(!a.component.legends[t]){continue}if(r.legend[t]==="shared"){delete a.component.legends[t]}}});return n}function JG(e,t){if(!e){return t.clone()}var n=e.getWithExplicit("orient");var r=t.getWithExplicit("orient");if(n.explicit&&r.explicit&&n.value!==r.value){return undefined}var i=false;var a=function(n){var r=CG(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",function(e,t){switch(n){case"title":return oG(e,t);case"type":i=true;return MG("symbol")}return DG(e,t,n,"legend")});e.setWithExplicit(n,r)};for(var o=0,u=gV;o<u.length;o++){var s=u[o];a(s)}if(i){if(((e.implicit||{}).encode||{}).gradient){tF(e.implicit,["encode","gradient"])}if(((e.explicit||{}).encode||{}).gradient){tF(e.explicit,["encode","gradient"])}}return e}function QG(e){var t=e.component.legends;var n={};for(var r=0,i=YI(t);r<i.length;r++){var a=i[r];var o=e.getScaleComponent(a);var u=DI(o.domains);if(n[u]){for(var s=0,l=n[u];s<l.length;s++){var f=l[s];var c=JG(f,t[a]);if(!c){n[u].push(t[a])}}}else{n[u]=[t[a].clone()]}}return qI(XI(n)).map(function(e){return e.combine()})}function ZG(e){if(wY(e)||OY(e)||kY(e)){return KG(e)}else{return e$(e)}}function KG(e){return e.children.reduce(function(e,t){return e.concat(t.assembleProjections())},e$(e))}function e$(e){var t=e.component.projection;if(!t||t.merged){return[]}var n=t.combine();var r=n.name,i=I["__rest"](n,["name"]);var a={signal:"["+t.size.map(function(e){return e.signal}).join(", ")+"]"};var o=t.data.reduce(function(t,n){var r=tB(n)?n.signal:"data('"+e.lookupDataSource(n)+"')";if(!PI(t,r)){t.push(r)}return t},[]);if(o.length<=0){throw new Error("Projection's fit didn't find any data sources")}return[I["__assign"]({name:r,size:a,fit:{signal:o.length>1?"["+o.join(", ")+"]":o[0]}},i)]}var t$=["type","clipAngle","clipExtent","center","rotate","precision","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];var n$=function(e){I["__extends"](t,e);function t(t,n,r,i){var a=e.call(this,I["__assign"]({},n),{name:t})||this;a.specifiedProjection=n;a.size=r;a.data=i;a.merged=false;return a}return t}(zG);function r$(e){if(_Y(e)){e.component.projection=i$(e)}else{e.component.projection=o$(e)}}function i$(e){var t=e.specifiedProjection,n=e.config,r=e.hasProjection;if(r){var i=[];[[MF,zF],[NF,TF]].forEach(function(t){if(e.channelHasField(t[0])||e.channelHasField(t[1])){i.push({signal:e.getName("geojson_"+i.length)})}});if(e.channelHasField(PF)&&e.fieldDef(PF).type===iW){i.push({signal:e.getName("geojson_"+i.length)})}if(i.length===0){i.push(e.requestDataName(KH))}return new n$(e.projectionName(true),I["__assign"]({},n.projection||{},t||{}),[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")],i)}return undefined}function a$(e,t){var n=FI(t$,function(n){if(!e.explicit.hasOwnProperty(n)&&!t.explicit.hasOwnProperty(n)){return true}if(e.explicit.hasOwnProperty(n)&&t.explicit.hasOwnProperty(n)&&DI(e.get(n))===DI(t.get(n))){return true}return false});var r=DI(e.size)===DI(t.size);if(r){if(n){return e}else if(DI(e.explicit)===DI({})){return t}else if(DI(t.explicit)===DI({})){return e}}return null}function o$(e){if(e.children.length===0){return undefined}var t;var n=FI(e.children,function(e){r$(e);var n=e.component.projection;if(!n){return true}else if(!t){t=n;return true}else{var r=a$(t,n);if(r){t=r}return!!r}});if(t&&n){var r=e.projectionName(true);var i=new n$(r,t.specifiedProjection,t.size,QI(t.data));e.children.forEach(function(e){if(e.component.projection){i.data=i.data.concat(e.component.projection.data);e.renameProjection(e.component.projection.get("name"),r);e.component.projection.merged=true}});return i}return undefined}function u$(e,t,n){if(n.bin){e[mW(n,{})]=true;e[mW(n,{binSuffix:"end"})]=true;if(uG(n,t)){e[mW(n,{binSuffix:"range"})]=true}}else{e[mW(n)]=true}return e}function s$(e,t){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];for(var i in r){if(r.hasOwnProperty(i)){if(n in e){e[n][i]=r[i]}else{e[n]={op:r[i]}}}}}}}var l$=function(e){I["__extends"](t,e);function t(t,n,r){var i=e.call(this,t)||this;i.dimensions=n;i.measures=r;return i}t.prototype.clone=function(){return new t(null,I["__assign"]({},this.dimensions),QI(this.measures))};t.makeFromEncoding=function(e,n){var r=false;n.forEachFieldDef(function(e){if(e.aggregate){r=true}});var i={};var a={};if(!r){return null}n.forEachFieldDef(function(e,t){var r=e.aggregate,o=e.field;if(r){if(r==="count"){i["*"]=i["*"]||{};i["*"]["count"]=mW(e)}else{i[o]=i[o]||{};i[o][r]=mW(e);if(Aq(t)&&n.scaleDomain(t)==="unaggregated"){i[o]["min"]=mW({field:o,aggregate:"min"});i[o]["max"]=mW({field:o,aggregate:"max"})}}}else{u$(a,t,e)}});if(YI(a).length+YI(i).length===0){return null}return new t(e,a,i)};t.makeFromTransform=function(e,n){var r={};var i={};for(var a=0,o=n.aggregate;a<o.length;a++){var u=o[a];var s=u.op,l=u.field,f=u.as;if(s){if(s==="count"){i["*"]=i["*"]||{};i["*"]["count"]=f||mW(u)}else{i[l]=i[l]||{};i[l][s]=f||mW(u)}}}for(var c=0,d=n.groupby||[];c<d.length;c++){var u=d[c];r[u]=true}if(YI(r).length+YI(i).length===0){return null}return new t(e,r,i)};t.prototype.merge=function(e){if(!HI(this.dimensions,e.dimensions)){s$(this.measures,e.measures);e.remove()}else{mU("different dimensions, cannot merge")}};t.prototype.addDimensions=function(e){var t=this;e.forEach(function(e){return t.dimensions[e]=true})};t.prototype.dependentFields=function(){var e={};YI(this.dimensions).forEach(function(t){return e[t]=true});YI(this.measures).forEach(function(t){return e[t]=true});return e};t.prototype.producedFields=function(){var e=this;var t={};YI(this.measures).forEach(function(n){YI(e.measures[n]).forEach(function(e){t[e+"_"+n]=true})});return t};t.prototype.assemble=function(){var e=[];var t=[];var n=[];for(var r=0,i=YI(this.measures);r<i.length;r++){var a=i[r];for(var o=0,u=YI(this.measures[a]);o<u.length;o++){var s=u[o];n.push(this.measures[a][s]);e.push(s);t.push(a)}}var l={type:"aggregate",groupby:YI(this.dimensions),ops:e,fields:t,as:n};return l};return t}(lG);var f$=function(e){I["__extends"](t,e);function t(t,n,r,i){var a=e.call(this,t)||this;a.model=n;a.name=r;a.data=i;for(var o=0,u=[CF,DF];o<u.length;o++){var s=u[o];var l=n.facet[s];if(l){var f=l.bin,c=l.sort;a[s]=I["__assign"]({name:n.getName(s+"_domain"),fields:[mW(l)].concat(f?[mW(l,{binSuffix:"end"})]:[])},gB(c)?{sortField:c}:Object(V["isArray"])(c)?{sortIndexField:dG(l,s)}:{})}}a.childModel=n.child;return a}Object.defineProperty(t.prototype,"fields",{get:function(){return(this.column&&this.column.fields||[]).concat(this.row&&this.row.fields||[])},enumerable:true,configurable:true});t.prototype.getSource=function(){return this.name};t.prototype.getChildIndependentFieldsWithStep=function(){var e={};for(var t=0,n=["x","y"];t<n.length;t++){var r=n[t];var i=this.childModel.component.scales[r];if(i&&!i.merged){var a=i.get("type");var o=i.get("range");if(MV(a)&&nB(o)){var u=U$(this.childModel,r);var s=q$(u);if(s){e[r]=s}else{vU("Unknown field for ${channel}.  Cannot calculate view size.")}}}}return e};t.prototype.assembleRowColumnData=function(e,t,n){var r=e==="row"?"y":"x";var i=[];var a=[];var o=[];if(n[r]){if(t){i.push("distinct_"+n[r]);a.push("max")}else{i.push(n[r]);a.push("distinct")}o.push("distinct_"+n[r])}var u=this[e],s=u.sortField,l=u.sortIndexField;if(s){var f=s.op,c=s.field;i.push(c);a.push(f);o.push(mW(s))}else if(l){i.push(l);a.push("max");o.push(l)}return{name:this[e].name,source:t||this.data,transform:[I["__assign"]({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}};t.prototype.assemble=function(){var e=[];var t=null;var n=this.getChildIndependentFieldsWithStep();if(this.column&&this.row&&(n.x||n.y)){t="cross_"+this.column.name+"_"+this.row.name;var r=[].concat(n.x?[n.x]:[],n.y?[n.y]:[]);var i=r.map(function(){return"distinct"});e.push({name:t,source:this.data,transform:[{type:"aggregate",groupby:this.column.fields.concat(this.row.fields),fields:r,ops:i}]})}for(var a=0,o=[CF,DF];a<o.length;a++){var u=o[a];if(this[u]){e.push(this.assembleRowColumnData(u,t,n))}}return e};return t}(lG);var c$=function(e){I["__extends"](t,e);function t(t,n){var r=e.call(this,t)||this;r.fieldDefs=n;return r}t.prototype.clone=function(){return new t(null,I["__assign"]({},this.fieldDefs))};t.make=function(e,n){var r=n.config,i=n.mark;if(r.invalidValues!=="filter"){return null}var a=n.reduceFieldDef(function(e,t,r){var a=Aq(r)&&n.getScaleComponent(r);if(a){var o=a.get("type");if(DV(o)&&!t.aggregate&&!Jq(i)){e[t.field]=t}}return e},{});if(!YI(a).length){return null}return new t(e,a)};Object.defineProperty(t.prototype,"filter",{get:function(){return this.fieldDefs},enumerable:true,configurable:true});t.prototype.assemble=function(){var e=this;var t=YI(this.filter).reduce(function(t,n){var r=e.fieldDefs[n];var i=mW(r,{expr:"datum"});if(r!==null){t.push(i+" !== null");t.push("!isNaN("+i+")")}return t},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null};return t}(lG);function d$(e,t){var n=rF(e);if(t==="number"){return"toNumber("+n+")"}else if(t==="boolean"){return"toBoolean("+n+")"}else if(t==="string"){return"toString("+n+")"}else if(t==="date"){return"toDate("+n+")"}else if(t==="flatten"){return n}else if(t.indexOf("date:")===0){var r=t.slice(5,t.length);return"timeParse("+n+","+r+")"}else if(t.indexOf("utc:")===0){var r=t.slice(4,t.length);return"utcParse("+n+","+r+")"}else{vU(yU.unrecognizedParse(t));return null}}var h$=function(e){I["__extends"](t,e);function t(t,n){var r=e.call(this,t)||this;r._parse=n;return r}t.prototype.clone=function(){return new t(null,QI(this._parse))};t.makeExplicit=function(e,t,n){var r={};var i=t.data;if(i&&i.format&&i.format.parse){r=i.format.parse}return this.makeWithAncestors(e,r,{},n)};t.makeImplicitFromFilterTransform=function(e,t,n){var r={};zI(t.filter,function(e){if(LX(e)){var t=null;if(TX(e)){t=e.equal}else if(PX(e)){t=e.range[0]}else if(RX(e)){t=(e.oneOf||e["in"])[0]}if(t){if(_U(t)){r[e.field]="date"}else if(Object(V["isNumber"])(t)){r[e.field]="number"}else if(Object(V["isString"])(t)){r[e.field]="string"}}if(e.timeUnit){r[e.field]="date"}}});if(YI(r).length===0){return null}return this.makeWithAncestors(e,{},r,n)};t.makeImplicitFromEncoding=function(e,t,n){var r={};if(_Y(t)||xY(t)){t.forEachFieldDef(function(e){if(RW(e)){r[e.field]="date"}else if(PW(e)){if(!dF(e.aggregate)){r[e.field]="number"}}else if(uF(e.field)>1){if(!(e.field in r)){r[e.field]="flatten"}}else if(vW(e)&&gB(e.sort)&&uF(e.sort.field)>1){if(!(e.sort.field in r)){r[e.sort.field]="flatten"}}})}return this.makeWithAncestors(e,{},r,n)};t.makeWithAncestors=function(e,n,r,i){for(var a=0,o=YI(r);a<o.length;a++){var u=o[a];var s=i.getWithExplicit(u);if(s.value!==undefined){if(s.explicit||s.value===r[u]||s.value==="derived"||r[u]==="flatten"){delete r[u]}else{vU(yU.differentParse(u,r[u],s.value))}}}for(var l=0,f=YI(n);l<f.length;l++){var u=f[l];var s=i.get(u);if(s!==undefined){if(s===n[u]){delete n[u]}else{vU(yU.differentParse(u,n[u],s))}}}var c=new zG(n,r);i.copyAll(c);var d={};for(var h=0,p=YI(c.combine());h<p.length;h++){var v=p[h];var g=c.get(v);if(g!==null){d[v]=g}}if(YI(d).length===0||i.parseNothing){return null}return new t(e,d)};Object.defineProperty(t.prototype,"parse",{get:function(){return this._parse},enumerable:true,configurable:true});t.prototype.merge=function(e){this._parse=I["__assign"]({},this._parse,e.parse);e.remove()};t.prototype.assembleFormatParse=function(){var e={};for(var t=0,n=YI(this._parse);t<n.length;t++){var r=n[t];var i=this._parse[r];if(uF(r)===1){e[r]=i}}return e};t.prototype.producedFields=function(){return Object(V["toSet"])(YI(this._parse))};t.prototype.dependentFields=function(){return Object(V["toSet"])(YI(this._parse))};t.prototype.assembleTransforms=function(e){var t=this;if(e===void 0){e=false}return YI(this._parse).filter(function(t){return e?uF(t)>1:true}).map(function(e){var n=d$(e,t._parse[e]);if(!n){return null}var r={type:"formula",expr:n,as:oF(e)};return r}).filter(function(e){return e!==null})};return t}(lG);var p$=function(e){I["__extends"](t,e);function t(t){var n=e.call(this,null)||this;t=t||{name:"source"};if(QH(t)){n._data={values:t.values}}else if(JH(t)){n._data={url:t.url};if(!t.format){t.format={}}if(!t.format||!t.format.type){var r=/(?:\.([^.]+))?$/.exec(t.url)[1];if(!PI(["json","csv","tsv","dsv","topojson"],r)){r="json"}t.format.type=r}}else if(ZH(t)){n._data={}}if(t.name){n._name=t.name}if(t.format){var i=t.format,a=i.parse,o=a===void 0?null:a,u=I["__rest"](i,["parse"]);n._data.format=u}return n}Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:true,configurable:true});t.prototype.hasName=function(){return!!this._name};Object.defineProperty(t.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:true,configurable:true});t.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")};t.prototype.hash=function(){if(QH(this._data)){if(!this._hash){this._hash=CI(this._data)}return this._hash}else if(JH(this._data)){return CI([this._data.url,this._data.format])}else{return this._name}};t.prototype.assemble=function(){return I["__assign"]({name:this._name},this._data,{transform:[]})};return t}(lG);var v$=function(e){I["__extends"](t,e);function t(t,n){var r=e.call(this,t)||this;r.formula=n;return r}t.prototype.clone=function(){return new t(null,QI(this.formula))};t.makeFromEncoding=function(e,n){var r=n.reduceFieldDef(function(e,t){if(t.timeUnit){var n=mW(t);e[n]={as:n,timeUnit:t.timeUnit,field:t.field}}return e},{});if(YI(r).length===0){return null}return new t(e,r)};t.makeFromTransform=function(e,n){var r;return new t(e,(r={},r[n.field]={as:n.as,timeUnit:n.timeUnit,field:n.field},r))};t.prototype.merge=function(e){this.formula=I["__assign"]({},this.formula,e.formula);e.remove()};t.prototype.producedFields=function(){var e={};XI(this.formula).forEach(function(t){e[t.as]=true});return e};t.prototype.dependentFields=function(){var e={};XI(this.formula).forEach(function(t){e[t.field]=true});return e};t.prototype.assemble=function(){return XI(this.formula).map(function(e){return{type:"formula",as:e.as,expr:YU(e.timeUnit,e.field)}})};return t}(lG);function g$(e){function t(n){if(n instanceof p$){return}var r=n.parent;if(e(n)){t(r)}}return t}function m$(e){var t=e.parent;if(e instanceof h$){if(t instanceof p$){return false}if(t.numChildren()>1){return true}if(t instanceof h$){t.merge(e)}else{if(BI(t.producedFields(),e.dependentFields())){return true}e.swapWithParent()}}return true}function y$(e){if(e instanceof fG||e.numChildren()>0||e instanceof f$){return false}else{e.remove()}return true}function b$(e){var t={};return g$(function(e){if(e instanceof v$){var n=e.producedFields();var r=YI(n).every(function(e){return!!t[e]});if(r){e.remove()}else{t=I["__assign"]({},t,n)}}return true})(e)}function _$(e){return e.stack.stackBy.reduce(function(e,t){var n=t.fieldDef;var r=mW(n);if(r){e.push(r)}return e},[])}function x$(e){return Object(V["isArray"])(e)&&e.every(function(e){return Object(V["isString"])(e)})&&e.length>1}var k$=function(e){I["__extends"](t,e);function t(t,n){var r=e.call(this,t)||this;r._stack=n;return r}t.prototype.clone=function(){return new t(null,QI(this._stack))};t.makeFromTransform=function(e,n){var r=n.stack,i=n.groupby,a=n.as,o=n.offset,u=o===void 0?"zero":o;var s=[];var l=[];if(n.sort!==undefined){for(var f=0,c=n.sort;f<c.length;f++){var d=c[f];s.push(d.field);l.push(d.order===undefined?"ascending":d.order)}}var h={field:s,order:l};var p;if(x$(a)){p=a}else if(Object(V["isString"])(a)){p=[a,a+"_end"]}else{p=[n.stack+"_start",n.stack+"_end"]}return new t(e,{stackField:r,groupby:i,offset:u,sort:h,facetby:[],as:p})};t.makeFromEncoding=function(e,n){var r=n.stack;if(!r){return null}var i;if(r.groupbyChannel){i=n.fieldDef(r.groupbyChannel)}var a=_$(n);var o=n.encoding.order;var u;if(Object(V["isArray"])(o)||dW(o)){u=rG(o)}else{u=a.reduce(function(e,t){e.field.push(t);e.order.push("descending");return e},{field:[],order:[]})}var s=n.vgField(r.fieldChannel);return new t(e,{dimensionFieldDef:i,stackField:s,facetby:[],stackby:a,sort:u,offset:r.offset,impute:r.impute,as:[s+"_start",s+"_end"]})};Object.defineProperty(t.prototype,"stack",{get:function(){return this._stack},enumerable:true,configurable:true});t.prototype.addDimensions=function(e){this._stack.facetby=this._stack.facetby.concat(e)};t.prototype.dependentFields=function(){var e={};e[this._stack.stackField]=true;this.getGroupbyFields().forEach(function(t){return e[t]=true});this._stack.facetby.forEach(function(t){return e[t]=true});var t=this._stack.sort.field;Object(V["isArray"])(t)?t.forEach(function(t){return e[t]=true}):e[t]=true;return e};t.prototype.producedFields=function(){return this._stack.as.reduce(function(e,t){e[t]=true;return e},{})};t.prototype.getGroupbyFields=function(){var e=this._stack,t=e.dimensionFieldDef,n=e.impute,r=e.groupby;if(t){if(t.bin){if(n){return[mW(t,{binSuffix:"mid"})]}return[mW(t,{}),mW(t,{binSuffix:"end"})]}return[mW(t)]}return r||[]};t.prototype.assemble=function(){var e=[];var t=this._stack,n=t.facetby,r=t.dimensionFieldDef,i=t.stackField,a=t.stackby,o=t.sort,u=t.offset,s=t.impute,l=t.as;if(s&&r){var f=r?mW(r,{binSuffix:"mid"}):undefined;if(r.bin){e.push({type:"formula",expr:"("+mW(r,{expr:"datum"})+"+"+mW(r,{expr:"datum",binSuffix:"end"})+")/2",as:f})}e.push({type:"impute",field:i,groupby:a,key:f,method:"value",value:0})}e.push({type:"stack",groupby:this.getGroupbyFields().concat(n),field:i,sort:o,as:l,offset:u});return e};return t}(lG);var O$="scale_";function w$(e){function t(n){if(!(n instanceof f$)){var r=n.clone();if(r instanceof fG){var i=O$+r.getSource();r.setSource(i);e.model.component.data.outputNodes[i]=r}else if(r instanceof l$||r instanceof k$){r.addDimensions(e.fields)}qI(n.children.map(t)).forEach(function(e){return e.parent=r});return[r]}return qI(n.children.map(t))}return t}function j$(e){if(e instanceof f$){if(e.numChildren()===1&&!(e.children[0]instanceof fG)){var t=e.children[0];if(t instanceof l$||t instanceof k$){t.addDimensions(e.fields)}t.swapWithParent();j$(e)}else{S$(e.model.component.data.main);var n=qI(e.children.map(w$(e)));n.forEach(function(t){return t.parent=e.model.component.data.main})}}else{e.children.forEach(j$)}}function S$(e){if(e instanceof fG&&e.type===KH){if(e.numChildren()===1){var t=e.children[0];if(!(t instanceof f$)){t.swapWithParent();S$(e)}}}}function E$(e){if(e instanceof c$&&FI(XI(e.filter),function(e){return e===null})){e.remove()}if(e instanceof fG&&!e.isRequired()){e.remove()}e.children.forEach(E$)}function A$(e){var t=[];function n(e){if(e.numChildren()===0){t.push(e)}else{e.children.forEach(n)}}e.forEach(n);return t}function z$(e){var t=XI(e.sources);t.forEach(E$);t=t.filter(function(e){return e.numChildren()>0});A$(t).forEach(g$(y$));t=t.filter(function(e){return e.numChildren()>0});A$(t).forEach(g$(m$));A$(t).forEach(b$);t.forEach(j$);YI(e.sources).forEach(function(t){if(e.sources[t].numChildren()===0){delete e.sources[t]}})}function T$(e){if(_Y(e)){M$(e)}else{N$(e)}}function M$(e){var t=e.specifiedScales;var n=e.component.scales;YI(n).forEach(function(r){var i=t[r];var a=i?i.domain:undefined;var o=C$(e,r);var u=n[r];u.domains=o;if(LV(a)){u.set("domainRaw",{signal:dX+CI(a)},true)}if(e.component.data.isFaceted){var s=e;while(!xY(s)&&s.parent){s=s.parent}var l=s.component.resolve.scale[r];if(l==="shared"){for(var f=0,c=o;f<c.length;f++){var d=c[f];if(aB(d)){d.data=O$+d.data.replace(O$,"")}}}}})}function N$(e){for(var t=0,n=e.children;t<n.length;t++){var r=n[t];T$(r)}var i=e.component.scales;YI(i).forEach(function(t){var n;var r=null;for(var a=0,o=e.children;a<o.length;a++){var u=o[a];var s=u.component.scales[t];if(s){if(n===undefined){n=s.domains}else{n=n.concat(s.domains)}var l=s.get("domainRaw");if(r&&l&&r.signal!==l.signal){vU("The same selection must be used to override scale domains in a layered view.")}r=l}}i[t].domains=n;if(r){i[t].set("domainRaw",r,true)}})}function D$(e,t,n,r){if(e==="unaggregated"){var i=I$(t,n),a=i.valid,o=i.reason;if(!a){vU(o);return undefined}}else if(e===undefined&&r.useUnaggregatedDomain){var a=I$(t,n).valid;if(a){return"unaggregated"}}return e}function C$(e,t){var n=e.getScaleComponent(t).get("type");var r=D$(e.scaleDomain(t),e.fieldDef(t),n,e.config.scale);if(r!==e.scaleDomain(t)){e.specifiedScales[t]=I["__assign"]({},e.specifiedScales[t],{domain:r})}if(t==="x"&&e.channelHasField("x2")){if(e.channelHasField("x")){return R$(n,r,e,"x").concat(R$(n,r,e,"x2"))}else{return R$(n,r,e,"x2")}}else if(t==="y"&&e.channelHasField("y2")){if(e.channelHasField("y")){return R$(n,r,e,"y").concat(R$(n,r,e,"y2"))}else{return R$(n,r,e,"y2")}}return R$(n,r,e,t)}function P$(e,t,n){return e.map(function(e){var r=LW(e,{timeUnit:n,type:t});return{signal:"{data: "+r+"}"}})}function R$(e,t,n,r){var i=n.fieldDef(r);if(t&&t!=="unaggregated"&&!LV(t)){var a=i.type,o=i.timeUnit;if(a==="temporal"||o){return P$(t,a,o)}return[t]}var u=n.stack;if(u&&r===u.fieldChannel){if(u.offset==="normalize"){return[[0,1]]}var s=n.requestDataName(KH);return[{data:s,field:n.vgField(r,{suffix:"start"})},{data:s,field:n.vgField(r,{suffix:"end"})}]}var l=Aq(r)?L$(n,r,e):undefined;if(t==="unaggregated"){var s=n.requestDataName(KH);var f=i.field;return[{data:s,field:mW({field:f,aggregate:"min"})},{data:s,field:mW({field:f,aggregate:"max"})}]}else if(i.bin){if(NV(e)){var c=n.getName(Nq(i.bin)+"_"+i.field+"_bins");return[{signal:"sequence("+c+".start, "+c+".stop + "+c+".step, "+c+".step)"}]}if(MV(e)){return[{data:ZI(l)?n.requestDataName(KH):n.requestDataName(eB),field:n.vgField(r,uG(i,r)?{binSuffix:"range"}:{}),sort:l===true||!gB(l)?{field:n.vgField(r,{}),op:"min"}:l}]}else{if(r==="x"||r==="y"){if(Dq(i.bin)&&i.bin.extent){return[i.bin.extent]}var s=n.requestDataName(KH);return[{data:s,field:n.vgField(r,{})},{data:s,field:n.vgField(r,{binSuffix:"end"})}]}else{return[{data:n.requestDataName(KH),field:n.vgField(r,{})}]}}}else if(l){return[{data:ZI(l)?n.requestDataName(KH):n.requestDataName(eB),field:n.vgField(r),sort:l}]}else{return[{data:n.requestDataName(KH),field:n.vgField(r)}]}}function L$(e,t,n){if(!MV(n)){return undefined}var r=e.fieldDef(t);var i=r.sort;if(mB(i)){return{op:"min",field:dG(r,t),order:"ascending"}}if(gB(i)){return I["__assign"]({},i,i.field?{field:aF(i.field)}:{})}if(i==="descending"){return{op:"min",field:e.vgField(t),order:"descending"}}if(PI(["ascending",undefined],i)){return true}return undefined}function I$(e,t){if(!e.aggregate){return{valid:false,reason:yU.unaggregateDomainHasNoEffectForRawField(e)}}if(!vF[e.aggregate]){return{valid:false,reason:yU.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}}if(e.type==="quantitative"){if(t==="log"){return{valid:false,reason:yU.unaggregatedDomainWithLogScale(e)}}}return{valid:true}}function F$(e){var t=VI(e.map(function(e){if(aB(e)){var t=e.sort,n=I["__rest"](e,["sort"]);return n}return e}),CI);var n=VI(e.map(function(e){if(aB(e)){var t=e.sort;if(t!==undefined&&!ZI(t)){if(t.op==="count"){delete t.field}if(t.order==="ascending"){delete t.order}}return t}return undefined}).filter(function(e){return e!==undefined}),CI);if(t.length===1){var r=e[0];if(aB(r)&&n.length>0){var i=n[0];if(n.length>1){vU(yU.MORE_THAN_ONE_SORT);i=true}return I["__assign"]({},r,{sort:i})}return r}var a=VI(n.map(function(e){if(e===true){return e}if(e.op==="count"){return e}vU(yU.domainSortDropped(e));return true}),CI);var o=undefined;if(a.length===1){o=a[0]}else if(a.length>1){vU(yU.MORE_THAN_ONE_SORT);o=true}var u=VI(e.map(function(e){if(aB(e)){return e.data}return null}),function(e){return e});if(u.length===1&&u[0]!==null){var r=I["__assign"]({data:u[0],fields:t.map(function(e){return e.field})},o?{sort:o}:{});return r}return I["__assign"]({fields:t},o?{sort:o}:{})}function q$(e){if(aB(e)&&Object(V["isString"])(e.field)){return e.field}else if(rB(e)){var t=void 0;for(var n=0,r=e.fields;n<r.length;n++){var i=r[n];if(aB(i)&&Object(V["isString"])(i.field)){if(!t){t=i.field}else if(t!==i.field){vU("Detected faceted independent scales that union domain of multiple fields from different data sources.  We will use the first field.  The result view size may be incorrect.");return t}}}vU("Detected faceted independent scales that union domain of identical fields from different source detected.  We will assume that this is the same field from a different fork of the same data source.  However, if this is not case, the result view size maybe incorrect.");return t}else if(iB(e)){vU("Detected faceted independent scales that union domain of multiple fields from the same data source.  We will use the first field.  The result view size may be incorrect.");var t=e.fields[0];return Object(V["isString"])(t)?t:undefined}return undefined}function U$(e,t){var n=e.component.scales[t];var r=n.domains.map(function(t){if(aB(t)){t.data=e.lookupDataSource(t.data)}return t});return F$(r)}function W$(e){if(wY(e)||OY(e)||kY(e)){return e.children.reduce(function(e,t){return e.concat(W$(t))},V$(e))}else{return V$(e)}}function V$(e){return YI(e.component.scales).reduce(function(t,n){var r=e.component.scales[n];if(r.merged){return t}var i=r.combine();var a=i.domainRaw,o=i.range;var u=i.name,s=i.type,l=i.domainRaw,f=i.range,c=I["__rest"](i,["name","type","domainRaw","range"]);o=H$(o,u,e,n);if(a&&_X(a)){a=xX(e,a)}t.push(I["__assign"]({name:u,type:s,domain:U$(e,n)},a?{domainRaw:a}:{},{range:o},c));return t},[])}function H$(e,t,n,r){if(r==="x"||r==="y"){if(nB(e)){return{step:{signal:t+"_step"}}}else if(Object(V["isArray"])(e)&&e.length===2){var i=e[0];var a=e[1];if(i===0&&tB(a)){return[0,{signal:n.getSizeName(a.signal)}]}else if(tB(i)&&a===0){return[{signal:n.getSizeName(i.signal)},0]}}}return e}var B$=function(e){I["__extends"](t,e);function t(t,n){var r=e.call(this,{},{name:t})||this;r.merged=false;r.domains=[];r.setWithExplicit("type",n);return r}return t}(zG);var G$=["range","rangeStep","scheme"];function $$(e){if(_Y(e)){Y$(e)}else{aY(e,"range")}}function Y$(e){var t=e.component.scales;Eq.forEach(function(n){var r=t[n];if(!r){return}var i=e.getScaleComponent(n);var a=e.specifiedScales[n];var o=e.fieldDef(n);var u=n==="x"?"width":n==="y"?"height":undefined;var s=u?!!e.component.layoutSize.get(u):undefined;var l=i.get("type");var f=PI(["point","band"],l)||!!a.rangeStep;if(u&&e.fit&&!s&&f){vU(yU.CANNOT_FIX_RANGE_STEP_WITH_FIT);s=true}var c=X$(e);var d=J$(n,l,o.type,a,e.config,r.get("zero"),e.mark,s,e.getName(u),c);r.setWithExplicit("range",d)})}function X$(e){var t=[];var n=e.getScaleComponent("x");var r=n&&n.get("range");if(r&&nB(r)&&Object(V["isNumber"])(r.step)){t.push(r.step)}var i=e.getScaleComponent("y");var a=i&&i.get("range");if(a&&nB(a)&&Object(V["isNumber"])(a.step)){t.push(a.step)}return t}function J$(e,t,n,r,i,a,o,u,s,l){var f=u||r.rangeStep===null;for(var c=0,d=G$;c<d.length;c++){var h=d[c];if(r[h]!==undefined){var p=YV(t,h);var v=XV(e,h);if(!p){vU(yU.scalePropertyNotWorkWithScaleType(t,h,e))}else if(v){vU(v)}else{switch(h){case"range":return TG(r[h]);case"scheme":return TG(Q$(r[h]));case"rangeStep":var g=r[h];if(g!==null){if(!u){return TG({step:g})}else{vU(yU.rangeStepDropped(e))}}}}}}return MG(Z$(e,t,n,i,a,o,s,l,f))}function Q$(e){if(RV(e)){var t={scheme:e.name};if(e.count){t.count=e.count}if(e.extent){t.extent=e.extent}return t}return{scheme:e}}function Z$(e,t,n,r,i,a,o,u,s){switch(e){case jF:case SF:if(PI(["point","band"],t)&&!s){if(e===jF&&a==="text"){if(r.scale.textXRangeStep){return{step:r.scale.textXRangeStep}}}else{if(r.scale.rangeStep){return{step:r.scale.rangeStep}}}}if(e===SF&&DV(t)){return[{signal:o},0]}else{return[0,{signal:o}]}case RF:var l=K$(a,i,r);var f=eY(a,u,r);return[l,f];case PF:return"symbol";case LF:case IF:case FF:if(t==="ordinal"){return n==="nominal"?"category":"ordinal"}return a==="rect"||a==="geoshape"?"heatmap":"ramp";case HF:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}function K$(e,t,n){if(t){return 0}switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(yU.incompatibleChannel("size",e))}function eY(e,t,n){var r=n.scale;switch(e){case"bar":case"tick":if(n.scale.maxBandSize!==undefined){return n.scale.maxBandSize}return tY(t,n.scale)-1;case"line":case"trail":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize){return n.scale.maxSize}var i=tY(t,r);return(i-2)*(i-2)}throw new Error(yU.incompatibleChannel("size",e))}function tY(e,t){if(e.length>0){return Math.min.apply(null,e)}if(t.rangeStep){return t.rangeStep}return 21}function nY(e,t){if(_Y(e)){rY(e,t)}else{aY(e,t)}}function rY(e,t){var n=e.component.scales;YI(n).forEach(function(r){var i=e.specifiedScales[r];var a=n[r];var o=e.getScaleComponent(r);var u=e.fieldDef(r);var s=e.config;var l=i[t];var f=o.get("type");var c=YV(f,t);var d=XV(r,t);if(l!==undefined){if(!c){vU(yU.scalePropertyNotWorkWithScaleType(f,t,r))}else if(d){vU(d)}}if(c&&d===undefined){if(l!==undefined){a.copyKeyFromObject(t,i)}else{var h=iY(t,r,u,o.get("type"),o.get("padding"),o.get("paddingInner"),i.domain,e.markDef,s);if(h!==undefined){a.set(t,h,false)}}}})}function iY(e,t,n,r,i,a,o,u,s){var l=s.scale;switch(e){case"nice":return oY(r,t,n);case"padding":return uY(t,r,l,n,u,s.bar);case"paddingInner":return sY(i,t,l);case"paddingOuter":return lY(i,t,r,a,l);case"reverse":return fY(r,n.sort);case"zero":return cY(t,n,o,u)}return l[e]}function aY(e,t){var n=e.component.scales;for(var r=0,i=e.children;r<i.length;r++){var a=i[r];if(t==="range"){$$(a)}else{nY(a,t)}}YI(n).forEach(function(r){var i;for(var a=0,o=e.children;a<o.length;a++){var u=o[a];var s=u.component.scales[r];if(s){var l=s.getWithExplicit(t);i=CG(i,l,t,"scale",NG(function(e,n){switch(t){case"range":if(e.step&&n.step){return e.step-n.step}return 0}return 0}))}}n[r].setWithExplicit(t,i)})}function oY(e,t,n){if(n.bin||PI([mV.TIME,mV.UTC],e)){return undefined}return PI([jF,SF],t)}function uY(e,t,n,r,i,a){if(PI([jF,SF],e)){if(CV(t)){if(n.continuousPadding!==undefined){return n.continuousPadding}var o=i.type,u=i.orient;if(o==="bar"&&!r.bin){if(u==="vertical"&&e==="x"||u==="horizontal"&&e==="y"){return a.continuousBandSize}}}if(t===mV.POINT){return n.pointPadding}}return undefined}function sY(e,t,n){if(e!==undefined){return undefined}if(PI([jF,SF],t)){return n.bandPaddingInner}return undefined}function lY(e,t,n,r,i){if(e!==undefined){return undefined}if(PI([jF,SF],t)){if(n===mV.BAND){if(i.bandPaddingOuter!==undefined){return i.bandPaddingOuter}return r/2}}return undefined}function fY(e,t){if(DV(e)&&t==="descending"){return true}return undefined}function cY(e,t,n,r){var i=!!n&&n!=="unaggregated";if(i){return false}if(e==="size"&&t.type==="quantitative"){return true}if(!t.bin&&PI([jF,SF],e)){var a=r.orient,o=r.type;if(PI(["bar","area","line","trail"],o)){if(a==="horizontal"&&e==="y"||a==="vertical"&&e==="x"){return false}}return true}return false}function dY(e,t,n,r,i){var a=hY(t,n,r,i);if(!Aq(t)){return null}if(e!==undefined){if(!QV(t,e)){vU(yU.scaleTypeNotWorkWithChannel(t,e,a));return a}if(!JV(e,n.type,n.bin)){vU(yU.scaleTypeNotWorkWithFieldDef(e,a));return a}return e}return a}function hY(e,t,n,r){switch(t.type){case"nominal":case"ordinal":if(JF(e)||Mq(e)==="discrete"){if(e==="shape"&&t.type==="ordinal"){vU(yU.discreteChannelCannotEncode(e,"ordinal"))}return"ordinal"}if(PI(["x","y"],e)){if(PI(["rect","bar","rule"],n)){return"band"}if(n==="bar"){return"band"}}return"point";case"temporal":if(JF(e)){return"sequential"}else if(Mq(e)==="discrete"){vU(yU.discreteChannelCannotEncode(e,"temporal"));return"ordinal"}return"time";case"quantitative":if(JF(e)){if(t.bin){return"bin-ordinal"}return"sequential"}else if(Mq(e)==="discrete"){vU(yU.discreteChannelCannotEncode(e,"quantitative"));return"ordinal"}if(t.bin&&e!=="x"&&e!=="y"){return"bin-linear"}return"linear";case"latitude":case"longitude":case"geojson":return undefined}throw new Error(yU.invalidFieldType(t.type))}function pY(e){vY(e);T$(e);for(var t=0,n=GV;t<n.length;t++){var r=n[t];nY(e,r)}$$(e)}function vY(e){if(_Y(e)){e.component.scales=gY(e)}else{e.component.scales=yY(e)}}function gY(e){var t=e.encoding,n=e.config,r=e.mark;return Eq.reduce(function(i,a){var o;var u=undefined;var s=t[a];if(dW(s)&&r===Bq&&a===PF&&s.type===iW){return i}if(dW(s)){o=s;u=s.scale}else if(fW(s)){o=s.condition;u=s.condition["scale"]}else if(a===jF){o=zW(t.x2)}else if(a===SF){o=zW(t.y2)}if(o&&u!==null&&u!==false){u=u||{};var l=u.type;var f=dY(u.type,a,o,r,n.scale);i[a]=new B$(e.scaleName(a+"",true),{value:f,explicit:l===f})}return i},{})}var mY=NG(function(e,t){return kV(e)-kV(t)});function yY(e){var t=e.component.scales={};var n={};var r=e.component.resolve;var i=function(t){vY(t);YI(t.component.scales).forEach(function(i){r.scale[i]=r.scale[i]||EG(i,e);if(r.scale[i]==="shared"){var a=n[i];var o=t.component.scales[i].getWithExplicit("type");if(a){if(_V(a.value,o.value)){n[i]=CG(a,o,"type","scale",mY)}else{r.scale[i]="independent";delete n[i]}}else{n[i]=o}}})};for(var a=0,o=e.children;a<o.length;a++){var u=o[a];i(u)}YI(n).forEach(function(r){var i=e.scaleName(r,true);var a=n[r];t[r]=new B$(i,a);for(var o=0,u=e.children;o<u.length;o++){var s=u[o];var l=s.component.scales[r];if(l){s.renameScale(l.get("name"),i);l.merged=true}}});return t}var bY=function(){function e(){this.nameMap={}}e.prototype.rename=function(e,t){this.nameMap[e]=t};e.prototype.has=function(e){return this.nameMap[e]!==undefined};e.prototype.get=function(e){while(this.nameMap[e]&&e!==this.nameMap[e]){e=this.nameMap[e]}return e};return e}();function _Y(e){return e&&e.type==="unit"}function xY(e){return e&&e.type==="facet"}function kY(e){return e&&e.type==="repeat"}function OY(e){return e&&e.type==="concat"}function wY(e){return e&&e.type==="layer"}var jY=function(){function e(e,t,n,r,i,a){var o=this;this.children=[];this.correctDataNames=function(e){if(e.from&&e.from.data){e.from.data=o.lookupDataSource(e.from.data)}if(e.from&&e.from.facet&&e.from.facet.data){e.from.facet.data=o.lookupDataSource(e.from.facet.data)}return e};this.parent=t;this.config=r;this.repeater=i;this.name=e.name||n;this.title=Object(V["isString"])(e.title)?{text:e.title}:e.title;this.scaleNameMap=t?t.scaleNameMap:new bY;this.projectionNameMap=t?t.projectionNameMap:new bY;this.layoutSizeNameMap=t?t.layoutSizeNameMap:new bY;this.data=e.data;this.description=e.description;this.transforms=QX(e.transform||[]);this.layout=bH(e)||_H(e)?undefined:BH(e);this.component={data:{sources:t?t.component.data.sources:{},outputNodes:t?t.component.data.outputNodes:{},outputNodeRefCounts:t?t.component.data.outputNodeRefCounts:{},isFaceted:yH(e)||t&&t.component.data.isFaceted&&!e.data},layoutSize:new zG,layoutHeaders:{row:{},column:{}},mark:null,resolve:I["__assign"]({scale:{},axis:{},legend:{}},a||{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}Object.defineProperty(e.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:true,configurable:true});e.prototype.initSize=function(e){var t=e.width,n=e.height;if(t){this.component.layoutSize.set("width",t,true)}if(n){this.component.layoutSize.set("height",n,true)}};e.prototype.parse=function(){this.parseScale();this.parseLayoutSize();this.renameTopLevelLayoutSize();this.parseSelection();this.parseProjection();this.parseData();this.parseAxisAndHeader();this.parseLegend();this.parseMarkGroup()};e.prototype.parseScale=function(){pY(this)};e.prototype.parseProjection=function(){r$(this)};e.prototype.renameTopLevelLayoutSize=function(){if(this.getName("width")!=="width"){this.renameLayoutSize(this.getName("width"),"width")}if(this.getName("height")!=="height"){this.renameLayoutSize(this.getName("height"),"height")}};e.prototype.parseLegend=function(){HG(this)};e.prototype.assembleGroupStyle=function(){if(this.type==="unit"||this.type==="layer"){return"cell"}return undefined};e.prototype.assembleLayoutSize=function(){if(this.type==="unit"||this.type==="layer"){return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}}return undefined};e.prototype.assembleLayout=function(){if(!this.layout){return undefined}var e=this.layout,t=e.align,n=e.bounds,r=e.center,i=e.spacing,a=i===void 0?{}:i;return I["__assign"]({padding:Object(V["isNumber"])(a)?a:{row:a.row||10,column:a.column||10}},this.assembleDefaultLayout(),t?{align:t}:{},n?{bounds:n}:{},r?{center:r}:{})};e.prototype.assembleDefaultLayout=function(){return{}};e.prototype.assembleHeaderMarks=function(){var e=this.component.layoutHeaders;var t=[];for(var n=0,r=hG;n<r.length;n++){var i=r[n];if(e[i].title){t.push(gG(this,i))}}for(var a=0,o=hG;a<o.length;a++){var i=o[a];t=t.concat(mG(this,i))}return t};e.prototype.assembleAxes=function(){return cB(this.component.axes,this.config)};e.prototype.assembleLegends=function(){return QG(this)};e.prototype.assembleProjections=function(){return ZG(this)};e.prototype.assembleTitle=function(){var e=I["__assign"]({},rH(this.config.title).nonMark,this.title);if(e.text){if(!PI(["unit","layer"],this.type)){if(e.anchor&&e.anchor!=="start"){vU(yU.cannotSetTitleAnchor(this.type))}e.anchor="start"}return YI(e).length>0?e:undefined}return undefined};e.prototype.assembleGroup=function(e){if(e===void 0){e=[]}var t={};e=e.concat(this.assembleSelectionSignals());if(e.length>0){t.signals=e}var n=this.assembleLayout();if(n){t.layout=n}t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var r=!this.parent||xY(this.parent)?W$(this):[];if(r.length>0){t.scales=r}var i=this.assembleAxes();if(i.length>0){t.axes=i}var a=this.assembleLegends();if(a.length>0){t.legends=a}return t};e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(_Y(r)){if(r.channelHasField(e)){return true}}else{if(r.hasDescendantWithFieldOnChannel(e)){return true}}}return false};e.prototype.getName=function(e){return KI((this.name?this.name+"_":"")+e)};e.prototype.requestDataName=function(e){var t=this.getName(e);var n=this.component.data.outputNodeRefCounts;n[t]=(n[t]||0)+1;return t};e.prototype.getSizeSignalRef=function(e){if(xY(this.parent)){var t=e==="width"?"x":"y";var n=this.component.scales[t];if(n&&!n.merged){var r=n.get("type");var i=n.get("range");if(MV(r)&&nB(i)){var a=n.get("name");var o=U$(this,t);var u=q$(o);if(u){var s=mW({aggregate:"distinct",field:u},{expr:"datum"});return{signal:SG(a,n,s)}}else{vU("Unknown field for ${channel}.  Cannot calculate view size.");return null}}}}return{signal:this.layoutSizeNameMap.get(this.getName(e))}};e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];if(!t){return e}return t.getSource()};e.prototype.getSizeName=function(e){return this.layoutSizeNameMap.get(e)};e.prototype.renameLayoutSize=function(e,t){this.layoutSizeNameMap.rename(e,t)};e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)};e.prototype.renameProjection=function(e,t){this.projectionNameMap.rename(e,t)};e.prototype.scaleName=function(e,t){if(t){return this.getName(e)}if(iq(e)&&Aq(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))){return this.scaleNameMap.get(this.getName(e))}return undefined};e.prototype.projectionName=function(e){if(e){return this.getName("projection")}if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))){return this.projectionNameMap.get(this.getName("projection"))}return undefined};e.prototype.getScaleComponent=function(e){if(!this.component.scales){throw new Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().")}var t=this.component.scales[e];if(t&&!t.merged){return t}return this.parent?this.parent.getScaleComponent(e):undefined};e.prototype.getSelectionComponent=function(e,t){var n=this.component.selection[e];if(!n&&this.parent){n=this.parent.getSelectionComponent(e,t)}if(!n){throw new Error(yU.selectionNotFound(t))}return n};return e}();var SY=function(e){I["__extends"](t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.vgField=function(e,t){if(t===void 0){t={}}var n=this.fieldDef(e);if(!n){return undefined}return mW(n,t)};t.prototype.reduceFieldDef=function(e,t,n){return BW(this.getMapping(),function(t,n,r){var i=zW(n);if(i){return e(t,i,r)}return t},t,n)};t.prototype.forEachFieldDef=function(e,t){HW(this.getMapping(),function(t,n){var r=zW(t);if(r){e(r,n)}},t)};return t}(jY);var EY={has:function(e){return e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales"},parse:function(e,t,n){var r=n.scales=[];n.project.forEach(function(t){var i=t.channel;var a=e.getScaleComponent(i);var o=a?a.get("type"):undefined;if(!a||!DV(o)||NV(o)){vU(yU.SCALE_BINDINGS_CONTINUOUS);return}a.set("domainRaw",{signal:EX(n,i,"data")},true);r.push(i);if(e.repeater&&e.repeater.row===e.repeater.column){var u=e.getScaleComponent(i===jF?SF:jF);u.set("domainRaw",{signal:EX(n,i,"data")},true)}})},topLevelSignals:function(e,t,n){if(!e.parent){return n}var r=t.scales.filter(function(e){return!n.filter(function(n){return n.name===EX(t,e,"data")}).length});return n.concat(r.map(function(e){return{name:EX(t,e,"data")}}))},signals:function(e,t,n){if(e.parent){t.scales.forEach(function(e){var r=n.filter(function(n){return n.name===EX(t,e,"data")})[0];r.push="outer";delete r.value;delete r.update})}return n}};var AY=EY;function zY(e,t){var n=Object(V["stringValue"])(e.scaleName(t));return"domain("+n+")"}var TY="_brush";var MY="_scale_trigger";var NY={predicate:"vlInterval",scaleDomain:"vlIntervalDomain",signals:function(e,t){var n=t.name;var r=AY.has(t);var i=[];var a=[];var o=[];var u=[];if(t.translate&&!r){var s="!event.item || event.item.mark.name !== "+Object(V["stringValue"])(n+TY);PY(t,function(e,t){var n=t.between[0].filter||(t.between[0].filter=[]);if(n.indexOf(s)<0){n.push(s)}})}t.project.forEach(function(n){var r=n.channel;if(r!==jF&&r!==SF){vU("Interval selections only support x and y encoding channels.");return}var s=CY(e,t,r);var l=EX(t,r,"data");var f=EX(t,r,"visual");var c=Object(V["stringValue"])(e.scaleName(r));var d=e.getScaleComponent(r).get("type");var h=DV(d)?"+":"";i.push.apply(i,s);o.push(l);a.push("{encoding: "+Object(V["stringValue"])(r)+", "+("field: "+Object(V["stringValue"])(n.field)+", extent: "+l+"}"));u.push({scaleName:e.scaleName(r),expr:"(!isArray("+l+") || "+("("+h+"invert("+c+", "+f+")[0] === "+h+l+"[0] && ")+(h+"invert("+c+", "+f+")[1] === "+h+l+"[1]))")})});if(!r){i.push({name:n+MY,update:u.map(function(e){return e.expr}).join(" && ")+(" ? "+(n+MY)+" : {}")})}return i.concat({name:n+fX,on:[{events:o.map(function(e){return{signal:e}}),update:o.join(" && ")+(" ? {unit: "+jX(e)+", intervals: ["+a.join(", ")+"]} : null")}]})},modifyExpr:function(e,t){var n=t.name+fX;return n+", "+(t.resolve==="global"?"true":"{unit: "+jX(e)+"}")},marks:function(e,t,n){var r=t.name;var i=AX(t),a=i.xi,o=i.yi;var u="data("+Object(V["stringValue"])(t.name+lX)+")";if(AY.has(t)){return n}var s={x:a!==null?{signal:r+"_x[0]"}:{value:0},y:o!==null?{signal:r+"_y[0]"}:{value:0},x2:a!==null?{signal:r+"_x[1]"}:{field:{group:"width"}},y2:o!==null?{signal:r+"_y[1]"}:{field:{group:"height"}}};if(t.resolve==="global"){for(var l=0,f=YI(s);l<f.length;l++){var c=f[l];s[c]=[I["__assign"]({test:u+".length && "+u+"[0].unit === "+jX(e)},s[c]),{value:0}]}}var d=t.mark,h=d.fill,p=d.fillOpacity,v=I["__rest"](d,["fill","fillOpacity"]);var g=YI(v).reduce(function(e,t){e[t]=[{test:[a!==null&&r+"_x[0] !== "+r+"_x[1]",o!=null&&r+"_y[0] !== "+r+"_y[1]"].filter(function(e){return e}).join(" && "),value:v[t]},{value:null}];return e},{});return[{name:r+TY+"_bg",type:"rect",clip:true,encode:{enter:{fill:{value:h},fillOpacity:{value:p}},update:s}}].concat(n,{name:r+TY,type:"rect",clip:true,encode:{enter:{fill:{value:"transparent"}},update:I["__assign"]({},s,g)}})}};var DY=NY;function CY(e,t,n){var r=EX(t,n,"visual");var i=EX(t,n,"data");var a=AY.has(t);var o=e.scaleName(n);var u=Object(V["stringValue"])(o);var s=e.getScaleComponent(n);var l=s?s.get("type"):undefined;var f=e.getSizeSignalRef(n===jF?"width":"height").signal;var c=n+"(unit)";var d=PY(t,function(e,t){return e.concat({events:t.between[0],update:"["+c+", "+c+"]"},{events:t,update:"["+r+"[0], clamp("+c+", 0, "+f+")]"})});d.push({events:{signal:t.name+MY},update:DV(l)&&!NV(l)?"[scale("+u+", "+i+"[0]), scale("+u+", "+i+"[1])]":"[0, 0]"});return a?[{name:i,on:[]}]:[{name:r,value:[],on:d},{name:i,on:[{events:{signal:r},update:r+"[0] === "+r+"[1] ? null : invert("+u+", "+r+")"}]}]}function PY(e,t){return e.events.reduce(function(e,n){if(!n.between){vU(n+" is not an ordered event stream for interval selections");return e}return t(e,n)},[])}var RY="voronoi";var LY={has:function(e){return e.type!=="interval"&&e.nearest},marks:function(e,t,n){var r=AX(t),i=r.x,a=r.y;var o=e.mark;if(Jq(o)){vU(yU.nearestNotSupportForContinuous(o));return n}var u={name:e.getName(RY),type:"path",from:{data:e.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:true}}},transform:[{type:"voronoi",x:{expr:i||!i&&!a?"datum.datum.x || 0":"0"},y:{expr:a||!i&&!a?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};var s=0;var l=false;n.forEach(function(t,n){var r=t.name||"";if(r===e.component.mark[0].name){s=n}else if(r.indexOf(RY)>=0){l=true}});if(!l){n.splice(s+1,0,u)}return n}};var IY=LY;function FY(e,t){var n=t.project;var r=IY.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";var i=[];var a=n.map(function(e){return Object(V["stringValue"])(e.channel)}).filter(function(e){return e}).join(", ");var o=n.map(function(e){return Object(V["stringValue"])(e.field)}).join(", ");var u=n.map(function(t){var n=t.channel;var a=e.fieldDef(n);return a&&a.bin?(i.push(t.field),"["+rF(e.vgField(n,{}),r)+", "+(rF(e.vgField(n,{binSuffix:"end"}),r)+"]")):""+rF(t.field,r)}).join(", ");return[{name:t.name+fX,value:{},on:[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? "+("{unit: "+jX(e)+", encodings: ["+a+"], ")+("fields: ["+o+"], values: ["+u+"]")+(i.length?", "+i.map(function(e){return Object(V["stringValue"])("bin_"+e)+": 1"}).join(", "):"")+"} : null",force:true}]}]}var qY={predicate:"vlMulti",scaleDomain:"vlMultiDomain",signals:FY,modifyExpr:function(e,t){var n=t.name+fX;return n+", "+(t.resolve==="global"?"null":"{unit: "+jX(e)+"}")}};var UY=qY;var WY={predicate:"vlSingle",scaleDomain:"vlSingleDomain",signals:FY,topLevelSignals:function(e,t,n){var r=n.filter(function(e){return e.name===t.name});var i="data("+Object(V["stringValue"])(t.name+lX)+")";var a=i+"[0].values";return r.length?n:n.concat({name:t.name,update:i+".length && {"+t.project.map(function(e,t){return e.field+": "+a+"["+t+"]"}).join(", ")+"}"})},modifyExpr:function(e,t){var n=t.name+fX;return n+", "+(t.resolve==="global"?"true":"{unit: "+jX(e)+"}")}};var VY=WY;var HY={has:function(e){return e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"},topLevelSignals:function(e,t,n){var r=t.name;var i=t.project;var a=t.bind;var o=IY.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";i.forEach(function(e){var i=KI(r+"_"+e.field);var u=n.filter(function(e){return e.name===i});if(!u.length){n.unshift({name:i,value:"",on:[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? "+rF(e.field,o)+" : null"}],bind:a[e.field]||a[e.channel]||a})}});return n},signals:function(e,t,n){var r=t.name;var i=t.project;var a=n.filter(function(e){return e.name===r+fX})[0];var o=i.map(function(e){return Object(V["stringValue"])(e.field)}).join(", ");var u=i.map(function(e){return KI(r+"_"+e.field)});if(u.length){a.update=u.join(" && ")+" ? {fields: ["+o+"], values: ["+u.join(", ")+"]} : null"}delete a.value;delete a.on;return n}};var BY=HY;var GY={has:function(e){var t=e;return t.fields!==undefined||t.encodings!==undefined},parse:function(e,t,n){var r={};var i={};(t.fields||[]).forEach(function(e){return r[e]=null});(t.encodings||[]).forEach(function(t){var n=e.fieldDef(t);if(n){if(n.timeUnit){var a=e.vgField(t);r[a]=t;i[a]={as:a,field:n.field,timeUnit:n.timeUnit}}else{r[n.field]=t}}else{vU(yU.cannotProjectOnChannelWithoutField(t))}});var a=n.project||(n.project=[]);for(var o in r){if(r.hasOwnProperty(o)){a.push({field:o,channel:r[o]})}}var u=n.fields||(n.fields={});a.filter(function(e){return e.channel}).forEach(function(e){return u[e.channel]=e.field});if(YI(i).length){n.timeUnit=new v$(null,i)}}};var $Y=GY;var YY="_toggle";var XY={has:function(e){return e.type==="multi"&&e.toggle},signals:function(e,t,n){return n.concat({name:t.name+YY,value:false,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var r=t.name+fX;var i=t.name+YY;return i+" ? null : "+r+", "+(t.resolve==="global"?i+" ? null : true, ":i+" ? null : {unit: "+jX(e)+"}, ")+(i+" ? "+r+" : null")}};var JY=XY;var QY="_translate_anchor";var ZY="_translate_delta";var KY={has:function(e){return e.type==="interval"&&e.translate},signals:function(e,t,n){var r=t.name;var i=AY.has(t);var a=r+QY;var o=AX(t),u=o.x,s=o.y;var l=Object(hD["selector"])(t.translate,"scope");if(!i){l=l.map(function(e){return e.between[0].markname=r+TY,e})}n.push({name:a,value:{},on:[{events:l.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit)"+(u!==null?", extent_x: "+(i?zY(e,jF):"slice("+EX(t,"x","visual")+")"):"")+(s!==null?", extent_y: "+(i?zY(e,SF):"slice("+EX(t,"y","visual")+")"):"")+"}"}]},{name:r+ZY,value:{},on:[{events:l,update:"{x: "+a+".x - x(unit), y: "+a+".y - y(unit)}"}]});if(u!==null){tX(e,t,jF,"width",n)}if(s!==null){tX(e,t,SF,"height",n)}return n}};var eX=KY;function tX(e,t,n,r,i){var a=t.name;var o=AY.has(t);var u=i.filter(function(e){return e.name===EX(t,n,o?"data":"visual")})[0];var s=a+QY;var l=a+ZY;var f=e.getSizeSignalRef(r).signal;var c=e.getScaleComponent(n);var d=c.get("type");var h=o&&n===jF?"-":"";var p=s+".extent_"+n;var v=""+h+l+"."+n+" / "+(o?""+f:"span("+p+")");var g=!o?"panLinear":d==="log"?"panLog":d==="pow"?"panPow":"panLinear";var m=g+"("+p+", "+v+(o&&d==="pow"?", "+(c.get("exponent")||1):"")+")";u.on.push({events:{signal:l},update:o?m:"clampRange("+m+", 0, "+f+")"})}var nX="_zoom_anchor";var rX="_zoom_delta";var iX={has:function(e){return e.type==="interval"&&e.zoom},signals:function(e,t,n){var r=t.name;var i=AY.has(t);var a=r+rX;var o=AX(t),u=o.x,s=o.y;var l=Object(V["stringValue"])(e.scaleName(jF));var f=Object(V["stringValue"])(e.scaleName(SF));var c=Object(hD["selector"])(t.zoom,"scope");if(!i){c=c.map(function(e){return e.markname=r+TY,e})}n.push({name:r+nX,on:[{events:c,update:!i?"{x: x(unit), y: y(unit)}":"{"+[l?"x: invert("+l+", x(unit))":"",f?"y: invert("+f+", y(unit))":""].filter(function(e){return!!e}).join(", ")+"}"}]},{name:a,on:[{events:c,force:true,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]});if(u!==null){oX(e,t,"x","width",n)}if(s!==null){oX(e,t,"y","height",n)}return n}};var aX=iX;function oX(e,t,n,r,i){var a=t.name;var o=AY.has(t);var u=i.filter(function(e){return e.name===EX(t,n,o?"data":"visual")})[0];var s=e.getSizeSignalRef(r).signal;var l=e.getScaleComponent(n);var f=l.get("type");var c=o?zY(e,n):u.name;var d=a+rX;var h=""+a+nX+"."+n;var p=!o?"zoomLinear":f==="log"?"zoomLog":f==="pow"?"zoomPow":"zoomLinear";var v=p+"("+c+", "+h+", "+d+(o&&f==="pow"?", "+(l.get("exponent")||1):"")+")";u.on.push({events:{signal:d},update:o?v:"clampRange("+v+", 0, "+s+")"})}var uX={project:$Y,toggle:JY,scales:AY,translate:eX,zoom:aX,inputs:BY,nearest:IY};function sX(e,t){for(var n in uX){if(uX[n].has(e)){t(uX[n])}}}var lX="_store";var fX="_tuple";var cX="_modify";var dX="_selection_domain_";function hX(e,t){var n={};var r=e.config.selection;var i=function(i){if(!t.hasOwnProperty(i)){return"continue"}var a=t[i];var o=r[a.type];for(var u in o){if(u==="encodings"&&a.fields||u==="fields"&&a.encodings){continue}if(u==="mark"){a[u]=I["__assign"]({},o[u],a[u])}if(a[u]===undefined||a[u]===true){a[u]=o[u]||a[u]}}i=KI(i);var s=n[i]=I["__assign"]({},a,{name:i,events:Object(V["isString"])(a.on)?Object(hD["selector"])(a.on,"scope"):a.on});sX(s,function(t){if(t.parse){t.parse(e,a,s)}})};for(var a in t){i(a)}return n}function pX(e,t){kX(e,function(n,r){var i=n.name;var a=r.modifyExpr(e,n);t.push.apply(t,r.signals(e,n));sX(n,function(r){if(r.signals){t=r.signals(e,n,t)}if(r.modifyExpr){a=r.modifyExpr(e,n,a)}});t.push({name:i+cX,on:[{events:{signal:i+fX},update:"modify("+Object(V["stringValue"])(n.name+lX)+", "+a+")"}]})});var n=wX(e);if(t.length&&n){var r=Object(V["stringValue"])(n.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Object(hD["selector"])("mousemove","scope"),update:"isTuple(facet) ? facet : group("+r+").datum"}]})}return t}function vX(e,t){var n=false;kX(e,function(r,i){if(i.topLevelSignals){t=i.topLevelSignals(e,r,t)}sX(r,function(n){if(n.topLevelSignals){t=n.topLevelSignals(e,r,t)}});n=true});if(n){var r=t.filter(function(e){return e.name==="unit"});if(!r.length){t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}}return t}function gX(e,t){kX(e,function(e){var n=t.filter(function(t){return t.name===e.name+lX});if(!n.length){t.push({name:e.name+lX})}});return t}function mX(e,t){kX(e,function(n,r){t=r.marks?r.marks(e,n,t):t;sX(n,function(r){if(r.marks){t=r.marks(e,n,t)}})});return t}function yX(e,t){e.children.forEach(function(e){if(_Y(e)){t=mX(e,t)}});return t}function bX(e,t,n){var r=[];function i(t){var i=KI(t);var a=e.getSelectionComponent(i,t);var o=Object(V["stringValue"])(i+lX);if(a.timeUnit){var u=n||e.component.data.raw;var s=a.timeUnit.clone();if(u.parent){s.insertAsParentOf(u)}else{u.parent=s}}if(a.empty!=="none"){r.push(o)}return OX(a.type).predicate+("("+o+", datum")+(a.resolve==="global"?")":", "+Object(V["stringValue"])(a.resolve)+")")}var a=eF(t,i);return(r.length?"!("+r.map(function(e){return"length(data("+e+"))"}).join(" || ")+") || ":"")+("("+a+")")}function _X(e){return e.signal.indexOf(dX)>=0}function xX(e,t){var n=JSON.parse(t.signal.replace(dX,""));var r=KI(n.selection);var i=e.component.selection&&e.component.selection[r];if(i){vU('Use "bind": "scales" to setup a binding for scales and selections within the same view.')}else{i=e.getSelectionComponent(r,n.selection);if(!n.encoding&&!n.field){n.field=i.project[0].field;if(i.project.length>1){vU('A "field" or "encoding" must be specified when using a selection as a scale domain. '+('Using "field": '+Object(V["stringValue"])(n.field)+"."))}}return{signal:OX(i.type).scaleDomain+("("+Object(V["stringValue"])(r+lX)+", "+Object(V["stringValue"])(n.encoding||null)+", ")+Object(V["stringValue"])(n.field||null)+(i.resolve==="global"?")":", "+Object(V["stringValue"])(i.resolve)+")")}}return{signal:"null"}}function kX(e,t){var n=e.component.selection;for(var r in n){if(n.hasOwnProperty(r)){var i=n[r];t(i,OX(i.type))}}}function OX(e){switch(e){case"single":return VY;case"multi":return UY;case"interval":return DY}return null}function wX(e){var t=e.parent;while(t){if(xY(t)){break}t=t.parent}return t}function jX(e){var t=Object(V["stringValue"])(e.name);var n=wX(e);if(n){t+=(n.facet.row?" + '_' + ("+rF(n.vgField("row"),"facet")+")":"")+(n.facet.column?" + '_' + ("+rF(n.vgField("column"),"facet")+")":"")}return t}function SX(e){var t=false;kX(e,function(e){t=t||e.project.some(function(e){return e.field===tH})});return t}function EX(e,t,n){var r=e._signalNames||(e._signalNames={});if(r[t]&&r[t][n]){return r[t][n]}r[t]=r[t]||{};var i=KI(e.name+"_"+(n==="visual"?t:e.fields[t]));var a=i;var o=1;while(r[a]){a=i+"_"+o++}return r[a]=r[t][n]=a}function AX(e){var t=null;var n=null;var r=null;var i=null;e.project.forEach(function(e,a){if(e.channel===jF){t=e;n=a}else if(e.channel===SF){r=e;i=a}});return{x:t,xi:n,y:r,yi:i}}function zX(e){return e&&e["selection"]}function TX(e){return e&&!!e.field&&e.equal!==undefined}function MX(e){return e&&!!e.field&&e.lt!==undefined}function NX(e){return e&&!!e.field&&e.lte!==undefined}function DX(e){return e&&!!e.field&&e.gt!==undefined}function CX(e){return e&&!!e.field&&e.gte!==undefined}function PX(e){if(e&&e.field){if(Object(V["isArray"])(e.range)&&e.range.length===2){return true}}return false}function RX(e){return e&&!!e.field&&(Object(V["isArray"])(e.oneOf)||Object(V["isArray"])(e.in))}function LX(e){return RX(e)||TX(e)||PX(e)||MX(e)||DX(e)||NX(e)||CX(e)}function IX(e,t,n){return eF(t,function(t){if(Object(V["isString"])(t)){return t}else if(zX(t)){return bX(e,t.selection,n)}else{return UX(t)}})}function FX(e,t){return LW(e,{timeUnit:t,time:true})}function qX(e,t){return e.map(function(e){return FX(e,t)})}function UX(e,t){if(t===void 0){t=true}var n=e.field,r=e.timeUnit;var i=r?"time("+YU(r,n)+")":mW(e,{expr:"datum"});if(TX(e)){return i+"==="+FX(e.equal,r)}else if(MX(e)){var a=e.lt;return i+"<"+FX(a,r)}else if(DX(e)){var o=e.gt;return i+">"+FX(o,r)}else if(NX(e)){var a=e.lte;return i+"<="+FX(a,r)}else if(CX(e)){var o=e.gte;return i+">="+FX(o,r)}else if(RX(e)){var u=e.oneOf;u=u||e["in"];return"indexof(["+qX(u,r).join(",")+"], "+i+") !== -1"}else if(PX(e)){var o=e.range[0];var a=e.range[1];if(o!==null&&a!==null&&t){return"inrange("+i+", ["+FX(o,r)+", "+FX(a,r)+"])"}var s=[];if(o!==null){s.push(i+" >= "+FX(o,r))}if(a!==null){s.push(i+" <= "+FX(a,r))}return s.length>0?s.join(" && "):"true"}throw new Error("Invalid field predicate: "+JSON.stringify(e))}function WX(e){if(LX(e)&&e.timeUnit){return I["__assign"]({},e,{timeUnit:JU(e.timeUnit)})}return e}function VX(e){return e["filter"]!==undefined}function HX(e){return e["lookup"]!==undefined}function BX(e){return e["window"]!==undefined}function GX(e){return e["calculate"]!==undefined}function $X(e){return!!e["bin"]}function YX(e){return e["timeUnit"]!==undefined}function XX(e){return e["aggregate"]!==undefined}function JX(e){return e["stack"]!==undefined}function QX(e){return e.map(function(e){if(VX(e)){return{filter:TI(e.filter,WX)}}return e})}function ZX(e,t,n,r){if(uG(t,n)){var i=_Y(e)?e.axis(n)||e.legend(n)||{}:{};var a=mW(t,{expr:"datum"});var o=mW(t,{expr:"datum",binSuffix:"end"});return{formulaAs:mW(t,{binSuffix:"range"}),formula:tG(a,o,i.format,r)}}return{}}function KX(e,t){return Nq(e)+"_"+t}function eJ(e,t){return{signal:e.getName(t+"_bins"),extentSignal:e.getName(t+"_extent")}}function tJ(e){return"as"in e}function nJ(e,t){var n;if(tJ(e)){n=Object(V["isString"])(e.as)?[e.as,e.as+"_end"]:[e.as[0],e.as[1]]}else{n=[mW(e,{}),mW(e,{binSuffix:"end"})]}var r=NW(e.bin,undefined)||{};var i=KX(r,e.field);var a=eJ(t,i),o=a.signal,u=a.extentSignal;var s=I["__assign"]({bin:r,field:e.field,as:n},o?{signal:o}:{},u?{extentSignal:u}:{});return{key:i,binComponent:s}}var rJ=function(e){I["__extends"](t,e);function t(t,n){var r=e.call(this,t)||this;r.bins=n;return r}t.prototype.clone=function(){return new t(null,QI(this.bins))};t.makeFromEncoding=function(e,n){var r=n.reduceFieldDef(function(e,t,r){if(t.bin){var i=nJ(t,n),a=i.key,o=i.binComponent;e[a]=I["__assign"]({},o,e[a],ZX(n,t,r,n.config))}return e},{});if(YI(r).length===0){return null}return new t(e,r)};t.makeFromTransform=function(e,n,r){var i;var a=nJ(n,r),o=a.key,u=a.binComponent;return new t(e,(i={},i[o]=u,i))};t.prototype.merge=function(e){this.bins=I["__assign"]({},this.bins,e.bins);e.remove()};t.prototype.producedFields=function(){var e={};XI(this.bins).forEach(function(t){t.as.forEach(function(t){return e[t]=true})});return e};t.prototype.dependentFields=function(){var e={};XI(this.bins).forEach(function(t){e[t.field]=true});return e};t.prototype.assemble=function(){return qI(XI(this.bins).map(function(e){var t=[];var n=I["__assign"]({type:"bin",field:e.field,as:e.as,signal:e.signal},e.bin);if(!e.bin.extent&&e.extentSignal){t.push({type:"extent",field:e.field,signal:e.extentSignal});n.extent={signal:e.extentSignal}}t.push(n);if(e.formula){t.push({type:"formula",expr:e.formula,as:e.formulaAs})}return t}))};return t}(lG);var iJ=function(e){I["__extends"](t,e);function t(t,n,r){var i=e.call(this,t)||this;i.model=n;i.filter=r;i.expr=IX(i.model,i.filter,i);return i}t.prototype.clone=function(){return new t(null,this.model,QI(this.filter))};t.prototype.assemble=function(){return{type:"filter",expr:this.expr}};return t}(lG);var aJ=function(e){I["__extends"](t,e);function t(t,n,r,i){var a=e.call(this,t)||this;a.fields=n;a.geojson=r;a.signal=i;return a}t.prototype.clone=function(){return new t(null,QI(this.fields),this.geojson,this.signal)};t.parseAll=function(e,n){var r=0;[[MF,zF],[NF,TF]].forEach(function(i){var a=i.map(function(e){return n.channelHasField(e)?n.fieldDef(e).field:undefined});if(a[0]||a[1]){e=new t(e,a,null,n.getName("geojson_"+r++))}});if(n.channelHasField(PF)){var i=n.fieldDef(PF);if(i.type===iW){e=new t(e,null,i.field,n.getName("geojson_"+r++))}}return e};t.prototype.assemble=function(){return I["__assign"]({type:"geojson"},this.fields?{fields:this.fields}:{},this.geojson?{geojson:this.geojson}:{},{signal:this.signal})};return t}(lG);var oJ=function(e){I["__extends"](t,e);function t(t,n,r,i){var a=e.call(this,t)||this;a.projection=n;a.fields=r;a.as=i;return a}t.prototype.clone=function(){return new t(null,this.projection,QI(this.fields),QI(this.as))};t.parseAll=function(e,n){if(!n.projectionName()){return e}[[MF,zF],[NF,TF]].forEach(function(r){var i=r.map(function(e){return n.channelHasField(e)?n.fieldDef(e).field:undefined});var a=r[0]===NF?"2":"";if(i[0]||i[1]){e=new t(e,n.projectionName(),i,[n.getName("x"+a),n.getName("y"+a)])}});return e};t.prototype.assemble=function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}};return t}(lG);var uJ=function(e){I["__extends"](t,e);function t(t){return e.call(this,t)||this}t.prototype.clone=function(){return new t(null)};t.prototype.producedFields=function(){var e;return e={},e[tH]=true,e};t.prototype.assemble=function(){return{type:"identifier",as:tH}};return t}(lG);var sJ=function(e){I["__extends"](t,e);function t(t,n,r){if(t===void 0){t={}}if(n===void 0){n={}}if(r===void 0){r=false}var i=e.call(this,t,n)||this;i.explicit=t;i.implicit=n;i.parseNothing=r;return i}t.prototype.clone=function(){var t=e.prototype.clone.call(this);t.parseNothing=this.parseNothing;return t};return t}(zG);var lJ=function(e){I["__extends"](t,e);function t(t,n,r){var i=e.call(this,t)||this;i.transform=n;i.secondary=r;return i}t.make=function(e,n,r,i){var a=n.component.data.sources;var o=new p$(r.from.data);var u=a[o.hash()];if(!u){a[o.hash()]=o;u=o}var s=n.getName("lookup_"+i);var l=new fG(u,s,"lookup",n.component.data.outputNodeRefCounts);n.component.data.outputNodes[s]=l;return new t(e,r,l.getSource())};t.prototype.producedFields=function(){return Object(V["toSet"])(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))};t.prototype.assemble=function(){var e;if(this.transform.from.fields){e=I["__assign"]({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof Array?this.transform.as:[this.transform.as]}:{})}else{var t=this.transform.as;if(!Object(V["isString"])(t)){vU(yU.NO_FIELDS_NEEDS_AS);t="_lookup"}e={as:[t]}}return I["__assign"]({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e,this.transform.default?{default:this.transform.default}:{})};return t}(lG);function fJ(e){console.log(""+e.constructor.name+(e.debugName?" ("+e.debugName+")":"")+" -> "+e.children.map(function(e){return""+e.constructor.name+(e.debugName?" ("+e.debugName+")":"")}));console.log(e);e.children.forEach(fJ)}function cJ(e){var t=0;function n(r,i){if(r instanceof p$){if(!JH(r.data)){e.push(i);var a={name:null,source:i.name,transform:[]};i=a}}if(r instanceof h$){if(r.parent instanceof p$&&!i.source){i.format=I["__assign"]({},i.format||{},{parse:r.assembleFormatParse()});i.transform=i.transform.concat(r.assembleTransforms(true))}else{i.transform=i.transform.concat(r.assembleTransforms())}}if(r instanceof f$){if(!i.name){i.name="data_"+t++}if(!i.source||i.transform.length>0){e.push(i);r.data=i.name}else{r.data=i.source}r.assemble().forEach(function(t){return e.push(t)});return}if(r instanceof iJ||r instanceof cG||r instanceof oJ||r instanceof aJ||r instanceof l$||r instanceof lJ||r instanceof zJ||r instanceof uJ){i.transform.push(r.assemble())}if(r instanceof c$||r instanceof rJ||r instanceof v$||r instanceof k$){i.transform=i.transform.concat(r.assemble())}if(r instanceof l$){if(!i.name){i.name="data_"+t++}}if(r instanceof fG){if(i.source&&i.transform.length===0){r.setSource(i.source)}else if(r.parent instanceof fG){r.setSource(i.name)}else{if(!i.name){i.name="data_"+t++}r.setSource(i.name);if(r.numChildren()===1){e.push(i);var a={name:null,source:i.name,transform:[]};i=a}}}switch(r.numChildren()){case 0:if(r instanceof fG&&(!i.source||i.transform.length>0)){e.push(i)}break;case 1:n(r.children[0],i);break;default:if(!i.name){i.name="data_"+t++}var o=i.name;if(!i.source||i.transform.length>0){e.push(i)}else{o=i.source}r.children.forEach(function(e){var t={name:null,source:o,transform:[]};n(e,t)});break}}return n}function dJ(e){var t=[];var n=cJ(t);e.children.forEach(function(t){return n(t,{source:e.name,name:null,transform:[]})});return t}function hJ(e,t){var n=XI(e.sources);var r=[];var i=cJ(r);var a=0;n.forEach(function(e){if(!e.hasName()){e.dataName="source_"+a++}var t=e.assemble();i(e,t)});r.forEach(function(e){if(e.transform.length===0){delete e.transform}});var o=0;for(var u=0;u<r.length;u++){var s=r[u];if((s.transform||[]).length===0&&!s.source){r.splice(o++,0,r.splice(u,1)[0])}}for(var l=0,f=r;l<f.length;l++){var s=f[l];for(var c=0,d=s.transform||[];c<d.length;c++){var h=d[c];if(h.type==="lookup"){h.from=e.outputNodes[h.from].getSource()}}}for(var p=0,v=r;p<v.length;p++){var s=v[p];if(s.name in t){s.values=t[s.name]}}return r}function pJ(e){mJ(e);var t=e.component.layoutSize;t.setWithExplicit("width",yJ(e,"width"));t.setWithExplicit("height",yJ(e,"height"))}var vJ=pJ;function gJ(e){mJ(e);var t=e.component.layoutSize;var n=e.isVConcat?"width":"height";t.setWithExplicit(n,yJ(e,n))}function mJ(e){for(var t=0,n=e.children;t<n.length;t++){var r=n[t];r.parseLayoutSize()}}function yJ(e,t){var n=t==="width"?"x":"y";var r=e.component.resolve;var i;for(var a=0,o=e.children;a<o.length;a++){var u=o[a];var s=u.component.layoutSize.getWithExplicit(t);var l=r.scale[n];if(l==="independent"&&s.value==="range-step"){i=undefined;break}if(i){if(l==="independent"&&i.value!==s.value){i=undefined;break}i=CG(i,s,t,"")}else{i=s}}if(i){for(var f=0,c=e.children;f<c.length;f++){var u=c[f];e.renameLayoutSize(u.getName(t),e.getName(t));u.component.layoutSize.set(t,"merged",false)}return i}else{return{explicit:false,value:undefined}}}function bJ(e){var t=e.component.layoutSize;if(!t.explicit.width){var n=_J(e,"width");t.set("width",n,false)}if(!t.explicit.height){var r=_J(e,"height");t.set("height",r,false)}}function _J(e,t){var n=t==="width"?"x":"y";var r=e.config;var i=e.getScaleComponent(n);if(i){var a=i.get("type");var o=i.get("range");if(MV(a)&&nB(o)){return"range-step"}else{return r.view[t]}}else if(e.hasProjection){return r.view[t]}else{if(t==="width"&&e.mark==="text"){return r.scale.textXRangeStep}return r.scale.rangeStep||PV.rangeStep}}function xJ(e,t){return SJ(e,t)}function kJ(e,t){return SJ(e,t)}function OJ(e,t){if(uW(e.field)){if(e.field.repeat in t){return I["__assign"]({},e,{field:t[e.field.repeat]})}else{vU(yU.noSuchRepeatedValue(e.field.repeat));return undefined}}return e}function wJ(e,t){e=OJ(e,t);if(e===undefined){return undefined}if(e.sort&&gB(e.sort)){var n=OJ(e.sort,t);e=I["__assign"]({},e,n?{sort:n}:{})}return e}function jJ(e,t){if(dW(e)){var n=wJ(e,t);if(n){return n}else if(lW(e)){return{condition:e.condition}}}else{if(fW(e)){var n=wJ(e.condition,t);if(n){return I["__assign"]({},e,{condition:n})}else{var r=e.condition,i=I["__rest"](e,["condition"]);return i}}return e}return undefined}function SJ(e,t){var n={};for(var r in e){if(e.hasOwnProperty(r)){var i=e[r];if(Object(V["isArray"])(i)){n[r]=i.map(function(e){return jJ(e,t)}).filter(function(e){return e})}else{var a=jJ(i,t);if(a){n[r]=a}}}}return n}function EJ(e,t,n){return mW(t,{expr:n,suffix:"by_"+mW(e)})}var AJ=function(e){I["__extends"](t,e);function t(t,n,r,i,a){var o=e.call(this,t,n,r,a,i,t.resolve)||this;o.type="facet";o.child=UQ(t.spec,o,o.getName("child"),undefined,i,a,false);o.children=[o.child];var u=xJ(t.facet,i);o.facet=o.initFacet(u);return o}t.prototype.initFacet=function(e){return BW(e,function(e,t,n){if(!PI([DF,CF],n)){vU(yU.incompatibleChannel(n,"facet"));return e}if(t.field===undefined){vU(yU.emptyFieldDef(t,n));return e}e[n]=TW(t,n);return e},{})};t.prototype.channelHasField=function(e){return!!this.facet[e]};t.prototype.fieldDef=function(e){return this.facet[e]};t.prototype.parseData=function(){this.component.data=NJ(this);this.child.parseData()};t.prototype.parseLayoutSize=function(){mJ(this)};t.prototype.parseSelection=function(){this.child.parseSelection();this.component.selection=this.child.component.selection};t.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()};t.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader();this.parseHeader("column");this.parseHeader("row");this.mergeChildAxis("x");this.mergeChildAxis("y")};t.prototype.parseHeader=function(e){if(this.channelHasField(e)){var t=this.facet[e];var n=t.header||{};var r=t.title!==undefined?t.title:n.title!==undefined?n.title:EW(t,this.config);if(this.child.component.layoutHeaders[e].title){r+=" / "+this.child.component.layoutHeaders[e].title;this.child.component.layoutHeaders[e].title=null}this.component.layoutHeaders[e]={title:r,facetFieldDef:t,header:[this.makeHeaderComponent(e,true)]}}};t.prototype.makeHeaderComponent=function(e,t){var n=e==="row"?"height":"width";return{labels:t,sizeSignal:this.child.component.layoutSize.get(n)?this.child.getSizeSignalRef(n):undefined,axes:[]}};t.prototype.mergeChildAxis=function(e){var t=this.child;if(t.component.axes[e]){var n=this.component,r=n.layoutHeaders,i=n.resolve;i.axis[e]=AG(i,e);if(i.axis[e]==="shared"){var a=e==="x"?"column":"row";var o=r[a];for(var u=0,s=t.component.axes[e];u<s.length;u++){var l=s[u];var f=vG(l.get("orient"));o[f]=o[f]||[this.makeHeaderComponent(a,false)];var c=fB(l,"main",this.config,{header:true});o[f][0].axes.push(c);l.mainExtracted=true}}else{}}};t.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)};t.prototype.assembleSelectionSignals=function(){this.child.assembleSelectionSignals();return[]};t.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)};t.prototype.getHeaderLayoutMixins=function(){var e=this;var t={};["row","column"].forEach(function(n){["header","footer"].forEach(function(r){var i=e.component.layoutHeaders[n];var a=i[r];if(a&&a[0]){var o=n==="row"?"height":"width";var u=r==="header"?"headerBand":"footerBand";if(!e.child.component.layoutSize.get(o)){t[u]=t[u]||{};t[u][n]=.5}if(i.title){t.offset=t.offset||{};t.offset[n==="row"?"rowTitle":"columnTitle"]=10}}})});return t};t.prototype.assembleDefaultLayout=function(){var e=this.channelHasField("column")?this.columnDistinctSignal():1;return I["__assign"]({},this.getHeaderLayoutMixins(),{columns:e,bounds:"full",align:"all"})};t.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()};t.prototype.columnDistinctSignal=function(){if(this.parent&&this.parent instanceof t){return undefined}else{var e=this.getName("column_domain");return{signal:"length(data('"+e+"'))"}}};t.prototype.assembleGroup=function(n){if(this.parent&&this.parent instanceof t){return I["__assign"]({},this.channelHasField("column")?{encode:{update:{columns:{field:mW(this.facet.column,{prefix:"distinct"})}}}}:{},e.prototype.assembleGroup.call(this,n))}return e.prototype.assembleGroup.call(this,n)};t.prototype.getCardinalityAggregateForChild=function(){var e=[];var n=[];var r=[];if(this.child instanceof t){if(this.child.channelHasField("column")){var i=mW(this.child.facet.column);e.push(i);n.push("distinct");r.push("distinct_"+i)}}else{for(var a=0,o=["x","y"];a<o.length;a++){var u=o[a];var s=this.child.component.scales[u];if(s&&!s.merged){var l=s.get("type");var f=s.get("range");if(MV(l)&&nB(f)){var c=U$(this.child,u);var i=q$(c);if(i){e.push(i);n.push("distinct");r.push("distinct_"+i)}else{vU("Unknown field for ${channel}.  Cannot calculate view size.")}}}}}return{fields:e,ops:n,as:r}};t.prototype.assembleFacet=function(){var e=this;var t=this.component.data.facetRoot,n=t.name,r=t.data;var i=this.facet,a=i.row,o=i.column;var u=this.getCardinalityAggregateForChild(),s=u.fields,l=u.ops,f=u.as;var c=[];["row","column"].forEach(function(t){var n=e.facet[t];if(n){c.push(mW(n));var r=n.sort;if(gB(r)){var i=r.field,u=r.op;var d=EJ(n,r);if(a&&o){s.push(d);l.push("max");f.push(d)}else{s.push(i);l.push(u);f.push(d)}}else if(Object(V["isArray"])(r)){var d=dG(n,t);s.push(d);l.push("max");f.push(d)}}});var d=!!a&&!!o;return I["__assign"]({name:n,data:r,groupby:c},d||s.length?{aggregate:I["__assign"]({},d?{cross:d}:{},s.length?{fields:s,ops:l,as:f}:{})}:{})};t.prototype.headerSortFields=function(e){var t=this.facet;var n=t[e];if(n){if(gB(n.sort)){return[EJ(n,n.sort,"datum")]}else if(Object(V["isArray"])(n.sort)){return[dG(n,e,"datum")]}return[mW(n,{expr:"datum"})]}return[]};t.prototype.headerSortOrder=function(e){var t=this.facet;var n=t[e];if(n){var r=n.sort;var i=(gB(r)?r.order:!Object(V["isArray"])(r)&&r)||"ascending";return[i]}return[]};t.prototype.assembleMarks=function(){var e=this.child;var t=this.component.data.facetRoot;var n=dJ(t);var r=e.assembleLayoutSize();var i=e.assembleTitle();var a=e.assembleGroupStyle();var o=I["__assign"]({name:this.getName("cell"),type:"group"},i?{title:i}:{},a?{style:a}:{},{from:{facet:this.assembleFacet()},sort:{field:this.headerSortFields("row").concat(this.headerSortFields("column")),order:this.headerSortOrder("row").concat(this.headerSortOrder("column"))}},n.length>0?{data:n}:{},r?{encode:{update:r}}:{},e.assembleGroup());return[o]};t.prototype.getMapping=function(){return this.facet};return t}(SY);var zJ=function(e){I["__extends"](t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.makeFromFacet=function(e,n){var r=n.row,i=n.column;if(r&&i){var a=null;for(var o=0,u=[r,i];o<u.length;o++){var s=u[o];if(gB(s.sort)){var l=s.sort,f=l.field,c=l.op;e=a=new t(e,{window:[{op:c,field:f,as:EJ(s,s.sort)}],groupby:[mW(s)],frame:[null,null]})}}return a}return null};t.prototype.clone=function(){return new t(this.parent,QI(this.transform))};t.prototype.producedFields=function(){var e=this;var t={};this.transform.window.forEach(function(n){t[e.getDefaultName(n)]=true});return t};t.prototype.getDefaultName=function(e){return e.as||mW(e)};t.prototype.assemble=function(){var e=[];var t=[];var n=[];var r=[];for(var i=0,a=this.transform.window;i<a.length;i++){var o=a[i];t.push(o.op);n.push(this.getDefaultName(o));r.push(o.param===undefined?null:o.param);e.push(o.field===undefined?null:o.field)}var u=this.transform.frame;var s=this.transform.groupby;var l=[];var f=[];if(this.transform.sort!==undefined){for(var c=0,d=this.transform.sort;c<d.length;c++){var h=d[c];l.push(h.field);f.push(h.order||"ascending")}}var p={field:l,order:f};var v=this.transform.ignorePeers;var g={type:"window",params:r,as:n,ops:t,fields:e,sort:p};if(v!==undefined){g.ignorePeers=v}if(s!==undefined){g.groupby=s}if(u!==undefined){g.frame=u}return g};return t}(lG);function TJ(e,t){if(e.data||!e.parent){var n=new p$(e.data);var r=n.hash();if(r in t){return t[r]}else{t[r]=n;return n}}else{return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}}function MJ(e,t,n){var r=0;t.transforms.forEach(function(i){if(GX(i)){e=new cG(e,i);n.set(i.as,"derived",false)}else if(VX(i)){e=h$.makeImplicitFromFilterTransform(e,i,n)||e;e=new iJ(e,t,i.filter)}else if($X(i)){var a=e=rJ.makeFromTransform(e,i,t);for(var o=0,u=YI(a.producedFields());o<u.length;o++){var s=u[o];n.set(s,"number",false)}}else if(YX(i)){e=v$.makeFromTransform(e,i);n.set(i.as,"date",false)}else if(XX(i)){var l=e=l$.makeFromTransform(e,i);if(SX(t)){e=new uJ(e)}for(var f=0,c=YI(l.producedFields());f<c.length;f++){var s=c[f];n.set(s,"derived",false)}}else if(HX(i)){var d=e=lJ.make(e,t,i,r++);for(var h=0,p=YI(d.producedFields());h<p.length;h++){var s=p[h];n.set(s,"derived",false)}}else if(BX(i)){var v=e=new zJ(e,i);for(var g=0,m=YI(v.producedFields());g<m.length;g++){var s=m[g];n.set(s,"derived",false)}}else if(JX(i)){var y=e=k$.makeFromTransform(e,i);for(var b=0,_=YI(y.producedFields());b<_.length;b++){var s=_[b];n.set(s,"derived",false)}}else{vU(yU.invalidTransformIgnored(i));return}});return e}function NJ(e){var t=TJ(e,e.component.data.sources);var n=e.component.data,r=n.outputNodes,i=n.outputNodeRefCounts;var a=e.parent?e.parent.component.data.ancestorParse.clone():new sJ;if(e.data&&e.data.format&&e.data.format.parse===null){a.parseNothing=true}t=h$.makeExplicit(t,e,a)||t;if(SX(e)&&(_Y(e)||wY(e))){t=new uJ(t)}var o=e.parent&&wY(e.parent);if(_Y(e)||xY(e)){if(o){t=rJ.makeFromEncoding(t,e)||t}}if(e.transforms.length>0){t=MJ(t,e,a)}t=h$.makeImplicitFromEncoding(t,e,a)||t;if(_Y(e)){t=aJ.parseAll(t,e);t=oJ.parseAll(t,e)}if(_Y(e)||xY(e)){if(!o){t=rJ.makeFromEncoding(t,e)||t}t=v$.makeFromEncoding(t,e)||t;t=cG.parseAllForSortIndex(t,e)}var u=e.getName(eB);var s=new fG(t,u,eB,i);r[u]=s;t=s;if(_Y(e)){var l=l$.makeFromEncoding(t,e);if(l){t=l;if(SX(e)){t=new uJ(t)}}t=k$.makeFromEncoding(t,e)||t}if(_Y(e)){t=c$.make(t,e)||t}var f=e.getName(KH);var c=new fG(t,f,KH,i);r[f]=c;t=c;var d=null;if(xY(e)){var h=e.getName("facet");t=cG.parseAllForSortIndex(t,e);t=zJ.makeFromFacet(t,e.facet)||t;d=new f$(t,e,h,c.getSource());r[h]=d;t=d}return I["__assign"]({},e.component.data,{outputNodes:r,outputNodeRefCounts:i,raw:s,main:c,facetRoot:d,ancestorParse:a})}var DJ=function(e){I["__extends"](t,e);function t(t,n,r,i,a,o){return e.call(this,t,n,r,i,a,o)||this}t.prototype.parseData=function(){this.component.data=NJ(this);this.children.forEach(function(e){e.parseData()})};t.prototype.parseSelection=function(){var e=this;this.component.selection={};var t=function(t){t.parseSelection();YI(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})};for(var n=0,r=this.children;n<r.length;n++){var i=r[n];t(i)}};t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseMarkGroup()}};t.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseAxisAndHeader()}};t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)};t.prototype.assembleSelectionSignals=function(){this.children.forEach(function(e){return e.assembleSelectionSignals()});return[]};t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},OG(this))};t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},e)};t.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleTitle();var n=e.assembleGroupStyle();var r=e.assembleLayoutSize();return I["__assign"]({type:"group",name:e.getName("group")},t?{title:t}:{},n?{style:n}:{},r?{encode:{update:r}}:{},e.assembleGroup())})};return t}(jY);var CJ=function(e){I["__extends"](t,e);function t(t,n,r,i,a){var o=e.call(this,t,n,r,a,i,t.resolve)||this;o.type="concat";if(t.resolve&&t.resolve.axis&&(t.resolve.axis.x==="shared"||t.resolve.axis.y==="shared")){vU(yU.CONCAT_CANNOT_SHARE_AXIS)}o.isVConcat=OH(t);o.children=(OH(t)?t.vconcat:t.hconcat).map(function(e,t){return UQ(e,o,o.getName("concat_"+t),undefined,i,a,false)});return o}t.prototype.parseLayoutSize=function(){gJ(this)};t.prototype.parseAxisGroup=function(){return null};t.prototype.assembleDefaultLayout=function(){return I["__assign"]({},this.isVConcat?{columns:1}:{},{bounds:"full",align:"each"})};return t}(DJ);function PJ(e){return e===false||e===null}var RJ=function(e){I["__extends"](t,e);function t(t,n,r){if(t===void 0){t={}}if(n===void 0){n={}}if(r===void 0){r=false}var i=e.call(this)||this;i.explicit=t;i.implicit=n;i.mainExtracted=r;return i}t.prototype.clone=function(){return new t(QI(this.explicit),QI(this.implicit),this.mainExtracted)};t.prototype.hasAxisPart=function(e){if(e==="axis"){return true}if(e==="grid"||e==="title"){return!!this.get(e)}return!PJ(this.get(e))};return t}(zG);function LJ(e,t,n,r,i){if(r===void 0){r=""}var a=(i==="band"?["axisBand"]:[]).concat([n==="x"?"axisX":"axisY","axis"+r.substr(0,1).toUpperCase()+r.substr(1),"axis"]);for(var o=0,u=a;o<u.length;o++){var s=u[o];if(t[s]&&t[s][e]!==undefined){return t[s][e]}}return undefined}function IJ(e,t,n,r){var i=e.fieldDef(t)||(t==="x"?e.fieldDef("x2"):t==="y"?e.fieldDef("y2"):undefined);var a=e.axis(t);var o=e.config;var u={};if(RW(i)){var s=e.getScaleComponent(t).get("type")===mV.UTC;var l=nG("datum.value",i.timeUnit,a.format,o.axis.shortTimeLabels,o.timeFormat,s);if(l){u.text={signal:l}}}var f=LJ("labelAngle",e.config,t,r,e.getScaleComponent(t).get("type"));if(f===undefined){f=qJ(a,t,i);if(f){u.angle={value:f}}}if(f!==undefined){var c=UJ(f,r);if(c){u.align={value:c}}u.baseline=FJ(f,r)}u=I["__assign"]({},u,n);return YI(u).length===0?undefined:u}function FJ(e,t){if(t==="top"||t==="bottom"){if(e<=45||315<=e){return{value:t==="top"?"bottom":"top"}}else if(135<=e&&e<=225){return{value:t==="top"?"top":"bottom"}}else{return{value:"middle"}}}else{if(e<=45||315<=e||135<=e&&e<=225){return{value:"middle"}}else if(45<=e&&e<=135){return{value:t==="left"?"top":"bottom"}}else{return{value:t==="left"?"bottom":"top"}}}}function qJ(e,t,n){if(e.labelAngle!==undefined){return(e.labelAngle%360+360)%360}else{if(t===jF&&PI([rW,tW],n.type)){return 270}}return undefined}function UJ(e,t){e=(e%360+360)%360;if(t==="top"||t==="bottom"){if(e%180===0){return"center"}else if(0<e&&e<180){return t==="top"?"right":"left"}else{return t==="top"?"left":"right"}}else{if((e+90)%180===0){return"center"}else if(90<=e&&e<270){return t==="left"?"left":"right"}else{return t==="left"?"right":"left"}}}function WJ(e,t){return!MV(e)&&!t.bin}function VJ(e,t){var n=t==="x"?"y":"x";if(e.getScaleComponent(n)){return e.scaleName(n)}return undefined}function HJ(e,t,n){if(n.labelFlush!==undefined){return n.labelFlush}if(t==="x"&&PI(["quantitative","temporal"],e.type)){return true}return undefined}function BJ(e,t,n,r){if(t.labelOverlap!==undefined){return t.labelOverlap}if(e.type!=="nominal"){if(r==="log"){return"greedy"}return true}return undefined}function GJ(e){switch(e){case jF:return"bottom";case SF:return"left"}throw new Error(yU.INVALID_CHANNEL_FOR_AXIS)}function $J(e,t,n,r){if(!MV(n)&&n!=="log"&&!PI(["month","hours","day","quarter"],t.timeUnit)){if(t.bin){return{signal:"ceil("+r.signal+"/20)"}}return{signal:"ceil("+r.signal+"/40)"}}return undefined}function YJ(e,t,n){var r=EW(t,n);return e?Object(V["truncate"])(r,e):r}function XJ(e,t,n,r){var i=e.values;if(i){return IW(n,i)}if(n.bin&&n.type===eW){var a=t.scaleDomain(r);if(a&&a!=="unaggregated"&&!LV(a)){return undefined}var o=t.getName(Nq(n.bin)+"_"+n.field+"_bins");return{signal:"sequence("+o+".start, "+o+".stop + "+o+".step, "+o+".step)"}}return undefined}function JJ(e){return mq.reduce(function(t,n){if(e.component.scales[n]&&e.axis(n)){t[n]=[nQ(n,e)]}return t},{})}var QJ={bottom:"top",top:"bottom",left:"right",right:"left"};function ZJ(e){var t=e.component,n=t.axes,r=t.resolve;var i={top:0,bottom:0,right:0,left:0};for(var a=0,o=e.children;a<o.length;a++){var u=o[a];u.parseAxisAndHeader();for(var s=0,l=YI(u.component.axes);s<l.length;s++){var f=l[s];r.axis[f]=AG(e.component.resolve,f);if(r.axis[f]==="shared"){n[f]=KJ(n[f],u.component.axes[f]);if(!n[f]){r.axis[f]="independent";delete n[f]}}}}for(var c=0,d=[jF,SF];c<d.length;c++){var f=d[c];for(var h=0,p=e.children;h<p.length;h++){var u=p[h];if(!u.component.axes[f]){continue}if(r.axis[f]==="independent"){n[f]=(n[f]||[]).concat(u.component.axes[f]);for(var v=0,g=u.component.axes[f];v<g.length;v++){var m=g[v];var y=m.getWithExplicit("orient"),b=y.value,_=y.explicit;if(i[b]>0&&!_){var x=QJ[b];if(i[b]>i[x]){m.set("orient",x,false)}}i[b]++}}delete u.component.axes[f]}}}function KJ(e,t){if(e){if(e.length!==t.length){return undefined}var n=e.length;for(var r=0;r<n;r++){var i=e[r];var a=t[r];if(!!i!==!!a){return undefined}else if(i&&a){var o=i.getWithExplicit("orient");var u=a.getWithExplicit("orient");if(o.explicit&&u.explicit&&o.value!==u.value){return undefined}else{e[r]=eQ(i,a)}}}}else{return t.map(function(e){return e.clone()})}return e}function eQ(e,t){var n=function(n){var r=CG(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",function(e,t){switch(n){case"title":return oG(e,t);case"gridScale":return{explicit:e.explicit,value:e.value||t.value}}return DG(e,t,n,"axis")});e.setWithExplicit(n,r)};for(var r=0,i=kF;r<i.length;r++){var a=i[r];n(a)}return e}function tQ(e,t){var n=t==="x"?"x2":"y2";var r=e.fieldDef(t);var i=e.fieldDef(n);var a=r?r.title:undefined;var o=i?i.title:undefined;if(a&&o){return aG(a,o)}else if(a){return a}else if(o){return o}else if(a!==undefined){return a}else if(o!==undefined){return o}return undefined}function nQ(e,t){var n=t.axis(e);var r=new RJ;kF.forEach(function(i){var a=rQ(i,n,e,t);if(a!==undefined){var o=i==="values"?!!n.values:i==="encode"?!!n.encoding||!!n.labelAngle:i==="title"&&a===tQ(t,e)?true:a===n[i];var u=LJ(i,t.config,e,r.get("orient"),t.getScaleComponent(e).get("type"));if(o||u===undefined){r.set(i,a,o)}else if(i==="grid"&&u){r.set(i,u,false)}}});var i=n.encoding||{};var a=gF.reduce(function(n,a){if(!r.hasAxisPart(a)){return n}var o=sG(i[a]||{},t);var u=a==="labels"?IJ(t,e,o,r.get("orient")):o;if(u!==undefined&&YI(u).length>0){n[a]={update:u}}return n},{});if(YI(a).length>0){r.set("encode",a,!!n.encoding||n.labelAngle!==undefined)}return r}function rQ(e,t,n,r){var i=r.fieldDef(n);switch(e){case"scale":return r.scaleName(n);case"gridScale":return VJ(r,n);case"format":return ZB(i,t.format,r.config);case"grid":{var a=r.getScaleComponent(n).get("type");return QB(t.grid,WJ(a,i))}case"labelFlush":return HJ(i,n,t);case"labelOverlap":{var a=r.getScaleComponent(n).get("type");return BJ(i,t,n,a)}case"orient":return QB(t.orient,GJ(n));case"tickCount":{var a=r.getScaleComponent(n).get("type");var o=n==="x"?"width":n==="y"?"height":undefined;var u=o?r.getSizeSignalRef(o):undefined;return QB(t.tickCount,$J(n,i,a,u))}case"title":var s=n==="x"?"x2":"y2";var l=r.fieldDef(s);var f=tQ(r,n);var c=f!==undefined?f:t.title===undefined?undefined:t.title;return QB(c,iG([sW(i)],l?[sW(l)]:[]));case"values":return XJ(t,r,i,n)}return xF(e)?t[e]:undefined}function iQ(e,t,n){var r=Zq(e)?I["__assign"]({},e):{type:e};var i=r.orient||XB("orient",r,n);r.orient=sQ(r.type,t,i);if(i!==undefined&&i!==r.orient){vU(yU.orientOverridden(r.orient,i))}var a=r.opacity!==undefined?r.opacity:XB("opacity",r,n);if(a===undefined){r.opacity=oQ(r.type,t)}var o=r.filled;if(o===undefined){r.filled=uQ(r,n)}var u=r.cursor||XB("cursor",r,n);if(u===undefined){r.cursor=aQ(r,t,n)}return r}function aQ(e,t,n){if(t.href||e.href||XB("href",e,n)){return"pointer"}return e.cursor}function oQ(e,t){if(PI([Fq,Uq,Gq,$q],e)){if(!qW(t)){return.7}}return undefined}function uQ(e,t){var n=XB("filled",e,t);var r=e.type;return n!==undefined?n:r!==Fq&&r!==Iq&&r!==Hq}function sQ(e,t,n){switch(e){case Fq:case Gq:case $q:case qq:case Vq:return undefined}var r=t.y2;var i=t.x2;switch(e){case Lq:if(r||i){if(n){return n}var a=t.x;if(!i&&dW(a)&&a.type===eW&&!a.bin){return"horizontal"}var o=t.y;if(!r&&dW(o)&&o.type===eW&&!o.bin){return"vertical"}}case Hq:if(i&&r){return undefined}case Rq:if(r){return"vertical"}else if(i){return"horizontal"}else if(e===Hq){if(t.x&&!t.y){return"vertical"}else if(t.y&&!t.x){return"horizontal"}}case Iq:case Uq:var u=dW(t.x)&&bW(t.x);var s=dW(t.y)&&bW(t.y);if(u&&!s){return e!=="tick"?"horizontal":"vertical"}else if(!u&&s){return e!=="tick"?"vertical":"horizontal"}else if(u&&s){var a=t.x;var o=t.y;var l=a.type===nW;var f=o.type===nW;if(l&&!f){return e!=="tick"?"vertical":"horizontal"}else if(!l&&f){return e!=="tick"?"horizontal":"vertical"}if(!a.aggregate&&o.aggregate){return e!=="tick"?"vertical":"horizontal"}else if(a.aggregate&&!o.aggregate){return e!=="tick"?"horizontal":"vertical"}if(n){return n}return"vertical"}else{if(n){return n}return undefined}}return"vertical"}var lQ={vgMark:"area",encodeEntry:function(e){return I["__assign"]({},MB(e,{size:"ignore",orient:"include"}),HB("x",e,"zeroOrMin"),HB("y",e,"zeroOrMin"),BB(e,"zeroOrMin",e.markDef.orient==="horizontal"?"x2":"y2"),PB(e))}};var fQ={vgMark:"rect",encodeEntry:function(e){return I["__assign"]({},MB(e,{size:"ignore",orient:"ignore"}),cQ(e),dQ(e))}};function cQ(e){var t=e.config,n=e.encoding,r=e.markDef,i=e.width;var a=r.orient;var o=n.size;var u=n.x;var s=n.x2;var l=e.scaleName(jF);var f=e.getScaleComponent(jF);if(a==="horizontal"||s){return I["__assign"]({},HB("x",e,"zeroOrMin"),BB(e,"zeroOrMin","x2"))}else{if(dW(u)){var c=f.get("type");if(u.bin&&!o&&!MV(c)){return VB(u,"x",e.scaleName("x"),r.binSpacing===undefined?t.bar.binSpacing:r.binSpacing,f.get("reverse"))}else{if(c===mV.BAND){return UB(u,"x",e)}}}return WB("x",e,I["__assign"]({},EB(i)),hQ(r,l,f,t))}}function dQ(e){var t=e.config,n=e.encoding,r=e.height,i=e.markDef;var a=i.orient;var o=n.size;var u=n.y;var s=n.y2;var l=e.scaleName(SF);var f=e.getScaleComponent(SF);if(a==="vertical"||s){return I["__assign"]({},HB("y",e,"zeroOrMin"),BB(e,"zeroOrMin","y2"))}else{if(dW(u)){var c=f.get("type");if(u.bin&&!o&&!MV(c)){return VB(u,"y",e.scaleName("y"),i.binSpacing===undefined?t.bar.binSpacing:i.binSpacing,f.get("reverse"))}else if(c===mV.BAND){return UB(u,"y",e)}}return WB("y",e,EB(r),hQ(i,l,f,t))}}function hQ(e,t,n,r){if(e.size!==undefined){return{value:e.size}}else if(r.bar.discreteBandSize){return{value:r.bar.discreteBandSize}}else if(n){var i=n.get("type");if(i===mV.POINT){var a=n.get("range");if(nB(a)&&Object(V["isNumber"])(a.step)){return{value:a.step-1}}vU(yU.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}else if(i===mV.BAND){return OB(t)}else{return{value:r.bar.continuousBandSize}}}else if(r.scale.rangeStep&&r.scale.rangeStep!==null){return{value:r.scale.rangeStep-1}}return{value:20}}var pQ={vgMark:"shape",encodeEntry:function(e){return I["__assign"]({},MB(e,{size:"ignore",orient:"ignore"}))},postEncodingTransform:function(e){var t=e.encoding;var n=t.shape;var r=I["__assign"]({type:"geoshape",projection:e.projectionName()},n&&dW(n)&&n.type===iW?{field:mW(n,{expr:"datum"})}:{});return[r]}};var vQ={vgMark:"line",encodeEntry:function(e){var t=e.width,n=e.height;return I["__assign"]({},MB(e,{size:"ignore",orient:"ignore"}),HB("x",e,EB(t)),HB("y",e,EB(n)),RB("size",e,{vgChannel:"strokeWidth"}),PB(e))}};var gQ={vgMark:"trail",encodeEntry:function(e){var t=e.width,n=e.height;return I["__assign"]({},MB(e,{size:"include",orient:"ignore"}),HB("x",e,EB(t)),HB("y",e,EB(n)),RB("size",e),PB(e))}};function mQ(e,t){var n=e.config,r=e.width,i=e.height;return I["__assign"]({},MB(e,{size:"include",orient:"ignore"}),HB("x",e,EB(r)),HB("y",e,EB(i)),RB("size",e),yQ(e,n,t))}function yQ(e,t,n){if(n){return{shape:{value:n}}}return RB("shape",e,{defaultValue:XB("shape",e.markDef,t)})}var bQ={vgMark:"symbol",encodeEntry:function(e){return mQ(e)}};var _Q={vgMark:"symbol",encodeEntry:function(e){return mQ(e,"circle")}};var xQ={vgMark:"symbol",encodeEntry:function(e){return mQ(e,"square")}};var kQ={vgMark:"rect",encodeEntry:function(e){return I["__assign"]({},MB(e,{size:"ignore",orient:"ignore"}),OQ(e),wQ(e))}};function OQ(e){var t=e.encoding.x;var n=e.encoding.x2;var r=e.getScaleComponent(jF);var i=r?r.get("type"):undefined;if(dW(t)&&t.bin&&!n){return VB(t,"x",e.scaleName("x"),0,r.get("reverse"))}else if(dW(t)&&r&&MV(i)){if(i===mV.BAND){return UB(t,"x",e)}else{throw new Error(yU.scaleTypeNotWorkWithMark(Vq,i))}}else{return I["__assign"]({},HB("x",e,"zeroOrMax"),BB(e,"zeroOrMin","x2"))}}function wQ(e){var t=e.encoding.y;var n=e.encoding.y2;var r=e.getScaleComponent(SF);var i=r?r.get("type"):undefined;if(dW(t)&&t.bin&&!n){return VB(t,"y",e.scaleName("y"),0,r.get("reverse"))}else if(dW(t)&&r&&MV(i)){if(i===mV.BAND){return UB(t,"y",e)}else{throw new Error(yU.scaleTypeNotWorkWithMark(Vq,i))}}else{return I["__assign"]({},HB("y",e,"zeroOrMax"),BB(e,"zeroOrMin","y2"))}}var jQ={vgMark:"rule",encodeEntry:function(e){var t=e.config,n=e.markDef,r=e.width,i=e.height;var a=n.orient;if(!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude){return{}}return I["__assign"]({},MB(e,{size:"ignore",orient:"ignore"}),HB("x",e,a==="horizontal"?"zeroOrMin":EB(r)),HB("y",e,a==="vertical"?"zeroOrMin":EB(i)),a!=="vertical"?BB(e,"zeroOrMax","x2"):{},a!=="horizontal"?BB(e,"zeroOrMax","y2"):{},RB("size",e,{vgChannel:"strokeWidth",defaultValue:n.size}))}};var SQ={vgMark:"text",encodeEntry:function(e){var t=e.config,n=e.encoding,r=e.width,i=e.height,a=e.markDef;return I["__assign"]({},MB(e,{size:"ignore",orient:"ignore"}),HB("x",e,EB(r)),HB("y",e,EB(i)),FB(e),RB("size",e,I["__assign"]({},a.size?{defaultValue:a.size}:{},{vgChannel:"fontSize"})),DB("align",EQ(e.markDef,n,t)))}};function EQ(e,t,n){var r=e.align||XB("align",e,n);if(r===undefined){return"center"}return undefined}var AQ={vgMark:"rect",encodeEntry:function(e){var t;var n=e.config,r=e.markDef,i=e.width,a=e.height;var o=r.orient;var u=o==="horizontal"?"width":"height";var s=o==="horizontal"?"height":"width";return I["__assign"]({},MB(e,{size:"ignore",orient:"ignore"}),HB("x",e,EB(i),"xc"),HB("y",e,EB(a),"yc"),RB("size",e,{defaultValue:zQ(e),vgChannel:u}),(t={},t[s]={value:r.thickness||n.tick.thickness},t))}};function zQ(e){var t=e.config,n=e.markDef;var r=n.orient;var i=e.getScaleComponent(r==="horizontal"?"x":"y");if(n.size!==undefined){return n.size}else if(t.tick.bandSize!==undefined){return t.tick.bandSize}else{var a=i?i.get("range"):undefined;var o=a&&nB(a)?a.step:t.scale.rangeStep;if(typeof o!=="number"){throw new Error("Function does not handle non-numeric rangeStep")}return o/1.5}}var TQ={area:lQ,bar:fQ,circle:_Q,geoshape:pQ,line:vQ,point:bQ,rect:kQ,rule:jQ,square:xQ,text:SQ,tick:AQ,trail:gQ};function MQ(e){if(PI([Iq,Rq,Wq],e.mark)){return DQ(e)}else{return PQ(e)}}var NQ="faceted_path_";function DQ(e){var t=RQ(e.mark,e.encoding);var n=PQ(e,{fromPrefix:t.length>0?NQ:""});if(t.length>0){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:NQ+e.requestDataName(KH),data:e.requestDataName(KH),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]}else{return n}}function CQ(e){var t=e.encoding,n=e.stack,r=e.mark,i=e.markDef;var a=t.order;if(!Object(V["isArray"])(a)&&pW(a)){return undefined}else if((Object(V["isArray"])(a)||dW(a))&&!n){return rG(a,{expr:"datum"})}else if(Jq(r)){var o=t[i.orient==="horizontal"?"y":"x"];if(dW(o)){var u=o.sort;var s=gB(u)?mW({aggregate:qW(e.encoding)?u.op:undefined,field:u.field},{expr:"datum"}):mW(o,{binSuffix:e.stack&&e.stack.impute?"mid":undefined,expr:"datum"});return{field:s,order:"descending"}}return undefined}return undefined}function PQ(e,t){if(t===void 0){t={fromPrefix:""}}var n=e.mark;var r=e.markDef.clip!==undefined?!!e.markDef.clip:LQ(e);var i=YB(e.markDef);var a=e.encoding.key;var o=CQ(e);var u=TQ[n].postEncodingTransform?TQ[n].postEncodingTransform(e):null;return[I["__assign"]({name:e.getName("marks"),type:TQ[n].vgMark},r?{clip:true}:{},i?{style:i}:{},a?{key:{field:a.field}}:{},o?{sort:o}:{},{from:{data:t.fromPrefix+e.requestDataName(KH)},encode:{update:TQ[n].encodeEntry(e)}},u?{transform:u}:{})]}function RQ(e,t){return YI(t).reduce(function(n,r){switch(r){case"x":case"y":case"order":case"tooltip":case"href":case"x2":case"y2":case"latitude":case"longitude":case"latitude2":case"longitude2":case"text":case"shape":return n;case"detail":case"key":var i=t[r];if(i){(Object(V["isArray"])(i)?i:[i]).forEach(function(e){if(!e.aggregate){n.push(mW(e,{}))}})}return n;case"size":if(e==="trail"){return n}case"color":case"fill":case"stroke":case"opacity":var a=zW(t[r]);if(a&&!a.aggregate){n.push(mW(a,{}))}return n;default:throw new Error("Bug: Channel "+r+" unimplemented for line mark")}},[])}function LQ(e){var t=e.getScaleComponent("x");var n=e.getScaleComponent("y");return t&&t.get("domainRaw")||n&&n.get("domainRaw")?true:false}var IQ=function(e){I["__extends"](t,e);function t(t,n,r,i,a,o,u){if(i===void 0){i={}}var s=e.call(this,t,n,r,o,a,undefined)||this;s.fit=u;s.type="unit";s.specifiedScales={};s.specifiedAxes={};s.specifiedLegends={};s.specifiedProjection={};s.selection={};s.children=[];s.initSize(I["__assign"]({},i,t.width?{width:t.width}:{},t.height?{height:t.height}:{}));var l=Zq(t.mark)?t.mark.type:t.mark;var f=s.encoding=UW(kJ(t.encoding||{},a),l);s.markDef=iQ(t.mark,f,o);s.stack=mH(l,f,s.config.stack);s.specifiedScales=s.initScales(l,f);s.specifiedAxes=s.initAxes(f);s.specifiedLegends=s.initLegend(f);s.specifiedProjection=t.projection;s.selection=t.selection;return s}Object.defineProperty(t.prototype,"hasProjection",{get:function(){var e=this.encoding;var t=this.mark===Bq;var n=e&&YF.some(function(t){return dW(e[t])});return t||n},enumerable:true,configurable:true});t.prototype.scaleDomain=function(e){var t=this.specifiedScales[e];return t?t.domain:undefined};t.prototype.axis=function(e){return this.specifiedAxes[e]};t.prototype.legend=function(e){return this.specifiedLegends[e]};t.prototype.initScales=function(e,t){return Eq.reduce(function(e,n){var r;var i;var a=t[n];if(dW(a)){r=a;i=a.scale}else if(fW(a)){r=a.condition;i=a.condition["scale"]}else if(n==="x"){r=zW(t.x2)}else if(n==="y"){r=zW(t.y2)}if(r){e[n]=i||{}}return e},{})};t.prototype.initAxes=function(e){return[jF,SF].reduce(function(t,n){var r=e[n];if(dW(r)||n===jF&&dW(e.x2)||n===SF&&dW(e.y2)){var i=dW(r)?r.axis:null;if(i!==null&&i!==false){t[n]=I["__assign"]({},i)}}return t},{})};t.prototype.initLegend=function(e){return jq.reduce(function(t,n){var r=e[n];if(r){var i=dW(r)?r.legend:fW(r)?r.condition["legend"]:null;if(i!==null&&i!==false){t[n]=I["__assign"]({},i)}}return t},{})};t.prototype.parseData=function(){this.component.data=NJ(this)};t.prototype.parseLayoutSize=function(){bJ(this)};t.prototype.parseSelection=function(){this.component.selection=hX(this,this.selection)};t.prototype.parseMarkGroup=function(){this.component.mark=MQ(this)};t.prototype.parseAxisAndHeader=function(){this.component.axes=JJ(this)};t.prototype.assembleSelectionTopLevelSignals=function(e){return vX(this,e)};t.prototype.assembleSelectionSignals=function(){return pX(this,[])};t.prototype.assembleSelectionData=function(e){return gX(this,e)};t.prototype.assembleLayout=function(){return null};t.prototype.assembleLayoutSignals=function(){return OG(this)};t.prototype.assembleMarks=function(){var e=this.component.mark||[];if(!this.parent||!wY(this.parent)){e=mX(this,e)}return e.map(this.correctDataNames)};t.prototype.assembleLayoutSize=function(){return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}};t.prototype.getMapping=function(){return this.encoding};t.prototype.toSpec=function(e,t){var n=QI(this.encoding);var r;r={mark:this.markDef,encoding:n};if(!e){r.config=QI(this.config)}if(!t){r.data=QI(this.data)}return r};Object.defineProperty(t.prototype,"mark",{get:function(){return this.markDef.type},enumerable:true,configurable:true});t.prototype.channelHasField=function(e){return FW(this.encoding,e)};t.prototype.fieldDef=function(e){var t=this.encoding[e];return zW(t)};return t}(SY);var FQ=function(e){I["__extends"](t,e);function t(n,r,i,a,o,u,s){var l=e.call(this,n,r,i,u,o,n.resolve)||this;l.type="layer";var f=I["__assign"]({},a,n.width?{width:n.width}:{},n.height?{height:n.height}:{});l.initSize(f);l.children=n.layer.map(function(e,n){if(_H(e)){return new t(e,l,l.getName("layer_"+n),f,o,u,s)}if(bH(e)){return new IQ(e,l,l.getName("layer_"+n),f,o,u,s)}throw new Error(yU.INVALID_SPEC)});return l}t.prototype.parseData=function(){this.component.data=NJ(this);for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseData()}};t.prototype.parseLayoutSize=function(){pJ(this)};t.prototype.parseSelection=function(){var e=this;this.component.selection={};var t=function(t){t.parseSelection();YI(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})};for(var n=0,r=this.children;n<r.length;n++){var i=r[n];t(i)}};t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseMarkGroup()}};t.prototype.parseAxisAndHeader=function(){ZJ(this)};t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)};t.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleSelectionSignals())},[])};t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},OG(this))};t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},e)};t.prototype.assembleTitle=function(){var t=e.prototype.assembleTitle.call(this);if(t){return t}for(var n=0,r=this.children;n<r.length;n++){var i=r[n];t=i.assembleTitle();if(t){return t}}return undefined};t.prototype.assembleLayout=function(){return null};t.prototype.assembleMarks=function(){return yX(this,qI(this.children.map(function(e){return e.assembleMarks()})))};t.prototype.assembleLegends=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLegends())},QG(this))};return t}(jY);var qQ=function(e){I["__extends"](t,e);function t(t,n,r,i,a){var o=e.call(this,t,n,r,a,i,t.resolve)||this;o.type="repeat";if(t.resolve&&t.resolve.axis&&(t.resolve.axis.x==="shared"||t.resolve.axis.y==="shared")){vU(yU.REPEAT_CANNOT_SHARE_AXIS)}o.repeat=t.repeat;o.children=o._initChildren(t,o.repeat,i,a);return o}t.prototype._initChildren=function(e,t,n,r){var i=[];var a=t.row||[n?n.row:null];var o=t.column||[n?n.column:null];for(var u=0,s=a;u<s.length;u++){var l=s[u];for(var f=0,c=o;f<c.length;f++){var d=c[f];var h=(l?"_"+l:"")+(d?"_"+d:"");var p={row:l,column:d};i.push(UQ(e.spec,this,this.getName("child"+h),undefined,p,r,false))}}return i};t.prototype.parseLayoutSize=function(){vJ(this)};t.prototype.assembleDefaultLayout=function(){return{columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}};return t}(DJ);function UQ(e,t,n,r,i,a,o){if(yH(e)){return new AJ(e,t,n,i,a)}if(_H(e)){return new FQ(e,t,n,r,i,a,o)}if(bH(e)){return new IQ(e,t,n,r,i,a,o)}if(xH(e)){return new qQ(e,t,n,i,a)}if(kH(e)){return new CJ(e,t,n,i,a)}throw new Error(yU.INVALID_SPEC)}function WQ(e,t){if(t===void 0){t={}}if(t.logger){hU(t.logger)}if(t.fieldTitle){jW(t.fieldTitle)}try{var n=oH(UI({},t.config,e.config));var r=jH(e,n);var i=$H(e.autosize,n.autosize,_H(r)||bH(r));var a=UQ(r,null,"",undefined,undefined,n,i.type==="fit");a.parse();z$(a.component.data);return HQ(a,VQ(e,n,i))}finally{if(t.logger){pU()}if(t.fieldTitle){SW()}}}function VQ(e,t,n){return I["__assign"]({autosize:YI(n).length===1&&n.type?n.type:n},XH(t),XH(e))}function HQ(e,t){var n=e.config?fH(e.config):undefined;var r=[].concat(e.assembleSelectionData([]),hJ(e.component.data,t.datasets||{}));delete t.datasets;var i=e.assembleProjections();var a=e.assembleTitle();var o=e.assembleGroupStyle();var u=e.assembleLayoutSignals();u=u.filter(function(e){if((e.name==="width"||e.name==="height")&&e.value!==undefined){t[e.name]=+e.value;return false}return true});var s=I["__assign"]({$schema:"https://vega.github.io/schema/vega/v3.json"},e.description?{description:e.description}:{},t,a?{title:a}:{},o?{style:o}:{},{data:r},i.length>0?{projections:i}:{},e.assembleGroup(u.concat(e.assembleSelectionTopLevelSignals([]))),n?{config:n}:{});return{spec:s}}var BQ=n("1uk8");var GQ={text:["text"],line:["x","y"],trail:["x","y"],area:["x","y"]};var $Q={bar:Object(V["toSet"])(["row","column","x","y","size","color","fill","stroke","detail"]),line:Object(V["toSet"])(["row","column","x","y","color","fill","stroke","color","detail"]),trail:Object(V["toSet"])(["row","column","x","y","color","fill","stroke","color","detail","size"]),area:Object(V["toSet"])(["row","column","x","y","color","fill","stroke","detail"]),tick:Object(V["toSet"])(["row","column","x","y","color","fill","stroke","detail"]),circle:Object(V["toSet"])(["row","column","x","y","color","fill","stroke","size","detail"]),square:Object(V["toSet"])(["row","column","x","y","color","fill","stroke","size","detail"]),point:Object(V["toSet"])(["row","column","x","y","color","fill","stroke","size","detail","shape"]),geoshape:Object(V["toSet"])(["row","column","color","fill","stroke","detail","shape"]),text:Object(V["toSet"])(["row","column","size","color","fill","stroke","text"])};function YQ(e,t,n){if(t===void 0){t=GQ}if(n===void 0){n=$Q}var r=Zq(e.mark)?e.mark.type:e.mark;var i=e.encoding;var a=t[r];var o=n[r];for(var u in a){if(!(a[u]in i)){return'Missing encoding channel "'+a[u]+'" for mark "'+r+'"'}}for(var s in i){if(!o[s]){return'Encoding channel "'+s+'" is not supported by mark type "'+r+'"'}}if(r===Lq&&!i.x&&!i.y){return"Missing both x and y for bar"}return null}var XQ=n("9koE");var JQ=XQ.version;var QQ=n("gatG");var ZQ=n.n(QQ);var KQ="#4572a7";var eZ={background:"#fff",arc:{fill:KQ},area:{fill:KQ},line:{stroke:KQ,strokeWidth:2},path:{stroke:KQ},rect:{fill:KQ},shape:{stroke:KQ},symbol:{fill:KQ,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:true,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:false,tickExtra:true},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}};var tZ=eZ;var nZ="#000";var rZ={group:{fill:"#e5e5e5"},arc:{fill:nZ},area:{fill:nZ},line:{stroke:nZ},path:{stroke:nZ},rect:{fill:nZ},shape:{stroke:nZ},symbol:{fill:nZ,size:40},axis:{domain:false,grid:true,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}};var iZ=rZ;var aZ="#ab5787";var oZ="#979797";var uZ={background:"#f9f9f9",arc:{fill:aZ},area:{fill:aZ},line:{stroke:aZ},path:{stroke:aZ},rect:{fill:aZ},shape:{stroke:aZ},symbol:{fill:aZ,size:30},axis:{domainColor:oZ,domainWidth:.5,gridWidth:.2,labelColor:oZ,tickColor:oZ,tickWidth:.2,titleColor:oZ},axisBand:{grid:false},axisX:{grid:true,tickSize:10},axisY:{domain:false,grid:true,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}};var sZ=uZ;var lZ="#3e5c69";var fZ={background:"#fff",arc:{fill:lZ},area:{fill:lZ},line:{stroke:lZ},path:{stroke:lZ},rect:{fill:lZ},shape:{stroke:lZ},symbol:{fill:lZ},axis:{domainWidth:.5,grid:true,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:false},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}};var cZ=fZ;var dZ="#fff";var hZ="#aaa";var pZ={background:"#333",title:{color:dZ},style:{"guide-label":{fill:dZ},"guide-title":{fill:dZ}},axis:{domainColor:dZ,gridColor:hZ,tickColor:dZ}};var vZ=pZ;var gZ="#30a2da";var mZ="#cbcbcb";var yZ="#f0f0f0";var bZ={arc:{fill:gZ},area:{fill:gZ},axisBand:{grid:false},axisBottom:{domain:false,domainColor:"black",domainWidth:3,grid:true,gridColor:mZ,gridWidth:1,labelFontSize:12,labelPadding:4,tickColor:mZ,tickSize:10,titleFontSize:14,titlePadding:10},axisLeft:{domainColor:mZ,domainWidth:1,gridColor:mZ,gridWidth:1,labelFontSize:12,labelPadding:4,tickColor:mZ,tickSize:10,ticks:true,titleFontSize:14,titlePadding:10},axisRight:{domainColor:mZ,domainWidth:1,gridColor:mZ,gridWidth:1,labelFontSize:12,labelPadding:4,tickColor:mZ,tickSize:10,ticks:true,titleFontSize:14,titlePadding:10},axisTop:{domain:false,domainColor:"black",domainWidth:3,grid:true,gridColor:mZ,gridWidth:1,labelFontSize:12,labelPadding:4,tickColor:mZ,tickSize:10,titleFontSize:14,titlePadding:10},background:yZ,group:{fill:yZ},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleFontSize:14,titlePadding:10},line:{stroke:gZ,strokeWidth:2},path:{stroke:gZ,strokeWidth:.5},point:{filled:true},rect:{fill:gZ},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},symbol:{opacity:1,shape:"circle",size:40,strokeWidth:1},shape:{stroke:gZ},style:{bar:{binSpacing:2,fill:gZ,stroke:null}},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}};var _Z=bZ;var xZ="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0,0,0,0.1);\n\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black;\n}\n#vg-tooltip-element.visible {\n  visibility: visible;\n}\n#vg-tooltip-element h2 {\n  margin-top: 0;\n  margin-bottom: 10px;\n  font-size: 13px;\n}\n#vg-tooltip-element table {\n  border-spacing: 0;\n}\n#vg-tooltip-element td {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-top: 2px;\n  padding-bottom: 2px;\n}\n#vg-tooltip-element td.key {\n  color: #808080;\n  max-width: 150px;\n  text-align: right;\n  padding-right: 4px;\n}\n#vg-tooltip-element td.value {\n  display: block;\n  max-width: 300px;\n  max-height: 7em;\n  text-align: left;\n}\n\n/* Dark and light color themes */\n#vg-tooltip-element.dark-theme {\n  background-color: rgba(32, 32, 32, 0.9);\n  border: 1px solid #f5f5f5;\n  color: white;\n}\n#vg-tooltip-element.dark-theme td.key {\n  color: #bfbfbf;\n}\n\n#vg-tooltip-element.light-theme {\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black;\n}\n#vg-tooltip-element.light-theme td.key {\n  color: #808080;\n}";var kZ="vg-tooltip-element";var OZ={offsetX:10,offsetY:10,id:kZ,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:false,sanitize:wZ,maxDepth:2};function wZ(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function jZ(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e)){throw new Error("Invalid HTML ID")}return xZ.toString().replace(kZ,e)}function SZ(e,t,n){if(Object(V["isArray"])(e)){return"["+e.map(function(e){return t(Object(V["isString"])(e)?e:AZ(e,n))}).join(", ")+"]"}if(Object(V["isObject"])(e)){var r="";var i=e,a=i.title,o=I["__rest"](i,["title"]);if(a){r+="<h2>"+t(a)+"</h2>"}var u=Object.keys(o);if(u.length>0){r+="<table>";for(var s=0,l=u;s<l.length;s++){var f=l[s];var c=o[f];if(Object(V["isObject"])(c)){c=AZ(c,n)}r+='<tr><td class="key">'+t(f)+':</td><td class="value">'+t(c)+"</td></tr>"}r+="</table>"}return r||"{}"}return t(e)}function EZ(e){var t=[];return function(n,r){if(typeof r!=="object"||r===null){return r}var i=t.indexOf(this)+1;t.length=i;if(t.length>e){return"[Object]"}if(t.indexOf(r)>=0){return"[Circular]"}t.push(r);return r}}function AZ(e,t){return JSON.stringify(e,EZ(t))}function zZ(e,t,n,r){var i=e.clientX+n;if(i+t.width>window.innerWidth){i=+e.clientX-n-t.width}var a=e.clientY+r;if(a+t.height>window.innerHeight){a=+e.clientY-r-t.height}return{x:i,y:a}}var TZ=function(){function e(e){this.options=I["__assign"]({},OZ,e);var t=this.options.id;this.call=this.tooltip_handler.bind(this);if(!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){var n=document.createElement("style");n.setAttribute("id",this.options.styleId);n.innerHTML=jZ(t);if(document.head.childNodes.length>0){document.head.insertBefore(n,document.head.childNodes[0])}else{document.head.appendChild(n)}}this.el=document.getElementById(t);if(!this.el){this.el=document.createElement("div");this.el.setAttribute("id",t);this.el.classList.add("vg-tooltip");document.body.appendChild(this.el)}}e.prototype.tooltip_handler=function(e,t,n,r){if(r==null||r===""){this.el.classList.remove("visible",this.options.theme+"-theme");return}this.el.innerHTML=SZ(r,this.options.sanitize,this.options.maxDepth);this.el.classList.add("visible",this.options.theme+"-theme");var i=zZ(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY),a=i.x,o=i.y;this.el.setAttribute("style","top: "+o+"px; left: "+a+"px")};return e}();var MZ=function(e,t){var n=new TZ(t);e.tooltip(n.call).run();return n};function NZ(e,t,n){var r=e.open(t);var i=1e4;var a=250;var o=~~(i/a);function u(t){if(t.source===r){o=0;e.removeEventListener("message",u,false)}}e.addEventListener("message",u,false);function s(){if(o<=0){return}r.postMessage(n,"*");setTimeout(s,a);o-=1}setTimeout(s,a)}var DZ=".vega-embed {\n  position: relative;\n  display: inline-block;\n  padding-right: 38px;\n}\n\n.vega-embed .vega-actions-wrapper {\n  display: inline-flex;\n  position: absolute;\n  top: 0;\n  right: 0;\n  padding: 6px;\n  z-index: 1000;\n\n  opacity: 0.2;\n  background: white;\n  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n  color: #1b1e23;\n  border: 1px solid #aaa;\n  border-radius: 999px;\n  transition: opacity 0.4s ease-in;\n}\n\n.vega-embed:hover .vega-actions-wrapper {\n  transition: opacity 0.2s ease;\n  opacity: 1;\n}\n\n.vega-embed .vega-actions {\n  position: absolute;\n  top: 0;\n  right: 0;\n  display: none;\n  flex-direction: column;\n\n  padding-bottom: 8px;\n  padding-top: 8px;\n  border-radius: 4px;\n  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n  border: 1px solid #d9d9d9;\n  background: white;\n}\n\n.vega-embed .vega-actions-wrapper:hover {\n  background: transparent;\n  color: transparent;\n  border: none;\n  box-shadow: none;\n}\n\n.vega-embed .vega-actions-wrapper:hover .vega-actions {\n  display: flex;\n}\n\n.vega-embed .vega-actions a {\n  padding: 8px 16px;\n  font-family: sans-serif;\n  font-size: 14px;\n  font-weight: 600;\n  white-space: nowrap;\n  color: #434a56;\n  text-decoration: none;\n}\n\n.vega-embed .vega-actions a:hover {\n  background-color: #f7f7f9;\n  color: #1b1e23;\n}";function CZ(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}for(var r=0,i=t;r<i.length;r++){var a=i[r];e=PZ(e,a)}return e}function PZ(e,t){if(typeof t!=="object"||t===null){return e}for(var n in t){if(!t.hasOwnProperty(n)){continue}if(t[n]===undefined){continue}if(typeof t[n]!=="object"||Object(V["isArray"])(t[n])||t[n]===null){e[n]=t[n]}else if(typeof e[n]!=="object"||e[n]===null){e[n]=CZ(Object(V["isArray"])(t[n].constructor)?[]:{},t[n])}else{CZ(e[n],t[n])}}return e}if(!String.prototype.startsWith){String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}}function RZ(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("//")}n.d(t,"vega",function(){return LZ});n.d(t,"vl",function(){return IZ});n.d(t,"guessMode",function(){return GZ});n.d(t,"default",function(){return YZ});var LZ=d;var IZ=R;var FZ={vega:"Vega","vega-lite":"Vega-Lite"};var qZ={vega:LZ.version,"vega-lite":IZ?IZ.version:"not available"};var UZ={vega:function(e,t){return e},"vega-lite":function(e,t){return IZ.compile(e,{config:t}).spec}};var WZ='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" width="14" height="14">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>';var VZ={COMPILED_ACTION:"View Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"};function HZ(e){return typeof e==="function"}function BZ(e,t,n,r){var i="<html><head>"+t+'</head><body><pre><code class="json">';var a="</code></pre>"+n+"</body></html>";var o=window.open("");o.document.write(i+e+a);o.document.title=FZ[r]+" JSON Source"}function GZ(e,t){if(e.$schema){var n=ZQ()(e.$schema);if(t&&t!==n.library){console.warn("The given visualization spec is written in "+FZ[n.library]+", but mode argument sets "+FZ[t]+".")}var r=n.library;if(!Object(W["satisfies"])(qZ[r],"^"+n.version.slice(1))){console.warn("The input spec uses "+r+" "+n.version+", but the current version of "+FZ[r]+" is "+qZ[r]+".")}return r}else{if("mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e){return"vega-lite"}if("marks"in e||"signals"in e||"scales"in e||"axes"in e){return"vega"}}return t||"vega"}function $Z(e){return!!(e&&"load"in e)}function YZ(e,t,n){if(n===void 0){n={}}return I["__awaiter"](this,void 0,void 0,function(){var r,i,a,o,u,s,l,s,f,c,d,h,p,v,g,m,y,b,_,x,k,O,w,j;return I["__generator"](this,function(S){switch(S.label){case 0:n=n||{};r=n.actions===true||n.actions===false?n.actions:CZ({},{export:{svg:true,png:true},source:true,compiled:false,editor:true},n.actions||{});i=I["__assign"]({},VZ,n.i18n);a=$Z(n.loader)?n.loader:LZ.loader(n.loader);o=n.renderer||"canvas";u=n.logLevel||LZ.Warn;if(!LZ.isString(t))return[3,2];return[4,a.load(t)];case 1:s=S.sent();return[2,YZ(e,JSON.parse(s),n)];case 2:l=n.config||{};if(!LZ.isString(l))return[3,4];return[4,a.load(l)];case 3:s=S.sent();return[2,YZ(e,t,I["__assign"]({},n,{config:JSON.parse(s)}))];case 4:if(n.defaultStyle){f="vega-embed-style";if(!document.getElementById(f)){c=document.createElement("style");c.id=f;c.innerText=n.defaultStyle===true?(DZ||"").toString():n.defaultStyle;document.getElementsByTagName("head")[0].appendChild(c)}}if(n.theme){l=CZ({},L[n.theme],l)}d=GZ(t,n.mode);h=UZ[d](t,l);if(d==="vega-lite"){if(h.$schema){p=ZQ()(h.$schema);if(!Object(W["satisfies"])(qZ.vega,"^"+p.version.slice(1))){console.warn("The compiled spec uses Vega "+p.version+", but current version is "+qZ.vega+".")}}}v=F["select"](e).classed("vega-embed",true).html("");if(n.onBeforeParse){h=n.onBeforeParse(h)}g=LZ.parse(h,d==="vega-lite"?{}:l);m=new LZ.View(g,{loader:a,logLevel:u,renderer:o}).initialize(e);if(n.tooltip!==false){y=void 0;if(HZ(n.tooltip)){y=n.tooltip}else{y=new TZ(n.tooltip===true?{}:n.tooltip).call}m.tooltip(y)}if(n.hover===undefined?d!=="vega-lite":n.hover){m.hover()}if(n){if(n.width){m.width(n.width)}if(n.height){m.height(n.height)}if(n.padding){m.padding(n.padding)}}if(!n.runAsync)return[3,6];return[4,m.runAsync()];case 5:S.sent();return[3,7];case 6:m.run();S.label=7;case 7:if(r!==false){b=v.append("div").attr("class","vega-actions-wrapper");if(n.defaultStyle===true){b.html(WZ)}_=b.insert("div").attr("class","vega-actions");if(r===true||r.export!==false){x=function(e){if(r===true||r.export===true||r.export[e]){var t=i[e.toUpperCase()+"_ACTION"];_.append("a").text(t).attr("href","#").attr("target","_blank").attr("download","visualization."+e).on("mousedown",function(){var t=this;m.toImageURL(e,n.scaleFactor).then(function(e){t.href=e}).catch(function(e){throw e});F["event"].preventDefault()})}};for(k=0,O=["svg","png"];k<O.length;k++){w=O[k];x(w)}}if(r===true||r.source!==false){_.append("a").text(i.SOURCE_ACTION).attr("href","#").on("click",function(){BZ(U()(t),n.sourceHeader||"",n.sourceFooter||"",d);F["event"].preventDefault()})}if(d==="vega-lite"&&(r===true||r.compiled!==false)){_.append("a").text(i.COMPILED_ACTION).attr("href","#").on("click",function(){BZ(U()(h),n.sourceHeader||"",n.sourceFooter||"","vega");F["event"].preventDefault()})}if(r===true||r.editor!==false){j=n.editorUrl||"https://vega.github.io/editor/";_.append("a").text(i.EDITOR_ACTION).attr("href","#").on("click",function(){NZ(window,j,{config:l,mode:d,renderer:o,spec:U()(t)});F["event"].preventDefault()})}}return[2,{view:m,spec:t}]}})})}},gatG:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});function r(e){var t=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g;var n=t.exec(e).slice(1,3),r=n[0],i=n[1];return{library:r,version:i}}t.default=r},xJ3j:function(e){e.exports={a:"4.2.0"}}}]);
//# sourceMappingURL=vendors~vega.d3f2c28d85aee0b9c378.js.map